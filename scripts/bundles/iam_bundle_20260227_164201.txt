====================================================================================================
IAM PORTFOLIO — CODE BUNDLE
====================================================================================================
Generated : 2026-02-27 16:42:01
Root      : C:\Users\n.khromenok\AppData\Local\Temp\IAM
Files     : 52
====================================================================================================

TABLE OF CONTENTS
----------------------------------------------------------------------------------------------------
    1. CLAUDE.md
    2. README.md
    3. bundler.py
    4. eslint.config.js
    5. index.html
    6. package.json
    7. tsconfig.app.json
    8. tsconfig.json
    9. tsconfig.node.json
   10. vite.config.ts
   11. scripts\bundler.py
   12. src\App.tsx
   13. src\index.css
   14. src\main.tsx
   15. src\components\CodeShowcase.tsx
   16. src\components\DataBookDemo.tsx
   17. src\components\DemoAIHub.tsx
   18. src\components\DemoAutoprotocol.tsx
   19. src\components\DemoCostManager.tsx
   20. src\components\ProductCard.tsx
   21. src\components\Reveal.tsx
   22. src\components\sminex\AnalyticsScreen.tsx
   23. src\components\sminex\ArchitectureModal.tsx
   24. src\components\sminex\AssignModal.tsx
   25. src\components\sminex\BillsScreen.tsx
   26. src\components\sminex\BookingScreen.tsx
   27. src\components\sminex\BottomNav.tsx
   28. src\components\sminex\CamerasScreen.tsx
   29. src\components\sminex\CreateRequestModal.tsx
   30. src\components\sminex\DashboardScreen.tsx
   31. src\components\sminex\DiscoveryModal.tsx
   32. src\components\sminex\FloorPlanScreen.tsx
   33. src\components\sminex\IntercomScreen.tsx
   34. src\components\sminex\NotificationsScreen.tsx
   35. src\components\sminex\PackagesScreen.tsx
   36. src\components\sminex\ParkingScreen.tsx
   37. src\components\sminex\PhoneFrame.tsx
   38. src\components\sminex\PrivilegesScreen.tsx
   39. src\components\sminex\ProfileScreen.tsx
   40. src\components\sminex\ProjectSelector.tsx
   41. src\components\sminex\RequestDetailScreen.tsx
   42. src\components\sminex\RequestsScreen.tsx
   43. src\components\sminex\RoleSelectScreen.tsx
   44. src\components\sminex\ServicesScreen.tsx
   45. src\components\sminex\SmartHomeScreen.tsx
   46. src\components\sminex\SubScreenHeader.tsx
   47. src\components\sminex\Toast.tsx
   48. src\data\prescriptions.ts
   49. src\data\products.ts
   50. src\data\sminex.ts
   51. src\hooks\useReveal.ts
   52. src\pages\SminexDemo.tsx

====================================================================================================


####################################################################################################
# DIR: .
####################################################################################################

====================================================================================================
FILE [1/52]: CLAUDE.md
Size: 2,082 bytes
====================================================================================================

# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Build & Development Commands

```bash
npm run dev        # Start Vite dev server with HMR (port 3001)
npm run build      # TypeScript check (tsc -b) + Vite production build → ./dist/
npm run lint       # ESLint on all .ts/.tsx files
npm run preview    # Preview production build locally
```

Dev server runs on **http://localhost:3001**.

No test framework is configured.

## Architecture

React 19 + TypeScript 5.9 + Tailwind CSS v4 + Vite 7 single-page portfolio application. All content is in Russian.

**App structure:** `App.tsx` is a monolithic file containing all page sections (Nav, Hero, Competence, Products, Architecture, BusinessValue, Methodology, Research, Career, Contact) as inline function components. Navigation uses hash-based anchor links with smooth scrolling — no router library.

**Product demos:** Four interactive modal components in `src/components/` — `DataBookDemo`, `DemoAIHub`, `DemoCostManager`, `DemoAutoprotocol`. Each is a self-contained modal with internal state, sidebar navigation, and multiple screens. Opened via `ProductCard` component.

**Data layer:** Static data only, no API calls. Product definitions live in `src/data/products.ts`, demo data in `src/data/prescriptions.ts`.

**State management:** Local `useState` only — no global store.

**Styling:** Tailwind v4 with custom dark theme defined in `@theme` block in `src/index.css`. Color palette uses custom tokens (bg, surface, accent, text-primary, text-muted). Font: Inter via Google Fonts.

## Key Files

- `src/App.tsx` — All page sections (~526 lines)
- `src/components/ProductCard.tsx` — Expandable product card with animated grid expand/collapse
- `src/components/DataBookDemo.tsx`, `DemoAIHub.tsx`, `DemoCostManager.tsx`, `DemoAutoprotocol.tsx` — Product demo modals
- `src/data/products.ts` — Product type definition and product array
- `src/index.css` — Tailwind theme config and custom animations

====================================================================================================
END: CLAUDE.md
====================================================================================================

====================================================================================================
FILE [2/52]: README.md
Size: 2,628 bytes
====================================================================================================

# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type-aware lint rules:

```js
export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...

      // Remove tseslint.configs.recommended and replace with this
      tseslint.configs.recommendedTypeChecked,
      // Alternatively, use this for stricter rules
      tseslint.configs.strictTypeChecked,
      // Optionally, add this for stylistic rules
      tseslint.configs.stylisticTypeChecked,

      // Other configs...
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```

You can also install [eslint-plugin-react-x](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-x) and [eslint-plugin-react-dom](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-dom) for React-specific lint rules:

```js
// eslint.config.js
import reactX from 'eslint-plugin-react-x'
import reactDom from 'eslint-plugin-react-dom'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...
      // Enable lint rules for React
      reactX.configs['recommended-typescript'],
      // Enable lint rules for React DOM
      reactDom.configs.recommended,
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```

====================================================================================================
END: README.md
====================================================================================================

====================================================================================================
FILE [3/52]: bundler.py
Size: 16,301 bytes
====================================================================================================

"""
WhisperX Pipeline - Code Bundler
Собирает кодовую базу проекта в один текстовый файл для анализа.
Использует git для определения tracked файлов, игнорирует мусорные файлы.
"""

import os
import subprocess
from pathlib import Path
from datetime import datetime
from typing import List

# --- НАСТРОЙКИ ---
# Корневая папка проекта (где находится .git)
PROJECT_ROOT = Path(__file__).parent.parent.absolute()

# Папка для сохранения bundle файлов
OUTPUT_DIR = PROJECT_ROOT / "scripts" / "bundles"

# Имя выходного файла (с timestamp)
OUTPUT_FILENAME = f"codebase_bundle_{datetime.now().strftime('%Y%m%d_%H%M%S')}.txt"

# Разрешенные расширения файлов (релевантные для проекта)
ALLOWED_EXTENSIONS = {
    # Backend Python
    ".py",          # Python код
    ".pyi",         # Python type stubs
    ".toml",        # pyproject.toml
    ".ini",         # alembic.ini, configs
    ".cfg",         # setup.cfg

    # Frontend (если появится)
    ".js", ".jsx",  # JavaScript
    ".ts", ".tsx",  # TypeScript
    ".vue",         # Vue.js
    ".json",        # package.json, configs
    ".css",         # Стили
    ".scss", ".sass",
    ".html",        # HTML templates

    # DevOps
    ".yml", ".yaml",    # Docker Compose, CI/CD
    ".dockerfile",      # Dockerfile
    ".sh",              # Shell scripts
    ".ps1",             # PowerShell scripts
    ".bat",             # Batch scripts

    # Документация
    ".md",          # Markdown

    # Конфиги
    ".gitignore",
    ".editorconfig",
    ".dockerignore",
}

# Файлы без расширения или с особыми именами
ALLOWED_FILENAMES = {
    "Dockerfile",
    "Makefile",
    ".env.example",
    "requirements.txt",
    "requirements-dev.txt",
    "requirements-extra.txt",
    "requirements-docker.txt",
    "setup.py",
    "CLAUDE.md",
}

# Игнорируемые папки (даже если в git)
IGNORED_DIR_NAMES = {
    # Python
    "__pycache__",
    ".pytest_cache",
    ".mypy_cache",
    ".ruff_cache",
    "htmlcov",
    ".venv", "venv", "env",
    "dist", "build",
    ".eggs",
    "*.egg-info",

    # Node
    "node_modules",

    # Project specific
    "output",           # Результаты транскрипции
    "bundles",          # Выходные bundle файлы
    "legacy",           # Устаревшие скрипты
    ".playwright-mcp",  # Playwright временные файлы

    # IDE
    ".idea",
    ".vscode",
}

# Игнорируемые паттерны/суффиксы файлов
IGNORED_FILE_PATTERNS = {
    # Python compiled
    ".pyc", ".pyo", ".pyd",

    # Libraries
    ".so", ".dll", ".dylib",
    ".egg-info",

    # Logs
    ".log",

    # Databases
    ".db", ".sqlite", ".sqlite3",

    # Secrets (ВАЖНО!)
    ".env",

    # System
    ".DS_Store",
    "Thumbs.db",
    ".coverage",

    # Minified
    ".min.js",
    ".min.css",

    # Media (WhisperX specific)
    ".mp4", ".mp3", ".wav", ".m4a", ".ogg", ".flac", ".webm", ".avi", ".mkv",
    ".mov", ".wmv", ".aac", ".wma",

    # Documents (output files)
    ".docx", ".doc", ".pdf", ".xlsx", ".xls",

    # Images
    ".png", ".jpg", ".jpeg", ".gif", ".bmp", ".ico", ".svg", ".webp",

    # Archives
    ".zip", ".tar", ".gz", ".rar", ".7z",

    # Models/weights
    ".pt", ".pth", ".onnx", ".bin", ".safetensors",
}

# Игнорируемые имена файлов
IGNORED_FILENAMES = {
    "package-lock.json",
    "poetry.lock",
    "yarn.lock",
    "pnpm-lock.yaml",
    "uv.lock",
    "nul",               # Windows null file
}

# Максимальный размер файла в байтах (5 MB)
MAX_FILE_SIZE = 5 * 1024 * 1024

# --- КОНЕЦ НАСТРОЕК ---


def get_git_tracked_files(include_untracked: bool = False) -> List[Path]:
    """
    Получает список файлов из git.

    Args:
        include_untracked: Также включить untracked файлы (новые, не добавленные в git)

    Returns:
        List[Path]: Список путей к файлам
    """
    files = []

    try:
        # Tracked files
        result = subprocess.run(
            ["git", "ls-files"],
            cwd=PROJECT_ROOT,
            capture_output=True,
            text=True,
            check=True
        )

        for line in result.stdout.strip().split('\n'):
            if line:
                file_path = PROJECT_ROOT / line
                if file_path.exists() and file_path.is_file():
                    files.append(file_path)

        tracked_count = len(files)
        print(f"    Tracked файлов: {tracked_count}")

        # Untracked files (новые, еще не добавленные в git)
        if include_untracked:
            result = subprocess.run(
                ["git", "ls-files", "--others", "--exclude-standard"],
                cwd=PROJECT_ROOT,
                capture_output=True,
                text=True,
                check=True
            )

            untracked_count = 0
            for line in result.stdout.strip().split('\n'):
                if line:
                    file_path = PROJECT_ROOT / line
                    if file_path.exists() and file_path.is_file():
                        files.append(file_path)
                        untracked_count += 1

            print(f"    Untracked файлов: {untracked_count}")

        return files

    except subprocess.CalledProcessError:
        print("  Git не доступен или это не git репозиторий.")
        print("Используйте git init для инициализации репозитория.")
        return []
    except FileNotFoundError:
        print("  Git не установлен в системе.")
        return []


def should_include_file(file_path: Path) -> bool:
    """
    Проверяет, должен ли файл быть включен в bundle.

    Args:
        file_path: Путь к файлу

    Returns:
        bool: True если файл нужно включить
    """
    # Проверка размера файла
    try:
        if file_path.stat().st_size > MAX_FILE_SIZE:
            return False
    except OSError:
        return False

    # Проверка имени файла (игнорируемые)
    if file_path.name in IGNORED_FILENAMES:
        return False

    # Проверка паттернов файлов
    file_name_lower = file_path.name.lower()
    file_suffix_lower = file_path.suffix.lower()

    for pattern in IGNORED_FILE_PATTERNS:
        if pattern.startswith('*'):
            if file_name_lower.endswith(pattern[1:]):
                return False
        elif pattern.startswith('.'):
            if file_suffix_lower == pattern:
                return False
        elif file_name_lower.endswith(pattern):
            return False

    # Проверка директорий
    for part in file_path.parts:
        if part in IGNORED_DIR_NAMES:
            return False

    # Проверка разрешенных имен файлов
    if file_path.name in ALLOWED_FILENAMES:
        return True

    # Проверка расширения
    if file_path.suffix.lower() not in ALLOWED_EXTENSIONS:
        return False

    return True


def get_relative_path(file_path: Path) -> str:
    """
    Получает относительный путь файла от корня проекта.

    Args:
        file_path: Абсолютный путь к файлу

    Returns:
        str: Относительный путь
    """
    try:
        return str(file_path.relative_to(PROJECT_ROOT))
    except ValueError:
        return str(file_path)


def create_bundle(use_git: bool = True, include_untracked: bool = True, verbose: bool = False):
    """
    Создает bundle файл с кодовой базой проекта.

    Args:
        use_git: Использовать git для получения списка файлов
        include_untracked: Включить файлы, не добавленные в git (новые файлы)
        verbose: Показывать исключённые файлы
    """
    print("=" * 80)
    print("WhisperX Pipeline - Code Bundler")
    print("=" * 80)

    # Создаем выходную директорию
    OUTPUT_DIR.mkdir(parents=True, exist_ok=True)
    output_file_path = OUTPUT_DIR / OUTPUT_FILENAME

    # Получаем список файлов
    if use_git:
        print("\n[*] Получаю список файлов из git...")
        if include_untracked:
            print("    (включая untracked файлы)")
        all_files = get_git_tracked_files(include_untracked=include_untracked)
        if not all_files:
            print("[!] Не удалось получить список файлов из git.")
            return
    else:
        print("\n[*] Сканирую файловую систему...")
        all_files = []
        for root, dirs, files in os.walk(PROJECT_ROOT):
            # Удаляем игнорируемые директории
            dirs[:] = [d for d in dirs if d not in IGNORED_DIR_NAMES and not d.startswith('.')]

            for filename in files:
                file_path = Path(root) / filename
                all_files.append(file_path)

    print(f"    Всего файлов: {len(all_files)}")

    # Фильтруем файлы
    print("\n[*] Фильтрую файлы...")
    filtered_files = []
    excluded_files = []

    for f in all_files:
        if should_include_file(f):
            filtered_files.append(f)
        else:
            excluded_files.append(f)

    print(f"    Отобрано для bundle: {len(filtered_files)}")
    print(f"    Исключено: {len(excluded_files)}")

    if verbose and excluded_files:
        print("\n    Исключённые файлы:")
        for f in excluded_files[:20]:  # Показываем первые 20
            print(f"      - {get_relative_path(f)}")
        if len(excluded_files) > 20:
            print(f"      ... и ещё {len(excluded_files) - 20} файлов")

    # Группируем файлы по директориям для лучшей организации
    filtered_files.sort(key=lambda x: (str(x.parent), x.name))

    # Записываем bundle
    print(f"\n[*] Создаю bundle файл: {output_file_path.name}")

    try:
        with open(output_file_path, "w", encoding="utf-8") as outfile:
            # Заголовок
            outfile.write("=" * 100 + "\n")
            outfile.write("WHISPERX PIPELINE - CODE BUNDLE\n")
            outfile.write("=" * 100 + "\n")
            outfile.write(f"Generated: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n")
            outfile.write(f"Project Root: {PROJECT_ROOT}\n")
            outfile.write(f"Total Files: {len(filtered_files)}\n")
            outfile.write(f"Git Tracked: {'Yes' if use_git else 'No'}\n")
            outfile.write("=" * 100 + "\n\n")

            # Оглавление
            outfile.write("TABLE OF CONTENTS\n")
            outfile.write("-" * 100 + "\n")
            for idx, file_path in enumerate(filtered_files, 1):
                rel_path = get_relative_path(file_path)
                outfile.write(f"{idx:4d}. {rel_path}\n")
            outfile.write("\n" + "=" * 100 + "\n\n")

            # Содержимое файлов
            current_dir = None

            for idx, file_path in enumerate(filtered_files, 1):
                rel_path = get_relative_path(file_path)

                # Показываем прогресс
                if idx % 10 == 0:
                    print(f"    Обработано: {idx}/{len(filtered_files)}")

                # Заголовок директории (если изменилась)
                try:
                    file_dir = str(file_path.parent.relative_to(PROJECT_ROOT))
                except ValueError:
                    file_dir = str(file_path.parent)

                if file_dir != current_dir:
                    current_dir = file_dir
                    outfile.write("\n" + "#" * 100 + "\n")
                    outfile.write(f"# DIRECTORY: {file_dir}\n")
                    outfile.write("#" * 100 + "\n\n")

                # Заголовок файла
                outfile.write(f"\n{'=' * 100}\n")
                outfile.write(f"FILE [{idx}/{len(filtered_files)}]: {rel_path}\n")
                outfile.write(f"Size: {file_path.stat().st_size} bytes\n")
                outfile.write(f"{'=' * 100}\n\n")

                # Содержимое файла
                try:
                    with open(file_path, "r", encoding="utf-8") as infile:
                        content = infile.read()
                        outfile.write(content)

                        # Добавляем перевод строки, если файл не заканчивается на него
                        if content and not content.endswith('\n'):
                            outfile.write('\n')

                except UnicodeDecodeError:
                    # Попытка прочитать в другой кодировке
                    try:
                        with open(file_path, "r", encoding="latin-1") as infile:
                            content = infile.read()
                            outfile.write("[WARNING: File read with latin-1 encoding]\n\n")
                            outfile.write(content)
                    except Exception as e:
                        outfile.write(f"[ERROR: Could not read file: {e}]\n")

                except Exception as e:
                    outfile.write(f"[ERROR: {e}]\n")

                outfile.write(f"\n{'=' * 100}\n")
                outfile.write(f"END OF FILE: {rel_path}\n")
                outfile.write(f"{'=' * 100}\n\n")

            # Футер
            outfile.write("\n" + "=" * 100 + "\n")
            outfile.write("END OF BUNDLE\n")
            outfile.write(f"Total Files Bundled: {len(filtered_files)}\n")
            outfile.write(f"Generated: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n")
            outfile.write("=" * 100 + "\n")

        # Информация о результате
        file_size_kb = output_file_path.stat().st_size / 1024
        file_size_mb = file_size_kb / 1024

        print("\n" + "=" * 80)
        print("[+] Bundle успешно создан!")
        print("=" * 80)
        print(f"    Файл: {output_file_path}")
        if file_size_mb >= 1:
            print(f"    Размер: {file_size_mb:.2f} MB")
        else:
            print(f"    Размер: {file_size_kb:.2f} KB")
        print(f"    Файлов: {len(filtered_files)}")
        print("=" * 80)

    except IOError as e:
        print(f"\n[!] Ошибка записи в файл: {e}")
    except Exception as e:
        print(f"\n[!] Непредвиденная ошибка: {e}")


def main():
    """Главная функция."""
    import argparse

    parser = argparse.ArgumentParser(
        description="Собирает кодовую базу WhisperX Pipeline в один текстовый файл"
    )
    parser.add_argument(
        "--no-git",
        action="store_true",
        help="Не использовать git, сканировать файловую систему"
    )
    parser.add_argument(
        "--tracked-only",
        action="store_true",
        help="Только tracked файлы (без новых untracked)"
    )
    parser.add_argument(
        "-v", "--verbose",
        action="store_true",
        help="Показать исключённые файлы"
    )

    args = parser.parse_args()

    create_bundle(
        use_git=not args.no_git,
        include_untracked=not args.tracked_only,
        verbose=args.verbose
    )


if __name__ == "__main__":
    main()

====================================================================================================
END: bundler.py
====================================================================================================

====================================================================================================
FILE [4/52]: eslint.config.js
Size: 639 bytes
====================================================================================================

import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])

====================================================================================================
END: eslint.config.js
====================================================================================================

====================================================================================================
FILE [5/52]: index.html
Size: 943 bytes
====================================================================================================

<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>Никита Хроменок — Портфолио</title>
    <meta name="description" content="R&D Engineer — цифровизация строительных процессов. 4 продукта в production, 10 лет в строительной отрасли." />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet" />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>

====================================================================================================
END: index.html
====================================================================================================

====================================================================================================
FILE [6/52]: package.json
Size: 877 bytes
====================================================================================================

{
  "name": "portfolio",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@tailwindcss/vite": "^4.1.18",
    "lucide-react": "^0.575.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.13.1",
    "tailwindcss": "^4.1.18"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/node": "^24.10.1",
    "@types/react": "^19.2.7",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "typescript": "~5.9.3",
    "typescript-eslint": "^8.48.0",
    "vite": "^7.3.1"
  }
}

====================================================================================================
END: package.json
====================================================================================================

====================================================================================================
FILE [7/52]: tsconfig.app.json
Size: 760 bytes
====================================================================================================

{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "types": ["vite/client"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}

====================================================================================================
END: tsconfig.app.json
====================================================================================================

====================================================================================================
FILE [8/52]: tsconfig.json
Size: 126 bytes
====================================================================================================

{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}

====================================================================================================
END: tsconfig.json
====================================================================================================

====================================================================================================
FILE [9/52]: tsconfig.node.json
Size: 679 bytes
====================================================================================================

{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": ["node"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}

====================================================================================================
END: tsconfig.node.json
====================================================================================================

====================================================================================================
FILE [10/52]: vite.config.ts
Size: 199 bytes
====================================================================================================

import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import tailwindcss from '@tailwindcss/vite'

export default defineConfig({
  plugins: [react(), tailwindcss()],
})

====================================================================================================
END: vite.config.ts
====================================================================================================


####################################################################################################
# DIR: scripts
####################################################################################################

====================================================================================================
FILE [11/52]: scripts\bundler.py
Size: 9,386 bytes
====================================================================================================

"""
IAM Portfolio - Code Bundler
Собирает кодовую базу в один текстовый файл для анализа / передачи в LLM.
Использует git для определения tracked файлов, игнорирует мусор.
"""

import os
import subprocess
from pathlib import Path
from datetime import datetime
from typing import List

# --- НАСТРОЙКИ ---
PROJECT_ROOT = Path(__file__).parent.parent.absolute()
OUTPUT_DIR = PROJECT_ROOT / "scripts" / "bundles"
OUTPUT_FILENAME = f"iam_bundle_{datetime.now().strftime('%Y%m%d_%H%M%S')}.txt"

ALLOWED_EXTENSIONS = {
    ".ts", ".tsx",      # TypeScript / React
    ".js", ".jsx",      # JavaScript
    ".css", ".scss",    # Стили
    ".html",            # HTML
    ".json",            # package.json, tsconfig, etc.
    ".md",              # Документация
    ".yml", ".yaml",    # CI/CD конфиги
    ".sh",              # Shell скрипты
    ".py",              # Python скрипты (bundler сам себя)
    ".gitignore",
    ".editorconfig",
}

ALLOWED_FILENAMES = {
    "CLAUDE.md",
    ".env.example",
    "Makefile",
}

IGNORED_DIR_NAMES = {
    "node_modules",
    "dist",
    "build",
    ".git",
    ".vscode",
    ".idea",
    "__pycache__",
    "bundles",          # Сам аутпут бандлера
    "coverage",
    ".playwright-mcp",
}

IGNORED_FILENAMES = {
    "package-lock.json",
    "yarn.lock",
    "pnpm-lock.yaml",
    "bun.lock",
    "bun.lockb",
}

IGNORED_FILE_PATTERNS = {
    ".log",
    ".env",
    ".DS_Store",
    "Thumbs.db",
    ".min.js",
    ".min.css",
    ".map",             # Source maps — мусор
    ".png", ".jpg", ".jpeg", ".gif", ".bmp", ".ico", ".webp",
    ".svg",             # SVG можно включить если нужно, пока исключаем
    ".woff", ".woff2", ".ttf", ".eot",
    ".zip", ".tar", ".gz",
}

MAX_FILE_SIZE = 2 * 1024 * 1024  # 2 MB


def get_git_tracked_files(include_untracked: bool = True) -> List[Path]:
    files = []

    try:
        result = subprocess.run(
            ["git", "ls-files"],
            cwd=PROJECT_ROOT,
            capture_output=True,
            text=True,
            check=True
        )
        for line in result.stdout.strip().split('\n'):
            if line:
                fp = PROJECT_ROOT / line
                if fp.exists() and fp.is_file():
                    files.append(fp)

        print(f"    Tracked файлов: {len(files)}")

        if include_untracked:
            result = subprocess.run(
                ["git", "ls-files", "--others", "--exclude-standard"],
                cwd=PROJECT_ROOT,
                capture_output=True,
                text=True,
                check=True
            )
            untracked = 0
            for line in result.stdout.strip().split('\n'):
                if line:
                    fp = PROJECT_ROOT / line
                    if fp.exists() and fp.is_file():
                        files.append(fp)
                        untracked += 1
            print(f"    Untracked файлов: {untracked}")

        return files

    except subprocess.CalledProcessError:
        print("  [!] Git не доступен или не инициализирован.")
        return []
    except FileNotFoundError:
        print("  [!] Git не установлен.")
        return []


def should_include(fp: Path) -> bool:
    try:
        if fp.stat().st_size > MAX_FILE_SIZE:
            return False
    except OSError:
        return False

    if fp.name in IGNORED_FILENAMES:
        return False

    name_lower = fp.name.lower()
    suffix_lower = fp.suffix.lower()

    for pattern in IGNORED_FILE_PATTERNS:
        if suffix_lower == pattern or name_lower.endswith(pattern):
            return False

    for part in fp.parts:
        if part in IGNORED_DIR_NAMES:
            return False

    if fp.name in ALLOWED_FILENAMES:
        return True

    if suffix_lower in ALLOWED_EXTENSIONS:
        return True

    return False


def create_bundle(include_untracked: bool = True, verbose: bool = False):
    print("=" * 80)
    print("IAM Portfolio - Code Bundler")
    print("=" * 80)

    OUTPUT_DIR.mkdir(parents=True, exist_ok=True)
    out_path = OUTPUT_DIR / OUTPUT_FILENAME

    print("\n[*] Получаю список файлов из git...")
    all_files = get_git_tracked_files(include_untracked=include_untracked)
    if not all_files:
        print("[!] Нет файлов для обработки.")
        return

    print(f"    Всего найдено: {len(all_files)}")

    print("\n[*] Фильтрую...")
    included = [f for f in all_files if should_include(f)]
    excluded = [f for f in all_files if not should_include(f)]

    print(f"    В bundle: {len(included)}")
    print(f"    Исключено: {len(excluded)}")

    if verbose:
        print("\n    Исключённые файлы:")
        for f in excluded[:20]:
            try:
                print(f"      - {f.relative_to(PROJECT_ROOT)}")
            except ValueError:
                print(f"      - {f}")
        if len(excluded) > 20:
            print(f"      ... и ещё {len(excluded) - 20}")

    # Сортировка: сначала корень, потом по директориям
    included.sort(key=lambda x: (str(x.parent), x.name))

    print(f"\n[*] Записываю bundle: {out_path.name}")

    with open(out_path, "w", encoding="utf-8") as out:
        # Шапка
        out.write("=" * 100 + "\n")
        out.write("IAM PORTFOLIO — CODE BUNDLE\n")
        out.write("=" * 100 + "\n")
        out.write(f"Generated : {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n")
        out.write(f"Root      : {PROJECT_ROOT}\n")
        out.write(f"Files     : {len(included)}\n")
        out.write("=" * 100 + "\n\n")

        # Оглавление
        out.write("TABLE OF CONTENTS\n")
        out.write("-" * 100 + "\n")
        for i, fp in enumerate(included, 1):
            try:
                rel = fp.relative_to(PROJECT_ROOT)
            except ValueError:
                rel = fp
            out.write(f"  {i:3d}. {rel}\n")
        out.write("\n" + "=" * 100 + "\n\n")

        # Файлы
        current_dir = None
        for i, fp in enumerate(included, 1):
            try:
                rel = str(fp.relative_to(PROJECT_ROOT))
                file_dir = str(fp.parent.relative_to(PROJECT_ROOT))
            except ValueError:
                rel = str(fp)
                file_dir = str(fp.parent)

            # Заголовок директории
            if file_dir != current_dir:
                current_dir = file_dir
                out.write("\n" + "#" * 100 + "\n")
                out.write(f"# DIR: {file_dir}\n")
                out.write("#" * 100 + "\n\n")

            # Заголовок файла
            out.write("=" * 100 + "\n")
            out.write(f"FILE [{i}/{len(included)}]: {rel}\n")
            out.write(f"Size: {fp.stat().st_size:,} bytes\n")
            out.write("=" * 100 + "\n\n")

            # Содержимое
            try:
                content = fp.read_text(encoding="utf-8")
            except UnicodeDecodeError:
                try:
                    content = "[WARNING: latin-1]\n\n" + fp.read_text(encoding="latin-1")
                except Exception as e:
                    content = f"[ERROR reading file: {e}]"
            except Exception as e:
                content = f"[ERROR: {e}]"

            out.write(content)
            if content and not content.endswith('\n'):
                out.write('\n')

            out.write("\n" + "=" * 100 + "\n")
            out.write(f"END: {rel}\n")
            out.write("=" * 100 + "\n\n")

        # Футер
        out.write("=" * 100 + "\n")
        out.write("END OF BUNDLE\n")
        out.write(f"Files: {len(included)}\n")
        out.write(f"Generated: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n")
        out.write("=" * 100 + "\n")

    size_kb = out_path.stat().st_size / 1024
    size_mb = size_kb / 1024

    print("\n" + "=" * 80)
    print("[+] Готово!")
    print(f"    Файл : {out_path}")
    print(f"    Размер: {f'{size_mb:.2f} MB' if size_mb >= 1 else f'{size_kb:.1f} KB'}")
    print(f"    Файлов: {len(included)}")
    print("=" * 80)


def main():
    import argparse

    parser = argparse.ArgumentParser(
        description="Собирает кодовую базу IAM Portfolio в один файл"
    )
    parser.add_argument(
        "--tracked-only",
        action="store_true",
        help="Только tracked git файлы (без untracked новых)"
    )
    parser.add_argument(
        "-v", "--verbose",
        action="store_true",
        help="Показать исключённые файлы"
    )
    args = parser.parse_args()

    create_bundle(
        include_untracked=not args.tracked_only,
        verbose=args.verbose
    )


if __name__ == "__main__":
    main()

====================================================================================================
END: scripts\bundler.py
====================================================================================================


####################################################################################################
# DIR: src
####################################################################################################

====================================================================================================
FILE [12/52]: src\App.tsx
Size: 41,615 bytes
====================================================================================================

import { useState, useEffect, useCallback } from 'react'
import { flushSync } from 'react-dom'
import { products } from './data/products'
import { ProductCard } from './components/ProductCard'
import { Reveal } from './components/Reveal'
import { DataBookDemo } from './components/DataBookDemo'
import { DemoAIHub } from './components/DemoAIHub'
import { DemoAutoprotocol } from './components/DemoAutoprotocol'
import { DemoCostManager } from './components/DemoCostManager'

function App() {
  return (
    <>
      <Nav />
      <Hero />
      <Competence />
      <Products />
      <Architecture />
      <Methodology />
      <BusinessValue />
      <Research />
      <Lab />
      <Contact />
    </>
  )
}

/* ── Scroll Progress ── */
function ScrollProgress() {
  const [progress, setProgress] = useState(0)

  useEffect(() => {
    const update = () => {
      const scrollTop = window.scrollY
      const docHeight = document.documentElement.scrollHeight - window.innerHeight
      setProgress(docHeight > 0 ? scrollTop / docHeight : 0)
    }
    window.addEventListener('scroll', update, { passive: true })
    return () => window.removeEventListener('scroll', update)
  }, [])

  return <div className="scroll-progress" style={{ width: `${progress * 100}%` }} />
}

/* ── Navigation ── */
function Nav() {
  const [theme, setTheme] = useState<'dark' | 'light'>(() => {
    const saved = localStorage.getItem('theme')
    if (saved === 'light' || saved === 'dark') return saved
    if (window.matchMedia('(prefers-color-scheme: light)').matches) return 'light'
    return 'dark'
  })
  const [scrolled, setScrolled] = useState(false)
  const [activeSection, setActiveSection] = useState('')

  useEffect(() => {
    document.documentElement.classList.toggle('light', theme === 'light')
    localStorage.setItem('theme', theme)
  }, [theme])

  useEffect(() => {
    const onScroll = () => setScrolled(window.scrollY > 20)
    window.addEventListener('scroll', onScroll, { passive: true })
    return () => window.removeEventListener('scroll', onScroll)
  }, [])

  useEffect(() => {
    const sections = document.querySelectorAll('section[id]')
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            setActiveSection(entry.target.id)
          }
        })
      },
      { threshold: 0.3, rootMargin: '-80px 0px -40% 0px' },
    )
    sections.forEach((s) => observer.observe(s))
    return () => observer.disconnect()
  }, [])

  const toggleTheme = useCallback((e: React.MouseEvent) => {
    const newTheme = theme === 'dark' ? 'light' : 'dark'
    const x = e.clientX
    const y = e.clientY
    const endRadius = Math.hypot(
      Math.max(x, window.innerWidth - x),
      Math.max(y, window.innerHeight - y),
    )

    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    const doc = document as any
    if (!doc.startViewTransition) {
      setTheme(newTheme)
      return
    }

    const transition = doc.startViewTransition(() => {
      flushSync(() => setTheme(newTheme))
    })

    transition.ready.then(() => {
      document.documentElement.animate(
        { clipPath: [`circle(0px at ${x}px ${y}px)`, `circle(${endRadius}px at ${x}px ${y}px)`] },
        { duration: 600, easing: 'ease-in-out', pseudoElement: '::view-transition-new(root)' },
      )
    })
  }, [theme])

  const navLinks = [
    ['#competence', 'competence', 'Опыт'],
    ['#products', 'products', 'Продукты'],
    ['#architecture', 'architecture', 'Архитектура'],
    ['#value', 'value', 'Подход'],
    ['#research', 'research', 'R&D'],
  ]

  return (
    <>
      <ScrollProgress />
      <nav className={`fixed top-0 left-0 right-0 z-50 backdrop-blur-xl border-b border-border py-3 transition-all duration-300 ${scrolled ? 'bg-bg/95 shadow-sm' : 'bg-bg/85'}`}>
        <div className="max-w-[1080px] mx-auto px-8 flex justify-between items-center">
          <div className="font-display font-bold text-[0.95rem]">Никита Хроменок</div>
          <div className="flex items-center gap-6">
            <div className="hidden md:flex gap-6">
              {navLinks.map(([href, id, label]) => (
                <a
                  key={href}
                  href={href}
                  className={`text-sm font-medium transition-colors no-underline ${activeSection === id ? 'text-accent' : 'text-muted hover:text-text-primary'}`}
                >
                  {label}
                </a>
              ))}
            </div>
            <button
              onClick={toggleTheme}
              className="w-8 h-8 flex items-center justify-center rounded-lg bg-surface-2 border border-border text-muted hover:text-text-primary transition-colors cursor-pointer"
              aria-label="Переключить тему"
            >
              {theme === 'dark' ? (
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                  <circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/>
                  <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                  <line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/>
                  <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                </svg>
              ) : (
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                  <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
              )}
            </button>
          </div>
        </div>
      </nav>
    </>
  )
}

/* ── Hero ── */
function Hero() {
  const stats = [
    { num: '10 лет', label: 'в строительстве' },
    { num: '15+', label: 'проектов за 1.5 года' },
    { num: 'МГСУ', label: 'аспирантура' },
  ]

  return (
    <section className="min-h-screen relative overflow-hidden flex items-center">
      <div className="absolute -top-[100px] right-[-200px] w-[700px] h-[700px] bg-[radial-gradient(circle,rgba(79,124,255,0.08)_0%,transparent_70%)] pointer-events-none animate-[heroOrb_8s_ease-in-out_infinite]" />

      <div className="w-full pt-14">
        <div className="max-w-[1080px] mx-auto px-8 py-10">
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-20">

            {/* Левая колонка */}
            <div>
              <div className="inline-block px-3 py-1 bg-accent-soft text-accent rounded-full text-xs font-semibold tracking-widest uppercase mb-6">
                От процесса к продукту
              </div>
              <h1 className="font-display text-[1.75rem] md:text-[2rem] font-extrabold leading-[1.25] mb-5 bg-gradient-to-br from-text-primary to-accent bg-clip-text text-transparent">
                Знаю стройку изнутри — делаю инструменты для бизнеса, которых нет на рынке
              </h1>
              <p className="text-[0.95rem] text-text-primary/70 mb-8 leading-relaxed">
                10 лет в строительном контроле — понимаю отрасль изнутри, не по описанию.
                Нужных инструментов не было, написал сам: 4 продукта в production и 12+ прототипов
                за полтора года, в одиночку и без ТЗ сверху.
              </p>
              <div className="grid grid-cols-3 gap-3">
                {stats.map((s) => (
                  <div key={s.label} className="bg-surface border border-border rounded-xl p-3 text-center">
                    <div className="text-lg font-extrabold text-accent font-display leading-tight">{s.num}</div>
                    <div className="text-xs text-text-primary/50 mt-1 leading-tight">{s.label}</div>
                  </div>
                ))}
              </div>
            </div>

            {/* Правая колонка */}
            <div className="lg:border-l lg:border-border lg:pl-12 flex items-center">
              <div className="border-l-2 border-accent/30 pl-5">
                <p className="text-[0.95rem] leading-relaxed text-text-primary/75">
                  «Знаю изнутри» — это не строчка в резюме. Это значит понимать где система
                  ломается до того как это попадёт в отчёт, видеть узкое место раньше дедлайна.
                </p>
                <p className="text-[0.95rem] leading-relaxed text-text-primary/75 mt-4">
                  Hands-on — не про то чтобы делать всё самому. Про то чтобы оставаться
                  достаточно близко к работе: задавать команде вопросы которые имеют смысл,
                  принимать решения на основе реальности а не её описания.
                </p>
              </div>
            </div>

          </div>
        </div>
      </div>
    </section>
  )
}

/* ── Competence (merged with Career) ── */
function Competence() {
  const timeline = [
    { date: '2016–2017', role: 'Инженер ПТО', place: 'МГСУ \u2022 Парк Зарядье', desc: 'Исполнительная документация, фасады и благоустройство' },
    { date: '2018–2020', role: 'Строительно-технический эксперт', place: 'Судебная экспертиза', desc: 'Экспертиза и финансово-технический аудит. АО АККУЮ НУКЛЕАР, ВЦ «Павловопосадские платки»' },
    { date: '2020–2021', role: 'Инженер СК', place: 'ТСК-ТИТУЛ', desc: 'Приёмка работ, проверка КС-2, накопительные. ЖК Discovery (MR Group), Савёловский-сити' },
    { date: '2021–2024', role: 'Инженер → ведущий инженер СК', place: 'Severin Development', desc: 'ЖК FORIVER (InGrad/Sminex) — 11 корпусов, 3 года на объекте, получение ЗОС' },
    { date: '2024', role: 'Руководитель группы СК / Департамент качества', place: 'Severin Development', desc: 'Координация 20+ инженеров. Регламенты, шаблоны для проектных команд' },
    { date: '2024–н.в.', role: 'Департамент цифровой трансформации', place: 'Severin Development', desc: '4 продукта в production, ~10 прототипов. Full-cycle R&D — от идеи до внедрения', active: true },
  ]

  const edu = [
    { date: '2014–2018', text: 'Бакалавриат, ПГС' },
    { date: '2018–2020', text: 'Магистратура, ПГС' },
    { date: '2021–2025', text: 'Аспирантура, ЭБСиГХ' },
  ]

  return (
    <section id="competence" className="py-10">
      <div className="max-w-[1080px] mx-auto px-8">
        <Reveal>
          <div className="flex items-center justify-between mb-5">
            <h2 className="font-display text-base font-bold uppercase tracking-widest text-muted">Карьерный трек</h2>
            <span className="px-2.5 py-0.5 rounded text-xs font-bold tracking-wider uppercase bg-green-soft text-green">Опыт</span>
          </div>

          {/* Timeline */}
          <div>
            {timeline.map((t, i) => (
              <div key={t.date} className="flex gap-4 items-stretch">
                <div className="w-[76px] shrink-0 text-right pt-0.5">
                  <div className="text-xs font-semibold text-accent leading-tight">{t.date}</div>
                </div>
                <div className="flex flex-col items-center shrink-0">
                  <div className={`w-2 h-2 rounded-full border-2 border-accent mt-1 ${t.active ? 'bg-accent animate-[pulseGlow_2s_ease-in-out_infinite]' : 'bg-bg'}`} />
                  {i < timeline.length - 1 && <div className="w-px flex-1 bg-border mt-1" />}
                </div>
                <div className={`${i < timeline.length - 1 ? 'pb-3' : 'pb-0'}`}>
                  <div className="text-sm font-semibold leading-tight">{t.role}</div>
                  <div className="text-xs text-accent/60 font-medium">{t.place}</div>
                  <div className="text-xs text-muted leading-snug mt-0.5">{t.desc}</div>
                </div>
              </div>
            ))}
          </div>

          {/* Education */}
          <div className="mt-4 pt-4 border-t border-border flex flex-wrap items-center gap-x-6 gap-y-1">
            <span className="text-xs font-bold uppercase tracking-wider text-muted">НИУ МГСУ</span>
            {edu.map((e) => (
              <div key={e.date} className="text-xs">
                <span className="text-accent font-semibold">{e.date}</span>
                <span className="text-muted ml-1.5">{e.text}</span>
              </div>
            ))}
          </div>
        </Reveal>
      </div>
    </section>
  )
}

/* ── Products ── */
function Products() {
  return (
    <section id="products" className="bg-surface py-16">
      <div className="max-w-[1080px] mx-auto px-8">
        <Reveal>
          <div className="mb-8">
            <h2 className="font-display text-2xl md:text-3xl font-bold mb-2">Продукты</h2>
            <p className="text-muted text-[0.95rem]">Четыре инструмента, написанных с нуля под реальные задачи строительного бизнеса.</p>
          </div>
        </Reveal>
        <Reveal stagger>
          {products.map((p) => (
            <ProductCard
              key={p.id}
              product={p}
              demo={p.id === 'aihub' ? <DemoAIHub /> : p.id === 'databook' ? <DataBookDemo /> : p.id === 'autoprotocol' ? <DemoAutoprotocol /> : p.id === 'costmanager' ? <DemoCostManager /> : undefined}
            />
          ))}
        </Reveal>
      </div>
    </section>
  )
}

/* ── Lab / Experiments ── */
function Lab() {
  const experiments = [
    { desc: 'RAG-консультант по строительным нормам с гибридным поиском', tags: ['RAG', 'Gemini', 'Embeddings'] },
    { desc: 'Автоклассификация элементов BIM-моделей через LLM', tags: ['Ollama', 'IFC', 'ML'] },
    { desc: 'AI-ассистент по документации бизнес-процессов', tags: ['RAG', 'BM25', 'ChromaDB'] },
    { desc: 'Голосовой ассистент с распознаванием и синтезом речи', tags: ['STT', 'TTS', 'Gemini'] },
    { desc: 'Real-time перевод аудио на совещаниях', tags: ['Whisper', 'WebSocket', 'Gemini'] },
    { desc: 'Платформа конкурсов с голосованием и OAuth2', tags: ['FastAPI', 'React', 'OAuth2'] },
    { desc: 'Канбан-система для AI-контента с автокатегоризацией', tags: ['Next.js', 'FastAPI', 'Gemini'] },
    { desc: 'Telegram-бот для автоматического создания задач из ссылок', tags: ['aiogram', 'Gemini', 'API'] },
    { desc: 'AI-сравнение версий PDF-документации с визуализацией', tags: ['PyMuPDF', 'Gemini', 'PDF.js'] },
    { desc: 'Автоматический анализ стенограмм совещаний из СЭД', tags: ['Gemini', 'API', 'Pydantic'] },
    { desc: 'Парсинг и структурирование данных из реестров экспертизы', tags: ['Python', 'BeautifulSoup'] },
    { desc: 'Программная генерация документов по корпоративному брендбуку', tags: ['python-docx'] },
  ]

  return (
    <section className="py-12">
      <div className="max-w-[1080px] mx-auto px-8">
        <Reveal>
          <div className="mb-6">
            <div className="inline-block px-3 py-1 rounded text-xs font-bold tracking-wider uppercase mb-3 bg-purple-soft text-purple">
              Эксперименты
            </div>
            <h2 className="font-display text-xl md:text-2xl font-bold mb-1">Прототипы и эксперименты</h2>
            <p className="text-sm text-muted">Каждый production-продукт вырос из серии экспериментов. Ниже — задачи, которые решались на пути.</p>
          </div>
        </Reveal>
        <Reveal stagger>
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2">
            {experiments.map((e, i) => (
              <div key={i} className="bg-surface border border-border rounded-lg px-4 py-3 flex flex-col gap-1.5 transition-colors hover:border-accent/20">
                <div className="text-sm text-text-primary leading-snug">{e.desc}</div>
                <div className="flex flex-wrap gap-1 mt-auto">
                  {e.tags.map((t) => (
                    <span key={t} className="px-1.5 py-0.5 rounded text-xs font-medium bg-surface-3 text-muted">{t}</span>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </Reveal>
      </div>
    </section>
  )
}

/* ── Architecture ── */
function Architecture() {
  return (
    <section id="architecture" className="py-16">
      <div className="max-w-[1080px] mx-auto px-8">
        <Reveal>
          <SectionHeader
            tag="Архитектура"
            tagColor="bg-cyan-soft text-cyan"
            title="Как это устроено под капотом"
            subtitle="Общая авторизация, общие данные, общий AI-слой. Всё крутится на одной инфраструктуре."
          />
        </Reveal>

        {/* Technical landscape */}
        <Reveal>
          <div className="bg-surface border border-border rounded-2xl p-8 mb-6">
            <div className="text-xs font-bold uppercase tracking-wider text-muted text-center mb-6">
              Технический ландшафт
            </div>
            <div className="flex flex-col gap-3 max-w-[820px] mx-auto">
              <ArchLayer label="Потребители">
                <ArchItem color="amber" title="Инженеры СК" sub="DataBook, Puls" />
                <ArchItem color="amber" title="Экономисты" sub="CostManager" />
                <ArchItem color="amber" title="Руководители" sub="Автопротокол" />
                <ArchItem color="amber" title="Все сотрудники" sub="AI-Hub, AI-чат" />
              </ArchLayer>
              <div className="arch-arrow">&darr; SSO / OAuth2 + PKCE &darr;</div>
              <ArchLayer label="Авторизация">
                <ArchItem color="accent" title="AI-Hub — OAuth2 Authorization Server, RBAC, ADFS/OIDC, аудит" sub="Единая точка входа и управления доступами" wide />
              </ArchLayer>
              <div className="arch-arrow">&darr;</div>
              <ArchLayer label="Приложения">
                <ArchItem color="green" title="DataBook" sub="NLP-поиск" />
                <ArchItem color="green" title="CostManager" sub="Аналитика смет" />
                <ArchItem color="green" title="Автопротокол" sub="ML-транскрипция" />
                <ArchItem color="green" title="Puls" sub="ERP (прототип)" />
              </ArchLayer>
              <div className="arch-arrow">&darr;</div>
              <ArchLayer label="AI / ML слой">
                <ArchItem color="purple" title="Gemini API" sub="Генерация, классификация" />
                <ArchItem color="purple" title="Ollama" sub="Локальный инференс" />
                <ArchItem color="purple" title="WhisperX + pyannote" sub="Speech pipeline" />
                <ArchItem color="purple" title="Embeddings" sub="Векторный поиск" />
              </ArchLayer>
              <div className="arch-arrow">&darr;</div>
              <ArchLayer label="Инфраструктура">
                <ArchItem color="cyan" title="PostgreSQL" sub="СУБД" />
                <ArchItem color="cyan" title="Redis" sub="Очереди, кеш" />
                <ArchItem color="cyan" title="Celery" sub="Async-задачи" />
                <ArchItem color="cyan" title="Docker + Nginx" sub="Контейнеризация" />
                <ArchItem color="cyan" title="GitHub Actions" sub="CI/CD" />
              </ArchLayer>
            </div>
          </div>
        </Reveal>

      </div>
    </section>
  )
}

/* ── Business Value ── */
function BusinessValue() {
  const cards = [
    {
      num: '01',
      title: 'Без посредников',
      text: 'Обычная цепочка: бизнес → аналитик → разработчик. На каждом шаге теряется контекст. Когда сам знаешь предметку и сам пишешь код — попадание в потребность точнее.',
      metric: 'Нулевая потеря контекста',
    },
    {
      num: '02',
      title: 'Люди пришли сами',
      text: 'Ни один продукт не внедрялся приказом сверху. DataBook сделал год назад и забыл — а инженеры пользуются каждый день. Это лучшая валидация.',
      metric: 'Adoption без бюджета',
    },
    {
      num: '03',
      title: 'Быстрый цикл',
      text: 'От боли до рабочего MVP — 2–3 месяца. Услышал проблему на совещании, за выходные прототип, в понедельник показал, собрал обратную связь, доработал.',
      metric: '4 продукта за 1.5 года (solo)',
    },
  ]

  return (
    <section id="value" className="bg-surface py-16">
      <div className="max-w-[1080px] mx-auto px-8">
        <Reveal>
          <SectionHeader
            tag="Почему это работает"
            tagColor="bg-green-soft text-green"
            title="Что даёт совмещение отрасли и разработки"
          />
        </Reveal>
        <Reveal stagger>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            {cards.map((c) => (
              <div key={c.title} className="bg-bg border border-border rounded-xl p-6 relative overflow-hidden transition-transform hover:-translate-y-0.5">
                <div className="absolute top-3 right-4 text-4xl font-extrabold font-display text-border/30 leading-none select-none">{c.num}</div>
                <h3 className="text-[0.95rem] font-bold mb-1.5 relative">{c.title}</h3>
                <p className="text-sm text-muted leading-relaxed relative">{c.text}</p>
                <div className="mt-3 pt-3 border-t border-border text-sm text-green font-semibold relative">
                  {c.metric}
                </div>
              </div>
            ))}
          </div>
        </Reveal>
      </div>
    </section>
  )
}

/* ── Methodology ── */
function Methodology() {
  const oldChain = ['Заказчик', 'Аналитик', 'Разработчик', 'QA', 'Заказчик']
  const newChain = ['Бизнес-задача', 'Отраслевой эксперт + AI', 'Продукт']

  const steps = [
    { num: '01', title: 'Выявляю потребность', text: 'Не через исследование рынка — а через ежедневную работу внутри процессов. 10 лет в отрасли — понимание задач из первых рук.' },
    { num: '02', title: 'Быстрый прототип', text: 'AI-инструменты снимают технические ограничения. Архитектура → MVP за дни. Минимально достаточный функционал для проверки гипотезы.' },
    { num: '03', title: 'Экспертная валидация', text: 'Отраслевая экспертиза позволяет самостоятельно оценить корректность решения. Без промежуточных звеньев — от задачи до результата напрямую.' },
    { num: '04', title: 'Итеративное развитие', text: 'Развитие по реальным запросам пользователей, не по гипотетическому roadmap. Приоритет — то, что создаёт измеримую ценность.' },
  ]

  return (
    <section className="py-16">
      <div className="max-w-[1080px] mx-auto px-8">
        <Reveal>
          <SectionHeader
            tag="Как я делаю продукты"
            tagColor="bg-purple-soft text-purple"
            title="От задачи на площадке до рабочего инструмента"
            subtitle="Техническая реализация перестаёт быть ограничением. Ключевой дефицит — понимание предметной области."
          />
        </Reveal>

        {/* Old vs New model */}
        <Reveal stagger>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
            {/* Old model */}
            <div className="bg-surface border border-border rounded-xl p-6 relative overflow-hidden">
              <div className="absolute inset-0 bg-red/[0.03]" />
              <div className="relative">
                <div className="text-xs font-bold uppercase tracking-wider text-red mb-3">Линейная модель</div>
                <div className="flex flex-wrap items-center gap-1.5 mb-4">
                  {oldChain.map((item, i) => (
                    <span key={i} className="contents">
                      <span className="px-2.5 py-1 rounded bg-surface-3 text-xs text-muted line-through decoration-red/40">{item}</span>
                      {i < oldChain.length - 1 && <span className="text-muted/40 text-xs">&rarr;</span>}
                    </span>
                  ))}
                </div>
                <div className="space-y-1.5 text-sm text-muted">
                  <div className="flex items-start gap-2"><span className="text-red shrink-0">&#x2717;</span> Потеря контекста на каждом звене передачи</div>
                  <div className="flex items-start gap-2"><span className="text-red shrink-0">&#x2717;</span> Разработчик не владеет предметной областью</div>
                  <div className="flex items-start gap-2"><span className="text-red shrink-0">&#x2717;</span> Аналитик не знает возможностей технологий</div>
                  <div className="flex items-start gap-2"><span className="text-red shrink-0">&#x2717;</span> Цикл обратной связи — месяцы</div>
                  <div className="flex items-start gap-2"><span className="text-red shrink-0">&#x2717;</span> Ускорение одного звена смещает узкое место в следующее</div>
                </div>
              </div>
            </div>

            {/* New model */}
            <div className="bg-surface border border-accent/30 rounded-xl p-6 relative overflow-hidden">
              <div className="absolute inset-0 bg-accent/[0.03]" />
              <div className="relative">
                <div className="text-xs font-bold uppercase tracking-wider text-accent mb-3">Новая модель</div>
                <div className="flex flex-wrap items-center gap-1.5 mb-4">
                  {newChain.map((item, i) => (
                    <span key={i} className="contents">
                      <span className="px-2.5 py-1 rounded bg-accent-soft text-xs text-accent font-semibold">{item}</span>
                      {i < newChain.length - 1 && <span className="text-accent/50 text-xs">&rarr;</span>}
                    </span>
                  ))}
                </div>
                <div className="space-y-1.5 text-sm text-muted">
                  <div className="flex items-start gap-2"><span className="text-green shrink-0">&#x2713;</span> Эксперт совмещает понимание процесса и реализацию</div>
                  <div className="flex items-start gap-2"><span className="text-green shrink-0">&#x2713;</span> AI снимает технические ограничения</div>
                  <div className="flex items-start gap-2"><span className="text-green shrink-0">&#x2713;</span> Валидация встроена в процесс — без промежуточных звеньев</div>
                  <div className="flex items-start gap-2"><span className="text-green shrink-0">&#x2713;</span> Цикл обратной связи — дни, а не месяцы</div>
                  <div className="flex items-start gap-2"><span className="text-green shrink-0">&#x2713;</span> Ускоряется весь процесс, а не отдельное звено</div>
                </div>
              </div>
            </div>
          </div>
        </Reveal>

        {/* Thesis */}
        <Reveal>
          <div className="bg-surface-2 border border-border rounded-xl p-5 mb-8 max-w-[820px] mx-auto text-center">
            <p className="text-[0.95rem] text-text-primary leading-relaxed">
              AI-инструменты снимают барьер технической реализации. Дефицит смещается: разработчик без отраслевой экспертизы теряет ценность, аналитик без понимания технологий — тоже.{' '}
              <span className="text-accent font-semibold">Максимальная эффективность — у специалиста на стыке: предметная область + технологии + AI.</span>{' '}
              Это редкое сочетание, потому что требует двух параллельных карьер.
            </p>
          </div>
        </Reveal>

        {/* Steps */}
        <Reveal stagger>
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            {steps.map((s) => (
              <div key={s.num} className="bg-surface border border-border rounded-xl p-5">
                <div className="text-3xl font-extrabold font-display text-accent opacity-30 mb-2">{s.num}</div>
                <h4 className="text-sm font-bold mb-1.5">{s.title}</h4>
                <p className="text-sm text-muted leading-relaxed">{s.text}</p>
              </div>
            ))}
          </div>
        </Reveal>
      </div>
    </section>
  )
}

/* ── Research ── */
function Research() {
  const items = [
    {
      title: 'AI-агенты и мультиагентные системы',
      text: 'Архитектуры автономных агентов, context engineering, framework-ы для оркестрации. Применение в продуктах: Автопротокол, AI-Hub.',
      tags: [{ label: 'LangChain', color: 'bg-purple-soft text-purple' }, { label: 'MCP Protocol', color: 'bg-purple-soft text-purple' }, { label: 'Claude Code', color: 'bg-purple-soft text-purple' }],
    },
    {
      title: 'LLM: облачные и локальные модели',
      text: 'Prompt engineering, structured output, RAG-системы. Практика с Gemini, Claude, GPT, Ollama (Llama, Mistral, Qwen).',
      tags: [{ label: 'Gemini', color: 'bg-accent-soft text-accent' }, { label: 'Claude', color: 'bg-accent-soft text-accent' }, { label: 'Ollama', color: 'bg-accent-soft text-accent' }],
    },
    {
      title: 'Speech & NLP',
      text: 'Транскрипция, диаризация, анализ эмоций. Работа с WhisperX, pyannote, wav2vec2. Лемматизация русского языка.',
      tags: [{ label: 'WhisperX', color: 'bg-green-soft text-green' }, { label: 'pyannote', color: 'bg-green-soft text-green' }, { label: 'NLP', color: 'bg-green-soft text-green' }],
    },
    {
      title: 'GPU и ML-инфраструктура',
      text: 'Настройка GPU-серверов для инференса. CUDA-оптимизация. Деплой моделей в Docker. Мониторинг ресурсов.',
      tags: [{ label: 'CUDA', color: 'bg-cyan-soft text-cyan' }, { label: 'PyTorch', color: 'bg-cyan-soft text-cyan' }, { label: 'Docker', color: 'bg-cyan-soft text-cyan' }],
    },
    {
      title: 'Научная деятельность',
      text: 'Аспирантура МГСУ. Публикация: «Integrated methodology for environmental risk management in the life cycle of buildings» (2025).',
      tags: [{ label: 'ORCID', color: 'bg-amber-soft text-amber' }, { label: 'МГСУ', color: 'bg-amber-soft text-amber' }],
    },
    {
      title: 'AI-ассистированная разработка',
      text: 'Системная работа с Cursor и Claude Code. Архитектурное проектирование + AI-генерация. Многоагентные workflow для масштабных задач.',
      tags: [{ label: 'Cursor', color: 'bg-red-soft text-red' }, { label: 'Claude Code', color: 'bg-red-soft text-red' }, { label: 'Vibe Coding', color: 'bg-red-soft text-red' }],
    },
  ]

  return (
    <section id="research" className="bg-surface py-16">
      <div className="max-w-[1080px] mx-auto px-8">
        <Reveal>
          <SectionHeader
            tag="R&D"
            tagColor="bg-purple-soft text-purple"
            title="Чем интересуюсь и что изучаю"
            subtitle="Слежу за технологиями системно: собственный Telegram-бот с AI-классификацией мониторит новые исследования."
          />
        </Reveal>
        <Reveal stagger>
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mt-6">
            {items.map((item) => (
              <div key={item.title} className="bg-bg border border-border rounded-xl p-5 transition-colors hover:border-accent/20">
                <h4 className="text-sm font-bold mb-1">{item.title}</h4>
                <p className="text-sm text-muted leading-relaxed">{item.text}</p>
                <div className="flex flex-wrap gap-1.5 mt-2">
                  {item.tags.map((t) => (
                    <span key={t.label} className={`px-1.5 py-0.5 rounded text-xs font-semibold ${t.color}`}>
                      {t.label}
                    </span>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </Reveal>
      </div>
    </section>
  )
}


/* ── Contact / Footer ── */
function Contact() {
  return (
    <footer className="border-t border-border py-12">
      <div className="max-w-[1080px] mx-auto px-8">
        <Reveal>
          <div className="grid grid-cols-1 md:grid-cols-[1fr_auto] gap-8 items-start">
            <div>
              <h2 className="font-display text-xl md:text-2xl font-bold mb-2">Давайте поговорим</h2>
              <p className="text-muted text-sm mb-5 max-w-[440px]">
                Ищу роль в R&D или продуктовом направлении — там где нужно не координировать разработку, а делать её.
                Руководящая позиция или автономный проект — главное, чтобы было что строить.
              </p>
              <div className="flex flex-col gap-2.5">
                <a
                  href="tel:+79268973225"
                  className="inline-flex items-center gap-3 text-sm text-muted hover:text-accent transition-colors no-underline group"
                >
                  <span className="w-8 h-8 flex items-center justify-center rounded-lg bg-surface-2 border border-border group-hover:border-accent/30 transition-colors">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                      <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                    </svg>
                  </span>
                  +7 (926) 897-32-25
                </a>
                <a
                  href="mailto:KhromenokNV@mail.ru"
                  className="inline-flex items-center gap-3 text-sm text-muted hover:text-accent transition-colors no-underline group"
                >
                  <span className="w-8 h-8 flex items-center justify-center rounded-lg bg-surface-2 border border-border group-hover:border-accent/30 transition-colors">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                      <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/>
                    </svg>
                  </span>
                  KhromenokNV@mail.ru
                </a>
              </div>
            </div>
            <div className="text-sm text-muted md:text-right">
              <div>Москва</div>
              <div className="mt-1">&copy; 2026</div>
            </div>
          </div>
        </Reveal>
      </div>
    </footer>
  )
}

/* ── Shared Components ── */
function SectionHeader({
  tag,
  tagColor,
  title,
  subtitle,
}: {
  tag: string
  tagColor: string
  title: string
  subtitle?: string
}) {
  return (
    <div className="mb-10">
      <div className={`inline-block px-3 py-1 rounded text-xs font-bold tracking-wider uppercase mb-3 ${tagColor}`}>
        {tag}
      </div>
      <h2 className="font-display text-2xl md:text-3xl font-bold mb-2">{title}</h2>
      {subtitle && <p className="text-muted text-[0.95rem] max-w-[620px]">{subtitle}</p>}
    </div>
  )
}

function ArchLayer({ label, children }: { label: string; children: React.ReactNode }) {
  return (
    <div className="flex items-stretch gap-3 flex-col md:flex-row">
      <div className="md:w-[110px] md:min-w-[110px] flex items-center md:justify-end text-xs font-bold uppercase tracking-wide text-muted md:text-right md:pr-2">
        {label}
      </div>
      <div className="flex-1 flex gap-2 flex-wrap">{children}</div>
    </div>
  )
}

const archColors = {
  accent: 'bg-accent-soft border-accent/25 text-accent',
  green: 'bg-green-soft border-green/25 text-green',
  purple: 'bg-purple-soft border-purple/25 text-purple',
  cyan: 'bg-cyan-soft border-cyan/25 text-cyan',
  amber: 'bg-amber-soft border-amber/25 text-amber',
}

function ArchItem({
  color,
  title,
  sub,
  wide,
}: {
  color: keyof typeof archColors
  title: string
  sub?: string
  wide?: boolean
}) {
  return (
    <div
      className={`${wide ? 'flex-[3]' : 'flex-1'} min-w-[130px] px-3 py-2.5 rounded-lg text-sm font-semibold text-center border ${archColors[color]}`}
    >
      {title}
      {sub && <small className="block text-xs font-normal opacity-70 mt-0.5">{sub}</small>}
    </div>
  )
}

export default App

====================================================================================================
END: src\App.tsx
====================================================================================================

====================================================================================================
FILE [13/52]: src\index.css
Size: 7,390 bytes
====================================================================================================

@import "tailwindcss";

@theme {
  --color-bg: #0a0b0f;
  --color-surface: #12141c;
  --color-surface-2: #1a1d28;
  --color-surface-3: #232736;
  --color-border: #2a2e3d;
  --color-text-primary: #e4e7f0;
  --color-muted: #7d8296;
  --color-accent: #4f7cff;
  --color-accent-soft: rgba(79, 124, 255, 0.12);
  --color-green: #34d399;
  --color-green-soft: rgba(52, 211, 153, 0.12);
  --color-amber: #fbbf24;
  --color-amber-soft: rgba(251, 191, 36, 0.12);
  --color-purple: #a78bfa;
  --color-purple-soft: rgba(167, 139, 250, 0.12);
  --color-red: #f87171;
  --color-red-soft: rgba(248, 113, 113, 0.12);
  --color-cyan: #22d3ee;
  --color-cyan-soft: rgba(34, 211, 238, 0.12);
  --font-sans: 'Inter', -apple-system, system-ui, sans-serif;
  --font-display: 'Space Grotesk', 'Inter', sans-serif;
}

html.light {
  --color-bg: #f8f9fc;
  --color-surface: #ffffff;
  --color-surface-2: #f0f2f7;
  --color-surface-3: #e4e7f0;
  --color-border: #d4d8e3;
  --color-text-primary: #1a1d28;
  --color-muted: #5c6178;
  --color-accent: #4f7cff;
  --color-accent-soft: rgba(79, 124, 255, 0.08);
  --color-green: #059669;
  --color-green-soft: rgba(5, 150, 105, 0.08);
  --color-amber: #d97706;
  --color-amber-soft: rgba(217, 119, 6, 0.08);
  --color-purple: #7c3aed;
  --color-purple-soft: rgba(124, 58, 237, 0.08);
  --color-red: #dc2626;
  --color-red-soft: rgba(220, 38, 38, 0.08);
  --color-cyan: #0891b2;
  --color-cyan-soft: rgba(8, 145, 178, 0.08);
}

html {
  scroll-behavior: smooth;
}

body {
  font-family: var(--font-sans);
  background: var(--color-bg);
  color: var(--color-text-primary);
  line-height: 1.65;
  -webkit-font-smoothing: antialiased;
  margin: 0;
}

/* Theme transition — circular reveal via View Transitions API */
::view-transition-old(root),
::view-transition-new(root) {
  animation: none;
  mix-blend-mode: normal;
}

::view-transition-old(root) {
  z-index: 1;
}

::view-transition-new(root) {
  z-index: 9999;
}

/* Product card expand animation */
.product-detail {
  display: grid;
  grid-template-rows: 0fr;
  transition: grid-template-rows 0.35s ease;
}

.product-detail.open {
  grid-template-rows: 1fr;
}

.product-detail-inner {
  overflow: hidden;
}

/* Timeline horizontal scroll */
.timeline-scroll {
  overflow-x: auto;
  scrollbar-width: thin;
  scrollbar-color: var(--color-border) transparent;
}

.timeline-scroll::-webkit-scrollbar {
  height: 6px;
}

.timeline-scroll::-webkit-scrollbar-track {
  background: transparent;
}

.timeline-scroll::-webkit-scrollbar-thumb {
  background: var(--color-border);
  border-radius: 3px;
}

/* Architecture connector arrows */
.arch-arrow {
  text-align: center;
  color: var(--color-muted);
  font-size: 0.75rem;
  padding: 0.15rem 0;
  opacity: 0.5;
}

/* DataBook demo search highlight */
mark {
  background: var(--color-accent-soft);
  color: var(--color-accent);
  padding: 0 2px;
  border-radius: 2px;
}

/* Demo modal animations */
.demo-modal-enter {
  animation: demoModalIn 0.3s ease-out both;
}

@keyframes demoModalIn {
  from {
    opacity: 0;
    transform: scale(0.95) translateY(10px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

/* Body scroll lock when modal is open */
body.demo-modal-open {
  overflow: hidden;
}

/* Sminex CRM animations */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes slideUp {
  from { opacity: 0; transform: translateY(100%); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes toastIn {
  from { opacity: 0; transform: translateY(-100%); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes scaleIn {
  from { opacity: 0; transform: scale(0.95); }
  to { opacity: 1; transform: scale(1); }
}

@keyframes toastOut {
  from { opacity: 1; transform: translateY(0); }
  to { opacity: 0; transform: translateY(-100%); }
}

@keyframes toastProgress {
  from { width: 100%; }
  to { width: 0%; }
}

/* ── Reveal animations ── */
.reveal {
  opacity: 0;
  transform: translateY(24px);
  transition: opacity 700ms cubic-bezier(0.16, 1, 0.3, 1),
              transform 700ms cubic-bezier(0.16, 1, 0.3, 1);
}

.reveal.revealed {
  opacity: 1;
  transform: translateY(0);
}

.reveal-stagger > * {
  opacity: 0;
  transform: translateY(24px);
  transition: opacity 700ms cubic-bezier(0.16, 1, 0.3, 1),
              transform 700ms cubic-bezier(0.16, 1, 0.3, 1);
}

.reveal-stagger.revealed > * {
  opacity: 1;
  transform: translateY(0);
}

.reveal-stagger.revealed > *:nth-child(1) { transition-delay: 0ms; }
.reveal-stagger.revealed > *:nth-child(2) { transition-delay: 80ms; }
.reveal-stagger.revealed > *:nth-child(3) { transition-delay: 160ms; }
.reveal-stagger.revealed > *:nth-child(4) { transition-delay: 240ms; }
.reveal-stagger.revealed > *:nth-child(5) { transition-delay: 320ms; }
.reveal-stagger.revealed > *:nth-child(6) { transition-delay: 400ms; }
.reveal-stagger.revealed > *:nth-child(7) { transition-delay: 480ms; }
.reveal-stagger.revealed > *:nth-child(8) { transition-delay: 560ms; }
.reveal-stagger.revealed > *:nth-child(9) { transition-delay: 640ms; }
.reveal-stagger.revealed > *:nth-child(10) { transition-delay: 720ms; }
.reveal-stagger.revealed > *:nth-child(11) { transition-delay: 800ms; }
.reveal-stagger.revealed > *:nth-child(12) { transition-delay: 880ms; }

/* ── Display font utility ── */
.font-display {
  font-family: var(--font-display);
}

/* ── Hero orb drift ── */
@keyframes heroOrb {
  0%, 100% { transform: translate(-50%, 0) scale(1); }
  50% { transform: translate(-45%, -8%) scale(1.05); }
}

/* ── Timeline pulse glow ── */
@keyframes pulseGlow {
  0%, 100% { box-shadow: 0 0 8px rgba(79, 124, 255, 0.4); }
  50% { box-shadow: 0 0 16px rgba(79, 124, 255, 0.7); }
}

/* ── Noise overlay ── */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 9998;
  opacity: 0.015;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
  background-repeat: repeat;
  background-size: 256px 256px;
}

html.light body::before {
  opacity: 0.025;
}

/* ── Selection ── */
::selection {
  background: var(--color-accent);
  color: white;
}

/* ── Focus visible ── */
:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
}

/* ── Custom scrollbar ── */
::-webkit-scrollbar {
  width: 6px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: var(--color-border);
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--color-muted);
}

/* ── Scroll progress bar ── */
.scroll-progress {
  position: fixed;
  top: 0;
  left: 0;
  height: 2px;
  background: var(--color-accent);
  z-index: 60;
  transform-origin: left;
  transition: none;
}

====================================================================================================
END: src\index.css
====================================================================================================

====================================================================================================
FILE [14/52]: src\main.tsx
Size: 514 bytes
====================================================================================================

import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import { BrowserRouter, Routes, Route } from 'react-router-dom'
import './index.css'
import App from './App'
import SminexDemo from './pages/SminexDemo'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<App />} />
        <Route path="/sminex" element={<SminexDemo />} />
      </Routes>
    </BrowserRouter>
  </StrictMode>,
)

====================================================================================================
END: src\main.tsx
====================================================================================================


####################################################################################################
# DIR: src\components
####################################################################################################

====================================================================================================
FILE [15/52]: src\components\CodeShowcase.tsx
Size: 17,308 bytes
====================================================================================================

import { useState } from 'react'

interface CodeSnippet {
  id: string
  label: string
  product: string
  productColor: string
  file: string
  description: string
  code: string
}

const snippets: CodeSnippet[] = [
  {
    id: 'oauth',
    label: 'OAuth2 Access Control',
    product: 'AI-Hub',
    productColor: 'bg-accent-soft text-accent',
    file: 'backend/src/services/oauth_service.py',
    description: 'Многоуровневая проверка доступа: публичность → департамент → прямой доступ → групповой доступ → legacy fallback',
    code: `@staticmethod
async def check_user_access(
    db: AsyncSession,
    user: User,
    application: Application,
) -> bool:
    """
    Check if user has access to the application.

    Access is granted if:
    1. Application is public (is_public=True), OR
    2. User's department is in allowed_departments (if set), OR
    3. User has direct ApplicationAccess, OR
    4. User is member of a group with ApplicationAccess
    """
    # 1. Public apps are accessible to everyone
    if application.is_public:
        return True

    # 2. Check department restrictions (if allowed_departments is set)
    allowed_departments = application.allowed_departments or []
    if allowed_departments:
        user_department = user.department or ""
        if user_department in allowed_departments:
            return True

    # 3. Check direct user access
    direct_access = await db.execute(
        select(ApplicationAccess).where(
            ApplicationAccess.user_id == user.id,
            ApplicationAccess.application_id == application.id
        )
    )
    if direct_access.scalar_one_or_none():
        return True

    # 4. Check group access
    from ..models.user_group import user_group_members
    user_groups = await db.execute(
        select(user_group_members.c.group_id).where(
            user_group_members.c.user_id == user.id
        )
    )
    group_ids = [row[0] for row in user_groups.fetchall()]

    if group_ids:
        group_access = await db.execute(
            select(ApplicationAccess).where(
                ApplicationAccess.group_id.in_(group_ids),
                ApplicationAccess.application_id == application.id
            )
        )
        if group_access.scalar_one_or_none():
            return True

    # 5. Legacy: if no rules defined, open to all authenticated
    if not allowed_departments:
        any_access_rules = await db.execute(
            select(ApplicationAccess).where(
                ApplicationAccess.application_id == application.id
            ).limit(1)
        )
        if not any_access_rules.scalar_one_or_none():
            return True

    return False`,
  },
  {
    id: 'streaming',
    label: 'Streaming Chat + Async',
    product: 'AI-Hub',
    productColor: 'bg-accent-soft text-accent',
    file: 'backend/src/api/chat.py',
    description: 'SSE-стриминг через thread pool для sync SDK, неблокирующее сохранение в БД, подсчёт токенов',
    code: `async def generate() -> AsyncGenerator[str, None]:
    try:
        # Run sync SDK in thread pool to avoid blocking
        response_text, input_tokens, output_tokens = await asyncio.to_thread(
            sync_generate_content,
            model_name,
            contents,
            chat_settings.system_prompt,
            chat_settings.max_tokens
        )

        # Stream response in small JSON-encoded chunks
        chunk_size = 12
        for i in range(0, len(response_text), chunk_size):
            chunk = response_text[i:i + chunk_size]
            yield f"data: {json.dumps(chunk)}\\n\\n"
            await asyncio.sleep(0.015)

        yield f"event: done\\ndata: {session_id}\\n\\n"

        # Save assistant message — new session to avoid blocking stream
        from ..db.base import AsyncSessionLocal
        async with AsyncSessionLocal() as new_db:
            assistant_message = ChatMessage(
                user_id=current_user.id,
                session_id=session_id,
                role="assistant",
                content=response_text,
                model_name=model_name,
                input_tokens=input_tokens,
                output_tokens=output_tokens
            )
            new_db.add(assistant_message)
            await new_db.commit()

    except Exception as e:
        error_msg = str(e)
        logger.error(f"Gemini error (model={model_name}): {error_msg}")
        yield f"event: error\\ndata: {error_msg}\\n\\n"

return StreamingResponse(
    generate(),
    media_type="text/event-stream",
    headers={
        "Cache-Control": "no-cache",
        "Connection": "keep-alive",
        "X-Session-Id": str(session_id),
    }
)`,
  },
  {
    id: 'gemini',
    label: 'AI-классификация (Gemini)',
    product: 'CostManager',
    productColor: 'bg-green-soft text-green',
    file: 'gemini_autoclassifier_routes.py',
    description: 'Chain-of-Thought промпт с few-shot примерами, structured JSON output, confidence scoring',
    code: `# УЛУЧШЕННЫЙ ПРОМПТ С FEW-SHOT И CoT
prompt = f"""Ты — эксперт по классификации строительных работ.
Всегда углубляйся до максимальной глубины.

**РАБОТА:** "{smet_name}"
**ТЕКУЩИЙ ПУТЬ:** {breadcrumb_str}

**ДОСТУПНЫЕ КАТЕГОРИИ:**
{context_list_str}

**КРИТИЧЕСКИ ВАЖНЫЕ ПРАВИЛА:**
1. Всегда выбирай наиболее конкретную категорию
2. STOP_HERE ТОЛЬКО если работа охватывает 3+ разные системы
3. UNCERTAIN только если уверенность <70%
4. ОБЯЗАТЕЛЬНЫЕ СООТВЕТСТВИЯ:
   - "водоснабжение" → "Хозяйственно-питьевой водопровод"
   - "хоз-бытовая канализация" → "Бытовая канализация"
   - "отопление" → "Отопление"
   - "вентиляция" → "Вентиляция общеобменная"

**ПРИМЕРЫ:**
- "Комплекс работ по монтажу систем вентиляции"
  → 8.2.2 (Вентиляция общеобменная), ключевое 'вентиляция'
- "Комплекс работ по монтажу теплового пункта"
  → 8.2.6 (Тепловые пункты), не STOP
- "водоснабжение, канализация, отопление"
  → STOP_HERE (3+ разные системы)

**ШАГ-ЗА-ШАГОМ:**
1. Выдели ключевые слова из работы
2. Сопоставь с именами категорий
3. Выбери самую конкретную
4. Оцени уверенность 0-1

Ответ: JSON {{"code": "код", "reason": "объяснение",
              "confidence": 0.9}}"""`,
  },
  {
    id: 'stats',
    label: 'P10/P90 аналитика',
    product: 'CostManager',
    productColor: 'bg-green-soft text-green',
    file: 'analogs_routes.py',
    description: 'Статистический анализ: перцентили, выбросы, медиана, стандартное отклонение через numpy',
    code: `def process_tree_for_stats(node_list):
    node_list.sort(key=lambda x: natural_sort_key(x['code']))
    for node in node_list:
        for metric in all_metrics_for_stats:
            ids_for_stats = [
                c_id for c_id in columns_info
                if c_id != reference_entity_col_id
            ]
            values = np.array([
                float(comparison_data[c_id]
                      .get(node['id'], {})
                      .get(metric, 0))
                for c_id in ids_for_stats
                if comparison_data[c_id]
                   .get(node['id'], {})
                   .get(metric) is not None
            ])
            non_zero_values = values[values != 0]
            stats_dict = {
                'avg': 0, 'min': 0, 'max': 0,
                'median': 0, 'p10': 0, 'p90': 0,
                'std': 0, 'count': 0, 'avg_no_outliers': 0
            }
            if len(non_zero_values) > 0:
                p10 = np.percentile(non_zero_values, 10)
                p90 = np.percentile(non_zero_values, 90)
                # Фильтрация выбросов по P10/P90
                values_no_outliers = non_zero_values[
                    (non_zero_values >= p10) &
                    (non_zero_values <= p90)
                ]
                stats_dict.update({
                    'avg': np.mean(non_zero_values),
                    'min': np.min(non_zero_values),
                    'max': np.max(non_zero_values),
                    'median': np.median(non_zero_values),
                    'p10': p10, 'p90': p90,
                    'std': np.std(non_zero_values),
                    'count': len(non_zero_values),
                    'avg_no_outliers': (
                        np.mean(values_no_outliers)
                        if len(values_no_outliers) > 0
                        else 0
                    )
                })
            statistics[node['id']][metric] = stats_dict`,
  },
  {
    id: 'excel',
    label: 'Excel-отчёты',
    product: 'CostManager',
    productColor: 'bg-green-soft text-green',
    file: 'analogs_routes.py',
    description: 'Генерация профессиональных отчётов: цветовые схемы, мульти-листы, форматирование, титульные страницы',
    code: `def _generate_comparison_excel(
    columns_info, categories_structure,
    comparison_data, statistics,
    reference_entity_col_id, target_date
):
    output = io.BytesIO()
    workbook = xlsxwriter.Workbook(
        output, {'in_memory': True, 'strings_to_numbers': True}
    )

    # Пастельная палитра для аналогов + зелёный для эталона
    pastel_colors = ['#FDE9D9', '#DEEAF6', '#FFF2CC', '#EAECEE']
    darker_shades_map = {
        '#E2EFDA': '#C5E0B4',  # Зеленый (Эталон)
        '#FDE9D9': '#F8CBAC',  # Оранжевый
        '#DEEAF6': '#BDD7EE',  # Синий
        '#FFF2CC': '#FFE699',  # Золотой
    }

    # Форматы: условное форматирование отклонений
    f = {
        'pct_dev_high': workbook.add_format({
            'font_color': '#9C0006',
            'bg_color': '#FFC7CE',
            'num_format': '0.0%'
        }),
        'pct_dev_low': workbook.add_format({
            'font_color': '#006100',
            'bg_color': '#D5F5E3',
            'num_format': '0.0%'
        }),
        'rub_c': workbook.add_format({
            'border': 1,
            'num_format': '#,##0.00',
            'align': 'center'
        }),
    }

    # Цветовая карта: эталон = зелёный, аналоги = пастельные
    col_color_map = {}
    color_index = 0
    for col_id in sorted_col_ids:
        if col_id == reference_entity_col_id:
            col_color_map[col_id] = {
                'light': '#E2EFDA', 'dark': '#C5E0B4'
            }
        else:
            base = pastel_colors[color_index % len(pastel_colors)]
            col_color_map[col_id] = {
                'light': base,
                'dark': darker_shades_map[base]
            }
            color_index += 1

    # Титульный лист
    ws_title = workbook.add_worksheet("Титульный лист")
    ws_title.merge_range(
        'B2:C2',
        'Сравнительный анализ стоимостных показателей',
        f['h_title']
    )`,
  },
  {
    id: 'ratelimit',
    label: 'Rate Limiting Middleware',
    product: 'AI-Hub',
    productColor: 'bg-accent-soft text-accent',
    file: 'backend/src/core/rate_limit.py',
    description: 'Path-aware rate limiting со sliding windows, X-Forwarded-For, автоочистка памяти',
    code: `class RateLimitMiddleware(BaseHTTPMiddleware):
    """In-memory rate limiting with path-based limits."""

    def __init__(self, app):
        super().__init__(app)
        self.requests: Dict[str, Dict[str, Tuple[int, float]]] = (
            defaultdict(dict)
        )
        # Rate limits: (max_requests, window_seconds)
        self.limits = {
            '/auth/': (50, 60),
            '/oauth/token': (30, 60),
            '/api/admin/': (100, 60),
            'default': (200, 60),
        }

    def _get_client_ip(self, request: Request) -> str:
        forwarded = request.headers.get('X-Forwarded-For')
        if forwarded:
            return forwarded.split(',')[0].strip()
        return request.client.host if request.client else 'unknown'

    def _check_rate_limit(
        self, client_ip: str, limit_key: str
    ) -> Tuple[bool, int]:
        max_requests, window_seconds = self.limits[limit_key]
        now = time.time()

        if limit_key not in self.requests[client_ip]:
            self.requests[client_ip][limit_key] = (1, now)
            return True, 0

        count, window_start = self.requests[client_ip][limit_key]

        if now - window_start > window_seconds:
            self.requests[client_ip][limit_key] = (1, now)
            return True, 0

        if count < max_requests:
            self.requests[client_ip][limit_key] = (
                count + 1, window_start
            )
            return True, 0

        retry_after = int(
            window_seconds - (now - window_start)
        ) + 1
        return False, retry_after

    def _cleanup_old_entries(self):
        """Prevent memory growth — remove expired entries."""
        now = time.time()
        max_window = max(l[1] for l in self.limits.values())
        for ip in list(self.requests.keys()):
            for key in list(self.requests[ip].keys()):
                _, start = self.requests[ip][key]
                if now - start > max_window * 2:
                    del self.requests[ip][key]
            if not self.requests[ip]:
                del self.requests[ip]`,
  },
]

export function CodeShowcase() {
  const [activeId, setActiveId] = useState(snippets[0].id)
  const active = snippets.find((s) => s.id === activeId)!

  return (
    <section id="code" className="py-16">
      <div className="max-w-[1080px] mx-auto px-8">
        <div className="mb-10">
          <div className="inline-block px-3 py-1 rounded text-[0.7rem] font-bold tracking-wider uppercase mb-3 bg-red-soft text-red">
            Исходный код
          </div>
          <h2 className="text-2xl font-bold mb-2">Фрагменты production-кода</h2>
          <p className="text-muted text-[0.92rem] max-w-[620px]">
            Реальный код из рабочих проектов. FastAPI async, SQLAlchemy, Gemini API, numpy, xlsxwriter.
          </p>
        </div>

        {/* Tab buttons */}
        <div className="flex flex-wrap gap-2 mb-4">
          {snippets.map((s) => (
            <button
              key={s.id}
              onClick={() => setActiveId(s.id)}
              className={`px-3 py-1.5 rounded-lg text-[0.78rem] font-medium border transition-all cursor-pointer ${
                activeId === s.id
                  ? 'bg-accent/15 border-accent/40 text-accent'
                  : 'bg-surface border-border text-muted hover:border-accent/20 hover:text-text-primary'
              }`}
            >
              {s.label}
            </button>
          ))}
        </div>

        {/* Code display */}
        <div className="bg-surface border border-border rounded-2xl overflow-hidden">
          {/* Header */}
          <div className="px-5 py-3 border-b border-border flex items-center justify-between flex-wrap gap-2">
            <div className="flex items-center gap-3">
              <span className={`px-2 py-0.5 rounded text-[0.66rem] font-bold ${active.productColor}`}>
                {active.product}
              </span>
              <span className="text-[0.8rem] font-semibold">{active.label}</span>
            </div>
            <span className="text-[0.72rem] text-muted font-mono">{active.file}</span>
          </div>

          {/* Description */}
          <div className="px-5 py-2.5 border-b border-border bg-surface-2">
            <p className="text-[0.78rem] text-muted">{active.description}</p>
          </div>

          {/* Code block */}
          <div className="overflow-x-auto">
            <pre className="p-5 text-[0.75rem] leading-relaxed font-mono text-text-primary/90">
              <code>{active.code}</code>
            </pre>
          </div>
        </div>
      </div>
    </section>
  )
}

====================================================================================================
END: src\components\CodeShowcase.tsx
====================================================================================================

====================================================================================================
FILE [16/52]: src\components\DataBookDemo.tsx
Size: 59,094 bytes
====================================================================================================

import { useState, useMemo, useCallback, useEffect } from 'react'
import { createPortal } from 'react-dom'

type Screen = 'search' | 'catalog' | 'analytics' | 'import' | 'settings'

/* ── Data ── */
const prescriptions = [
  /* Бетонные работы → Армирование */
  { id: 1, subtype: 'Армирование', text: 'Не обеспечена проектная толщина защитного слоя бетона. Фактическое расстояние от арматуры до опалубки 15мм при требуемом 25мм.', ntd: 'СП 70.13330', ntdClause: 'п.5.7.1', ntdFull: 'Несущие и ограждающие конструкции', rd: 'РД КЖ-1 лист 12', ntdOk: true, date: '12.01.2026' },
  /* Бетонные работы → Бетонирование */
  { id: 2, subtype: 'Бетонирование', text: 'Обнаружены раковины и каверны на поверхности монолитной стены подвала оси 3-4/А-Б. Глубина каверн до 30мм, площадь поражения ~0.8 м². Требуется инъектирование.', ntd: 'СП 70.13330', ntdClause: 'п.5.18.3', ntdFull: 'Несущие и ограждающие конструкции', rd: 'РД КЖ-2 лист 8', ntdOk: true, date: '15.01.2026' },
  /* Бетонные работы → Опалубка */
  { id: 3, subtype: 'Опалубка', text: 'Прогиб опалубки перекрытия на отм. +12.600 превышает допуск. Фактический прогиб 8мм при допустимом 3мм. Зафиксировано в осях 5-6/В-Г.', ntd: 'СП 70.13330', ntdClause: 'п.5.17.8', ntdFull: 'Несущие и ограждающие конструкции', rd: 'РД КЖ-3 лист 15', ntdOk: true, date: '18.01.2026' },
  /* Каменная кладка → Кладочные работы */
  { id: 4, subtype: 'Кладочные работы', text: 'Отклонение кладки от вертикали составляет 18мм на высоту этажа при допустимом 10мм. Кладка из керамического кирпича М150 на растворе М100.', ntd: 'СП 70.13330', ntdClause: 'п.9.2.1, табл.9.8', ntdFull: 'Несущие и ограждающие конструкции', rd: 'РД АР-1 лист 25', ntdOk: true, date: '22.01.2026' },
  /* Каменная кладка → Перегородки */
  { id: 5, subtype: 'Перегородки', text: 'Перегородки из ПГП толщиной 80мм не закреплены к перекрытию. Отсутствует упругая прокладка в узле примыкания к потолку. Этаж 9, секция 2.', ntd: 'СП 70.13330', ntdClause: 'п.9.3.2', ntdFull: 'Несущие и ограждающие конструкции', rd: 'РД АР-2 лист 31', ntdOk: true, date: '24.01.2026' },
  /* Кровля → Гидроизоляция */
  { id: 6, subtype: 'Гидроизоляция', text: 'Нарушена целостность гидроизоляционного ковра в зоне примыкания к парапету на отм. +28.500. Механические повреждения мембраны длиной ~1.2м.', ntd: 'СП 71.13330', ntdClause: 'п.5.1.23', ntdFull: 'Изоляционные и отделочные покрытия', rd: 'РД АР-1 лист 48', ntdOk: true, date: '28.01.2026' },
  /* Кровля → Водоотвод */
  { id: 7, subtype: 'Водоотвод', text: 'Уклон кровельного покрытия на участке между воронками В-3 и В-4 не соответствует проекту. Фактический уклон 0.5% при требуемом 1.5%. Образование застойных зон.', ntd: 'СП 17.13330', ntdClause: 'п.5.2.7', ntdFull: 'Кровли', rd: 'РД АР-3 лист 6', ntdOk: true, date: '30.01.2026' },
  /* Кровля → Утепление */
  { id: 8, subtype: 'Утепление', text: 'Толщина утеплителя кровли (ПИР 50мм) не соответствует проекту (ПИР 100мм). Участок в осях А-Б/1-3. Теплотехнический расчёт нарушен.', ntd: 'СП 50.13330', ntdClause: 'п.8.2', ntdFull: 'Тепловая защита зданий', rd: 'РД АР-3 лист 9', ntdOk: true, date: '01.02.2026' },
  /* Фасады → НВФ */
  { id: 9, subtype: 'НВФ', text: 'Монтаж навесного вентилируемого фасада выполнен с нарушением шага крепления кронштейнов. Фактический шаг 800мм при проектном 600мм. Участок 3-5 этажей.', ntd: 'СТО НОСТРОЙ 2.14.62', ntdClause: 'п.7.3.4', ntdFull: '', rd: 'РД АР-5 лист 14', ntdOk: false, date: '03.02.2026' },
  /* Фасады → Штукатурка */
  { id: 10, subtype: 'Штукатурка', text: 'Отслоение штукатурного слоя фасада на площади ~3.5 м² в уровне 2 этажа. Адгезия не обеспечена — основание не обработано грунтовкой.', ntd: 'СП 71.13330', ntdClause: 'п.7.2.13', ntdFull: 'Изоляционные и отделочные покрытия', rd: 'РД АР-5 лист 22', ntdOk: true, date: '05.02.2026' },
  /* Электромонтаж → Кабельные линии */
  { id: 11, subtype: 'Кабельные линии', text: 'Кабельные линии 0.4кВ в шахте проложены без соблюдения минимальных расстояний между силовыми и слаботочными трассами. Фактическое расстояние 50мм при требуемом 100мм.', ntd: 'ПУЭ-7', ntdClause: 'п.2.1.15, табл.2.1.1', ntdFull: 'Правила устройства электроустановок', rd: 'РД ЭОМ-1 лист 7', ntdOk: true, date: '06.02.2026' },
  /* Электромонтаж → Щитовое */
  { id: 12, subtype: 'Щитовое', text: 'Электрощит ВРУ-1 установлен с нарушением зоны обслуживания. Расстояние до стены 0.5м при требуемом не менее 0.8м. Подвал, пом. 001.', ntd: 'ПУЭ-7', ntdClause: 'п.4.1.23', ntdFull: 'Правила устройства электроустановок', rd: 'РД ЭОМ-2 лист 3', ntdOk: true, date: '07.02.2026' },
  /* Сантехника → Водоснабжение */
  { id: 13, subtype: 'Водоснабжение', text: 'Трубопровод ХВС Ду32 в техподполье проложен без уклона. Требуемый уклон i=0.002 не обеспечен на участке длиной 12м в осях 2-4.', ntd: 'СП 30.13330', ntdClause: 'п.8.3.1', ntdFull: 'Внутренний водопровод и канализация', rd: 'РД ВК-1 лист 5', ntdOk: true, date: '08.02.2026' },
  /* Сантехника → Канализация */
  { id: 14, subtype: 'Канализация', text: 'Канализационный стояк К1-5 смонтирован без ревизии на 5 этаже. По проекту ревизия предусмотрена через каждые 3 этажа.', ntd: 'СП 30.13330', ntdClause: 'п.8.6.4', ntdFull: 'Внутренний водопровод и канализация', rd: 'РД ВК-2 лист 11', ntdOk: true, date: '09.02.2026' },
  /* Металлоконструкции → Сварка */
  { id: 15, subtype: 'Сварка', text: 'Сварные соединения балки Б-12 к колонне К-5 не прошли ВИК. Обнаружены подрезы глубиной 1.5мм и непровар корня шва длиной 40мм.', ntd: 'СП 16.13330', ntdClause: 'п.14.1.8, табл.14.1', ntdFull: '', rd: 'РД КМ-1 лист 18', ntdOk: false, date: '10.02.2026' },
  /* Металлоконструкции → Антикор */
  { id: 16, subtype: 'Антикор', text: 'Антикоррозийное покрытие стальных колонн подземной автостоянки нанесено толщиной 80мкм при проектном значении 150мкм. Оси 1-3/А-В.', ntd: 'СП 28.13330', ntdClause: 'п.9.3.2', ntdFull: 'Защита строительных конструкций от коррозии', rd: 'РД КМ-1 лист 24', ntdOk: true, date: '11.02.2026' },
  /* Отделочные работы → Покраска */
  { id: 17, subtype: 'Покраска', text: 'Окраска стен МОП выполнена без шпаклевания. Видны дефекты основания, полосы от валика. Качество — ниже категории К3.', ntd: 'СП 71.13330', ntdClause: 'п.7.6.4', ntdFull: 'Изоляционные и отделочные покрытия', rd: 'РД АР-4 лист 7', ntdOk: true, date: '12.02.2026' },
  /* Отделочные работы → Плитка */
  { id: 18, subtype: 'Плитка', text: 'Отклонение поверхности керамогранита от плоскости 4мм на длине 2м при допустимом 2мм. Санузел кв. 412, корпус 2.', ntd: 'СП 71.13330', ntdClause: 'п.7.4.13, табл.7.6', ntdFull: 'Изоляционные и отделочные покрытия', rd: 'РД АР-4 лист 15', ntdOk: true, date: '13.02.2026' },
  /* Земляные работы → Котлован */
  { id: 19, subtype: 'Котлован', text: 'Перебор грунта при разработке котлована на отм. -4.200 составляет 300мм. Требуется устройство подготовки из щебня с уплотнением.', ntd: 'СП 45.13330', ntdClause: 'п.6.1.6, табл.6.3', ntdFull: 'Земляные сооружения, основания и фундаменты', rd: 'РД КЖ-0 лист 3', ntdOk: true, date: '14.02.2026' },
  /* Земляные работы → Обратная засыпка */
  { id: 20, subtype: 'Обратная засыпка', text: 'Обратная засыпка пазух котлована выполнена мёрзлым грунтом с включениями льда. Коэффициент уплотнения 0.89 при требуемом 0.95.', ntd: 'СП 45.13330', ntdClause: 'п.6.3.8', ntdFull: 'Земляные сооружения, основания и фундаменты', rd: 'РД КЖ-0 лист 5', ntdOk: true, date: '15.02.2026' },
  /* Геодезия → Исполнит. съёмка */
  { id: 21, subtype: 'Исполнит. съёмка', text: 'Отклонение оси колонны К-14 от проектного положения в плане составляет 22мм при допустимом 8мм. Отметка +6.000, секция 1.', ntd: 'СП 126.13330', ntdClause: 'п.10.2.3, табл.10.1', ntdFull: 'Геодезические работы в строительстве', rd: 'РД КЖ-1 лист 4', ntdOk: true, date: '16.02.2026' },
  /* Геодезия → Мониторинг */
  { id: 22, subtype: 'Мониторинг', text: 'Осадка фундаментной плиты корп. 2 по реперу Р-7 составила 18мм за последний цикл наблюдений при прогнозном значении 8мм. Требуется внеплановое обследование.', ntd: 'СП 22.13330', ntdClause: 'п.5.6.12', ntdFull: 'Основания зданий и сооружений', rd: 'ППГР лист 2', ntdOk: true, date: '17.02.2026' },
  /* Лифты → Монтаж */
  { id: 23, subtype: 'Монтаж', text: 'Отклонение направляющих лифта Л-3 от вертикали превышает 5мм на длине 5м при допустимом 1мм. Шахта 3, корпус 1.', ntd: 'ГОСТ 33984.1', ntdClause: 'п.5.2.5.2.1', ntdFull: 'Лифты. Общие требования безопасности', rd: 'РД КЖ-7 лист 2', ntdOk: true, date: '18.02.2026' },
  /* Лифты → Шахта */
  { id: 24, subtype: 'Шахта', text: 'Размеры лифтовой шахты не соответствуют паспорту оборудования. Ширина 1650мм при требуемой 1700мм. Корпус 2, шахта 1.', ntd: 'ГОСТ 33984.1', ntdClause: 'п.5.2.1.2', ntdFull: 'Лифты. Общие требования безопасности', rd: 'РД КЖ-7 лист 4', ntdOk: true, date: '18.02.2026' },
  /* Документация → ИД */
  { id: 25, subtype: 'ИД', text: 'Не оформлены акты освидетельствования скрытых работ на армирование плиты перекрытия П-5 (отм. +9.000). Бетонирование выполнено без подписанного АОСР.', ntd: 'РД 11-02-2006', ntdClause: 'п.5.3', ntdFull: 'Требования к составу и порядку ведения ИД', rd: 'РД КЖ-1 лист 20', ntdOk: true, date: '19.02.2026' },
  /* Документация → Журналы */
  { id: 26, subtype: 'Журналы', text: 'Общий журнал работ не заполняется с 01.02.2026. Отсутствуют записи о производстве работ за 14 рабочих дней. Корпус 1.', ntd: 'РД 11-05-2007', ntdClause: 'п.3, п.4', ntdFull: 'Порядок ведения общего и специальных журналов', rd: '—', ntdOk: true, date: '19.02.2026' },
]

const categories = [
  { emoji: '🏗', name: 'Бетонные работы', count: 1240, subtypes: ['Армирование', 'Бетонирование', 'Опалубка'] },
  { emoji: '🧱', name: 'Каменная кладка', count: 890, subtypes: ['Кладочные работы', 'Перегородки', 'Расшивка'] },
  { emoji: '🏠', name: 'Кровля', count: 670, subtypes: ['Гидроизоляция', 'Утепление', 'Водоотвод'] },
  { emoji: '🪟', name: 'Фасады', count: 520, subtypes: ['НВФ', 'Штукатурка', 'Остекление'] },
  { emoji: '🔌', name: 'Электромонтаж', count: 480, subtypes: ['Кабельные линии', 'Щитовое', 'Освещение'] },
  { emoji: '🚰', name: 'Сантехника', count: 440, subtypes: ['Водоснабжение', 'Канализация', 'Отопление'] },
  { emoji: '🏗', name: 'Металлоконструкции', count: 380, subtypes: ['Сварка', 'Болтовые соед.', 'Антикор'] },
  { emoji: '🪵', name: 'Отделочные работы', count: 350, subtypes: ['Штукатурка', 'Покраска', 'Плитка'] },
  { emoji: '⛏', name: 'Земляные работы', count: 310, subtypes: ['Котлован', 'Обратная засыпка', 'Планировка'] },
  { emoji: '📐', name: 'Геодезия', count: 280, subtypes: ['Разбивка', 'Исполнит. съёмка', 'Мониторинг'] },
  { emoji: '🛗', name: 'Лифты', count: 190, subtypes: ['Монтаж', 'Пусконаладка', 'Шахта'] },
  { emoji: '📋', name: 'Документация', count: 250, subtypes: ['ИД', 'Акты', 'Журналы'] },
]

const nav: { key: Screen; emoji: string; label: string; section?: string }[] = [
  { key: 'search', emoji: '🔍', label: 'Поиск' },
  { key: 'catalog', emoji: '📚', label: 'Каталог' },
  { key: 'analytics', emoji: '📊', label: 'Аналитика', section: 'АДМИНИСТРИРОВАНИЕ' },
  { key: 'import', emoji: '📥', label: 'Импорт' },
  { key: 'settings', emoji: '⚙️', label: 'Настройки' },
]

const titles: Record<Screen, string> = {
  search: 'Поиск предписаний',
  catalog: 'Каталог по категориям',
  analytics: 'Аналитика',
  import: 'Импорт данных',
  settings: 'Настройки',
}

const BRAND = '#2563EB'

/* ===== EXPORT ===== */
export function DataBookDemo() {
  const [open, setOpen] = useState(false)
  return (
    <>
      <div className="mt-5 flex justify-center">
        <button onClick={(e) => { e.stopPropagation(); setOpen(true) }} className="px-6 py-3 bg-accent hover:bg-accent/90 text-white font-semibold rounded-xl text-sm transition-all cursor-pointer border-none flex items-center gap-2 shadow-lg shadow-accent/25">
          <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path strokeLinecap="round" strokeLinejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
          Открыть демо
        </button>
      </div>
      {open && <Modal onClose={() => setOpen(false)} />}
    </>
  )
}

/* ===== MODAL ===== */
function Modal({ onClose }: { onClose: () => void }) {
  const [screen, setScreen] = useState<Screen>('search')
  const handleKey = useCallback((e: KeyboardEvent) => { if (e.key === 'Escape') onClose() }, [onClose])
  useEffect(() => {
    document.addEventListener('keydown', handleKey)
    document.body.classList.add('demo-modal-open')
    return () => { document.removeEventListener('keydown', handleKey); document.body.classList.remove('demo-modal-open') }
  }, [handleKey])

  return createPortal(
    <div className="fixed inset-0 z-[9999] flex items-center justify-center p-4" onClick={onClose}>
      <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" />
      <div className="demo-modal-enter relative w-full max-w-[1400px] rounded-2xl overflow-hidden shadow-2xl flex flex-col" style={{ height: '90vh', maxHeight: '920px' }} onClick={e => e.stopPropagation()}>
        <button onClick={onClose} className="absolute top-3 right-3 z-50 w-8 h-8 rounded-full bg-black/20 hover:bg-black/40 text-white flex items-center justify-center cursor-pointer border-none transition-colors text-lg" aria-label="Close">&times;</button>
        <div className="flex flex-1 min-h-0">
          {/* Sidebar — WHITE */}
          <div className="w-[240px] bg-white border-r border-slate-200 flex flex-col shrink-0">
            <div className="h-14 flex items-center px-4 border-b border-slate-200">
              <div className="w-8 h-8 rounded-lg flex items-center justify-center text-[0.6rem] text-white font-bold mr-3" style={{ background: BRAND }}>DB</div>
              <div><div className="text-sm font-bold text-slate-800">DataBook</div><div className="text-[0.58rem] text-slate-400">v3.0</div></div>
            </div>
            <div className="flex-1 py-2 px-3 space-y-0.5 overflow-y-auto">
              {nav.map(item => (
                <div key={item.key}>
                  {item.section && <div className="pt-4 pb-2 px-2"><div className="text-[0.6rem] font-bold text-slate-400 uppercase tracking-wider">{item.section}</div></div>}
                  <button onClick={() => setScreen(item.key)} className={`w-full flex items-center gap-2.5 px-3 py-2 rounded-lg text-left cursor-pointer border-none transition-colors text-[0.8rem] ${screen === item.key ? 'bg-[#2563EB]/10 text-[#2563EB] font-semibold' : 'bg-transparent text-slate-600 hover:bg-slate-50 hover:text-slate-800'}`}>
                    <span className="text-[0.85rem]">{item.emoji}</span><span>{item.label}</span>
                  </button>
                </div>
              ))}
            </div>
            <div className="p-3 border-t border-slate-200">
              <div className="flex items-center gap-2.5 p-2 rounded-lg bg-slate-50">
                <div className="w-8 h-8 rounded-full bg-[#2563EB]/10 flex items-center justify-center text-[0.65rem] font-bold" style={{ color: BRAND }}>НХ</div>
                <div className="flex-1 min-w-0"><div className="text-[0.75rem] font-semibold text-slate-700 truncate">Хроменок Н.В.</div><div className="text-[0.6rem] text-slate-400">Администратор</div></div>
              </div>
              <div className="text-[0.55rem] text-slate-400 text-center mt-2">v3.0 · Design by N. Khromenok</div>
            </div>
          </div>
          {/* Content */}
          <div className="flex-1 flex flex-col min-w-0 bg-slate-50">
            <div className="h-14 flex items-center justify-between px-6 bg-white border-b border-slate-200 shrink-0">
              <h2 className="text-[0.95rem] font-bold text-slate-800 m-0">{titles[screen]}</h2>
              <div className="flex items-center gap-3">
                <span className="text-[0.72rem] text-slate-400">Строительный контроль</span>
                <span className="text-[0.72rem] text-slate-400">19 февр. 2026</span>
              </div>
            </div>
            <div className="flex-1 overflow-y-auto">
              {screen === 'search' && <PgSearch />}
              {screen === 'catalog' && <PgCatalog />}
              {screen === 'analytics' && <PgAnalytics />}
              {screen === 'import' && <PgImport />}
              {screen === 'settings' && <PgSettings />}
            </div>
          </div>
        </div>
      </div>
    </div>, document.body)
}

/* ── Helpers ── */
function StatCard({ label, val, sub, color }: { label: string; val: string; sub: string; color: string }) {
  return <div className="bg-white rounded-xl p-4 border border-slate-200" style={{ borderLeftWidth: 3, borderLeftColor: color }}><span className="text-[0.65rem] text-slate-400 uppercase font-bold tracking-wider">{label}</span><div className="text-2xl font-extrabold text-slate-800 mt-1">{val}</div><div className="text-[0.7rem] text-slate-400 mt-0.5">{sub}</div></div>
}

function highlightText(text: string, query: string): React.ReactNode {
  if (!query.trim()) return text
  const q = query.toLowerCase()
  const parts: React.ReactNode[] = []
  let remaining = text
  let key = 0
  while (remaining.length > 0) {
    const idx = remaining.toLowerCase().indexOf(q)
    if (idx === -1) {
      parts.push(remaining)
      break
    }
    if (idx > 0) parts.push(remaining.slice(0, idx))
    parts.push(<mark key={key++} style={{ background: '#FDE68A', padding: '0 1px', borderRadius: 2 }}>{remaining.slice(idx, idx + query.length)}</mark>)
    remaining = remaining.slice(idx + query.length)
  }
  return <>{parts}</>
}

/* ===== SEARCH ===== */
function PgSearch() {
  const [query, setQuery] = useState('')
  const [selectedCat, setSelectedCat] = useState<string | null>(null)
  const [copiedId, setCopiedId] = useState<number | null>(null)

  const wordCount = useMemo(() => {
    const w = query.trim().split(/\s+/).filter(Boolean)
    return w.length > 0 && query.trim() ? w.length : 0
  }, [query])

  const filtered = useMemo(() => {
    let list = prescriptions
    if (selectedCat) {
      const cat = categories.find(c => c.name === selectedCat)
      if (cat) {
        list = list.filter(p => cat.subtypes.some(s => p.subtype.toLowerCase().includes(s.toLowerCase())) || p.subtype.toLowerCase().includes(selectedCat.toLowerCase()))
      }
    }
    if (query.trim()) {
      const q = query.toLowerCase()
      list = list.filter(p =>
        p.text.toLowerCase().includes(q) ||
        p.subtype.toLowerCase().includes(q) ||
        p.ntd.toLowerCase().includes(q)
      )
    }
    return list.slice(0, 8)
  }, [query, selectedCat])

  const matchPercent = useCallback((text: string) => {
    if (!query.trim()) return null
    const q = query.toLowerCase()
    const words = q.split(/\s+/).filter(Boolean)
    const matched = words.filter(w => text.toLowerCase().includes(w)).length
    return Math.round((matched / Math.max(words.length, 1)) * 100)
  }, [query])

  const handleCopy = useCallback((id: number, text: string) => {
    navigator.clipboard.writeText(text).catch(() => {})
    setCopiedId(id)
    setTimeout(() => setCopiedId(null), 2000)
  }, [])

  const totalCount = selectedCat ? (categories.find(c => c.name === selectedCat)?.count || 0) : prescriptions.length

  return (
    <div className="p-6">
      {/* Search bar */}
      <div className="mb-5">
        <div className="relative">
          <svg className="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><circle cx="11" cy="11" r="8"/><path strokeLinecap="round" d="m21 21-4.35-4.35"/></svg>
          <input
            type="text"
            value={query}
            onChange={e => setQuery(e.target.value)}
            placeholder="Введите запрос: бетон, трещины, кровля..."
            className="w-full pl-11 pr-24 py-3 bg-white border border-slate-200 rounded-xl text-[0.82rem] text-slate-800 placeholder:text-slate-400 focus:outline-none focus:border-[#2563EB]/50 focus:ring-2 focus:ring-[#2563EB]/10 transition-all"
          />
          <span className={`absolute right-4 top-1/2 -translate-y-1/2 text-[0.7rem] font-medium ${wordCount > 10 ? 'text-red-500' : 'text-slate-400'}`}>
            {wordCount} / 10 слов
          </span>
        </div>
      </div>

      <div className="flex gap-5">
        {/* Category sidebar */}
        <div className="w-[220px] shrink-0 space-y-1">
          <button
            onClick={() => setSelectedCat(null)}
            className={`w-full flex items-center gap-2 px-3 py-2 rounded-lg text-left cursor-pointer border-none transition-colors text-[0.75rem] ${!selectedCat ? 'bg-[#2563EB]/10 text-[#2563EB] font-semibold' : 'bg-white text-slate-600 hover:bg-slate-100'}`}
          >
            <span className="text-[0.82rem]">📁</span>
            <span className="flex-1">Все категории</span>
            <span className="text-[0.65rem] text-slate-400">8,547</span>
          </button>
          {categories.map(cat => (
            <button
              key={cat.name}
              onClick={() => setSelectedCat(selectedCat === cat.name ? null : cat.name)}
              className={`w-full flex items-center gap-2 px-3 py-2 rounded-lg text-left cursor-pointer border-none transition-colors text-[0.72rem] ${selectedCat === cat.name ? 'bg-[#2563EB]/10 text-[#2563EB] font-semibold' : 'bg-white text-slate-600 hover:bg-slate-100'}`}
            >
              <span className="text-[0.82rem]">{cat.emoji}</span>
              <span className="flex-1 truncate">{cat.name}</span>
              <span className="text-[0.6rem] text-slate-400">{cat.count}</span>
            </button>
          ))}
        </div>

        {/* Results */}
        <div className="flex-1 min-w-0 space-y-3">
          {filtered.length === 0 && (
            <div className="text-center py-12">
              <div className="text-3xl mb-3">🔍</div>
              <div className="text-[0.85rem] font-medium text-slate-500">Ничего не найдено</div>
              <div className="text-[0.72rem] text-slate-400 mt-1">Попробуйте изменить запрос или выбрать другую категорию</div>
            </div>
          )}
          {filtered.map(p => {
            const pct = matchPercent(p.text)
            return (
              <div key={p.id} className="bg-white rounded-xl border border-slate-200 overflow-hidden hover:border-[#2563EB]/30 hover:shadow-md transition-all" style={{ borderLeftWidth: 3, borderLeftColor: p.ntdOk ? '#10B981' : '#EF4444' }}>
                <div className="px-4 py-3">
                  {/* Header row */}
                  <div className="flex items-center gap-2 mb-2">
                    <span className="px-2 py-0.5 rounded text-[0.65rem] font-bold" style={{ background: `${BRAND}15`, color: BRAND }}>{p.subtype}</span>
                    {pct !== null && (
                      <span className="px-2 py-0.5 rounded text-[0.62rem] font-bold bg-amber-100 text-amber-700">{pct}%</span>
                    )}
                    <span className="text-[0.65rem] text-slate-400 ml-auto">{p.date}</span>
                  </div>
                  {/* Text */}
                  <div className="text-[0.78rem] text-slate-700 leading-relaxed mb-2.5">
                    {highlightText(p.text, query)}
                  </div>
                  {/* NTD + RD + actions */}
                  <div className="flex items-center gap-2 flex-wrap">
                    <span className={`inline-flex items-center gap-1.5 px-2 py-1 rounded text-[0.65rem] font-semibold ${p.ntdOk ? 'bg-green-50 text-green-700 border border-green-200' : 'bg-red-50 text-red-600 border border-red-200'}`}>
                      <span className="w-1.5 h-1.5 rounded-full" style={{ background: p.ntdOk ? '#10B981' : '#EF4444' }} />
                      {p.ntd} {p.ntdClause}
                      {p.ntdFull && <span className="text-[0.58rem] font-normal opacity-70">· {p.ntdFull}</span>}
                    </span>
                    {p.rd && p.rd !== '—' && (
                      <span className="inline-flex items-center gap-1 px-2 py-1 rounded text-[0.65rem] font-semibold bg-blue-50 text-blue-600 border border-blue-200">
                        <svg className="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                        {p.rd}
                      </span>
                    )}
                    <a href="#" onClick={e => e.preventDefault()} className="px-2 py-0.5 rounded-full text-[0.6rem] font-medium no-underline" style={{ background: `${BRAND}10`, color: BRAND }}>Техэксперт</a>
                    <button
                      onClick={() => handleCopy(p.id, p.text)}
                      className="ml-auto flex items-center gap-1 px-2 py-1 rounded-lg text-[0.65rem] font-medium cursor-pointer border border-slate-200 bg-white hover:bg-slate-50 transition-colors"
                      style={copiedId === p.id ? { borderColor: '#10B981', color: '#10B981' } : { color: '#64748B' }}
                    >
                      {copiedId === p.id ? (
                        <><svg className="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2.5}><path strokeLinecap="round" strokeLinejoin="round" d="M5 13l4 4L19 7"/></svg>Скопировано</>
                      ) : (
                        <><svg className="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>Копировать</>
                      )}
                    </button>
                  </div>
                </div>
              </div>
            )
          })}
          {filtered.length > 0 && (
            <div className="text-[0.72rem] text-slate-400 text-center pt-2">
              Показано {filtered.length} из {totalCount}
            </div>
          )}
        </div>
      </div>
    </div>
  )
}

/* ===== CATALOG ===== */
function PgCatalog() {
  const [openCat, setOpenCat] = useState<string | null>(null)
  const [copiedId, setCopiedId] = useState<number | null>(null)

  const handleCopy = useCallback((id: number, text: string) => {
    navigator.clipboard.writeText(text).catch(() => {})
    setCopiedId(id)
    setTimeout(() => setCopiedId(null), 2000)
  }, [])

  if (openCat) {
    const cat = categories.find(c => c.name === openCat)
    const catPrescriptions = prescriptions.filter(p =>
      cat?.subtypes.some(s => p.subtype.toLowerCase().includes(s.toLowerCase())) || p.subtype.toLowerCase().includes(openCat.toLowerCase())
    )

    return (
      <div className="p-6">
        <button
          onClick={() => setOpenCat(null)}
          className="flex items-center gap-2 mb-5 text-[0.78rem] font-medium cursor-pointer border-none bg-transparent hover:text-[#2563EB] transition-colors"
          style={{ color: '#64748B' }}
        >
          <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M15 19l-7-7 7-7"/></svg>
          Назад к каталогу
        </button>
        <div className="flex items-center gap-3 mb-5">
          <span className="text-2xl">{cat?.emoji}</span>
          <div>
            <h3 className="text-[0.95rem] font-bold text-slate-800 m-0">{openCat}</h3>
            <span className="text-[0.72rem] text-slate-400">{cat?.count} записей</span>
          </div>
        </div>
        <div className="space-y-3">
          {catPrescriptions.length === 0 ? (
            <div className="text-center py-10 text-slate-400 text-[0.82rem]">В демо-данных нет записей для этой категории</div>
          ) : (
            catPrescriptions.map(p => (
              <div key={p.id} className="bg-white rounded-xl border border-slate-200 overflow-hidden" style={{ borderLeftWidth: 3, borderLeftColor: p.ntdOk ? '#10B981' : '#EF4444' }}>
                <div className="px-4 py-3">
                  <div className="flex items-center gap-2 mb-2">
                    <span className="px-2 py-0.5 rounded text-[0.65rem] font-bold" style={{ background: `${BRAND}15`, color: BRAND }}>{p.subtype}</span>
                    <span className="text-[0.65rem] text-slate-400 ml-auto">{p.date}</span>
                  </div>
                  <div className="text-[0.78rem] text-slate-700 leading-relaxed mb-2.5">{p.text}</div>
                  <div className="flex items-center gap-2 flex-wrap">
                    <span className={`inline-flex items-center gap-1.5 px-2 py-1 rounded text-[0.65rem] font-semibold ${p.ntdOk ? 'bg-green-50 text-green-700 border border-green-200' : 'bg-red-50 text-red-600 border border-red-200'}`}>
                      <span className="w-1.5 h-1.5 rounded-full" style={{ background: p.ntdOk ? '#10B981' : '#EF4444' }} />
                      {p.ntd} {p.ntdClause}{p.ntdFull && <span className="text-[0.58rem] font-normal opacity-70">· {p.ntdFull}</span>}
                    </span>
                    {p.rd && p.rd !== '—' && (
                      <span className="inline-flex items-center gap-1 px-2 py-1 rounded text-[0.65rem] font-semibold bg-blue-50 text-blue-600 border border-blue-200">
                        <svg className="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                        {p.rd}
                      </span>
                    )}
                    <button onClick={() => handleCopy(p.id, p.text)} className="ml-auto flex items-center gap-1 px-2 py-1 rounded-lg text-[0.65rem] font-medium cursor-pointer border border-slate-200 bg-white hover:bg-slate-50 transition-colors" style={copiedId === p.id ? { borderColor: '#10B981', color: '#10B981' } : { color: '#64748B' }}>
                      {copiedId === p.id ? (
                        <><svg className="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2.5}><path strokeLinecap="round" strokeLinejoin="round" d="M5 13l4 4L19 7"/></svg>Скопировано</>
                      ) : (
                        <><svg className="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>Копировать</>
                      )}
                    </button>
                  </div>
                </div>
              </div>
            ))
          )}
        </div>
      </div>
    )
  }

  return (
    <div className="p-6">
      <div className="grid grid-cols-3 gap-4">
        {categories.map(cat => (
          <div
            key={cat.name}
            onClick={() => setOpenCat(cat.name)}
            className="bg-white rounded-xl border border-slate-200 p-4 cursor-pointer hover:border-[#2563EB]/30 hover:shadow-lg transition-all group"
          >
            <div className="flex items-start gap-3 mb-3">
              <div className="w-10 h-10 rounded-xl flex items-center justify-center text-xl" style={{ background: `${BRAND}10` }}>{cat.emoji}</div>
              <div className="flex-1 min-w-0">
                <div className="text-[0.82rem] font-semibold text-slate-800 group-hover:text-[#2563EB] transition-colors">{cat.name}</div>
                <div className="text-[0.7rem] text-slate-400">{cat.count} записей</div>
              </div>
            </div>
            <div className="flex gap-1.5 flex-wrap">
              {cat.subtypes.map(s => (
                <span key={s} className="px-2 py-0.5 bg-slate-50 border border-slate-100 rounded text-[0.6rem] text-slate-500">{s}</span>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  )
}

/* ===== ANALYTICS ===== */
function PgAnalytics() {
  const weekData = [
    { day: 'Пн', val: 42 },
    { day: 'Вт', val: 58 },
    { day: 'Ср', val: 35 },
    { day: 'Чт', val: 67 },
    { day: 'Пт', val: 51 },
    { day: 'Сб', val: 12 },
    { day: 'Вс', val: 8 },
  ]
  const maxVal = Math.max(...weekData.map(d => d.val))

  const popularQueries = [
    { query: 'защитный слой бетона', count: 34 },
    { query: 'трещины кладка', count: 28 },
    { query: 'гидроизоляция кровля', count: 22 },
    { query: 'сварные соединения', count: 19 },
    { query: 'отклонение от вертикали', count: 15 },
  ]

  const activeUsers = [
    { name: 'Хроменок Н.В.', role: 'Администратор', last: '5 мин назад', searches: 12 },
    { name: 'Козлова Е.А.', role: 'Инженер СК', last: '18 мин назад', searches: 8 },
    { name: 'Иванов А.С.', role: 'Инженер СК', last: '1 час назад', searches: 6 },
    { name: 'Орлов П.С.', role: 'ГИП', last: '2 часа назад', searches: 4 },
    { name: 'Федорова Е.А.', role: 'Инженер СК', last: '3 часа назад', searches: 3 },
  ]

  const catUsage = [
    { name: 'Бетонные работы', pct: 28 },
    { name: 'Каменная кладка', pct: 19 },
    { name: 'Кровля', pct: 15 },
    { name: 'Фасады', pct: 12 },
    { name: 'Электромонтаж', pct: 10 },
    { name: 'Сантехника', pct: 8 },
    { name: 'Прочие', pct: 8 },
  ]

  return (
    <div className="p-6 space-y-6">
      {/* Stat cards */}
      <div className="grid grid-cols-4 gap-4">
        <StatCard label="Поисков сегодня" val="47" sub="+12% к вчера" color={BRAND} />
        <StatCard label="Копирований" val="128" sub="за сегодня" color="#10B981" />
        <StatCard label="Активных пользователей" val="12" sub="сейчас онлайн" color="#8B5CF6" />
        <StatCard label="Записей в базе" val="8,547" sub="после дедупликации" color="#F59E0B" />
      </div>

      <div className="grid grid-cols-2 gap-5">
        {/* Bar chart */}
        <div className="bg-white rounded-xl border border-slate-200 p-5">
          <div className="text-[0.78rem] font-bold text-slate-800 mb-4">Поисков за неделю</div>
          <div className="flex items-end gap-3 h-[140px]">
            {weekData.map(d => (
              <div key={d.day} className="flex-1 flex flex-col items-center gap-1.5">
                <span className="text-[0.62rem] font-bold text-slate-600">{d.val}</span>
                <div className="w-full rounded-t-md transition-all" style={{ height: `${(d.val / maxVal) * 110}px`, background: `linear-gradient(to top, ${BRAND}, ${BRAND}AA)` }} />
                <span className="text-[0.6rem] text-slate-400">{d.day}</span>
              </div>
            ))}
          </div>
        </div>

        {/* Popular queries */}
        <div className="bg-white rounded-xl border border-slate-200 p-5">
          <div className="text-[0.78rem] font-bold text-slate-800 mb-4">Популярные запросы</div>
          <table className="w-full">
            <thead><tr className="text-[0.62rem] text-slate-400 uppercase tracking-wider">
              <th className="text-left pb-2 font-semibold">#</th>
              <th className="text-left pb-2 font-semibold">Запрос</th>
              <th className="text-right pb-2 font-semibold">Кол-во</th>
            </tr></thead>
            <tbody>{popularQueries.map((q, i) => (
              <tr key={q.query} className="border-t border-slate-50 text-[0.75rem]">
                <td className="py-2 text-slate-400 font-mono">{i + 1}</td>
                <td className="py-2 text-slate-700">{q.query}</td>
                <td className="py-2 text-right font-bold" style={{ color: BRAND }}>{q.count}</td>
              </tr>
            ))}</tbody>
          </table>
        </div>
      </div>

      <div className="grid grid-cols-2 gap-5">
        {/* User activity */}
        <div className="bg-white rounded-xl border border-slate-200 p-5">
          <div className="text-[0.78rem] font-bold text-slate-800 mb-4">Активность пользователей</div>
          <table className="w-full">
            <thead><tr className="text-[0.62rem] text-slate-400 uppercase tracking-wider">
              <th className="text-left pb-2 font-semibold">Пользователь</th>
              <th className="text-left pb-2 font-semibold">Роль</th>
              <th className="text-left pb-2 font-semibold">Последний поиск</th>
              <th className="text-right pb-2 font-semibold">Запросов</th>
            </tr></thead>
            <tbody>{activeUsers.map(u => (
              <tr key={u.name} className="border-t border-slate-50 text-[0.73rem]">
                <td className="py-2 text-slate-700 font-medium">{u.name}</td>
                <td className="py-2 text-slate-500">{u.role}</td>
                <td className="py-2 text-slate-400">{u.last}</td>
                <td className="py-2 text-right font-bold text-slate-600">{u.searches}</td>
              </tr>
            ))}</tbody>
          </table>
        </div>

        {/* Category usage */}
        <div className="bg-white rounded-xl border border-slate-200 p-5">
          <div className="text-[0.78rem] font-bold text-slate-800 mb-4">Популярные категории</div>
          <div className="space-y-2.5">
            {catUsage.map(c => (
              <div key={c.name} className="flex items-center gap-3">
                <span className="text-[0.72rem] text-slate-600 w-[130px] shrink-0 truncate">{c.name}</span>
                <div className="flex-1 h-5 bg-slate-100 rounded-full overflow-hidden">
                  <div className="h-full rounded-full transition-all" style={{ width: `${c.pct}%`, background: `linear-gradient(to right, ${BRAND}, ${BRAND}CC)` }} />
                </div>
                <span className="text-[0.68rem] font-bold text-slate-500 w-8 text-right">{c.pct}%</span>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  )
}

/* ===== IMPORT ===== */
function PgImport() {
  const pipelineSteps = [
    { emoji: '📝', name: 'Нормализация', desc: 'Очистка, унификация форматов, удаление дубликатов строк', status: 'done' as const },
    { emoji: '🔤', name: 'Лемматизация', desc: 'pymorphy2 — приведение к начальной форме слова', status: 'done' as const },
    { emoji: '📊', name: 'Векторизация', desc: 'TF-IDF + sentence-transformers для семантического поиска', status: 'done' as const },
    { emoji: '🔁', name: 'Дедупликация', desc: 'Cosine similarity > 0.92 → объединение записей', status: 'done' as const },
    { emoji: '🔍', name: 'FTS-индексация', desc: 'PostgreSQL tsvector + GIN-индекс для полнотекстового поиска', status: 'done' as const },
  ]

  return (
    <div className="p-6 max-w-[800px] mx-auto space-y-6">
      {/* Upload zone */}
      <div className="bg-white rounded-2xl border border-slate-200 p-6 shadow-sm">
        <div className="flex items-center gap-2 mb-4">
          <div className="w-6 h-6 rounded-full flex items-center justify-center text-[0.65rem] text-white font-bold" style={{ background: BRAND }}>1</div>
          <span className="text-[0.82rem] font-semibold text-slate-800">Загрузка файла</span>
        </div>
        <div className="border-2 border-dashed rounded-xl p-8 text-center" style={{ borderColor: `${BRAND}40`, background: `${BRAND}05` }}>
          <div className="w-12 h-12 mx-auto mb-3 rounded-xl flex items-center justify-center" style={{ background: `${BRAND}15` }}>
            <svg className="w-6 h-6" style={{ color: BRAND }} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
          </div>
          <div className="text-[0.82rem] font-medium text-slate-700 mb-1">Перетащите .xlsm файл или нажмите для выбора</div>
          <div className="text-[0.7rem] text-slate-400">Поддерживаются файлы Excel с макросами (.xlsm)</div>
        </div>
      </div>

      {/* Stats */}
      <div className="bg-white rounded-2xl border border-slate-200 p-6 shadow-sm">
        <div className="flex items-center gap-2 mb-4">
          <div className="w-6 h-6 rounded-full flex items-center justify-center text-[0.65rem] text-white font-bold" style={{ background: BRAND }}>2</div>
          <span className="text-[0.82rem] font-semibold text-slate-800">Статистика обработки</span>
        </div>
        <div className="grid grid-cols-3 gap-4">
          <div className="bg-slate-50 rounded-xl p-4 text-center">
            <div className="text-2xl font-extrabold text-slate-800">25,012</div>
            <div className="text-[0.7rem] text-slate-400 mt-1">Исходных записей</div>
          </div>
          <div className="bg-slate-50 rounded-xl p-4 text-center relative">
            <div className="absolute left-0 top-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6 rounded-full bg-white border border-slate-200 flex items-center justify-center text-[0.7rem]">→</div>
            <div className="text-[0.65rem] font-bold text-amber-600 uppercase tracking-wider mb-1">Дедупликация</div>
            <div className="text-[0.82rem] font-bold text-slate-600">-65.8%</div>
            <div className="text-[0.65rem] text-slate-400">удалено дублей</div>
          </div>
          <div className="bg-slate-50 rounded-xl p-4 text-center">
            <div className="text-2xl font-extrabold" style={{ color: BRAND }}>8,547</div>
            <div className="text-[0.7rem] text-slate-400 mt-1">Уникальных записей</div>
          </div>
        </div>
      </div>

      {/* NLP Pipeline */}
      <div className="bg-white rounded-2xl border border-slate-200 p-6 shadow-sm">
        <div className="flex items-center gap-2 mb-4">
          <div className="w-6 h-6 rounded-full flex items-center justify-center text-[0.65rem] text-white font-bold" style={{ background: BRAND }}>3</div>
          <span className="text-[0.82rem] font-semibold text-slate-800">NLP-пайплайн обработки</span>
        </div>
        <div className="space-y-1">
          {pipelineSteps.map((s, i) => (
            <div key={s.name} className="flex items-center gap-3 px-3 py-2.5 rounded-lg bg-slate-50/50 border border-transparent">
              <span className="text-[0.85rem] w-6 text-center">{s.status === 'done' ? '✅' : s.emoji}</span>
              <div className="flex-1 min-w-0">
                <span className="text-[0.78rem] text-slate-700 font-medium">{s.name}</span>
                <span className="text-[0.65rem] text-slate-400 ml-2">{s.desc}</span>
              </div>
              {i < pipelineSteps.length - 1 && (
                <span className="text-[0.6rem] text-slate-300">→</span>
              )}
            </div>
          ))}
        </div>
      </div>

      {/* Last import */}
      <div className="bg-white rounded-2xl border border-slate-200 p-6 shadow-sm">
        <div className="flex items-center gap-2 mb-4">
          <div className="w-6 h-6 rounded-full flex items-center justify-center text-[0.65rem] text-white font-bold" style={{ background: BRAND }}>4</div>
          <span className="text-[0.82rem] font-semibold text-slate-800">Последний импорт</span>
        </div>
        <div className="bg-slate-50 rounded-xl p-4 space-y-2">
          {[
            ['Файл', 'prescriptions_export_2026.xlsm'],
            ['Дата импорта', '14.02.2026, 14:32'],
            ['Обработано', '1,247 новых записей'],
            ['Добавлено после дедупликации', '312 уникальных'],
            ['Время обработки', '2 мин 18 сек'],
            ['Оператор', 'Хроменок Н.В.'],
          ].map(([label, value]) => (
            <div key={label} className="flex items-center text-[0.75rem]">
              <span className="text-slate-400 w-[200px] shrink-0">{label}:</span>
              <span className="text-slate-700 font-medium">{value}</span>
            </div>
          ))}
        </div>
      </div>
    </div>
  )
}

/* ===== SETTINGS ===== */
function PgSettings() {
  const users = [
    { name: 'Хроменок Н.В.', email: 'khromenok@company.ru', role: 'admin', status: 'active', lastLogin: '19.02.2026' },
    { name: 'Козлова Е.А.', email: 'kozlova@company.ru', role: 'editor', status: 'active', lastLogin: '19.02.2026' },
    { name: 'Иванов А.С.', email: 'ivanov@company.ru', role: 'user', status: 'active', lastLogin: '18.02.2026' },
    { name: 'Орлов П.С.', email: 'orlov@company.ru', role: 'user', status: 'active', lastLogin: '17.02.2026' },
    { name: 'Сидоров К.Л.', email: 'sidorov@company.ru', role: 'user', status: 'inactive', lastLogin: '10.02.2026' },
  ]
  const roleLabels: Record<string, string> = { admin: 'Админ', editor: 'Редактор', user: 'Пользователь' }
  const roleColors: Record<string, string> = { admin: 'bg-purple-100 text-purple-600', editor: 'bg-blue-100 text-blue-600', user: 'bg-slate-100 text-slate-500' }

  return (
    <div className="p-6 space-y-6">
      {/* OAuth2 */}
      <div className="bg-white rounded-xl border border-slate-200 p-5">
        <div className="flex items-center justify-between mb-4">
          <div className="text-[0.82rem] font-bold text-slate-800">OAuth2 / JetBrains Hub</div>
          <span className="px-2.5 py-1 rounded-lg text-[0.65rem] font-bold bg-green-100 text-green-600">Подключено</span>
        </div>
        <div className="bg-slate-50 rounded-xl p-4 space-y-2">
          {[
            ['Hub URL', 'https://hub.company.ru'],
            ['Client ID', 'databook-prod-****'],
            ['Scope', 'profile, email, groups'],
            ['Авторизованных сессий', '12'],
          ].map(([label, value]) => (
            <div key={label} className="flex items-center text-[0.75rem]">
              <span className="text-slate-400 w-[180px] shrink-0">{label}:</span>
              <span className="text-slate-700 font-mono text-[0.72rem]">{value}</span>
            </div>
          ))}
        </div>
      </div>

      {/* Search engine */}
      <div className="bg-white rounded-xl border border-slate-200 p-5">
        <div className="flex items-center justify-between mb-4">
          <div className="text-[0.82rem] font-bold text-slate-800">Поисковый движок</div>
          <span className="px-2.5 py-1 rounded-lg text-[0.65rem] font-bold bg-green-100 text-green-600">Активен</span>
        </div>
        <div className="grid grid-cols-3 gap-4 mb-3">
          <div className="bg-slate-50 rounded-xl p-3 text-center">
            <div className="text-xl font-extrabold text-slate-800">8 547</div>
            <div className="text-[0.65rem] text-slate-400">Записей в базе</div>
          </div>
          <div className="bg-slate-50 rounded-xl p-3 text-center">
            <div className="text-xl font-extrabold" style={{ color: BRAND }}>1 240</div>
            <div className="text-[0.65rem] text-slate-400">Терминов в словаре</div>
          </div>
          <div className="bg-slate-50 rounded-xl p-3 text-center">
            <div className="text-xl font-extrabold text-green-600">12 мс</div>
            <div className="text-[0.65rem] text-slate-400">Среднее время поиска</div>
          </div>
        </div>
        <div className="bg-slate-50 rounded-xl p-4 space-y-2">
          {[
            ['Полнотекстовый поиск', 'PostgreSQL FTS + лемматизация'],
            ['Язык', 'Русский (строительная терминология)'],
            ['Дедупликация', 'Cosine similarity > 0.92'],
          ].map(([label, value]) => (
            <div key={label} className="flex items-center text-[0.75rem]">
              <span className="text-slate-400 w-[200px] shrink-0">{label}:</span>
              <span className="text-slate-700 text-[0.72rem]">{value}</span>
            </div>
          ))}
        </div>
      </div>

      {/* NTD Reference */}
      <div className="bg-white rounded-xl border border-slate-200 p-5">
        <div className="flex items-center justify-between mb-4">
          <div className="text-[0.82rem] font-bold text-slate-800">Справочник НТД</div>
          <span className="px-2.5 py-1 rounded-lg text-[0.65rem] font-bold bg-green-100 text-green-600">Актуален</span>
        </div>
        <div className="grid grid-cols-3 gap-4">
          <div className="bg-slate-50 rounded-xl p-3 text-center">
            <div className="text-xl font-extrabold text-slate-800">342</div>
            <div className="text-[0.65rem] text-slate-400">СП / ГОСТ / СНиП</div>
          </div>
          <div className="bg-slate-50 rounded-xl p-3 text-center">
            <div className="text-xl font-extrabold text-green-600">289</div>
            <div className="text-[0.65rem] text-slate-400">Полный match (код + название)</div>
          </div>
          <div className="bg-slate-50 rounded-xl p-3 text-center">
            <div className="text-xl font-extrabold text-red-500">53</div>
            <div className="text-[0.65rem] text-slate-400">Только код (без названия)</div>
          </div>
        </div>
        <div className="text-[0.68rem] text-slate-400 mt-3">Последнее обновление: 14.02.2026 · Источник: Техэксперт API</div>
      </div>

      {/* User management */}
      <div className="bg-white rounded-xl border border-slate-200 p-5">
        <div className="flex items-center justify-between mb-4">
          <div className="text-[0.82rem] font-bold text-slate-800">Управление пользователями</div>
          <button className="px-3 py-1.5 rounded-lg text-[0.72rem] font-medium cursor-pointer border-none text-white transition-colors" style={{ background: BRAND }}>+ Добавить</button>
        </div>
        <div className="bg-white rounded-xl border border-slate-200 overflow-hidden">
          <table className="w-full">
            <thead><tr className="text-[0.62rem] text-slate-400 uppercase tracking-wider bg-slate-50">
              <th className="text-left px-4 py-2.5 font-semibold">Пользователь</th>
              <th className="text-left px-4 py-2.5 font-semibold">Email</th>
              <th className="text-center px-4 py-2.5 font-semibold">Роль</th>
              <th className="text-center px-4 py-2.5 font-semibold">Статус</th>
              <th className="text-left px-4 py-2.5 font-semibold">Посл. вход</th>
            </tr></thead>
            <tbody>{users.map((u, i) => (
              <tr key={u.email} className={`border-t border-slate-100 text-[0.73rem] hover:bg-slate-50/50 ${i % 2 ? 'bg-slate-50/30' : ''}`}>
                <td className="px-4 py-2.5 text-slate-700 font-medium">{u.name}</td>
                <td className="px-4 py-2.5 text-slate-500 font-mono text-[0.68rem]">{u.email}</td>
                <td className="px-4 py-2.5 text-center"><span className={`px-2 py-0.5 rounded text-[0.62rem] font-bold ${roleColors[u.role]}`}>{roleLabels[u.role]}</span></td>
                <td className="px-4 py-2.5 text-center"><span className={`w-2 h-2 rounded-full inline-block ${u.status === 'active' ? 'bg-green-500' : 'bg-slate-300'}`} /></td>
                <td className="px-4 py-2.5 text-slate-400 font-mono text-[0.68rem]">{u.lastLogin}</td>
              </tr>
            ))}</tbody>
          </table>
        </div>
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\DataBookDemo.tsx
====================================================================================================

====================================================================================================
FILE [17/52]: src\components\DemoAIHub.tsx
Size: 80,315 bytes
====================================================================================================

import React, { useState, useEffect, useCallback, useRef } from 'react'
import { createPortal } from 'react-dom'

type Screen = 'apps' | 'chat' | 'prompts' | 'tools' | 'monitoring' | 'users' | 'appAccess' | 'adminAi' | 'adminTools'

/* ── SVG Icons ── */
const Ico = {
  Apps: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><rect x="3" y="3" width="7" height="7" rx="1.5"/><rect x="14" y="3" width="7" height="7" rx="1.5"/><rect x="3" y="14" width="7" height="7" rx="1.5"/><rect x="14" y="14" width="7" height="7" rx="1.5"/></svg>,
  Chat: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M8 10h.01M12 10h.01M16 10h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>,
  Prompts: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>,
  Tools: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.573-1.066z"/><circle cx="12" cy="12" r="3"/></svg>,
  Monitor: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>,
  Users: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg>,
  Link: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg>,
  Download: () => <svg className="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>,
}

const IcoBot = () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><rect x="3" y="11" width="18" height="10" rx="2"/><circle cx="8.5" cy="16" r="1.5"/><circle cx="15.5" cy="16" r="1.5"/><path d="M12 2v5M8 8h8"/></svg>
const IcoAppWindow = () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M2 8h20"/><circle cx="5" cy="6" r="0.5" fill="currentColor"/><circle cx="7.5" cy="6" r="0.5" fill="currentColor"/></svg>
const IcoWrench = () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/></svg>

const nav: { key: Screen; icon: () => React.JSX.Element; label: string; admin?: boolean }[] = [
  { key: 'apps', icon: Ico.Apps, label: 'Приложения' },
  { key: 'chat', icon: Ico.Chat, label: 'AI-чат' },
  { key: 'prompts', icon: Ico.Prompts, label: 'Промпты' },
  { key: 'tools', icon: Ico.Tools, label: 'Инструменты' },
  { key: 'monitoring', icon: Ico.Monitor, label: 'Мониторинг', admin: true },
  { key: 'users', icon: Ico.Users, label: 'Пользователи и группы' },
  { key: 'appAccess', icon: IcoAppWindow, label: 'Приложения и доступ' },
  { key: 'adminAi', icon: IcoBot, label: 'AI и промпты' },
  { key: 'adminTools', icon: IcoWrench, label: 'Инструменты' },
]

const titles: Record<Screen, string> = {
  apps: 'Приложения', chat: 'AI-чат', prompts: 'Промпты', tools: 'Инструменты',
  monitoring: 'Панель администратора', users: 'Пользователи и группы',
  appAccess: 'Приложения и доступ', adminAi: 'AI и промпты', adminTools: 'Инструменты',
}

/* ===== EXPORT ===== */
export function DemoAIHub() {
  const [open, setOpen] = useState(false)
  return (
    <>
      <div className="mt-5 flex justify-center">
        <button onClick={(e) => { e.stopPropagation(); setOpen(true) }} className="px-6 py-3 bg-accent hover:bg-accent/90 text-white font-semibold rounded-xl text-sm transition-all cursor-pointer border-none flex items-center gap-2 shadow-lg shadow-accent/25">
          <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path strokeLinecap="round" strokeLinejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
          Открыть демо
        </button>
      </div>
      {open && <Modal onClose={() => setOpen(false)} />}
    </>
  )
}

/* ===== MODAL ===== */
function Modal({ onClose }: { onClose: () => void }) {
  const [screen, setScreen] = useState<Screen>('apps')
  const handleKey = useCallback((e: KeyboardEvent) => { if (e.key === 'Escape') onClose() }, [onClose])
  useEffect(() => {
    document.addEventListener('keydown', handleKey)
    document.body.classList.add('demo-modal-open')
    return () => { document.removeEventListener('keydown', handleKey); document.body.classList.remove('demo-modal-open') }
  }, [handleKey])

  return createPortal(
    <div className="fixed inset-0 z-[9999] flex items-center justify-center p-4" onClick={onClose}>
      <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" />
      <div className="demo-modal-enter relative w-full max-w-[1400px] rounded-2xl overflow-hidden shadow-2xl flex flex-col" style={{ height: '90vh', maxHeight: '920px' }} onClick={e => e.stopPropagation()}>
        <button onClick={onClose} className="absolute top-3 right-3 z-50 w-8 h-8 rounded-full bg-black/20 hover:bg-black/40 text-white flex items-center justify-center cursor-pointer border-none transition-colors text-lg" aria-label="Close">&times;</button>
        <div className="flex flex-1 min-h-0">
          {/* Sidebar */}
          <div className="w-[240px] bg-white border-r border-gray-200 flex flex-col shrink-0">
            <div className="h-14 flex items-center px-4 border-b border-gray-100">
              <div className="w-8 h-8 rounded-lg bg-[#E52713] flex items-center justify-center text-xs text-white font-bold mr-3">AI</div>
              <div className="text-sm font-bold text-gray-800">AI-Hub</div>
            </div>
            <div className="flex-1 py-3 px-3 space-y-0.5 overflow-y-auto">
              {nav.map(item => (
                <div key={item.key}>
                  {item.admin && <div className="pt-4 pb-2 px-2"><div className="text-[0.6rem] font-bold text-gray-400 uppercase tracking-wider">Администрирование</div></div>}
                  <button onClick={() => setScreen(item.key)} className={`w-full flex items-center gap-2.5 px-3 py-2 rounded-lg text-left cursor-pointer border-none transition-colors text-[0.8rem] ${screen === item.key ? 'bg-[#E52713]/8 text-[#E52713] font-semibold' : 'bg-transparent text-gray-600 hover:bg-gray-50'}`}>
                    <item.icon /><span>{item.label}</span>
                  </button>
                </div>
              ))}
            </div>
            <div className="p-3 border-t border-gray-100">
              <div className="flex items-center gap-2.5 p-2 rounded-lg bg-gray-50">
                <div className="w-8 h-8 rounded-full bg-[#E52713]/15 flex items-center justify-center text-[0.65rem] text-[#E52713] font-bold">НХ</div>
                <div className="flex-1 min-w-0"><div className="text-[0.75rem] font-semibold text-gray-800 truncate">Никита Х.</div><div className="text-[0.6rem] text-gray-400">Администратор</div></div>
              </div>
              <div className="text-[0.58rem] text-gray-300 text-center mt-2">v1.0</div>
            </div>
          </div>
          {/* Content */}
          <div className="flex-1 flex flex-col min-w-0 bg-[#FAFAFA]">
            <div className="h-14 flex items-center justify-between px-6 bg-white border-b border-gray-200 shrink-0">
              <h2 className="text-[0.95rem] font-bold text-gray-800 m-0">{titles[screen]}</h2>
              <span className="text-[0.72rem] text-gray-400">16 февр. 2026</span>
            </div>
            <div className="flex-1 overflow-y-auto">
              {screen === 'apps' && <PgApps />}
              {screen === 'chat' && <PgChat />}
              {screen === 'prompts' && <PgPrompts />}
              {screen === 'tools' && <PgTools />}
              {screen === 'monitoring' && <PgMonitoring />}
              {screen === 'users' && <PgUsers />}
              {screen === 'appAccess' && <PgAppAccess />}
              {screen === 'adminAi' && <PgAdminAi />}
              {screen === 'adminTools' && <PgAdminTools />}
            </div>
          </div>
        </div>
      </div>
    </div>, document.body)
}

/* ── Spotlight Card ── */
function Spot({ children }: { children: React.ReactNode }) {
  const ref = useRef<HTMLDivElement>(null)
  const [s, setS] = useState({ x: 0, y: 0, on: false })
  return (
    <div ref={ref} className="relative bg-white border border-gray-200 rounded-xl p-4 cursor-default transition-all hover:border-[#E52713]/30 hover:shadow-lg group overflow-hidden"
      onMouseMove={e => { const r = ref.current?.getBoundingClientRect(); if (r) setS({ x: e.clientX - r.left, y: e.clientY - r.top, on: true }) }}
      onMouseLeave={() => setS(p => ({ ...p, on: false }))}>
      <div className="pointer-events-none absolute inset-0 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300" style={{ background: s.on ? `radial-gradient(300px circle at ${s.x}px ${s.y}px, rgba(229,39,19,0.06), transparent 60%)` : 'none' }} />
      <div className="relative z-10">{children}</div>
    </div>
  )
}

/* ── Btn helpers ── */
function ExportBtn({ label }: { label: string }) {
  return <button className="flex items-center gap-1.5 px-3 py-1.5 bg-white border border-gray-200 rounded-lg text-[0.7rem] text-gray-600 font-medium cursor-pointer hover:border-[#E52713]/30 hover:text-[#E52713] transition-colors"><Ico.Download />{label}</button>
}
function TabBtn({ active, onClick, children }: { active: boolean; onClick: () => void; children: React.ReactNode }) {
  return <button onClick={onClick} className={`px-3 py-1.5 rounded-lg text-[0.75rem] font-medium cursor-pointer border transition-colors ${active ? 'bg-[#E52713]/10 text-[#E52713] border-[#E52713]/20' : 'bg-white text-gray-500 border-gray-200 hover:border-gray-300'}`}>{children}</button>
}
function StatCard({ label, val, sub, color }: { label: string; val: string; sub: string; color: string }) {
  return <div className="bg-white rounded-xl p-4 border border-gray-200" style={{ borderLeftWidth: 3, borderLeftColor: color }}><span className="text-[0.65rem] text-gray-400 uppercase font-bold tracking-wider">{label}</span><div className="text-2xl font-extrabold text-gray-800 mt-1">{val}</div><div className="text-[0.7rem] text-gray-400 mt-0.5">{sub}</div></div>
}

/* ===== APPS ===== */
function PgApps() {
  const cats = ['Все', 'Аналитика', 'AI & ML', 'Финансы', 'Инструменты']
  const [cat, setCat] = useState('Все')
  const apps = [
    { name: 'DataBook', desc: 'Интеллектуальный поиск предписаний строительного контроля', cat: 'Аналитика', users: 28, color: '#3B82F6' },
    { name: 'AI-чат', desc: 'Корпоративный AI-ассистент для сотрудников', cat: 'AI & ML', users: 47, color: '#E52713' },
    { name: 'CostManager', desc: 'Контроль себестоимости строительных объектов', cat: 'Финансы', users: 15, color: '#10B981' },
    { name: 'Автопротокол', desc: 'ML-протоколирование совещаний', cat: 'AI & ML', users: 34, color: '#8B5CF6' },
    { name: 'Puls', desc: 'ERP-прототип управления строительными проектами', cat: 'Аналитика', users: 12, color: '#F59E0B' },
    { name: 'Сметный калькулятор', desc: 'Быстрые расчёты на основе нормативной базы', cat: 'Инструменты', users: 41, color: '#6B7280' },
  ]
  const list = cat === 'Все' ? apps : apps.filter(a => a.cat === cat)
  return (
    <div className="p-6">
      <div className="flex items-center justify-between mb-5 flex-wrap gap-3">
        <div className="flex items-center gap-2">{cats.map(c => <TabBtn key={c} active={cat === c} onClick={() => setCat(c)}>{c}</TabBtn>)}</div>
        <div className="bg-white border border-gray-200 rounded-xl px-4 py-2 text-[0.78rem] text-gray-400 min-w-[200px]">Поиск приложений...</div>
      </div>
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        {list.map(a => (
          <Spot key={a.name}>
            <div className="flex items-start gap-3 mb-3">
              <div className="w-11 h-11 rounded-xl flex items-center justify-center text-[0.7rem] font-bold shrink-0" style={{ background: `${a.color}15`, color: a.color }}>{a.name.slice(0, 2).toUpperCase()}</div>
              <div className="flex-1 min-w-0"><div className="text-[0.88rem] font-semibold text-gray-800">{a.name}</div><div className="text-[0.72rem] text-gray-400 mt-0.5 leading-snug">{a.desc}</div></div>
            </div>
            <div className="flex items-center justify-between">
              <span className="px-2 py-0.5 rounded-md text-[0.65rem] font-semibold" style={{ background: `${a.color}15`, color: a.color }}>{a.cat}</span>
              <span className="text-[0.65rem] text-gray-400">{a.users} польз.</span>
            </div>
          </Spot>
        ))}
      </div>
    </div>
  )
}

/* ===== CHAT ===== */
type ConvKey = 'letter' | 'ks2' | 'agenda' | 'norm'
const convData: Record<ConvKey, { title: string; suggestion: string; userMsg: string; aiReply: string }> = {
  letter: {
    title: 'Письмо подрядчику',
    suggestion: 'Составь письмо подрядчику',
    userMsg: 'Составь письмо подрядчику ООО "СтройМонтаж" о задержке сроков по корпусу 3',
    aiReply: `Исх. No 156/ДЦТ от 16.02.2026\n\nГенеральному директору\nООО "СтройМонтаж"\nИванову И.И.\n\nУважаемый Иван Иванович!\n\nВ связи с нарушением сроков выполнения работ по объекту "Корпус 3" (договор No 78/2025 от 15.03.2025), просим Вас в срок до 20.02.2026:\n\n1. Предоставить актуализированный график производства работ\n2. Обеспечить мобилизацию дополнительных бригад\n3. Представить план компенсационных мероприятий\n\nВ случае дальнейшего нарушения сроков оставляем за собой право применения штрафных санкций согласно п.8.3 договора.\n\nС уважением,\nРуководитель ДЦТ`,
  },
  ks2: {
    title: 'Анализ КС-2 январь',
    suggestion: 'Проанализируй отчёт КС-2',
    userMsg: 'Проанализируй отклонения по КС-2 за январь. Какие подрядчики завышают объёмы?',
    aiReply: `Анализ отклонений КС-2 (январь 2026):\n\n1. ООО "СтройМонтаж" -- отклонение +12.3% по бетонным работам\n2. ИП Петров -- завышение объёмов кладки на корп. 3\n3. ООО "ФасадПро" -- в пределах нормы (<3%)\n\nРекомендация: запросить детализацию у СтройМонтаж по актам скрытых работ.`,
  },
  agenda: {
    title: 'Повестка совещания',
    suggestion: 'Подготовь повестку совещания',
    userMsg: 'Подготовь повестку еженедельного производственного совещания на 17.02',
    aiReply: `Повестка производственного совещания\n17.02.2026, 10:00, каб. 301\n\n1. Статус работ по корпусам 1-4 (отв. Петров К.Л., 15 мин)\n2. Отклонения по КС-2 за январь (отв. Хроменок Н.В., 10 мин)\n3. Поставка материалов: задержки и замены (отв. Лебедев А.М., 10 мин)\n4. Результаты проверки СК по корпусу 2 (отв. Иванов А.С., 10 мин)\n5. Корректировка графика на март (отв. Сидоров К.Л., 15 мин)\n6. Разное\n\nОбщая длительность: ~60 мин\nПротоколирование: Автопротокол (AI)`,
  },
  norm: {
    title: 'Нормативы СНиП',
    suggestion: 'Найди нормативный документ',
    userMsg: 'Найди актуальный нормативный документ по допустимым отклонениям при кирпичной кладке',
    aiReply: `Основные нормативные документы:\n\n1. СП 70.13330.2012 "Несущие и ограждающие конструкции" (актуализ. СНиП 3.03.01-87)\n   -- Раздел 9: Каменные конструкции\n   -- Таблица 9.8: допустимые отклонения\n\n2. Допуски при кладке из кирпича:\n   -- Толщина швов: горизонт. -2/+3 мм, вертик. -2/+2 мм\n   -- Отклонение от вертикали: на этаж не более 10 мм, на здание -- 30 мм\n   -- Отклонение рядов от горизонтали: 15 мм на 10 м длины\n   -- Неровности поверхности: 10 мм (кладка под штукатурку)\n\n3. ГОСТ 530-2012 "Кирпич и камень керамические" -- требования к материалу`,
  },
}
const historyItems: { key: ConvKey; time: string }[] = [
  { key: 'ks2', time: 'Сейчас' },
  { key: 'letter', time: '1 час назад' },
  { key: 'agenda', time: 'Вчера' },
  { key: 'norm', time: '2 дня назад' },
]

type ChatPhase = 'welcome' | 'typing' | 'thinking' | 'streaming' | 'done'

function PgChat() {
  const [convKey, setConvKey] = useState<ConvKey | null>(null)
  const [phase, setPhase] = useState<ChatPhase>('welcome')
  const [userText, setUserText] = useState('')
  const [aiText, setAiText] = useState('')
  const bottomRef = useRef<HTMLDivElement>(null)

  const conv = convKey ? convData[convKey] : null

  useEffect(() => { bottomRef.current?.scrollIntoView({ behavior: 'smooth' }) }, [userText, aiText, phase])

  const startConv = (key: ConvKey, instant?: boolean) => {
    setConvKey(key)
    if (instant) {
      setUserText(convData[key].userMsg)
      setAiText(convData[key].aiReply)
      setPhase('done')
    } else {
      setUserText('')
      setAiText('')
      setPhase('typing')
    }
  }

  useEffect(() => {
    if (!conv) return
    if (phase === 'typing') {
      let i = 0
      const id = setInterval(() => { i++; setUserText(conv.userMsg.slice(0, i)); if (i >= conv.userMsg.length) { clearInterval(id); setTimeout(() => setPhase('thinking'), 300) } }, 20)
      return () => clearInterval(id)
    }
    if (phase === 'thinking') { const id = setTimeout(() => setPhase('streaming'), 1000); return () => clearTimeout(id) }
    if (phase === 'streaming') {
      let i = 0
      const id = setInterval(() => { i += 3; setAiText(conv.aiReply.slice(0, i)); if (i >= conv.aiReply.length) { clearInterval(id); setPhase('done') } }, 12)
      return () => clearInterval(id)
    }
  }, [phase, conv])

  return (
    <div className="flex h-full">
      <div className="flex-1 flex flex-col">
        {phase === 'welcome' ? (
          <div className="flex-1 flex flex-col items-center justify-center px-6">
            <div className="w-16 h-16 rounded-2xl bg-[#E52713] flex items-center justify-center text-xl text-white font-bold mb-4 shadow-lg shadow-[#E52713]/20">AI</div>
            <div className="text-xl font-bold text-gray-800 mb-1">AI-чат</div>
            <div className="text-[0.82rem] text-gray-400 mb-6">Корпоративный AI-ассистент</div>
            <div className="grid grid-cols-2 gap-3 max-w-[480px] w-full">
              {(Object.keys(convData) as ConvKey[]).map(k => (
                <button key={k} onClick={() => startConv(k)} className="bg-white border border-gray-200 rounded-xl p-3 text-left cursor-pointer hover:border-[#E52713]/30 hover:shadow-md transition-all">
                  <span className="text-[0.78rem] text-gray-600">{convData[k].suggestion}</span>
                </button>
              ))}
            </div>
            <div className="mt-6 text-[0.7rem] text-gray-400">Лимит: 50 запросов / день | Осталось: 43</div>
          </div>
        ) : (
          <>
            <div className="flex-1 overflow-y-auto p-5 space-y-4">
              <div className="flex gap-3 max-w-[80%]">
                <div className="w-8 h-8 rounded-full bg-[#E52713] flex items-center justify-center text-white text-[0.6rem] font-bold shrink-0">AI</div>
                <div><div className="text-[0.65rem] text-gray-400 mb-1">AI-ассистент</div><div className="bg-white border border-gray-200 rounded-2xl rounded-tl-sm px-4 py-2.5 text-[0.82rem] text-gray-700 leading-relaxed shadow-sm">Добрый день! Чем могу помочь?</div><span className="text-[0.6rem] text-gray-300 mt-1 block">14:30</span></div>
              </div>
              {userText && (
                <div className="flex gap-3 max-w-[75%] ml-auto flex-row-reverse">
                  <div className="w-8 h-8 rounded-full bg-[#E52713]/15 flex items-center justify-center text-[#E52713] text-[0.6rem] font-bold shrink-0">НХ</div>
                  <div className="text-right"><div className="text-[0.65rem] text-gray-400 mb-1">Вы</div>
                    <div className="bg-[#E52713] text-white rounded-2xl rounded-tr-sm px-4 py-2.5 text-[0.82rem] leading-relaxed text-left shadow-sm">{userText}{phase === 'typing' && <span className="inline-block w-0.5 h-4 bg-white/70 ml-0.5 animate-pulse align-middle" />}</div>
                  </div>
                </div>
              )}
              {phase === 'thinking' && (
                <div className="flex gap-3"><div className="w-8 h-8 rounded-full bg-[#E52713] flex items-center justify-center text-white text-[0.6rem] font-bold shrink-0">AI</div>
                  <div className="bg-white border border-gray-200 rounded-2xl rounded-tl-sm px-4 py-3 shadow-sm"><div className="flex items-center gap-1.5"><span className="w-1.5 h-1.5 bg-[#E52713] rounded-full animate-pulse"/><span className="w-1.5 h-1.5 bg-[#E52713]/60 rounded-full animate-pulse" style={{animationDelay:'0.2s'}}/><span className="w-1.5 h-1.5 bg-[#E52713]/30 rounded-full animate-pulse" style={{animationDelay:'0.4s'}}/><span className="text-[0.72rem] text-gray-400 ml-2">Думаю...</span></div></div>
                </div>
              )}
              {(phase === 'streaming' || phase === 'done') && aiText && (
                <div className="flex gap-3 max-w-[85%]">
                  <div className="w-8 h-8 rounded-full bg-[#E52713] flex items-center justify-center text-white text-[0.6rem] font-bold shrink-0">AI</div>
                  <div><div className="text-[0.65rem] text-gray-400 mb-1">AI-ассистент</div>
                    <div className="bg-white border border-gray-200 rounded-2xl rounded-tl-sm px-4 py-3 text-[0.82rem] text-gray-700 leading-relaxed shadow-sm whitespace-pre-line">{aiText}{phase === 'streaming' && <span className="inline-block w-0.5 h-4 bg-[#E52713]/50 ml-0.5 animate-pulse align-middle" />}</div>
                    {phase === 'done' && <span className="text-[0.6rem] text-gray-300 mt-1 block">14:32</span>}
                  </div>
                </div>
              )}
              <div ref={bottomRef}/>
            </div>
            <div className="p-4 bg-white border-t border-gray-200">
              <div className="flex items-center gap-3">
                <div className="flex-1 bg-gray-50 rounded-xl px-4 py-3 text-[0.82rem] text-gray-400 border border-gray-200">Введите сообщение...</div>
                <button className="w-10 h-10 rounded-xl bg-[#E52713] flex items-center justify-center border-none cursor-pointer hover:bg-[#E52713]/90 transition-colors"><svg className="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M5 10l7-7m0 0l7 7m-7-7v18"/></svg></button>
              </div>
              <div className="flex items-center justify-between mt-2 px-1"><span className="text-[0.65rem] text-gray-300">Enter -- отправить</span><span className="text-[0.65rem] text-gray-400">7 / 50</span></div>
            </div>
          </>
        )}
      </div>
      {/* History */}
      <div className="w-[200px] bg-white border-l border-gray-200 flex flex-col shrink-0">
        <div className="h-12 flex items-center justify-between px-4 border-b border-gray-100"><span className="text-[0.78rem] font-semibold text-gray-600">История</span><button className="w-6 h-6 rounded-md bg-gray-100 flex items-center justify-center text-gray-400 text-sm border-none cursor-pointer hover:bg-gray-200 transition-colors">+</button></div>
        <div className="flex-1 p-2 space-y-1 overflow-y-auto">
          {historyItems.map(h => (
            <button key={h.key} onClick={() => startConv(h.key, true)} className={`w-full text-left px-3 py-2 rounded-lg cursor-pointer border-none transition-colors ${convKey === h.key ? 'bg-[#E52713]/8 text-[#E52713]' : 'bg-transparent text-gray-500 hover:bg-gray-50'}`}>
              <div className={`text-[0.72rem] truncate ${convKey === h.key ? 'font-semibold' : ''}`}>{convData[h.key].title}</div>
              <div className="text-[0.6rem] text-gray-300 mt-0.5">{h.time}</div>
            </button>
          ))}
        </div>
      </div>
    </div>
  )
}

/* ===== PROMPTS ===== */
function PgPrompts() {
  const cats = [{ n: 'Все', c: 24 }, { n: 'Написание', c: 8 }, { n: 'Анализ', c: 6 }, { n: 'Код', c: 5 }, { n: 'Перевод', c: 5 }]
  const [cat, setCat] = useState('Все')
  const ps = [
    { t: 'Деловое письмо', d: 'Составить профессиональное письмо по шаблону', c: 'Написание', u: 156 },
    { t: 'Анализ договора', d: 'Выделить ключевые пункты и риски из договора', c: 'Анализ', u: 89 },
    { t: 'Code Review', d: 'Проверить код на ошибки и предложить улучшения', c: 'Код', u: 134 },
    { t: 'Перевод документа', d: 'Технический перевод с сохранением терминологии', c: 'Перевод', u: 67 },
    { t: 'Протокол совещания', d: 'Структурировать заметки в формат протокола', c: 'Написание', u: 203 },
    { t: 'Анализ КС-2', d: 'Выявить отклонения в актах выполненных работ', c: 'Анализ', u: 78 },
    { t: 'SQL-запрос', d: 'Сгенерировать SQL по описанию на естественном языке', c: 'Код', u: 92 },
    { t: 'Краткое содержание', d: 'Сжать длинный текст до ключевых тезисов', c: 'Анализ', u: 145 },
    { t: 'Перевод ТЗ', d: 'Перевести техническое задание EN/RU', c: 'Перевод', u: 53 },
  ]
  const list = cat === 'Все' ? ps : ps.filter(p => p.c === cat)
  return (
    <div className="p-6">
      <div className="bg-white border border-gray-200 rounded-xl px-4 py-2.5 text-[0.82rem] text-gray-400 mb-5">Поиск промптов...</div>
      <div className="flex items-center gap-2 mb-5 flex-wrap">{cats.map(c => <TabBtn key={c.n} active={cat === c.n} onClick={() => setCat(c.n)}>{c.n} <span className="text-gray-400 ml-1">{c.c}</span></TabBtn>)}</div>
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
        {list.map(p => (
          <div key={p.t} className="bg-white border border-gray-200 rounded-xl p-4 hover:border-[#E52713]/30 hover:shadow-md transition-all cursor-default group">
            <div className="text-[0.82rem] font-semibold text-gray-800 group-hover:text-[#E52713] transition-colors mb-1">{p.t}</div>
            <div className="text-[0.72rem] text-gray-400 mb-3">{p.d}</div>
            <div className="flex items-center justify-between"><span className="text-[0.65rem] text-gray-400 bg-gray-100 px-2 py-0.5 rounded-md">{p.c}</span><span className="text-[0.65rem] text-gray-400">{p.u} использований</span></div>
          </div>
        ))}
      </div>
    </div>
  )
}

/* ===== TOOLS ===== */
function PgTools() {
  const tools = [
    { name: 'PDF to Excel', desc: 'Конвертация PDF-таблиц в формат XLSX с сохранением структуры', color: '#10B981', status: 'ok', uses: 342, ico: 'XLS' },
    { name: 'OCR', desc: 'Распознавание текста с изображений и сканов документов', color: '#3B82F6', status: 'ok', uses: 218, ico: 'OCR' },
    { name: 'Word to PDF', desc: 'Конвертация документов DOCX в PDF с сохранением форматирования', color: '#8B5CF6', status: 'ok', uses: 567, ico: 'PDF' },
    { name: 'Сжатие изображений', desc: 'Оптимизация размера JPG/PNG без потери качества', color: '#F59E0B', status: 'ok', uses: 189, ico: 'IMG' },
    { name: 'Извлечение таблиц', desc: 'Извлечение табличных данных из PDF и изображений через AI', color: '#E52713', status: 'warn', uses: 95, ico: 'TAB' },
    { name: 'Объединение PDF', desc: 'Склейка нескольких PDF-файлов в один документ', color: '#06B6D4', status: 'ok', uses: 276, ico: 'MRG' },
    { name: 'Excel to PDF', desc: 'Конвертация таблиц XLSX в PDF с настройкой ориентации', color: '#EC4899', status: 'ok', uses: 431, ico: 'E2P' },
    { name: 'Водяные знаки', desc: 'Добавление текстовых/графических водяных знаков на PDF', color: '#6366F1', status: 'ok', uses: 64, ico: 'WM' },
    { name: 'QR-генератор', desc: 'Создание QR-кодов со ссылками и текстом для документов', color: '#6B7280', status: 'ok', uses: 152, ico: 'QR' },
  ]
  return (
    <div className="p-6">
      <div className="bg-white border border-gray-200 rounded-xl px-4 py-2.5 text-[0.82rem] text-gray-400 mb-5">Поиск инструментов...</div>
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        {tools.map(t => (
          <div key={t.name} className="bg-white border border-gray-200 rounded-xl p-5 hover:border-gray-300 hover:shadow-md transition-all cursor-default group">
            <div className="flex items-start gap-3 mb-3">
              <div className="w-11 h-11 rounded-xl flex items-center justify-center text-[0.65rem] font-bold shrink-0 text-white" style={{ background: t.color }}>{t.ico}</div>
              <div className="flex-1 min-w-0">
                <div className="flex items-center gap-2">
                  <div className="text-[0.85rem] font-semibold text-gray-800">{t.name}</div>
                  <span className={`w-2 h-2 rounded-full shrink-0 ${t.status === 'ok' ? 'bg-green-500' : 'bg-amber-400'}`} />
                </div>
                <div className="text-[0.72rem] text-gray-400 mt-0.5 leading-snug">{t.desc}</div>
              </div>
            </div>
            <div className="flex items-center justify-between">
              <span className="text-[0.65rem] text-gray-400">{t.uses} использований</span>
              <button className="px-3 py-1 rounded-lg text-[0.7rem] font-medium border cursor-pointer transition-colors bg-white text-gray-500 border-gray-200 group-hover:border-[#E52713]/30 group-hover:text-[#E52713]">Открыть</button>
            </div>
          </div>
        ))}
      </div>
    </div>
  )
}

/* ===== MONITORING ===== */
function PgMonitoring() {
  const [tab, setTab] = useState<'overview' | 'health' | 'stats' | 'audit' | 'logins'>('overview')
  return (
    <div className="p-6">
      <div className="flex items-center gap-2 mb-5 flex-wrap">{(['overview', 'health', 'stats', 'audit', 'logins'] as const).map(t => <TabBtn key={t} active={tab === t} onClick={() => setTab(t)}>{{ overview: 'Обзор', health: 'Health', stats: 'Статистика', audit: 'Аудит', logins: 'История входов' }[t]}</TabBtn>)}</div>
      {tab === 'overview' && <MonOverview />}
      {tab === 'health' && <MonHealth />}
      {tab === 'stats' && <MonStats />}
      {tab === 'audit' && <MonAudit />}
      {tab === 'logins' && <MonLogins />}
    </div>
  )
}

function MonOverview() {
  return (<>
    <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-5">
      <StatCard label="Пользователи" val="47" sub="32 активных" color="#3B82F6" />
      <StatCard label="Приложения" val="6" sub="4 active" color="#10B981" />
      <StatCard label="Группы" val="8" sub="3 admin" color="#F59E0B" />
      <StatCard label="Токены" val="156" sub="42 активных" color="#8B5CF6" />
    </div>
    <div className="flex items-center gap-2 mb-5 flex-wrap">
      <ExportBtn label="Export Users (.xlsx)" />
      <ExportBtn label="Export Applications (.xlsx)" />
      <button className="flex items-center gap-1.5 px-3 py-1.5 bg-red-50 border border-red-200 rounded-lg text-[0.7rem] text-red-600 font-medium cursor-pointer hover:bg-red-100 transition-colors">Очистить старые токены</button>
    </div>
    <div className="grid grid-cols-2 gap-4">
      <div className="bg-white rounded-xl border border-gray-200 p-5">
        <div className="text-[0.82rem] font-semibold text-gray-700 mb-3">Сообщений AI-чат</div>
        <div className="grid grid-cols-3 gap-3 text-center">
          <div><div className="text-xl font-bold text-gray-800">1,847</div><div className="text-[0.65rem] text-gray-400">Всего</div></div>
          <div><div className="text-xl font-bold text-[#E52713]">34</div><div className="text-[0.65rem] text-gray-400">Сегодня</div></div>
          <div><div className="text-xl font-bold text-gray-800">198</div><div className="text-[0.65rem] text-gray-400">За неделю</div></div>
        </div>
      </div>
      <div className="bg-white rounded-xl border border-gray-200 p-5">
        <div className="text-[0.82rem] font-semibold text-gray-700 mb-3">Токены (стоимость)</div>
        <div className="grid grid-cols-3 gap-3 text-center">
          <div><div className="text-xl font-bold text-gray-800">$2.14</div><div className="text-[0.65rem] text-gray-400">Сегодня</div></div>
          <div><div className="text-xl font-bold text-gray-800">$12.80</div><div className="text-[0.65rem] text-gray-400">Неделя</div></div>
          <div><div className="text-xl font-bold text-gray-800">$48.50</div><div className="text-[0.65rem] text-gray-400">Всего</div></div>
        </div>
      </div>
    </div>
  </>)
}

function MonHealth() {
  const svcs = [
    { name: 'Backend API', lat: '8ms', st: 'healthy' }, { name: 'PostgreSQL', lat: '12ms', st: 'healthy' },
    { name: 'Redis', lat: '3ms', st: 'healthy' }, { name: 'LLM API', lat: '180ms', st: 'degraded' },
    { name: 'ADFS / OAuth', lat: '45ms', st: 'healthy' }, { name: 'S3 Storage', lat: '28ms', st: 'healthy' },
    { name: 'Tools Server', lat: '52ms', st: 'healthy' },
  ]
  const stColor = (s: string) => s === 'healthy' ? 'bg-green-500' : s === 'degraded' ? 'bg-amber-400' : 'bg-red-500'
  const stLabel = (s: string) => s === 'healthy' ? 'text-green-600' : s === 'degraded' ? 'text-amber-600' : 'text-red-600'
  return (
    <div className="bg-white rounded-xl border border-gray-200 p-5">
      <div className="flex items-center justify-between mb-4">
        <div className="text-[0.82rem] font-semibold text-gray-700">Service Health</div>
        <button className="px-3 py-1 bg-gray-100 rounded-lg text-[0.7rem] text-gray-500 font-medium cursor-pointer border-none hover:bg-gray-200 transition-colors">Refresh</button>
      </div>
      <div className="space-y-3">
        {svcs.map(s => (
          <div key={s.name} className="flex items-center justify-between py-2 border-b border-gray-50 last:border-b-0">
            <div className="flex items-center gap-3"><span className={`w-2.5 h-2.5 rounded-full ${stColor(s.st)}`} /><span className="text-[0.8rem] text-gray-700 font-medium">{s.name}</span></div>
            <div className="flex items-center gap-4"><span className="text-[0.72rem] text-gray-400 font-mono">{s.lat}</span><span className={`text-[0.7rem] font-semibold ${stLabel(s.st)}`}>{s.st}</span></div>
          </div>
        ))}
      </div>
    </div>
  )
}

function MonStats() {
  const days = ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс']
  const msgs = [42, 38, 55, 61, 34, 12, 8]
  const max = Math.max(...msgs)
  const topUsers = [{ n: 'Хроменок Н.В.', v: 312 }, { n: 'Петрова М.В.', v: 198 }, { n: 'Иванов А.С.', v: 156 }, { n: 'Козлова Е.А.', v: 89 }]
  return (<>
    <div className="bg-white rounded-xl border border-gray-200 p-5 mb-4">
      <div className="text-[0.82rem] font-semibold text-gray-700 mb-4">Сообщений по дням (последняя неделя)</div>
      <div className="flex items-end gap-3 h-[120px]">
        {days.map((d, i) => (
          <div key={d} className="flex-1 flex flex-col items-center gap-1">
            <span className="text-[0.65rem] font-semibold text-gray-800">{msgs[i]}</span>
            <div className="w-full rounded-t-md transition-all" style={{ height: `${(msgs[i] / max) * 90}px`, background: i < 5 ? '#E52713' : '#E5271333' }} />
            <span className="text-[0.6rem] text-gray-400">{d}</span>
          </div>
        ))}
      </div>
    </div>
    <div className="grid grid-cols-2 gap-4">
      <div className="bg-white rounded-xl border border-gray-200 p-5">
        <div className="text-[0.82rem] font-semibold text-gray-700 mb-3">Top пользователей по сообщениям</div>
        <div className="space-y-2.5">{topUsers.map((u, i) => (
          <div key={u.n} className="flex items-center gap-3">
            <span className="text-[0.7rem] text-gray-400 w-5">{i + 1}.</span>
            <span className="text-[0.78rem] text-gray-700 flex-1">{u.n}</span>
            <span className="text-[0.75rem] font-semibold text-gray-800">{u.v}</span>
          </div>
        ))}</div>
      </div>
      <div className="bg-white rounded-xl border border-gray-200 p-5">
        <div className="text-[0.82rem] font-semibold text-gray-700 mb-3">Top промптов</div>
        <div className="space-y-2.5">{[{ n: 'Протокол совещания', v: 203 }, { n: 'Деловое письмо', v: 156 }, { n: 'Краткое содержание', v: 145 }, { n: 'Code Review', v: 134 }].map((p, i) => (
          <div key={p.n} className="flex items-center gap-3">
            <span className="text-[0.7rem] text-gray-400 w-5">{i + 1}.</span>
            <span className="text-[0.78rem] text-gray-700 flex-1">{p.n}</span>
            <span className="text-[0.75rem] font-semibold text-gray-800">{p.v}</span>
          </div>
        ))}</div>
      </div>
    </div>
  </>)
}

function MonAudit() {
  const log = [
    { time: '14:32', user: 'Хроменок Н.В.', action: 'login', entity: 'auth', ip: '10.0.1.15', color: '#10B981' },
    { time: '14:30', user: 'Петрова М.В.', action: 'export_report', entity: 'data', ip: '10.0.1.22', color: '#3B82F6' },
    { time: '14:28', user: 'Система', action: 'token_cleanup', entity: 'system', ip: '--', color: '#6B7280' },
    { time: '14:15', user: 'Иванов А.С.', action: 'access_denied', entity: 'security', ip: '10.0.2.8', color: '#EF4444' },
    { time: '14:10', user: 'Морозов Д.И.', action: 'user.update', entity: 'user', ip: '10.0.1.3', color: '#8B5CF6' },
    { time: '14:05', user: 'Хроменок Н.В.', action: 'group.create', entity: 'group', ip: '10.0.1.15', color: '#F59E0B' },
    { time: '13:58', user: 'Система', action: 'health_check', entity: 'system', ip: '--', color: '#6B7280' },
    { time: '13:45', user: 'Козлова Е.А.', action: 'access.grant', entity: 'access', ip: '10.0.3.1', color: '#06B6D4' },
  ]
  return (
    <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
      <div className="flex items-center justify-between px-5 py-3 bg-gray-50 border-b border-gray-200">
        <span className="text-[0.82rem] font-semibold text-gray-700">Audit Log</span>
        <span className="px-2 py-0.5 bg-amber-100 text-amber-600 rounded-md text-[0.6rem] font-bold">LIVE</span>
      </div>
      <table className="w-full">
        <thead><tr className="text-[0.65rem] text-gray-400 uppercase tracking-wider"><th className="text-left px-5 py-2 font-semibold">Время</th><th className="text-left px-4 py-2 font-semibold">Пользователь</th><th className="text-left px-4 py-2 font-semibold">Действие</th><th className="text-left px-4 py-2 font-semibold">Сущность</th><th className="text-left px-4 py-2 font-semibold">IP</th></tr></thead>
        <tbody>{log.map((l, i) => (
          <tr key={i} className="border-t border-gray-100 hover:bg-gray-50/50 text-[0.78rem]">
            <td className="px-5 py-2 text-gray-400 font-mono text-[0.72rem]">{l.time}</td>
            <td className="px-4 py-2 text-gray-700">{l.user}</td>
            <td className="px-4 py-2"><span className="font-mono font-semibold px-2 py-0.5 rounded-md text-[0.68rem]" style={{ color: l.color, background: `${l.color}15` }}>{l.action}</span></td>
            <td className="px-4 py-2 text-gray-500">{l.entity}</td>
            <td className="px-4 py-2 text-gray-400 font-mono text-[0.7rem]">{l.ip}</td>
          </tr>
        ))}</tbody>
      </table>
    </div>
  )
}

function MonLogins() {
  const logins = [
    { time: '16.02 14:32', user: 'Хроменок Н.В.', email: 'khromenok@company.ru', type: 'SSO/ADFS', ok: true, ip: '10.0.1.15', browser: 'Chrome' },
    { time: '16.02 14:28', user: 'Петрова М.В.', email: 'petrova@company.ru', type: 'SSO/ADFS', ok: true, ip: '10.0.1.22', browser: 'Edge' },
    { time: '16.02 14:15', user: 'Неизвестный', email: 'test@external.ru', type: 'SSO/ADFS', ok: false, ip: '10.0.2.8', browser: 'Firefox' },
    { time: '16.02 13:50', user: 'Иванов А.С.', email: 'ivanov@company.ru', type: 'OAuth', ok: true, ip: '10.0.1.44', browser: 'Chrome' },
    { time: '16.02 13:45', user: 'Козлова Е.А.', email: 'kozlova@company.ru', type: 'SSO/ADFS', ok: true, ip: '10.0.3.1', browser: 'Safari' },
    { time: '15.02 18:30', user: 'Морозов Д.И.', email: 'morozov@company.ru', type: 'Dev Login', ok: true, ip: '127.0.0.1', browser: 'Chrome' },
    { time: '15.02 17:20', user: 'Сидоров К.Л.', email: 'sidorov@company.ru', type: 'SSO/ADFS', ok: true, ip: '10.0.1.88', browser: 'Edge' },
  ]
  const typeBg: Record<string, string> = { 'SSO/ADFS': 'bg-blue-100 text-blue-600', 'Dev Login': 'bg-amber-100 text-amber-600', 'OAuth': 'bg-purple-100 text-purple-600' }
  return (
    <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
      <div className="flex items-center justify-between px-5 py-3 bg-gray-50 border-b border-gray-200">
        <span className="text-[0.82rem] font-semibold text-gray-700">История входов</span>
        <div className="flex items-center gap-2">
          <div className="bg-white border border-gray-200 rounded-lg px-3 py-1 text-[0.72rem] text-gray-400 min-w-[140px]">Поиск по email...</div>
          <ExportBtn label="Export" />
        </div>
      </div>
      <table className="w-full">
        <thead><tr className="text-[0.65rem] text-gray-400 uppercase tracking-wider"><th className="text-left px-5 py-2 font-semibold">Дата</th><th className="text-left px-4 py-2 font-semibold">Пользователь</th><th className="text-left px-4 py-2 font-semibold">Тип</th><th className="text-center px-4 py-2 font-semibold">Статус</th><th className="text-left px-4 py-2 font-semibold">IP</th><th className="text-left px-4 py-2 font-semibold">Браузер</th></tr></thead>
        <tbody>{logins.map((l, i) => (
          <tr key={i} className="border-t border-gray-100 hover:bg-gray-50/50 text-[0.78rem]">
            <td className="px-5 py-2 text-gray-400 font-mono text-[0.72rem]">{l.time}</td>
            <td className="px-4 py-2"><div className="text-gray-700">{l.user}</div><div className="text-[0.65rem] text-gray-400">{l.email}</div></td>
            <td className="px-4 py-2"><span className={`px-2 py-0.5 rounded-md text-[0.65rem] font-bold ${typeBg[l.type] || 'bg-gray-100 text-gray-500'}`}>{l.type}</span></td>
            <td className="px-4 py-2 text-center">{l.ok ? <span className="text-green-500 text-sm">&#10003;</span> : <span className="text-red-500 text-sm">&#10007;</span>}</td>
            <td className="px-4 py-2 text-gray-400 font-mono text-[0.7rem]">{l.ip}</td>
            <td className="px-4 py-2 text-gray-500 text-[0.72rem]">{l.browser}</td>
          </tr>
        ))}</tbody>
      </table>
      <div className="flex items-center justify-between px-5 py-2.5 bg-gray-50 border-t border-gray-200 text-[0.7rem] text-gray-400">
        <span>1-7 из 156</span>
        <div className="flex gap-1"><button className="px-2 py-0.5 bg-white border border-gray-200 rounded text-[0.65rem] cursor-pointer">&larr;</button><button className="px-2 py-0.5 bg-white border border-gray-200 rounded text-[0.65rem] cursor-pointer">&rarr;</button></div>
      </div>
    </div>
  )
}

/* ===== USERS ===== */
function PgUsers() {
  const [tab, setTab] = useState<'users' | 'groups'>('users')
  return (
    <div className="p-6">
      <div className="flex items-center gap-2 mb-5"><TabBtn active={tab === 'users'} onClick={() => setTab('users')}>Пользователи</TabBtn><TabBtn active={tab === 'groups'} onClick={() => setTab('groups')}>Группы</TabBtn></div>
      {tab === 'users' ? <UsersTab /> : <GroupsTab />}
    </div>
  )
}

function UsersTab() {
  const [filter, setFilter] = useState('Все')
  const users = [
    { name: 'Хроменок Н.В.', email: 'khromenok@company.ru', dept: 'ДЦТ', role: 'admin', active: true, last: '16.02.2026' },
    { name: 'Иванов А.С.', email: 'ivanov@company.ru', dept: 'Стройконтроль', role: 'user', active: true, last: '16.02.2026' },
    { name: 'Петрова М.В.', email: 'petrova@company.ru', dept: 'Экономика', role: 'user', active: true, last: '15.02.2026' },
    { name: 'Сидоров К.Л.', email: 'sidorov@company.ru', dept: 'ПТО', role: 'user', active: true, last: '14.02.2026' },
    { name: 'Козлова Е.А.', email: 'kozlova@company.ru', dept: 'Юридический', role: 'user', active: true, last: '16.02.2026' },
    { name: 'Морозов Д.И.', email: 'morozov@company.ru', dept: 'ДЦТ', role: 'admin', active: true, last: '16.02.2026' },
    { name: 'Волкова Н.П.', email: 'volkova@company.ru', dept: 'Бухгалтерия', role: 'user', active: false, last: '13.02.2026' },
  ]
  const filtered = filter === 'Все' ? users : filter === 'Админы' ? users.filter(u => u.role === 'admin') : filter === 'Активные' ? users.filter(u => u.active) : users.filter(u => !u.active)
  return (<>
    <div className="flex items-center justify-between mb-4 flex-wrap gap-3">
      <div className="flex items-center gap-2">{['Все', 'Админы', 'Активные', 'Неактивные'].map(f => <TabBtn key={f} active={filter === f} onClick={() => setFilter(f)}>{f}</TabBtn>)}</div>
      <div className="flex items-center gap-2"><ExportBtn label="Export (.xlsx)" /><div className="bg-white border border-gray-200 rounded-xl px-3 py-1.5 text-[0.75rem] text-gray-400 min-w-[160px]">Поиск...</div></div>
    </div>
    <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
      <table className="w-full">
        <thead><tr className="text-[0.65rem] text-gray-400 uppercase tracking-wider bg-gray-50"><th className="text-left px-5 py-3 font-semibold">Пользователь</th><th className="text-left px-4 py-3 font-semibold">Email</th><th className="text-left px-4 py-3 font-semibold">Департамент</th><th className="text-left px-4 py-3 font-semibold">Вход</th><th className="text-center px-4 py-3 font-semibold">Роль</th><th className="text-center px-4 py-3 font-semibold">Статус</th></tr></thead>
        <tbody>{filtered.map(u => (
          <tr key={u.email} className="border-t border-gray-100 hover:bg-gray-50/50 text-[0.78rem]">
            <td className="px-5 py-2.5"><div className="flex items-center gap-2.5"><div className="w-7 h-7 rounded-full bg-[#E52713]/10 flex items-center justify-center text-[0.55rem] text-[#E52713] font-bold shrink-0">{u.name.split(' ').map(w => w[0]).join('').slice(0, 2)}</div><span className="font-medium text-gray-800">{u.name}</span></div></td>
            <td className="px-4 py-2.5 text-gray-500 text-[0.72rem]">{u.email}</td>
            <td className="px-4 py-2.5 text-gray-500">{u.dept}</td>
            <td className="px-4 py-2.5 text-gray-400 text-[0.72rem]">{u.last}</td>
            <td className="px-4 py-2.5 text-center">{u.role === 'admin' ? <span className="px-2 py-0.5 bg-red-100 text-red-600 rounded-md text-[0.65rem] font-bold">Админ</span> : <span className="px-2 py-0.5 bg-gray-100 text-gray-500 rounded-md text-[0.65rem]">User</span>}</td>
            <td className="px-4 py-2.5 text-center"><span className={`w-2 h-2 rounded-full inline-block ${u.active ? 'bg-green-500' : 'bg-gray-300'}`} /></td>
          </tr>
        ))}</tbody>
      </table>
    </div>
  </>)
}

function GroupsTab() {
  const groups = [
    { name: 'Админы', members: 3, color: '#EF4444', desc: 'Полный доступ к системе' },
    { name: 'СК-Инженеры', members: 12, color: '#3B82F6', desc: 'Стройконтроль' },
    { name: 'Экономисты', members: 8, color: '#10B981', desc: 'Финансовый отдел' },
    { name: 'ПТО', members: 6, color: '#F59E0B', desc: 'Проектно-технический отдел' },
    { name: 'Юристы', members: 4, color: '#8B5CF6', desc: 'Юридический отдел' },
    { name: 'Разработчики', members: 3, color: '#06B6D4', desc: 'IT-разработка' },
    { name: 'Бухгалтерия', members: 5, color: '#EC4899', desc: 'Бухгалтерский учёт' },
    { name: 'Снабжение', members: 4, color: '#6B7280', desc: 'Отдел снабжения' },
  ]
  return (
    <div className="grid grid-cols-2 lg:grid-cols-4 gap-3">
      {groups.map(g => (
        <div key={g.name} className="bg-white border border-gray-200 rounded-xl p-4 hover:shadow-md transition-all cursor-default">
          <div className="flex items-center gap-2.5 mb-2"><div className="w-3 h-3 rounded-full shrink-0" style={{ background: g.color }} /><span className="text-[0.82rem] font-semibold text-gray-800">{g.name}</span></div>
          <div className="text-[0.7rem] text-gray-400 mb-2">{g.desc}</div>
          <div className="text-[0.72rem] text-gray-500">{g.members} участников</div>
        </div>
      ))}
      <div className="bg-gray-50 border-2 border-dashed border-gray-200 rounded-xl p-4 flex items-center justify-center cursor-default">
        <span className="text-[0.78rem] text-gray-400">+ Создать группу</span>
      </div>
    </div>
  )
}

/* ===== APP ACCESS ===== */
function PgAppAccess() {
  const [tab, setTab] = useState<'apps' | 'departments' | 'groups' | 'oauth'>('apps')
  return (
    <div className="p-6">
      <div className="flex items-center gap-2 mb-5 flex-wrap"><TabBtn active={tab === 'apps'} onClick={() => setTab('apps')}>Приложения</TabBtn><TabBtn active={tab === 'departments'} onClick={() => setTab('departments')}>По отделам</TabBtn><TabBtn active={tab === 'groups'} onClick={() => setTab('groups')}>По группам</TabBtn><TabBtn active={tab === 'oauth'} onClick={() => setTab('oauth')}>OAuth2 / SSO</TabBtn></div>
      {tab === 'apps' && <IntApps />}
      {tab === 'departments' && <IntDepartments />}
      {tab === 'groups' && <IntAccess />}
      {tab === 'oauth' && <IntOAuth />}
    </div>
  )
}

function IntApps() {
  const apps = [
    { name: 'DataBook', slug: 'databook', clientId: 'hub_dk8f2m', category: 'analytics', active: true, public: false, depts: ['Стройконтроль', 'ПТО'] },
    { name: 'CostManager', slug: 'costmanager', clientId: 'hub_cm3x9p', category: 'documents', active: true, public: false, depts: ['Экономика', 'Бухгалтерия'] },
    { name: 'Автопротокол', slug: 'autoprotocol', clientId: 'hub_ap7k1n', category: 'ai', active: true, public: true, depts: [] },
    { name: 'Puls', slug: 'puls', clientId: 'hub_pl2w5r', category: 'productivity', active: false, public: false, depts: ['ПТО'] },
  ]
  const catColors: Record<string, string> = { ai: '#E52713', analytics: '#3B82F6', documents: '#10B981', productivity: '#F59E0B' }
  return (<>
    <div className="flex items-center justify-between mb-4">
      <ExportBtn label="Export Apps (.xlsx)" />
      <button className="px-3 py-1.5 bg-[#E52713] text-white rounded-lg text-[0.75rem] font-medium border-none cursor-pointer hover:bg-[#E52713]/90 transition-colors">+ Зарегистрировать приложение</button>
    </div>
    <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
      <table className="w-full">
        <thead><tr className="text-[0.65rem] text-gray-400 uppercase tracking-wider bg-gray-50"><th className="text-left px-5 py-2.5 font-semibold">Приложение</th><th className="text-left px-4 py-2.5 font-semibold">client_id</th><th className="text-left px-4 py-2.5 font-semibold">Категория</th><th className="text-left px-4 py-2.5 font-semibold">Доступ</th><th className="text-center px-4 py-2.5 font-semibold">Статус</th></tr></thead>
        <tbody>{apps.map(a => (
          <tr key={a.slug} className="border-t border-gray-100 hover:bg-gray-50/50 text-[0.78rem]">
            <td className="px-5 py-2.5 font-medium text-gray-800">{a.name} <span className="text-gray-400 font-normal text-[0.68rem]">/{a.slug}</span></td>
            <td className="px-4 py-2.5 font-mono text-[0.7rem] text-gray-500">{a.clientId}</td>
            <td className="px-4 py-2.5"><span className="px-2 py-0.5 rounded-md text-[0.65rem] font-semibold" style={{ color: catColors[a.category] || '#6B7280', background: `${catColors[a.category] || '#6B7280'}15` }}>{a.category}</span></td>
            <td className="px-4 py-2.5 text-[0.72rem] text-gray-500">{a.public ? 'Public' : a.depts.join(', ')}</td>
            <td className="px-4 py-2.5 text-center"><span className={`w-2 h-2 rounded-full inline-block ${a.active ? 'bg-green-500' : 'bg-gray-300'}`} /></td>
          </tr>
        ))}</tbody>
      </table>
    </div>
  </>)
}

function IntDepartments() {
  const apps = [
    { name: 'DataBook', depts: [{ n: 'Стройконтроль', on: true }, { n: 'ПТО', on: true }, { n: 'Экономика', on: false }, { n: 'Юридический', on: false }, { n: 'Бухгалтерия', on: false }] },
    { name: 'CostManager', depts: [{ n: 'Стройконтроль', on: false }, { n: 'ПТО', on: false }, { n: 'Экономика', on: true }, { n: 'Юридический', on: false }, { n: 'Бухгалтерия', on: true }] },
    { name: 'Автопротокол', depts: [{ n: 'Без ограничений', on: true }] },
    { name: 'AI-чат', depts: [{ n: 'Без ограничений', on: true }] },
  ]
  return (
    <div className="space-y-3">
      {apps.map(a => (
        <div key={a.name} className="bg-white rounded-xl border border-gray-200 p-4">
          <div className="text-[0.82rem] font-semibold text-gray-800 mb-3">{a.name}</div>
          <div className="flex flex-wrap gap-2">
            {a.depts.map(d => (
              <div key={d.n} className={`flex items-center gap-2 px-3 py-1.5 rounded-lg text-[0.72rem] font-medium border ${d.n === 'Без ограничений' ? 'bg-green-50 border-green-200 text-green-600' : d.on ? 'bg-blue-50 border-blue-200 text-blue-600' : 'bg-gray-50 border-gray-200 text-gray-400'}`}>
                <span className={`w-2 h-2 rounded-full ${d.n === 'Без ограничений' ? 'bg-green-500' : d.on ? 'bg-blue-500' : 'bg-gray-300'}`} />
                {d.n}
              </div>
            ))}
          </div>
        </div>
      ))}
    </div>
  )
}

function IntAccess() {
  const matrix = [
    { group: 'Админы', apps: ['Все'], level: 'full', color: '#EF4444' },
    { group: 'СК-Инженеры', apps: ['DataBook', 'AI-чат'], level: 'read+write', color: '#3B82F6' },
    { group: 'Экономисты', apps: ['CostManager', 'AI-чат'], level: 'read+write', color: '#10B981' },
    { group: 'ПТО', apps: ['DataBook', 'Puls'], level: 'read', color: '#F59E0B' },
    { group: 'Юристы', apps: ['AI-чат'], level: 'read', color: '#8B5CF6' },
    { group: 'Разработчики', apps: ['Все'], level: 'full', color: '#06B6D4' },
  ]
  const lvl = (l: string) => {
    const m: Record<string, string> = { full: 'bg-red-100 text-red-600', 'read+write': 'bg-blue-100 text-blue-600', read: 'bg-gray-100 text-gray-500' }
    return <span className={`px-2 py-0.5 rounded-md text-[0.65rem] font-bold ${m[l] || m.read}`}>{l}</span>
  }
  return (
    <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
      <div className="px-5 py-3 bg-gray-50 border-b border-gray-200 flex items-center justify-between">
        <span className="text-[0.82rem] font-semibold text-gray-700">Матрица доступа: группы / приложения</span>
        <ExportBtn label="Export" />
      </div>
      <table className="w-full">
        <thead><tr className="text-[0.65rem] text-gray-400 uppercase tracking-wider"><th className="text-left px-5 py-2.5 font-semibold">Группа</th><th className="text-left px-4 py-2.5 font-semibold">Приложения</th><th className="text-center px-4 py-2.5 font-semibold">Уровень</th></tr></thead>
        <tbody>{matrix.map(r => (
          <tr key={r.group} className="border-t border-gray-100 hover:bg-gray-50/50 text-[0.78rem]">
            <td className="px-5 py-2.5"><div className="flex items-center gap-2"><div className="w-2.5 h-2.5 rounded-full" style={{ background: r.color }} /><span className="font-medium text-gray-800">{r.group}</span></div></td>
            <td className="px-4 py-2.5"><div className="flex gap-1 flex-wrap">{r.apps.map(a => <span key={a} className="px-2 py-0.5 bg-gray-100 text-gray-600 rounded-md text-[0.65rem]">{a}</span>)}</div></td>
            <td className="px-4 py-2.5 text-center">{lvl(r.level)}</td>
          </tr>
        ))}</tbody>
      </table>
    </div>
  )
}

function IntOAuth() {
  return (
    <div className="space-y-4">
      {/* OAuth2 flow explanation */}
      <div className="bg-white rounded-xl border border-gray-200 p-5">
        <div className="text-[0.88rem] font-semibold text-gray-800 mb-3">Единая авторизация (SSO + OAuth2)</div>
        <div className="text-[0.78rem] text-gray-600 leading-relaxed mb-4">
          AI-Hub выступает как <strong>OAuth2 Provider</strong> для всех корпоративных приложений. Пользователь логинится один раз через ADFS/OIDC, после чего получает доступ ко всем разрешённым сервисам без повторного ввода пароля.
        </div>
        {/* Flow diagram */}
        <div className="bg-gray-50 rounded-xl p-5 border border-gray-100">
          <div className="text-[0.72rem] font-bold text-gray-500 uppercase tracking-wider mb-4">OAuth2 Authorization Code Flow</div>
          <div className="flex items-start gap-3">
            {[
              { step: '1', title: 'Authorize', desc: 'Приложение направляет пользователя на /oauth/authorize с client_id и redirect_uri' },
              { step: '2', title: 'SSO Login', desc: 'AI-Hub проверяет сессию. Если нет -- редирект на ADFS для ввода корпоративных учётных данных' },
              { step: '3', title: 'Auth Code', desc: 'После успешного входа AI-Hub выдаёт authorization code и редиректит обратно' },
              { step: '4', title: 'Token', desc: 'Приложение обменивает code + client_secret на JWT access_token через /oauth/token' },
            ].map((s, i) => (
              <div key={s.step} className="flex-1">
                <div className="flex items-center gap-2 mb-2">
                  <div className="w-6 h-6 rounded-full bg-[#E52713] text-white text-[0.65rem] font-bold flex items-center justify-center shrink-0">{s.step}</div>
                  {i < 3 && <div className="flex-1 h-px bg-[#E52713]/20" />}
                </div>
                <div className="text-[0.75rem] font-semibold text-gray-800 mb-1">{s.title}</div>
                <div className="text-[0.68rem] text-gray-500 leading-snug">{s.desc}</div>
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* Endpoints */}
      <div className="bg-white rounded-xl border border-gray-200 p-5">
        <div className="text-[0.82rem] font-semibold text-gray-700 mb-3">API Endpoints</div>
        <div className="space-y-2">
          {[
            { method: 'GET', path: '/oauth/authorize', desc: 'Начало авторизации (client_id, redirect_uri, response_type, state)' },
            { method: 'POST', path: '/oauth/token', desc: 'Обмен code на access_token (grant_type, code, client_id, client_secret)' },
            { method: 'GET', path: '/auth/me', desc: 'Информация о текущем пользователе' },
            { method: 'GET', path: '/auth/sso/login', desc: 'SSO вход через ADFS/OIDC' },
          ].map(e => (
            <div key={e.path} className="flex items-center gap-3 py-1.5 border-b border-gray-50 last:border-b-0">
              <span className={`px-2 py-0.5 rounded text-[0.6rem] font-bold ${e.method === 'GET' ? 'bg-blue-100 text-blue-600' : 'bg-green-100 text-green-600'}`}>{e.method}</span>
              <span className="text-[0.75rem] font-mono text-gray-800">{e.path}</span>
              <span className="text-[0.7rem] text-gray-400 flex-1 text-right">{e.desc}</span>
            </div>
          ))}
        </div>
      </div>

      {/* Security info */}
      <div className="grid grid-cols-3 gap-4">
        <StatCard label="Алгоритм" val="HS256" sub="JWT подпись" color="#E52713" />
        <StatCard label="Время жизни" val="60 мин" sub="access_token TTL" color="#3B82F6" />
        <StatCard label="Хранение" val="httpOnly" sub="secure cookie" color="#10B981" />
      </div>
    </div>
  )
}

/* ===== ADMIN AI & PROMPTS ===== */
function PgAdminAi() {
  const [tab, setTab] = useState<'prompts' | 'settings'>('prompts')
  return (
    <div className="p-6">
      <div className="flex items-center gap-2 mb-5"><TabBtn active={tab === 'prompts'} onClick={() => setTab('prompts')}>Промпты</TabBtn><TabBtn active={tab === 'settings'} onClick={() => setTab('settings')}>Настройки AI</TabBtn></div>
      {tab === 'prompts' ? <AdminPrompts /> : <AdminAiSettings />}
    </div>
  )
}

function AdminPrompts() {
  const prompts = [
    { name: 'Деловое письмо', cat: 'Написание', order: 1, active: true },
    { name: 'Анализ договора', cat: 'Анализ', order: 2, active: true },
    { name: 'Code Review', cat: 'Код', order: 3, active: true },
    { name: 'Перевод документа', cat: 'Перевод', order: 4, active: true },
    { name: 'Протокол совещания', cat: 'Написание', order: 5, active: true },
    { name: 'Анализ КС-2', cat: 'Анализ', order: 6, active: true },
    { name: 'SQL-запрос', cat: 'Код', order: 7, active: false },
    { name: 'Краткое содержание', cat: 'Анализ', order: 8, active: true },
  ]
  const catColor: Record<string, string> = { 'Написание': '#3B82F6', 'Анализ': '#10B981', 'Код': '#F59E0B', 'Перевод': '#8B5CF6' }
  return (<>
    <div className="flex items-center justify-between mb-4">
      <span className="text-[0.78rem] text-gray-500">{prompts.length} промптов</span>
      <button className="px-3 py-1.5 bg-[#E52713] text-white rounded-lg text-[0.75rem] font-medium border-none cursor-pointer hover:bg-[#E52713]/90 transition-colors">+ Создать промпт</button>
    </div>
    <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
      <table className="w-full">
        <thead><tr className="text-[0.65rem] text-gray-400 uppercase tracking-wider bg-gray-50"><th className="text-left px-5 py-2.5 font-semibold">Название</th><th className="text-left px-4 py-2.5 font-semibold">Категория</th><th className="text-center px-4 py-2.5 font-semibold">Порядок</th><th className="text-center px-4 py-2.5 font-semibold">Статус</th><th className="text-center px-4 py-2.5 font-semibold">Действия</th></tr></thead>
        <tbody>{prompts.map(p => (
          <tr key={p.name} className="border-t border-gray-100 hover:bg-gray-50/50 text-[0.78rem]">
            <td className="px-5 py-2.5 font-medium text-gray-800">{p.name}</td>
            <td className="px-4 py-2.5"><span className="px-2 py-0.5 rounded-md text-[0.65rem] font-semibold" style={{ color: catColor[p.cat] || '#6B7280', background: `${catColor[p.cat] || '#6B7280'}15` }}>{p.cat}</span></td>
            <td className="px-4 py-2.5 text-center text-gray-400">{p.order}</td>
            <td className="px-4 py-2.5 text-center"><div className={`w-8 h-4 rounded-full mx-auto relative cursor-pointer ${p.active ? 'bg-green-500' : 'bg-gray-300'}`}><div className={`absolute top-0.5 w-3 h-3 rounded-full bg-white shadow transition-all ${p.active ? 'left-4' : 'left-0.5'}`}/></div></td>
            <td className="px-4 py-2.5 text-center"><div className="flex items-center justify-center gap-1"><button className="px-2 py-0.5 bg-gray-100 rounded text-[0.65rem] text-gray-500 cursor-pointer border-none hover:bg-gray-200">Ред.</button><button className="px-2 py-0.5 bg-red-50 rounded text-[0.65rem] text-red-500 cursor-pointer border-none hover:bg-red-100">Удал.</button></div></td>
          </tr>
        ))}</tbody>
      </table>
    </div>
  </>)
}

function AdminAiSettings() {
  return (
    <div className="space-y-5">
      <div className="bg-white rounded-xl border border-gray-200 p-5">
        <div className="text-[0.82rem] font-semibold text-gray-800 mb-4">Модель</div>
        <div className="space-y-3">
          {[
            { name: 'Быстрая', desc: 'Быстрые ответы на простые вопросы', selected: false },
            { name: 'Продвинутая', desc: 'Глубокий анализ и сложные задачи', selected: true },
          ].map(m => (
            <label key={m.name} className={`flex items-center gap-3 p-3 rounded-xl border cursor-pointer transition-colors ${m.selected ? 'border-[#E52713]/30 bg-[#E52713]/5' : 'border-gray-200 hover:border-gray-300'}`}>
              <div className={`w-4 h-4 rounded-full border-2 flex items-center justify-center shrink-0 ${m.selected ? 'border-[#E52713]' : 'border-gray-300'}`}>{m.selected && <div className="w-2 h-2 rounded-full bg-[#E52713]"/>}</div>
              <div><div className="text-[0.82rem] font-medium text-gray-800">{m.name}</div><div className="text-[0.7rem] text-gray-400">{m.desc}</div></div>
            </label>
          ))}
        </div>
      </div>
      <div className="bg-white rounded-xl border border-gray-200 p-5">
        <div className="flex items-center justify-between mb-4">
          <div className="text-[0.82rem] font-semibold text-gray-800">Чат</div>
          <div className="w-10 h-5 rounded-full bg-green-500 relative cursor-pointer"><div className="absolute top-0.5 left-5 w-4 h-4 rounded-full bg-white shadow"/></div>
        </div>
        <div className="grid grid-cols-2 gap-4">
          <div>
            <div className="text-[0.72rem] text-gray-500 mb-1.5">Лимит сообщений (в день / на пользователя)</div>
            <div className="bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-[0.82rem] text-gray-800 font-medium">50</div>
          </div>
          <div>
            <div className="text-[0.72rem] text-gray-500 mb-1.5">Макс. токенов на ответ</div>
            <div className="bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-[0.82rem] text-gray-800 font-medium">8 192</div>
          </div>
        </div>
      </div>
      <div className="bg-white rounded-xl border border-gray-200 p-5">
        <div className="text-[0.82rem] font-semibold text-gray-800 mb-3">Системный промпт</div>
        <div className="bg-gray-50 border border-gray-200 rounded-lg p-3 text-[0.75rem] text-gray-600 font-mono leading-relaxed min-h-[80px]">Ты корпоративный AI-ассистент. Отвечай кратко и по делу на русском языке. Не раскрывай конфиденциальную информацию. При необходимости ссылайся на внутренние нормативные документы.</div>
        <div className="text-[0.65rem] text-gray-400 mt-2">Последнее обновление: 14 февр. 2026, 11:30</div>
      </div>
      <button className="px-5 py-2 bg-[#E52713] text-white rounded-lg text-[0.78rem] font-semibold border-none cursor-pointer hover:bg-[#E52713]/90 transition-colors">Сохранить настройки</button>
    </div>
  )
}

/* ===== ADMIN TOOLS ===== */
function PgAdminTools() {
  const [tab, setTab] = useState<'tools' | 'servers'>('tools')
  return (
    <div className="p-6">
      <div className="flex items-center gap-2 mb-5"><TabBtn active={tab === 'tools'} onClick={() => setTab('tools')}>Инструменты</TabBtn><TabBtn active={tab === 'servers'} onClick={() => setTab('servers')}>Серверы</TabBtn></div>
      {tab === 'tools' ? <AdminToolsList /> : <AdminServers />}
    </div>
  )
}

function AdminToolsList() {
  const tools = [
    { name: 'PDF to Excel', slug: 'pdf-to-excel', server: 'tools-main', color: '#10B981', active: true, uses: 342, last: '16.02.2026' },
    { name: 'OCR', slug: 'ocr', server: 'tools-main', color: '#3B82F6', active: true, uses: 218, last: '16.02.2026' },
    { name: 'Word to PDF', slug: 'word-to-pdf', server: 'tools-main', color: '#8B5CF6', active: true, uses: 567, last: '16.02.2026' },
    { name: 'Сжатие изображений', slug: 'image-compress', server: 'tools-media', color: '#F59E0B', active: true, uses: 189, last: '15.02.2026' },
    { name: 'Извлечение таблиц', slug: 'table-extract', server: 'tools-ai', color: '#E52713', active: false, uses: 95, last: '14.02.2026' },
    { name: 'Объединение PDF', slug: 'pdf-merge', server: 'tools-main', color: '#06B6D4', active: true, uses: 276, last: '16.02.2026' },
  ]
  return (<>
    <div className="flex items-center justify-between mb-4">
      <span className="text-[0.78rem] text-gray-500">{tools.length} инструментов</span>
      <button className="px-3 py-1.5 bg-[#E52713] text-white rounded-lg text-[0.75rem] font-medium border-none cursor-pointer hover:bg-[#E52713]/90 transition-colors">+ Создать инструмент</button>
    </div>
    <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
      <table className="w-full">
        <thead><tr className="text-[0.65rem] text-gray-400 uppercase tracking-wider bg-gray-50"><th className="text-left px-5 py-2.5 font-semibold">Инструмент</th><th className="text-left px-4 py-2.5 font-semibold">Slug</th><th className="text-left px-4 py-2.5 font-semibold">Сервер</th><th className="text-center px-4 py-2.5 font-semibold">Использований</th><th className="text-left px-4 py-2.5 font-semibold">Последний</th><th className="text-center px-4 py-2.5 font-semibold">Статус</th></tr></thead>
        <tbody>{tools.map(t => (
          <tr key={t.slug} className="border-t border-gray-100 hover:bg-gray-50/50 text-[0.78rem]">
            <td className="px-5 py-2.5"><div className="flex items-center gap-2"><div className="w-3 h-3 rounded-sm" style={{ background: t.color }}/><span className="font-medium text-gray-800">{t.name}</span></div></td>
            <td className="px-4 py-2.5 font-mono text-[0.7rem] text-gray-500">{t.slug}</td>
            <td className="px-4 py-2.5 text-[0.72rem] text-gray-500">{t.server}</td>
            <td className="px-4 py-2.5 text-center text-gray-600">{t.uses}</td>
            <td className="px-4 py-2.5 text-[0.72rem] text-gray-400">{t.last}</td>
            <td className="px-4 py-2.5 text-center"><div className={`w-8 h-4 rounded-full mx-auto relative cursor-pointer ${t.active ? 'bg-green-500' : 'bg-gray-300'}`}><div className={`absolute top-0.5 w-3 h-3 rounded-full bg-white shadow transition-all ${t.active ? 'left-4' : 'left-0.5'}`}/></div></td>
          </tr>
        ))}</tbody>
      </table>
    </div>
  </>)
}

function AdminServers() {
  const servers = [
    { name: 'tools-main', desc: 'Основной сервер инструментов', url: 'https://tools.internal:8080', health: 'healthy', tools: 4, key: 'sk-tools-***8f2m' },
    { name: 'tools-media', desc: 'Обработка медиа-файлов', url: 'https://media.internal:8081', health: 'healthy', tools: 1, key: 'sk-media-***3x9p' },
    { name: 'tools-ai', desc: 'AI-инструменты (OCR, извлечение)', url: 'https://ai-tools.internal:8082', health: 'unhealthy', tools: 1, key: 'sk-ai-***7k1n' },
  ]
  const stColor = (s: string) => s === 'healthy' ? 'text-green-600 bg-green-50 border-green-200' : s === 'unhealthy' ? 'text-red-600 bg-red-50 border-red-200' : 'text-amber-600 bg-amber-50 border-amber-200'
  return (<>
    <div className="flex items-center justify-between mb-4">
      <span className="text-[0.78rem] text-gray-500">{servers.length} серверов</span>
      <button className="px-3 py-1.5 bg-[#E52713] text-white rounded-lg text-[0.75rem] font-medium border-none cursor-pointer hover:bg-[#E52713]/90 transition-colors">+ Добавить сервер</button>
    </div>
    <div className="space-y-3">
      {servers.map(s => (
        <div key={s.name} className="bg-white rounded-xl border border-gray-200 p-5">
          <div className="flex items-center justify-between mb-3">
            <div>
              <div className="text-[0.85rem] font-semibold text-gray-800">{s.name}</div>
              <div className="text-[0.72rem] text-gray-400 mt-0.5">{s.desc}</div>
            </div>
            <div className="flex items-center gap-2">
              <span className={`px-2.5 py-0.5 rounded-lg text-[0.68rem] font-bold border ${stColor(s.health)}`}>{s.health}</span>
              <button className="px-2.5 py-1 bg-gray-100 rounded-lg text-[0.7rem] text-gray-500 font-medium cursor-pointer border-none hover:bg-gray-200 transition-colors">Check</button>
            </div>
          </div>
          <div className="grid grid-cols-3 gap-4 text-[0.72rem]">
            <div><span className="text-gray-400">URL:</span> <span className="font-mono text-gray-600">{s.url}</span></div>
            <div><span className="text-gray-400">Инструментов:</span> <span className="font-semibold text-gray-700">{s.tools}</span></div>
            <div><span className="text-gray-400">API Key:</span> <span className="font-mono text-gray-500">{s.key}</span></div>
          </div>
        </div>
      ))}
    </div>
  </>)
}

====================================================================================================
END: src\components\DemoAIHub.tsx
====================================================================================================

====================================================================================================
FILE [18/52]: src\components\DemoAutoprotocol.tsx
Size: 100,708 bytes
====================================================================================================

import { useState, useEffect, useCallback } from 'react'
import { createPortal } from 'react-dom'

type Screen = 'upload' | 'history' | 'processing' | 'results' | 'dashboard' | 'admin'

/* ── Icons ── */
const I = {
  Check: () => <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M5 13l4 4L19 7"/></svg>,
  Download: () => <svg className="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>,
}

const nav: { key: Screen; emoji: string; label: string; section?: string }[] = [
  { key: 'upload', emoji: '📤', label: 'Загрузка' },
  { key: 'history', emoji: '📋', label: 'История' },
  { key: 'processing', emoji: '⚙️', label: 'Обработка' },
  { key: 'results', emoji: '📄', label: 'Результаты', section: 'АНАЛИТИКА' },
  { key: 'dashboard', emoji: '📊', label: 'Дашборд' },
  { key: 'admin', emoji: '🔧', label: 'Админ-панель', section: 'АДМИНИСТРИРОВАНИЕ' },
]

const titles: Record<Screen, string> = {
  upload: 'Загрузка файла', history: 'История обработок', processing: 'Обработка',
  results: 'Результаты', dashboard: 'Dashboard менеджера', admin: 'Админ-панель',
}

/* ===== EXPORT ===== */
export function DemoAutoprotocol() {
  const [open, setOpen] = useState(false)
  return (
    <>
      <div className="mt-5 flex justify-center">
        <button onClick={(e) => { e.stopPropagation(); setOpen(true) }} className="px-6 py-3 bg-accent hover:bg-accent/90 text-white font-semibold rounded-xl text-sm transition-all cursor-pointer border-none flex items-center gap-2 shadow-lg shadow-accent/25">
          <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path strokeLinecap="round" strokeLinejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
          Открыть демо
        </button>
      </div>
      {open && <Modal onClose={() => setOpen(false)} />}
    </>
  )
}

/* ===== MODAL ===== */
function Modal({ onClose }: { onClose: () => void }) {
  const [screen, setScreen] = useState<Screen>('upload')
  const [domain, setDomain] = useState('construction')
  const handleKey = useCallback((e: KeyboardEvent) => { if (e.key === 'Escape') onClose() }, [onClose])
  useEffect(() => {
    document.addEventListener('keydown', handleKey)
    document.body.classList.add('demo-modal-open')
    return () => { document.removeEventListener('keydown', handleKey); document.body.classList.remove('demo-modal-open') }
  }, [handleKey])

  return createPortal(
    <div className="fixed inset-0 z-[9999] flex items-center justify-center p-4" onClick={onClose}>
      <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" />
      <div className="demo-modal-enter relative w-full max-w-[1400px] rounded-2xl overflow-hidden shadow-2xl flex flex-col" style={{ height: '90vh', maxHeight: '920px' }} onClick={e => e.stopPropagation()}>
        <button onClick={onClose} className="absolute top-3 right-3 z-50 w-8 h-8 rounded-full bg-black/20 hover:bg-black/40 text-white flex items-center justify-center cursor-pointer border-none transition-colors text-lg" aria-label="Close">&times;</button>
        <div className="flex flex-1 min-h-0">
          {/* Sidebar — WHITE */}
          <div className="w-[240px] bg-white border-r border-slate-200 flex flex-col shrink-0">
            <div className="h-14 flex items-center px-4 border-b border-slate-200">
              <div className="w-8 h-8 rounded-lg bg-[#E52713] flex items-center justify-center text-[0.6rem] text-white font-bold mr-3">AP</div>
              <div><div className="text-sm font-bold text-slate-800">Автопротокол</div><div className="text-[0.58rem] text-slate-400">v2.0</div></div>
            </div>
            {/* Domain selector */}
            <div className="px-3 pt-3 pb-1">
              <select value={domain} onChange={e => setDomain(e.target.value)} className="w-full px-3 py-1.5 bg-slate-50 border border-slate-200 rounded-lg text-[0.72rem] text-slate-600 cursor-pointer">
                <option value="construction">🏗 Строительство</option>
                <option value="dct">🏢 ДЦТ</option>
                <option value="hr">👥 HR</option>
                <option value="it">💻 IT</option>
              </select>
            </div>
            <div className="flex-1 py-2 px-3 space-y-0.5 overflow-y-auto">
              {nav.map(item => (
                <div key={item.key}>
                  {item.section && <div className="pt-4 pb-2 px-2"><div className="text-[0.6rem] font-bold text-slate-400 uppercase tracking-wider">{item.section}</div></div>}
                  <button onClick={() => setScreen(item.key)} className={`w-full flex items-center gap-2.5 px-3 py-2 rounded-lg text-left cursor-pointer border-none transition-colors text-[0.8rem] ${screen === item.key ? 'bg-[#E52713]/10 text-[#E52713] font-semibold' : 'bg-transparent text-slate-600 hover:bg-slate-50 hover:text-slate-800'}`}>
                    <span className="text-[0.85rem]">{item.emoji}</span><span>{item.label}</span>
                  </button>
                </div>
              ))}
            </div>
            <div className="p-3 border-t border-slate-200">
              <div className="flex items-center gap-2.5 p-2 rounded-lg bg-slate-50">
                <div className="w-8 h-8 rounded-full bg-[#E52713]/10 flex items-center justify-center text-[0.65rem] text-[#E52713] font-bold">НХ</div>
                <div className="flex-1 min-w-0"><div className="text-[0.75rem] font-semibold text-slate-700 truncate">Хроменок Н.В.</div><div className="text-[0.6rem] text-slate-400">Администратор</div></div>
              </div>
              <div className="text-[0.55rem] text-slate-400 text-center mt-2">v2.0 · Design by N. Khromenok & V. Vasin</div>
            </div>
          </div>
          {/* Content */}
          <div className="flex-1 flex flex-col min-w-0 bg-slate-50">
            <div className="h-14 flex items-center justify-between px-6 bg-white border-b border-slate-200 shrink-0">
              <h2 className="text-[0.95rem] font-bold text-slate-800 m-0">{titles[screen]}</h2>
              <div className="flex items-center gap-3">
                <span className="text-[0.72rem] text-slate-400">{domain === 'construction' ? 'Строительство' : domain === 'dct' ? 'ДЦТ' : domain === 'hr' ? 'HR' : 'IT'}</span>
                <span className="text-[0.72rem] text-slate-400">17 февр. 2026</span>
              </div>
            </div>
            <div className="flex-1 overflow-y-auto">
              {screen === 'upload' && <PgUpload />}
              {screen === 'history' && <PgHistory />}
              {screen === 'processing' && <PgProcessing />}
              {screen === 'results' && <PgResults />}
              {screen === 'dashboard' && <PgDashboard />}
              {screen === 'admin' && <PgAdmin />}
            </div>
          </div>
        </div>
      </div>
    </div>, document.body)
}

/* ── Helpers ── */
function TabBtn({ active, onClick, children }: { active: boolean; onClick: () => void; children: React.ReactNode }) {
  return <button onClick={onClick} className={`px-3 py-1.5 rounded-lg text-[0.75rem] font-medium cursor-pointer border transition-colors ${active ? 'bg-[#E52713]/10 text-[#E52713] border-[#E52713]/20' : 'bg-white text-slate-500 border-slate-200 hover:border-slate-300'}`}>{children}</button>
}
function StatCard({ label, val, sub, color }: { label: string; val: string; sub: string; color: string }) {
  return <div className="bg-white rounded-xl p-4 border border-slate-200" style={{ borderLeftWidth: 3, borderLeftColor: color }}><span className="text-[0.65rem] text-slate-400 uppercase font-bold tracking-wider">{label}</span><div className="text-2xl font-extrabold text-slate-800 mt-1">{val}</div><div className="text-[0.7rem] text-slate-400 mt-0.5">{sub}</div></div>
}

/* ===== UPLOAD ===== */
function PgUpload() {
  return (
    <div className="p-6 max-w-[700px] mx-auto">
      <div className="bg-white rounded-2xl border border-slate-200 p-6 shadow-sm">
        {/* Step 1: Project */}
        <div className="mb-6">
          <div className="flex items-center gap-2 mb-3">
            <div className="w-6 h-6 rounded-full bg-[#E52713] text-white text-[0.65rem] font-bold flex items-center justify-center">1</div>
            <span className="text-[0.82rem] font-semibold text-slate-800">Код проекта и дата</span>
          </div>
          <div className="grid grid-cols-2 gap-3">
            <div>
              <div className="text-[0.72rem] text-slate-500 mb-1">Код проекта (4 цифры)</div>
              <div className="flex items-center gap-2">
                <div className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-[0.85rem] text-slate-800 font-mono w-20 text-center">1234</div>
                <div className="flex items-center gap-1.5"><span className="w-2 h-2 rounded-full bg-green-500"/><span className="text-[0.72rem] text-green-600 font-medium">ARGO</span></div>
              </div>
            </div>
            <div>
              <div className="text-[0.72rem] text-slate-500 mb-1">Дата совещания</div>
              <div className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-[0.82rem] text-slate-700">17.02.2026</div>
            </div>
          </div>
        </div>
        {/* Step 2: Participants */}
        <div className="mb-6">
          <div className="flex items-center gap-2 mb-3">
            <div className="w-6 h-6 rounded-full bg-[#E52713] text-white text-[0.65rem] font-bold flex items-center justify-center">2</div>
            <span className="text-[0.82rem] font-semibold text-slate-800">Участники</span>
          </div>
          <div className="bg-slate-50 border border-slate-200 rounded-xl p-3 space-y-2">
            {[
              { org: 'Заказчик', persons: ['Хроменок Н.В.', 'Козлова Е.А.'] },
              { org: 'Генподрядчик', persons: ['Иванов А.С.'] },
              { org: 'Проектировщик', persons: ['Сидоров К.Л.'] },
            ].map(g => (
              <div key={g.org} className="flex items-center gap-2">
                <span className="text-[0.72rem] text-slate-500 w-28 shrink-0">{g.org}:</span>
                <div className="flex gap-1.5 flex-wrap">{g.persons.map(p => (
                  <span key={p} className="px-2 py-0.5 bg-white border border-slate-200 rounded-md text-[0.7rem] text-slate-700">{p}</span>
                ))}</div>
              </div>
            ))}
          </div>
        </div>
        {/* Step 3: File */}
        <div className="mb-6">
          <div className="flex items-center gap-2 mb-3">
            <div className="w-6 h-6 rounded-full bg-[#E52713] text-white text-[0.65rem] font-bold flex items-center justify-center">3</div>
            <span className="text-[0.82rem] font-semibold text-slate-800">Файл</span>
          </div>
          <div className="border-2 border-dashed border-[#E52713]/30 bg-[#E52713]/5 rounded-xl p-6 text-center">
            <div className="w-12 h-12 mx-auto mb-3 rounded-xl bg-[#E52713]/10 flex items-center justify-center">
              <svg className="w-6 h-6 text-[#E52713]" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
            </div>
            <div className="text-[0.82rem] font-medium text-slate-700 mb-1">production_meeting_17_02.mp4</div>
            <div className="text-[0.7rem] text-slate-400">MP4 video, 1:23:45, 847 MB</div>
          </div>
        </div>
        {/* Step 4: Languages */}
        <div className="mb-6">
          <div className="flex items-center gap-2 mb-3">
            <div className="w-6 h-6 rounded-full bg-[#E52713] text-white text-[0.65rem] font-bold flex items-center justify-center">4</div>
            <span className="text-[0.82rem] font-semibold text-slate-800">Языки распознавания</span>
          </div>
          <div className="flex gap-2 flex-wrap">
            {[{ l: 'Русский', on: true }, { l: 'English', on: false }, { l: '中文', on: false }, { l: 'العربية', on: false }, { l: 'Türkçe', on: false }].map(lang => (
              <button key={lang.l} className={`px-3 py-1.5 rounded-lg text-[0.72rem] font-medium border cursor-pointer transition-colors ${lang.on ? 'bg-[#E52713]/10 text-[#E52713] border-[#E52713]/20' : 'bg-white text-slate-400 border-slate-200'}`}>{lang.l}</button>
            ))}
          </div>
        </div>
        {/* Step 5: Artifacts */}
        <div className="mb-6">
          <div className="flex items-center gap-2 mb-3">
            <div className="w-6 h-6 rounded-full bg-[#E52713] text-white text-[0.65rem] font-bold flex items-center justify-center">5</div>
            <span className="text-[0.82rem] font-semibold text-slate-800">Артефакты</span>
          </div>
          <div className="grid grid-cols-2 gap-3">
            {[
              { name: 'Excel-отчёт', desc: 'Задачи и поручения', on: true, color: '#10B981' },
              { name: 'Word-протокол', desc: 'Резюме, эмоции, задачи', on: true, color: '#3B82F6' },
              { name: 'Транскрипция', desc: 'Полный текст с таймкодами', on: true, color: '#8B5CF6' },
              { name: 'Risk Brief', desc: 'PDF (авто для строительства)', on: true, color: '#E52713' },
            ].map(a => (
              <div key={a.name} className={`flex items-center gap-3 p-3 rounded-xl border transition-colors ${a.on ? 'border-slate-200 bg-white' : 'border-slate-100 bg-slate-50 opacity-50'}`}>
                <div className={`w-8 h-4 rounded-full relative ${a.on ? '' : 'bg-slate-300'}`} style={a.on ? { background: a.color } : {}}>
                  <div className={`absolute top-0.5 w-3 h-3 rounded-full bg-white shadow transition-all ${a.on ? 'left-4' : 'left-0.5'}`}/>
                </div>
                <div><div className="text-[0.78rem] font-medium text-slate-800">{a.name}</div><div className="text-[0.65rem] text-slate-400">{a.desc}</div></div>
              </div>
            ))}
          </div>
        </div>
        {/* Step 6: Email notifications */}
        <div className="mb-6">
          <div className="flex items-center gap-2 mb-3">
            <div className="w-6 h-6 rounded-full bg-[#E52713] text-white text-[0.65rem] font-bold flex items-center justify-center">6</div>
            <span className="text-[0.82rem] font-semibold text-slate-800">Уведомления</span>
          </div>
          <div className="bg-slate-50 border border-slate-200 rounded-xl p-3">
            <div className="flex items-center gap-3">
              <div className="w-8 h-4 rounded-full relative bg-[#E52713]"><div className="absolute top-0.5 left-4 w-3 h-3 rounded-full bg-white shadow"/></div>
              <div><div className="text-[0.78rem] font-medium text-slate-700">Email по завершении</div><div className="text-[0.65rem] text-slate-400">khromenok@company.ru</div></div>
            </div>
          </div>
        </div>
        <button className="w-full py-3 bg-[#E52713] text-white rounded-xl text-[0.85rem] font-semibold border-none cursor-pointer hover:bg-[#E52713]/90 transition-colors flex items-center justify-center gap-2">
          <span>⚡</span> Обработать
        </button>
      </div>
    </div>
  )
}

/* ===== HISTORY ===== */
function PgHistory() {
  const jobs = [
    { id: 'j-847', file: 'production_meeting_17_02.mp4', project: '1234 ARGO', date: '17.02.2026', status: 'done', duration: '4:12', artifacts: 4 },
    { id: 'j-846', file: 'weekly_sync_14_02.mp3', project: '1234 ARGO', date: '14.02.2026', status: 'done', duration: '2:38', artifacts: 3 },
    { id: 'j-845', file: 'site_inspection.mp3', project: '3045 САТУРН', date: '13.02.2026', status: 'done', duration: '1:55', artifacts: 4 },
    { id: 'j-844', file: 'budget_review.mp4', project: '2001 ВОСТОК', date: '12.02.2026', status: 'error', duration: '--', artifacts: 0 },
    { id: 'j-843', file: 'hr_interview_12_02.mp3', project: '-- HR', date: '12.02.2026', status: 'done', duration: '3:10', artifacts: 2 },
    { id: 'j-842', file: 'contractor_meeting.mp4', project: '1234 ARGO', date: '10.02.2026', status: 'done', duration: '5:22', artifacts: 4 },
  ]
  const stColor: Record<string, string> = { done: 'bg-green-100 text-green-600', error: 'bg-red-100 text-red-600', processing: 'bg-amber-100 text-amber-600' }
  const stLabel: Record<string, string> = { done: 'Готово', error: 'Ошибка', processing: 'Обработка' }
  return (
    <div className="p-6">
      <div className="flex items-center gap-3 mb-5">
        <div className="flex-1 bg-white border border-slate-200 rounded-lg px-3 py-2 text-[0.78rem] text-slate-400">Поиск по имени файла или проекту...</div>
        <select className="bg-white border border-slate-200 rounded-lg px-3 py-2 text-[0.72rem] text-slate-600 cursor-pointer">
          <option>Все статусы</option><option>Готово</option><option>Ошибка</option>
        </select>
      </div>
      <div className="bg-white rounded-xl border border-slate-200 overflow-hidden">
        <table className="w-full">
          <thead><tr className="text-[0.65rem] text-slate-400 uppercase tracking-wider bg-slate-50">
            <th className="text-left px-4 py-2.5 font-semibold">ID</th>
            <th className="text-left px-4 py-2.5 font-semibold">Файл</th>
            <th className="text-left px-4 py-2.5 font-semibold">Проект</th>
            <th className="text-left px-4 py-2.5 font-semibold">Дата</th>
            <th className="text-center px-4 py-2.5 font-semibold">Статус</th>
            <th className="text-left px-4 py-2.5 font-semibold">Время</th>
            <th className="text-center px-4 py-2.5 font-semibold">Артефакты</th>
          </tr></thead>
          <tbody>{jobs.map((j, i) => (
            <tr key={j.id} className={`border-t border-slate-100 text-[0.75rem] hover:bg-slate-50/50 cursor-pointer ${i % 2 ? 'bg-slate-50/30' : ''}`}>
              <td className="px-4 py-2.5 font-mono text-slate-400">{j.id}</td>
              <td className="px-4 py-2.5 text-slate-700 font-medium">{j.file}</td>
              <td className="px-4 py-2.5 text-slate-500">{j.project}</td>
              <td className="px-4 py-2.5 text-slate-500 font-mono">{j.date}</td>
              <td className="px-4 py-2.5 text-center"><span className={`px-2 py-0.5 rounded text-[0.65rem] font-bold ${stColor[j.status]}`}>{stLabel[j.status]}</span></td>
              <td className="px-4 py-2.5 text-slate-400 font-mono">{j.duration}</td>
              <td className="px-4 py-2.5 text-center">{j.artifacts > 0 ? <span className="text-[0.65rem] text-slate-500">{j.artifacts} файлов</span> : <span className="text-[0.65rem] text-slate-300">—</span>}</td>
            </tr>
          ))}</tbody>
        </table>
      </div>
      <div className="flex items-center justify-between mt-4">
        <span className="text-[0.72rem] text-slate-400">Показано 6 из 347</span>
        <div className="flex gap-1">
          {[1, 2, 3, '...', 58].map((p, i) => (
            <button key={i} className={`w-7 h-7 rounded text-[0.7rem] font-medium border-none cursor-pointer transition-colors ${p === 1 ? 'bg-[#E52713] text-white' : 'bg-white text-slate-500 hover:bg-slate-50'}`}>{p}</button>
          ))}
        </div>
      </div>
    </div>
  )
}

/* ===== PROCESSING ===== */
const pipelineStages = [
  { emoji: '🔄', name: 'Инициализация', desc: 'Подготовка задачи', weight: 3 },
  { emoji: '🎵', name: 'Извлечение аудио', desc: 'FFmpeg конвертация', weight: 7 },
  { emoji: '🎙️', name: 'Определение голоса', desc: 'Silero VAD', weight: 10 },
  { emoji: '📝', name: 'Транскрибация', desc: 'WhisperX large-v3', weight: 25 },
  { emoji: '👥', name: 'Идентификация спикеров', desc: 'pyannote 3.1', weight: 18 },
  { emoji: '🌍', name: 'Перевод', desc: 'LLM multi-language', weight: 12 },
  { emoji: '😊', name: 'Анализ эмоций', desc: 'wav2vec2-emotion', weight: 10 },
  { emoji: '📊', name: 'Генерация отчётов', desc: 'LLM structured output', weight: 10 },
  { emoji: '📄', name: 'Создание документов', desc: 'Excel + Word + PDF', weight: 5 },
]

function PgProcessing() {
  const [progress, setProgress] = useState(0)
  const [stageIdx, setStageIdx] = useState(0)

  useEffect(() => {
    const id = setInterval(() => {
      setProgress(p => {
        if (p >= 100) { clearInterval(id); return 100 }
        const next = p + 0.4
        let acc = 0
        for (let i = 0; i < pipelineStages.length; i++) {
          acc += pipelineStages[i].weight
          if (next < acc) { setStageIdx(i); break }
          if (i === pipelineStages.length - 1) setStageIdx(i)
        }
        return next
      })
    }, 50)
    return () => clearInterval(id)
  }, [])

  const done = progress >= 100

  return (
    <div className="p-6 max-w-[700px] mx-auto">
      <div className="bg-white rounded-2xl border border-slate-200 p-6 shadow-sm">
        <div className="flex items-center gap-3 mb-5 pb-5 border-b border-slate-100">
          <div className="w-10 h-10 rounded-xl bg-[#E52713]/10 flex items-center justify-center">
            <svg className="w-5 h-5 text-[#E52713]" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
          </div>
          <div className="flex-1">
            <div className="text-[0.85rem] font-semibold text-slate-800">production_meeting_17_02.mp4</div>
            <div className="text-[0.7rem] text-slate-400">Проект ARGO (1234) / 17.02.2026 / WhisperX + pyannote + wav2vec2 + LLM</div>
          </div>
          <span className={`px-2.5 py-1 rounded-lg text-[0.7rem] font-bold ${done ? 'bg-green-100 text-green-600' : 'bg-amber-100 text-amber-600'}`}>{done ? 'Завершено' : 'Обработка...'}</span>
        </div>
        <div className="mb-6">
          <div className="flex items-center justify-between mb-2">
            <span className="text-[0.78rem] font-medium text-slate-700">{done ? '✅ Готово' : `${pipelineStages[stageIdx].emoji} ${pipelineStages[stageIdx].name}`}</span>
            <span className="text-[0.78rem] font-bold text-[#E52713]">{Math.round(progress)}%</span>
          </div>
          <div className="h-2.5 bg-slate-100 rounded-full overflow-hidden">
            <div className="h-full bg-gradient-to-r from-[#E52713] to-[#ff6b5a] rounded-full transition-all duration-100" style={{ width: `${progress}%` }} />
          </div>
          {!done && <div className="text-[0.65rem] text-slate-400 mt-1">{pipelineStages[stageIdx].desc}</div>}
        </div>
        <div className="space-y-1">
          {pipelineStages.map((s, i) => {
            const completed = progress >= pipelineStages.slice(0, i + 1).reduce((a, b) => a + b.weight, 0)
            const active = stageIdx === i && !done
            return (
              <div key={s.name} className={`flex items-center gap-3 px-3 py-2 rounded-lg transition-colors ${active ? 'bg-[#E52713]/5 border border-[#E52713]/10' : 'border border-transparent'}`}>
                <span className="text-[0.85rem] w-6 text-center">{completed || done ? '✅' : active ? s.emoji : '⬜'}</span>
                <div className="flex-1 min-w-0">
                  <span className={`text-[0.78rem] ${completed || done ? 'text-slate-400 line-through' : active ? 'text-slate-800 font-medium' : 'text-slate-400'}`}>{s.name}</span>
                  <span className="text-[0.65rem] text-slate-400 ml-2">{s.desc}</span>
                </div>
                {active && <span className="text-[0.6rem] text-[#E52713] font-medium animate-pulse">Выполняется...</span>}
                <span className="text-[0.6rem] text-slate-300 w-8 text-right">{s.weight}%</span>
              </div>
            )
          })}
        </div>
        {done && (
          <div className="grid grid-cols-4 gap-4 mt-5 pt-5 border-t border-slate-100">
            <div className="text-center"><div className="text-xl font-bold text-slate-800">847</div><div className="text-[0.65rem] text-slate-400">Сегментов</div></div>
            <div className="text-center"><div className="text-xl font-bold text-slate-800">5</div><div className="text-[0.65rem] text-slate-400">Спикеров</div></div>
            <div className="text-center"><div className="text-xl font-bold text-slate-800">2</div><div className="text-[0.65rem] text-slate-400">Языка</div></div>
            <div className="text-center"><div className="text-xl font-bold text-slate-800">4:12</div><div className="text-[0.65rem] text-slate-400">Мин. обработки</div></div>
          </div>
        )}
      </div>
    </div>
  )
}

/* ===== RESULTS ===== */
function PgResults() {
  const [tab, setTab] = useState<'brief' | 'protocol' | 'tasks' | 'transcript'>('brief')
  return (
    <div className="p-6">
      <div className="flex items-center gap-2 mb-5 flex-wrap">
        <TabBtn active={tab === 'brief'} onClick={() => setTab('brief')}>Risk Brief</TabBtn>
        <TabBtn active={tab === 'protocol'} onClick={() => setTab('protocol')}>Протокол</TabBtn>
        <TabBtn active={tab === 'tasks'} onClick={() => setTab('tasks')}>Задачи (Excel)</TabBtn>
        <TabBtn active={tab === 'transcript'} onClick={() => setTab('transcript')}>Транскрипция</TabBtn>
        <div className="ml-auto">
          <button className="flex items-center gap-1.5 px-3 py-1.5 bg-[#E52713] text-white rounded-lg text-[0.72rem] font-medium cursor-pointer border-none hover:bg-[#E52713]/90 transition-colors"><I.Download /> Скачать все (ZIP)</button>
        </div>
      </div>
      {tab === 'brief' && <RiskBrief />}
      {tab === 'protocol' && <Protocol />}
      {tab === 'tasks' && <Tasks />}
      {tab === 'transcript' && <Transcript />}
    </div>
  )
}

/* ── Risk Brief (8 blocks) ── */
function RiskBrief() {
  const risks: { id: string; title: string; cat: string; score: number; prob: number; impact: number; desc: string; evidence: string; decision: string; responsible: string; deadline: string; drivers: { type: string; text: string }[]; hypothesis: string; recommendation?: string }[] = [
    { id: 'R1', title: 'Проектирование углового элемента блокирует производство панелей для склада', cat: 'Проектные', score: 25, prob: 5, impact: 5, desc: 'Незначительный 20-килограммовый угловой элемент для наружных стен склада находится в стадии проектирования более недели, что блокирует запуск производства всего объёма сэндвич-панелей для здания. Непропорциональная задержка из-за тривиальной детали блокирует основной поток работ.', evidence: '«Уголок тормозит изготовление большого завода. Уголок. 20 килограмм.» [25:00]', decision: 'Обеспечить согласование в день совещания. Вопрос помечен как требующий особого контроля.', responsible: 'Сидоров К.Л.', deadline: '17.02.2026', drivers: [{ type: 'root_cause', text: 'Системная неэффективность: согласование тривиального элемента занимает более недели' }, { type: 'blocker', text: 'Завод-изготовитель отказывается начинать без формального согласования' }], hypothesis: 'Срыв сроков поставки и монтажа наружных стен, задержка закрытия теплового контура. Каждый день задержки = смещение графика монтажа на 2-3 дня.', recommendation: 'Ввести регламент ускоренного согласования для элементов, блокирующих критический путь (SLA ≤ 2 рабочих дня).' },
    { id: 'R2', title: 'График проверок надзорного органа не соответствует модульному методу строительства', cat: 'Внешние', score: 16, prob: 4, impact: 4, desc: 'Официальный график предполагает визиты инспекции в апреле, однако по закону инспекторы приезжают только на финальную проверку. Это несовместимо с модульным подходом, при котором здания будут закрыты задолго до 100% завершения всех конструкций на площадке.', evidence: '«По закону они приезжают на финальную проверку. Не промежуточную, а именно финальную.» [27:02]', decision: 'Техническому заказчику уточнить у надзорного органа планы по визитам.', responsible: 'Козлова Е.А.', deadline: '24.02.2026', drivers: [{ type: 'root_cause', text: 'Стандартный процесс инспекции не учитывает модульный характер проекта' }, { type: 'blocker', text: 'Отсутствие чёткой информации от надзорного органа о графике визитов' }], hypothesis: 'Риск невозможности провести приёмку скрытых работ. Возможны предписания, штрафы или необходимость вскрытия готовых конструкций при финальной проверке.' },
    { id: 'R3', title: 'Разработка раскладки стен корпуса заблокирована отсутствием исходных данных', cat: 'Проектные', score: 12, prob: 4, impact: 3, desc: 'Проектирование раскладки сэндвич-панелей не может быть продолжено, так как исполнитель ожидает исходные данные по металлоконструкциям от проектировщика. Строго последовательный процесс создаёт цепочку зависимостей вместо параллельной работы.', evidence: '«По раскладке — ждём данные по МК. Без них раскладку не сделать, Техностиль стоит.» [32:15]', decision: 'Зафиксирован срок предоставления данных от проектировщика — 24.02.2026.', responsible: 'Сидоров К.Л.', deadline: '24.02.2026', drivers: [{ type: 'root_cause', text: 'Строго последовательный процесс: раскладка панелей не начинается до завершения проектирования МК' }], hypothesis: 'При задержке выдачи данных более 3 дней — смещение критического пути по монтажу панелей на 1.5-2 недели.' },
    { id: 'R5', title: 'Закупка муфт для кабеля 20кВ заблокирована несогласованным типом кабеля', cat: 'Строительные', score: 9, prob: 3, impact: 3, desc: 'Поставщик кабельных муфт согласован, однако закупка не может быть произведена — не принято окончательное решение по типу самого кабеля. Эта зависимость останавливает процесс закупки сопутствующих материалов.', evidence: '«Муфты готовы заказать, но без решения по кабелю — смысла нет, не те муфты возьмём.» [48:30]', decision: 'Отложить закупку муфт до момента согласования типа кабеля. Вопрос на контроле.', responsible: 'Иванов А.С.', deadline: '28.02.2026', drivers: [{ type: 'root_cause', text: 'Решение по типу кабеля зависит от одного сотрудника, который не определился' }, { type: 'aggravator', text: 'Длительный срок поставки муфт (4-6 недель) усугубляет последствия задержки' }], hypothesis: 'Каждая неделя задержки решения по кабелю = неделя задержки пусконаладочных работ электроснабжения.' },
    { id: 'R8', title: 'Неполный комплект исполнительной документации к сдаче', cat: 'Управленческие', score: 4, prob: 2, impact: 2, desc: 'Подрядчик не может предоставить полный комплект исполнительной документации к установленному сроку, в частности отсутствуют исполнительные схемы по металлоконструкциям.', evidence: '«ИД будет выложена кроме схем. По схемам — будет гарантийное письмо.» [01:35]', decision: 'Подрядчик предоставит гарантийное письмо с точным сроком подготовки схем (до конца февраля). Остальная ИД загружается до 23.02.', responsible: 'Иванов А.С.', deadline: '23.02.2026', drivers: [{ type: 'root_cause', text: 'Исполнительные схемы требуют геодезических замеров, которые не были выполнены вовремя' }], hypothesis: 'Отсутствие ИД не блокирует текущие работы, но может стать проблемой при итоговой приёмке объекта.' },
  ]
  const scoreColor = (s: number) => s >= 16 ? '#EF4444' : s >= 9 ? '#F59E0B' : s >= 4 ? '#FBBF24' : '#10B981'
  const driverIcon: Record<string, string> = { root_cause: '🔴', aggravator: '🟡', blocker: '⛔' }
  const driverLabel: Record<string, string> = { root_cause: 'Первопричина', aggravator: 'Усилитель', blocker: 'Блокер' }

  return (
    <div className="bg-white rounded-2xl border border-slate-200 overflow-hidden shadow-sm">
      {/* Block 1: Header */}
      <div className="bg-slate-900 text-white p-5 flex items-center justify-between">
        <div className="flex items-center gap-4">
          <div className="w-10 h-10 rounded-xl bg-[#E52713] flex items-center justify-center text-[0.65rem] font-bold">AP</div>
          <div><div className="text-[0.85rem] font-bold">RISK BRIEF</div><div className="text-[0.7rem] text-slate-400">Проект ARGO (1234) · Строительство</div></div>
        </div>
        <div className="text-right">
          <div className="text-[0.7rem] text-slate-400">17.02.2026 · 1:31:09</div>
          <span className="px-2 py-0.5 rounded text-[0.65rem] font-bold bg-red-500/20 text-red-400">КРИТИЧЕСКИЙ</span>
        </div>
      </div>

      <div className="p-5 space-y-5">
        {/* Block 2: Participants */}
        <div className="bg-slate-50 rounded-xl p-4">
          <div className="text-[0.68rem] font-bold text-slate-500 uppercase tracking-wider mb-3">Участники совещания</div>
          <div className="grid grid-cols-2 gap-3">
            {[
              { org: 'Заказчик', persons: ['Морозов Д.А.', 'Соколов Р.В.', 'Белова А.И.'] },
              { org: 'Тех. заказчик', persons: ['Хроменок Н.В. (РП)', 'Орлов П.С. (ГИП)', 'Козлова Е.А. (АП)'] },
              { org: 'Генподрядчик', persons: ['Иванов А.С.', 'Федорова Е.А.', 'Куликова А.С.'] },
              { org: 'Проектировщик', persons: ['Волкова Е.А. (ГАП)', 'Сидоров К.Л.', 'Григорьев А.Н.'] },
            ].map(g => (
              <div key={g.org}>
                <div className="text-[0.65rem] font-bold text-slate-400 uppercase mb-1">{g.org}</div>
                <div className="flex gap-1.5 flex-wrap">{g.persons.map(p => <span key={p} className="px-2 py-0.5 bg-white border border-slate-200 rounded-md text-[0.7rem] text-slate-700">{p}</span>)}</div>
              </div>
            ))}
          </div>
        </div>

        {/* Block 3: Executive Summary */}
        <div className="grid grid-cols-2 gap-4">
          <div className="rounded-xl border-l-4 border-[#E52713] bg-slate-50 p-4">
            <div className="text-[0.68rem] font-bold text-slate-500 uppercase tracking-wider mb-2">Резюме</div>
            <div className="text-[0.78rem] text-slate-700 leading-relaxed">Совещание выявило несколько критических рисков, блокирующих ключевые этапы работ. Основная проблема — системные задержки в проектировании: незначительный элемент блокирует производство панелей для целого здания, а разработка раскладок заблокирована из-за отсутствия исходных данных. Зафиксированы задержки поставок и блокировка закупок из-за внутренних зависимостей.</div>
          </div>
          {/* Block 4: Atmosphere */}
          <div className="rounded-xl border-l-4 border-amber-400 bg-slate-50 p-4">
            <div className="text-[0.68rem] font-bold text-slate-500 uppercase tracking-wider mb-2">Атмосфера</div>
            <div className="flex items-center gap-2 mb-2"><span className="px-2 py-0.5 bg-amber-100 text-amber-600 rounded text-[0.68rem] font-bold">Рабочее напряжение</span></div>
            <div className="text-[0.75rem] text-slate-600">Деловая атмосфера с фокусом на решении операционных вопросов. Модератор оказывает давление для получения конкретных сроков и обязательств, особенно по затянувшимся вопросам проектирования.</div>
            <div className="flex gap-3 mt-2">
              {[{ e: '😐', l: 'Нейтр.', v: 54 }, { e: '😤', l: 'Давл.', v: 24 }, { e: '😟', l: 'Тревога', v: 14 }, { e: '😊', l: 'Позит.', v: 8 }].map(em => (
                <div key={em.l} className="text-center">
                  <div className="text-[0.9rem]">{em.e}</div>
                  <div className="text-[0.55rem] text-slate-400">{em.l} {em.v}%</div>
                </div>
              ))}
            </div>
          </div>
        </div>

        {/* Block 5: Risk Matrix 5x5 */}
        <div className="bg-slate-50 rounded-xl p-4">
          <div className="text-[0.68rem] font-bold text-slate-500 uppercase tracking-wider mb-3">Матрица рисков 5×5</div>
          <div className="flex items-end gap-6">
            <div>
              <div className="text-[0.55rem] text-slate-400 mb-1 text-center">Вероятность ↑</div>
              <div className="grid grid-cols-5 gap-px bg-slate-200 rounded overflow-hidden" style={{ width: 160, height: 160 }}>
                {Array.from({ length: 25 }, (_, i) => {
                  const row = Math.floor(i / 5)
                  const col = i % 5
                  const prob = 5 - row
                  const imp = col + 1
                  const val = prob * imp
                  const bg = val >= 16 ? '#FEE2E2' : val >= 9 ? '#FEF3C7' : val >= 4 ? '#ECFDF5' : '#F0FDF4'
                  const hasRisk = risks.find(r => r.prob === prob && r.impact === imp)
                  return <div key={i} className="flex items-center justify-center text-[0.5rem] font-bold" style={{ background: bg, width: 32, height: 32, color: hasRisk ? scoreColor(val) : '#CBD5E1' }}>{hasRisk ? hasRisk.id : val}</div>
                })}
              </div>
              <div className="text-[0.55rem] text-slate-400 mt-1 text-center">Влияние →</div>
            </div>
            <div className="flex-1 space-y-2">
              <div className="text-[0.72rem] font-semibold text-slate-700 mb-2">Распределение</div>
              {[{ range: '16-25', label: 'Критический', color: '#EF4444', count: 2 }, { range: '9-15', label: 'Высокий', color: '#F59E0B', count: 2 }, { range: '4-8', label: 'Средний', color: '#FBBF24', count: 1 }, { range: '1-3', label: 'Низкий', color: '#10B981', count: 0 }].map(r => (
                <div key={r.range} className="flex items-center gap-2 text-[0.72rem]">
                  <span className="w-3 h-3 rounded" style={{ background: r.color }}/>
                  <span className="text-slate-600 flex-1">{r.label} ({r.range})</span>
                  <span className="font-bold text-slate-700">{r.count}</span>
                </div>
              ))}
            </div>
          </div>
        </div>

        {/* Block 6: Risk Cards with Drivers & Hypotheses */}
        <div className="space-y-3">
          {risks.map(r => (
            <div key={r.id} className="rounded-xl border border-slate-200 overflow-hidden">
              <div className="flex items-center gap-3 px-4 py-3 border-b border-slate-100 bg-slate-50/50">
                <span className="w-8 h-8 rounded-lg flex items-center justify-center text-[0.7rem] font-bold text-white" style={{ background: scoreColor(r.score) }}>{r.id}</span>
                <div className="flex-1"><div className="text-[0.82rem] font-semibold text-slate-800">{r.title}</div></div>
                <span className="px-2 py-0.5 bg-slate-100 text-slate-500 rounded text-[0.65rem]">{r.cat}</span>
                <span className="text-[0.65rem] text-slate-400">P:{r.prob} I:{r.impact}</span>
                <span className="text-[0.7rem] font-bold" style={{ color: scoreColor(r.score) }}>Score: {r.score}</span>
              </div>
              <div className="px-4 py-3 space-y-2.5">
                <div className="text-[0.78rem] text-slate-600">{r.desc}</div>
                <div className="bg-amber-50 border border-amber-100 rounded-lg px-3 py-2 text-[0.72rem] text-amber-800 italic">{r.evidence}</div>
                {/* Drivers */}
                <div className="bg-slate-50 rounded-lg p-3">
                  <div className="text-[0.65rem] font-bold text-slate-500 uppercase tracking-wider mb-2">Драйверы риска</div>
                  <div className="space-y-1.5">
                    {r.drivers.map((d, di) => (
                      <div key={di} className="flex items-start gap-2 text-[0.72rem]">
                        <span>{driverIcon[d.type]}</span>
                        <span className="px-1.5 py-0.5 bg-slate-200 text-slate-500 rounded text-[0.6rem] font-medium shrink-0">{driverLabel[d.type]}</span>
                        <span className="text-slate-600">{d.text}</span>
                      </div>
                    ))}
                  </div>
                </div>
                {/* Hypothesis */}
                <div className="bg-purple-50 border border-purple-100 rounded-lg px-3 py-2">
                  <div className="text-[0.65rem] font-bold text-purple-600 uppercase tracking-wider mb-0.5">Гипотеза AI</div>
                  <div className="text-[0.75rem] text-purple-800">{r.hypothesis}</div>
                </div>
                {r.decision && (
                  <div className="bg-green-50 border border-green-100 rounded-lg px-3 py-2">
                    <div className="text-[0.65rem] font-bold text-green-600 uppercase tracking-wider mb-0.5">Решение</div>
                    <div className="text-[0.75rem] text-green-800">{r.decision}</div>
                  </div>
                )}
                {r.recommendation && (
                  <div className="bg-blue-50 border border-blue-100 rounded-lg px-3 py-2">
                    <div className="text-[0.65rem] font-bold text-blue-600 uppercase tracking-wider mb-0.5">Рекомендация AI</div>
                    <div className="text-[0.75rem] text-blue-800">{r.recommendation}</div>
                  </div>
                )}
                <div className="flex items-center gap-4 text-[0.7rem] text-slate-500 pt-1">
                  <span>Ответственный: <strong className="text-slate-700">{r.responsible}</strong></span>
                  <span>Срок: <strong className="text-slate-700">{r.deadline}</strong></span>
                </div>
              </div>
            </div>
          ))}
        </div>

        {/* Block 7: Open Questions */}
        <div className="bg-slate-50 rounded-xl p-4">
          <div className="text-[0.68rem] font-bold text-slate-500 uppercase tracking-wider mb-3">Открытые вопросы</div>
          <div className="space-y-2">
            {[
              { q: 'Статус и участники тендера на витражи не раскрываются', cat: 'Закупки' },
              { q: 'Решение по выбору поставщика кабеля 20кВ не принято', cat: 'Электрика' },
              { q: 'Статус внутреннего тендера по кабельным системам 0.4кВ не определён', cat: 'Электрика' },
              { q: 'Наличие узла примыкания витражей к фальшполу не подтверждено', cat: 'Проектирование' },
            ].map((c, i) => (
              <div key={i} className="flex items-start gap-2 text-[0.75rem]">
                <span className="w-1.5 h-1.5 rounded-full bg-amber-400 mt-1.5 shrink-0"/>
                <div><span className="text-slate-600">{c.q}</span><span className="ml-2 px-1.5 py-0.5 bg-amber-100 text-amber-600 rounded text-[0.6rem]">{c.cat}</span></div>
              </div>
            ))}
          </div>
        </div>

        {/* Block 8: Glossary */}
        <div className="bg-slate-50 rounded-xl p-4">
          <div className="text-[0.68rem] font-bold text-slate-500 uppercase tracking-wider mb-2">Глоссарий</div>
          <div className="flex flex-wrap gap-x-6 gap-y-1 text-[0.7rem]">
            {[['ИД', 'Исполнительная документация'], ['КПП', 'Контрольно-пропускной пункт'], ['АБК', 'Административно-бытовой корпус'], ['КМД', 'Конструкции металлические деталировочные'], ['БРТП', 'Блочная распред. трансформаторная подстанция'], ['ХБК', 'Хозяйственно-бытовой корпус'], ['СМР', 'Строительно-монтажные работы'], ['МК', 'Металлоконструкции']].map(([a, b]) => (
              <span key={a} className="text-slate-500"><strong className="text-slate-700">{a}</strong> — {b}</span>
            ))}
          </div>
        </div>
      </div>
    </div>
  )
}

/* ── Protocol ── */
function Protocol() {
  return (
    <div className="bg-white rounded-2xl border border-slate-200 p-6 shadow-sm">
      <div className="text-center mb-6">
        <div className="text-lg font-bold text-slate-800 mb-1">ПРОТОКОЛ СОВЕЩАНИЯ</div>
        <div className="text-[0.78rem] text-slate-400">Проект ARGO (1234) / 17.02.2026 / Домен: Строительство</div>
      </div>
      <div className="bg-slate-50 rounded-xl p-4 mb-5">
        <div className="grid grid-cols-2 gap-2 text-[0.75rem]">
          <div><span className="text-slate-400">Файл:</span> <span className="text-slate-700">production_meeting_17_02.mp4</span></div>
          <div><span className="text-slate-400">Длительность:</span> <span className="text-slate-700">1:23:45</span></div>
          <div><span className="text-slate-400">Дата:</span> <span className="text-slate-700">17.02.2026</span></div>
          <div><span className="text-slate-400">Участников:</span> <span className="text-slate-700">5 спикеров</span></div>
        </div>
      </div>
      <div className="mb-5">
        <div className="text-[0.82rem] font-semibold text-slate-800 mb-2">Участники и эмоции</div>
        <div className="bg-white rounded-xl border border-slate-200 overflow-hidden">
          <table className="w-full">
            <thead><tr className="text-[0.65rem] text-slate-400 uppercase tracking-wider bg-slate-50"><th className="text-left px-4 py-2 font-semibold">Спикер</th><th className="text-left px-4 py-2 font-semibold">Время</th><th className="text-left px-4 py-2 font-semibold">Эмоция</th><th className="text-left px-4 py-2 font-semibold">Интерпретация</th></tr></thead>
            <tbody>{[
              { s: 'Хроменок Н.В.', t: '28:15', e: 'Нейтральная', ei: 'Деловой тон, контроль повестки' },
              { s: 'Иванов А.С.', t: '22:40', e: 'Раздражение', ei: 'Повышенный тон при обсуждении сроков' },
              { s: 'Петров К.Л.', t: '18:30', e: 'Спокойная', ei: 'Конструктивные предложения' },
              { s: 'Козлова Е.А.', t: '8:45', e: 'Нейтральная', ei: 'Фиксация решений' },
              { s: 'Сидоров К.Л.', t: '5:35', e: 'Тревожная', ei: 'Опасения по качеству' },
            ].map(p => (
              <tr key={p.s} className="border-t border-slate-100 text-[0.75rem]">
                <td className="px-4 py-2 font-medium text-slate-700">{p.s}</td>
                <td className="px-4 py-2 text-slate-500 font-mono">{p.t}</td>
                <td className="px-4 py-2"><span className={`px-2 py-0.5 rounded text-[0.65rem] font-medium ${p.e === 'Раздражение' ? 'bg-red-100 text-red-600' : p.e === 'Тревожная' ? 'bg-amber-100 text-amber-600' : 'bg-slate-100 text-slate-600'}`}>{p.e}</span></td>
                <td className="px-4 py-2 text-slate-500">{p.ei}</td>
              </tr>
            ))}</tbody>
          </table>
        </div>
      </div>
      <div className="mb-5">
        <div className="text-[0.82rem] font-semibold text-slate-800 mb-2">Краткое содержание</div>
        <div className="text-[0.78rem] text-slate-600 leading-relaxed bg-slate-50 rounded-xl p-4">
          Производственное совещание по проекту ARGO. Обсуждены критические вопросы: задержка поставки металлоконструкций (перенос на 2 недели), отклонения по кладке корпуса 2 (нарушение СП 70.13330), нехватка бригад на монолитных работах. Принят ряд решений по мобилизации ресурсов и контролю качества.
        </div>
      </div>
      <div>
        <div className="text-[0.82rem] font-semibold text-slate-800 mb-2">Экспертный анализ (AI)</div>
        <div className="text-[0.78rem] text-slate-600 leading-relaxed bg-blue-50 border border-blue-100 rounded-xl p-4 italic">
          Совещание продуктивное, но требует контроля исполнения. Основные риски сосредоточены на внешних поставках и качестве СМР. Рекомендуется провести внеочередную проверку кладки до конца недели.
        </div>
      </div>
    </div>
  )
}

/* ── Tasks ── */
function Tasks() {
  const tasks = [
    { n: 1, conf: 'Явная', pri: 'Высокий', cat: 'ИРД', task: 'Подготовить гарантийное письмо с точным сроком предоставления недостающих исполнительных схем', resp: 'Иванов А.С.', deadline: '18.02.2026', time: '01:11' },
    { n: 2, conf: 'Явная', pri: 'Высокий', cat: 'ИРД', task: 'Выгрузить всю готовую ИД (акты, сертификаты) за исключением исполнительных схем', resp: 'Иванов А.С.', deadline: '23.02.2026', time: '01:35' },
    { n: 3, conf: 'Явная', pri: 'Высокий', cat: 'Проект. и РД', task: 'Завершить согласование чертежей КМД по металлоконструкциям корпуса Б', resp: 'Сидоров К.Л.', deadline: '18.02.2026', time: '07:59' },
    { n: 4, conf: 'Явная', pri: 'Высокий', cat: 'Проект. и РД', task: 'Проверить и согласовать раскладку сэндвич-панелей для корпуса Б', resp: 'Волкова Е.А.', deadline: '20.02.2026', time: '17:31' },
    { n: 5, conf: 'Явная', pri: 'Критический', cat: 'Проект. и РД', task: 'Решить вопрос с проектированием «уголка» для наружных стен склада — стоп-фактор', resp: 'Сидоров К.Л.', deadline: '17.02.2026', time: '24:11' },
    { n: 6, conf: 'Явная', pri: 'Высокий', cat: 'Проект. и РД', task: 'Предоставить данные по МК для разработки раскладки стен АБК', resp: 'Григорьев А.Н.', deadline: '24.02.2026', time: '19:56' },
    { n: 7, conf: 'Явная', pri: 'Средний', cat: 'СМР', task: 'Завершить работы по фундаментам №6, №7 и №8', resp: 'Иванов А.С.', deadline: '27.02.2026', time: '03:34' },
    { n: 8, conf: 'Явная', pri: 'Средний', cat: 'СМР', task: 'Обеспечить поставку профлиста для кровли корпуса А', resp: 'Иванов А.С.', deadline: '15.03.2026', time: '14:56' },
    { n: 9, conf: 'Из контекста', pri: 'Средний', cat: 'СМР', task: 'Выполнить устройство песчаного основания под фундамент ХБК и приступить к подбетонке', resp: '—', deadline: '21.02.2026', time: '04:06' },
    { n: 10, conf: 'Явная', pri: 'Средний', cat: 'Финансы', task: 'Завершить тендер и определить подрядчика на устройство витражей', resp: 'Федорова Е.А.', deadline: '22.02.2026', time: '18:22' },
    { n: 11, conf: 'Явная', pri: 'Низкий', cat: 'Организация', task: 'К следующему совещанию подготовить данные по поставленным панелям в кв.м, а не в «машинах»', resp: 'Иванов А.С.', deadline: '—', time: '12:00' },
  ]
  const priColor: Record<string, string> = { 'Критический': 'bg-red-100 text-red-600', 'Высокий': 'bg-amber-100 text-amber-600', 'Средний': 'bg-blue-100 text-blue-600', 'Низкий': 'bg-slate-100 text-slate-500' }
  return (
    <div className="bg-white rounded-2xl border border-slate-200 overflow-hidden shadow-sm">
      <div className="flex items-center justify-between px-5 py-3 bg-slate-50 border-b border-slate-200">
        <span className="text-[0.82rem] font-semibold text-slate-700">Задачи и поручения</span>
        <div className="flex items-center gap-2">
          <span className="text-[0.7rem] text-slate-400">{tasks.length} задач · 1:31:09</span>
          <button className="flex items-center gap-1.5 px-3 py-1 bg-green-50 border border-green-200 rounded-lg text-[0.7rem] text-green-600 font-medium cursor-pointer hover:bg-green-100 transition-colors"><I.Download /> .xlsx</button>
        </div>
      </div>
      <table className="w-full">
        <thead><tr className="text-[0.6rem] text-slate-400 uppercase tracking-wider"><th className="text-left px-4 py-2 font-semibold w-8">#</th><th className="text-left px-3 py-2 font-semibold">Приоритет</th><th className="text-left px-3 py-2 font-semibold">Категория</th><th className="text-left px-3 py-2 font-semibold">Задача</th><th className="text-left px-3 py-2 font-semibold">Ответств.</th><th className="text-left px-3 py-2 font-semibold">Срок</th><th className="text-left px-3 py-2 font-semibold">Время</th></tr></thead>
        <tbody>{tasks.map((t, i) => (
          <tr key={t.n} className={`border-t border-slate-100 text-[0.72rem] ${i % 2 ? 'bg-slate-50/50' : ''}`}>
            <td className="px-4 py-2 text-slate-400 font-mono">{t.n}</td>
            <td className="px-3 py-2"><span className={`px-1.5 py-0.5 rounded text-[0.6rem] font-bold ${priColor[t.pri]}`}>{t.pri}</span></td>
            <td className="px-3 py-2 text-slate-500">{t.cat}</td>
            <td className="px-3 py-2 text-slate-700 max-w-[300px]">{t.task}</td>
            <td className="px-3 py-2 text-slate-600 font-medium whitespace-nowrap">{t.resp}</td>
            <td className="px-3 py-2 text-slate-500 font-mono whitespace-nowrap">{t.deadline}</td>
            <td className="px-3 py-2 text-slate-400 font-mono">[{t.time}]</td>
          </tr>
        ))}</tbody>
      </table>
    </div>
  )
}

/* ── Transcript ── */
function Transcript() {
  const segments = [
    { time: '00:00', speaker: 'Спикер 1', text: 'Добрый день, коллеги. Начинаем производственное совещание по проекту ARGO. Повестка у всех есть, предлагаю начать с вопроса по металлоконструкциям.', lang: 'RU', emotion: 'Нейтральная' },
    { time: '00:25', speaker: 'Спикер 2', text: 'Значит, по металлоконструкциям ситуация следующая. Нам сообщили что МК задерживаются, поставщик переносит на две недели. Я попросил их дать новые сроки в письменном виде.', lang: 'RU', emotion: 'Нейтральная' },
    { time: '01:15', speaker: 'Спикер 1', text: 'Две недели — это критично. Нам нужен альтернативный вариант. Подготовьте запрос минимум двум альтернативным поставщикам до среды.', lang: 'RU', emotion: 'Нейтральная' },
    { time: '01:42', speaker: 'Спикер 2', text: 'Понял, сделаю. Но хочу предупредить — альтернативные поставщики скорее всего дороже будут процентов на 15.', lang: 'RU', emotion: 'Раздражение' },
    { time: '02:10', speaker: 'Спикер 1', text: 'Цену обсудим, когда будут КП. Сейчас приоритет — не сорвать график. Дальше по кладке. Что по третьему этажу?', lang: 'RU', emotion: 'Нейтральная' },
    { time: '02:35', speaker: 'Спикер 3', text: 'По третьему этажу кладка уходит. При контрольном замере отклонение от вертикали 18 миллиметров на высоту этажа, при допуске 10. Надо перемерять и составлять акт.', lang: 'RU', emotion: 'Тревожная' },
  ]
  const emotionColor: Record<string, string> = { 'Нейтральная': 'bg-slate-100 text-slate-500', 'Раздражение': 'bg-red-100 text-red-500', 'Тревожная': 'bg-amber-100 text-amber-500' }
  return (
    <div className="bg-white rounded-2xl border border-slate-200 p-5 shadow-sm">
      <div className="flex items-center justify-between mb-4">
        <div className="text-[0.82rem] font-semibold text-slate-700">Транскрипция (фрагмент)</div>
        <button className="flex items-center gap-1.5 px-3 py-1 bg-purple-50 border border-purple-200 rounded-lg text-[0.7rem] text-purple-600 font-medium cursor-pointer hover:bg-purple-100 transition-colors"><I.Download /> .docx</button>
      </div>
      <div className="space-y-3">
        {segments.map((s, i) => (
          <div key={i} className="flex gap-3">
            <div className="text-[0.68rem] text-slate-400 font-mono w-10 shrink-0 pt-0.5">[{s.time}]</div>
            <div className="flex-1">
              <div className="flex items-center gap-2 mb-0.5">
                <span className="text-[0.75rem] font-semibold text-slate-700">{s.speaker}</span>
                <span className="text-[0.6rem] px-1.5 py-0.5 bg-blue-100 text-blue-500 rounded font-medium">{s.lang}</span>
                <span className={`text-[0.6rem] px-1.5 py-0.5 rounded font-medium ${emotionColor[s.emotion] || emotionColor['Нейтральная']}`}>{s.emotion}</span>
              </div>
              <div className="text-[0.78rem] text-slate-600 leading-relaxed">{s.text}</div>
            </div>
          </div>
        ))}
        <div className="text-center py-3 text-[0.72rem] text-slate-400 border-t border-slate-100 mt-3">... ещё 841 сегмент ...</div>
      </div>
    </div>
  )
}

/* ===== DASHBOARD ===== */
function PgDashboard() {
  const [project, setProject] = useState<string | null>(null)
  const projects = [
    { code: '1234', name: 'ARGO', health: 'critical', reports: 12, lastDate: '17.02' },
    { code: '2001', name: 'ВОСТОК', health: 'attention', reports: 8, lastDate: '15.02' },
    { code: '3045', name: 'САТУРН', health: 'stable', reports: 15, lastDate: '16.02' },
    { code: '4102', name: 'АЛЬФА', health: 'stable', reports: 6, lastDate: '14.02' },
  ]
  const healthColor = (h: string) => h === 'critical' ? '#EF4444' : h === 'attention' ? '#F59E0B' : '#10B981'

  const attentionItems = [
    { severity: 'critical', text: 'Задержка поставки МК — перенос на 2 недели', rec: 'Запросить альтернативного поставщика', project: 'ARGO', status: 'new' },
    { severity: 'critical', text: 'Отклонения кладки корп. 2 выше допуска СП', rec: 'Геодезическая съёмка и акт', project: 'ARGO', status: 'new' },
    { severity: 'attention', text: 'Нехватка бригад на монолитные работы (2/5)', rec: 'Претензия генподрядчику', project: 'ARGO', status: 'new' },
    { severity: 'attention', text: 'Задержка согласования РД по секции В', rec: 'Эскалация на ГИП проектировщика', project: 'ВОСТОК', status: 'done' },
  ]

  /* Calendar meetings data */
  type Meeting = { project: string; code: string; file: string; severity: string }
  const meetings: Record<number, Meeting[]> = {
    3: [{ project: 'ARGO', code: '1234', file: 'weekly_sync.mp3', severity: 'stable' }],
    5: [{ project: 'ВОСТОК', code: '2001', file: 'design_review.mp4', severity: 'stable' }],
    7: [{ project: 'ARGO', code: '1234', file: 'site_inspection.mp3', severity: 'attention' }, { project: 'САТУРН', code: '3045', file: 'progress_report.mp4', severity: 'stable' }],
    10: [{ project: 'ARGO', code: '1234', file: 'contractor_meeting.mp4', severity: 'attention' }],
    12: [{ project: 'ARGO', code: '1234', file: 'quality_review.mp4', severity: 'critical' }, { project: 'ВОСТОК', code: '2001', file: 'coord_meeting.mp3', severity: 'attention' }],
    14: [{ project: 'САТУРН', code: '3045', file: 'weekly_sync.mp3', severity: 'stable' }],
    17: [{ project: 'ARGO', code: '1234', file: 'production_meeting.mp4', severity: 'critical' }],
    19: [{ project: 'ВОСТОК', code: '2001', file: 'budget_review.mp4', severity: 'stable' }],
    21: [{ project: 'АЛЬФА', code: '4102', file: 'kickoff.mp4', severity: 'stable' }],
    24: [{ project: 'ARGO', code: '1234', file: 'weekly_sync.mp3', severity: 'attention' }, { project: 'САТУРН', code: '3045', file: 'site_walk.mp4', severity: 'stable' }],
    26: [{ project: 'ВОСТОК', code: '2001', file: 'design_session.mp4', severity: 'stable' }],
  }
  const [selectedDay, setSelectedDay] = useState<number | null>(17)

  const filteredMeetings = (day: number) => {
    const m = meetings[day] || []
    if (project) return m.filter(x => x.code === project)
    return m
  }

  return (
    <div className="flex h-full">
      {/* Sidebar — projects */}
      <div className="w-[220px] bg-white border-r border-slate-200 flex flex-col shrink-0">
        <div className="px-4 py-3 border-b border-slate-100">
          <div className="text-[0.78rem] font-semibold text-slate-700 mb-2">Мои проекты</div>
          <div className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 text-[0.72rem] text-slate-400">Поиск...</div>
        </div>
        <div className="flex-1 p-2 space-y-1 overflow-y-auto">
          <button onClick={() => setProject(null)} className={`w-full text-left px-3 py-2 rounded-lg text-[0.75rem] cursor-pointer border-none transition-colors ${!project ? 'bg-[#E52713]/8 text-[#E52713] font-semibold' : 'bg-transparent text-slate-500 hover:bg-slate-50'}`}>Все проекты</button>
          {projects.map(p => (
            <button key={p.code} onClick={() => setProject(p.code)} className={`w-full text-left px-3 py-2 rounded-lg cursor-pointer border-none transition-colors ${project === p.code ? 'bg-[#E52713]/8 text-[#E52713]' : 'bg-transparent text-slate-600 hover:bg-slate-50'}`}>
              <div className="flex items-center gap-2">
                <span className="w-2 h-2 rounded-full shrink-0" style={{ background: healthColor(p.health) }} />
                <span className={`text-[0.78rem] ${project === p.code ? 'font-semibold' : ''}`}>{p.name}</span>
                <span className="text-[0.6rem] text-slate-400 ml-auto">{p.code}</span>
              </div>
              <div className="text-[0.6rem] text-slate-400 mt-0.5 pl-4">{p.reports} отчётов · {p.lastDate}</div>
            </button>
          ))}
        </div>
      </div>

      {/* Main content */}
      <div className="flex-1 overflow-y-auto p-5">
        <div className="grid grid-cols-3 gap-4 mb-5">
          <StatCard label="Всего отчётов" val="41" sub="За текущий квартал" color="#3B82F6" />
          <StatCard label="Требует внимания" val="3" sub="Нерешённых проблем" color="#F59E0B" />
          <StatCard label="Критических" val="2" sub="Немедленное реагирование" color="#EF4444" />
        </div>

        {/* Calendar — main element */}
        <div className="bg-white rounded-xl border border-slate-200 p-5 mb-5">
          <div className="flex items-center justify-between mb-4">
            <div className="flex items-center gap-3">
              <span className="text-[0.95rem] font-bold text-slate-800">Февраль 2026</span>
              <div className="flex gap-1">
                <button className="w-6 h-6 rounded bg-slate-100 text-slate-500 flex items-center justify-center cursor-pointer border-none text-[0.7rem] hover:bg-slate-200">&lt;</button>
                <button className="w-6 h-6 rounded bg-slate-100 text-slate-500 flex items-center justify-center cursor-pointer border-none text-[0.7rem] hover:bg-slate-200">&gt;</button>
              </div>
            </div>
            <div className="flex items-center gap-4 text-[0.6rem] text-slate-400">
              <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-[#EF4444]"/>Критический</span>
              <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-[#F59E0B]"/>Внимание</span>
              <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-[#10B981]"/>Стабильный</span>
            </div>
          </div>
          {/* Day headers */}
          <div className="grid grid-cols-7 gap-1 mb-1">
            {['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'].map(d => <div key={d} className="text-[0.65rem] text-slate-400 text-center font-semibold py-1">{d}</div>)}
          </div>
          {/* Calendar grid */}
          <div className="grid grid-cols-7 gap-1">
            {Array.from({ length: 28 }, (_, i) => {
              const day = i + 1
              const dayMeetings = filteredMeetings(day)
              const hasMeeting = dayMeetings.length > 0
              const isToday = day === 17
              const isSelected = selectedDay === day
              const worstSeverity = dayMeetings.reduce((worst, m) => m.severity === 'critical' ? 'critical' : m.severity === 'attention' && worst !== 'critical' ? 'attention' : worst, 'stable')
              return (
                <div key={day} onClick={() => hasMeeting && setSelectedDay(day)} className={`relative p-1 rounded-lg min-h-[52px] text-center transition-colors ${hasMeeting ? 'cursor-pointer hover:bg-slate-50' : ''} ${isSelected && hasMeeting ? 'ring-2 ring-[#E52713] bg-red-50/30' : ''} ${isToday ? 'bg-[#E52713]/5' : ''}`}>
                  <div className={`text-[0.72rem] mb-0.5 ${isToday ? 'w-5 h-5 rounded-full bg-[#E52713] text-white flex items-center justify-center mx-auto font-bold text-[0.6rem]' : hasMeeting ? 'font-semibold text-slate-800' : 'text-slate-400'}`}>{day}</div>
                  {hasMeeting && (
                    <div className="flex gap-0.5 justify-center flex-wrap">
                      {dayMeetings.map((m, mi) => (
                        <div key={mi} className="w-1.5 h-1.5 rounded-full" style={{ background: healthColor(worstSeverity === 'stable' ? m.severity : worstSeverity) }} title={`${m.project}: ${m.file}`}/>
                      ))}
                    </div>
                  )}
                </div>
              )
            })}
          </div>
        </div>

        {/* Selected day detail */}
        {selectedDay && (meetings[selectedDay] || []).length > 0 && (
          <div className="bg-white rounded-xl border border-slate-200 p-5 mb-5">
            <div className="text-[0.82rem] font-semibold text-slate-700 mb-3">{selectedDay} февраля — совещания ({filteredMeetings(selectedDay).length})</div>
            <div className="space-y-2">
              {filteredMeetings(selectedDay).map((m, i) => (
                <div key={i} className="flex items-center gap-3 p-3 rounded-xl border border-slate-200 hover:bg-slate-50 cursor-pointer transition-colors">
                  <span className="w-2.5 h-2.5 rounded-full shrink-0" style={{ background: healthColor(m.severity) }}/>
                  <div className="w-10 h-10 rounded-xl bg-[#E52713]/10 flex items-center justify-center shrink-0">
                    <svg className="w-5 h-5 text-[#E52713]" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
                  </div>
                  <div className="flex-1 min-w-0">
                    <div className="text-[0.78rem] font-medium text-slate-800 truncate">{m.file}</div>
                    <div className="text-[0.65rem] text-slate-400">{m.project} ({m.code})</div>
                  </div>
                  <span className={`px-2 py-0.5 rounded text-[0.65rem] font-bold ${m.severity === 'critical' ? 'bg-red-100 text-red-600' : m.severity === 'attention' ? 'bg-amber-100 text-amber-600' : 'bg-green-100 text-green-600'}`}>{m.severity === 'critical' ? 'Критический' : m.severity === 'attention' ? 'Внимание' : 'Стабильный'}</span>
                  <svg className="w-4 h-4 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M9 5l7 7-7 7"/></svg>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Attention triage */}
        <div className="bg-white rounded-xl border border-slate-200 p-5">
          <div className="text-[0.82rem] font-semibold text-slate-700 mb-4">Требует внимания (триаж)</div>
          <div className="space-y-2.5">
            {attentionItems.map((item, i) => (
              <div key={i} className={`flex items-start gap-3 p-3 rounded-xl border transition-colors ${item.status === 'done' ? 'bg-slate-50 border-slate-100 opacity-60' : 'bg-white border-slate-200'}`}>
                <span className={`mt-0.5 w-2.5 h-2.5 rounded-full shrink-0 ${item.severity === 'critical' ? 'bg-red-500' : 'bg-amber-400'}`} />
                <div className="flex-1 min-w-0">
                  <div className={`text-[0.78rem] text-slate-700 ${item.status === 'done' ? 'line-through' : ''}`}>{item.text}</div>
                  <div className="text-[0.7rem] text-slate-400 mt-0.5">Рек.: {item.rec}</div>
                </div>
                <span className="text-[0.65rem] text-slate-400 bg-slate-100 px-2 py-0.5 rounded shrink-0">{item.project}</span>
                <span className={`text-[0.65rem] px-2 py-0.5 rounded font-medium shrink-0 ${item.status === 'done' ? 'bg-green-100 text-green-600' : 'bg-amber-100 text-amber-600'}`}>{item.status === 'done' ? 'Решено' : 'Новый'}</span>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  )
}

/* ===== ADMIN (7 tabs) ===== */
function PgAdmin() {
  const [tab, setTab] = useState<'overview' | 'jobs' | 'stats' | 'users' | 'projects' | 'settings' | 'logs'>('overview')
  return (
    <div className="p-6">
      <div className="flex items-center gap-2 mb-5 flex-wrap">
        <TabBtn active={tab === 'overview'} onClick={() => setTab('overview')}>Дашборд</TabBtn>
        <TabBtn active={tab === 'jobs'} onClick={() => setTab('jobs')}>Очередь</TabBtn>
        <TabBtn active={tab === 'stats'} onClick={() => setTab('stats')}>Статистика</TabBtn>
        <TabBtn active={tab === 'users'} onClick={() => setTab('users')}>Пользователи</TabBtn>
        <TabBtn active={tab === 'projects'} onClick={() => setTab('projects')}>Проекты</TabBtn>
        <TabBtn active={tab === 'settings'} onClick={() => setTab('settings')}>Настройки</TabBtn>
        <TabBtn active={tab === 'logs'} onClick={() => setTab('logs')}>Логи ошибок</TabBtn>
      </div>
      {tab === 'overview' && <AdminOverview />}
      {tab === 'jobs' && <AdminJobs />}
      {tab === 'stats' && <AdminStats />}
      {tab === 'users' && <AdminUsers />}
      {tab === 'projects' && <AdminProjects />}
      {tab === 'settings' && <AdminSettings />}
      {tab === 'logs' && <AdminLogs />}
    </div>
  )
}

function AdminOverview() {
  return (<>
    <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-5">
      <StatCard label="Пользователи" val="23" sub="18 активных" color="#3B82F6" />
      <StatCard label="Обработок" val="347" sub="3 в очереди" color="#10B981" />
      <StatCard label="Хранилище" val="12.4 GB" sub="Из 50 GB" color="#F59E0B" />
      <StatCard label="Ошибки" val="2" sub="Сегодня" color="#EF4444" />
    </div>
    <div className="bg-white rounded-xl border border-slate-200 p-5">
      <div className="text-[0.82rem] font-semibold text-slate-700 mb-3">System Health</div>
      <div className="grid grid-cols-3 gap-3">
        {[
          { name: 'Redis', st: 'OK' }, { name: 'PostgreSQL', st: 'OK' }, { name: 'GPU (CUDA)', st: 'OK' },
          { name: 'Celery Workers', st: '3/3' }, { name: 'Disk Space', st: '24%' }, { name: 'Memory', st: '67%' },
          { name: 'WhisperX', st: 'OK' }, { name: 'pyannote', st: 'OK' }, { name: 'LLM API', st: 'OK' },
        ].map(s => (
          <div key={s.name} className="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
            <span className="text-[0.78rem] text-slate-600">{s.name}</span>
            <span className="px-2 py-0.5 bg-green-100 text-green-600 rounded text-[0.65rem] font-bold">{s.st}</span>
          </div>
        ))}
      </div>
    </div>
  </>)
}

function AdminJobs() {
  const jobs = [
    { id: 'j-847', file: 'meeting_corp3.mp4', project: '1234', stage: 'Транскрибация', progress: 45, user: 'ivanov@company.ru' },
    { id: 'j-846', file: 'weekly_sync.mp3', project: '2001', stage: 'В очереди', progress: 0, user: 'petrova@company.ru' },
  ]
  const completed = [
    { id: 'j-845', file: 'production_17_02.mp4', status: 'done', project: '1234', user: 'khromenok@company.ru', time: '4:12' },
    { id: 'j-844', file: 'site_inspection.mp3', status: 'done', project: '3045', user: 'sidorov@company.ru', time: '2:38' },
    { id: 'j-843', file: 'budget_review.mp4', status: 'error', project: '2001', user: 'kozlova@company.ru', time: '--', error: 'GPU OOM' },
  ]
  return (<>
    <div className="mb-5">
      <div className="text-[0.82rem] font-semibold text-slate-700 mb-3">Активные</div>
      <div className="space-y-2">
        {jobs.map(j => (
          <div key={j.id} className="bg-white rounded-xl border border-slate-200 p-4 flex items-center gap-4">
            <div className="flex-1 min-w-0">
              <div className="text-[0.78rem] font-medium text-slate-700">{j.file}</div>
              <div className="text-[0.65rem] text-slate-400">Проект {j.project} / {j.user}</div>
            </div>
            <span className="px-2 py-0.5 bg-amber-100 text-amber-600 rounded text-[0.65rem] font-bold">{j.stage}</span>
            {j.progress > 0 && (
              <div className="w-20">
                <div className="h-1.5 bg-slate-100 rounded-full overflow-hidden"><div className="h-full bg-[#E52713] rounded-full" style={{ width: `${j.progress}%` }}/></div>
                <div className="text-[0.6rem] text-slate-400 text-right mt-0.5">{j.progress}%</div>
              </div>
            )}
            <button className="px-2 py-1 bg-red-50 border border-red-200 rounded-lg text-[0.65rem] text-red-500 font-medium cursor-pointer hover:bg-red-100 transition-colors">Отмена</button>
          </div>
        ))}
      </div>
    </div>
    <div>
      <div className="text-[0.82rem] font-semibold text-slate-700 mb-3">Завершённые</div>
      <div className="bg-white rounded-xl border border-slate-200 overflow-hidden">
        <table className="w-full">
          <thead><tr className="text-[0.65rem] text-slate-400 uppercase tracking-wider bg-slate-50"><th className="text-left px-4 py-2 font-semibold">ID</th><th className="text-left px-4 py-2 font-semibold">Файл</th><th className="text-center px-4 py-2 font-semibold">Статус</th><th className="text-left px-4 py-2 font-semibold">Пользователь</th><th className="text-left px-4 py-2 font-semibold">Время</th></tr></thead>
          <tbody>{completed.map(j => (
            <tr key={j.id} className="border-t border-slate-100 text-[0.75rem]">
              <td className="px-4 py-2 font-mono text-slate-400">{j.id}</td>
              <td className="px-4 py-2 text-slate-700">{j.file}</td>
              <td className="px-4 py-2 text-center"><span className={`px-2 py-0.5 rounded text-[0.65rem] font-bold ${j.status === 'done' ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}`}>{j.status === 'done' ? 'OK' : j.error}</span></td>
              <td className="px-4 py-2 text-slate-500 text-[0.7rem]">{j.user}</td>
              <td className="px-4 py-2 text-slate-400 font-mono">{j.time}</td>
            </tr>
          ))}</tbody>
        </table>
      </div>
    </div>
  </>)
}

function AdminStats() {
  const [statTab, setStatTab] = useState<'usage' | 'models' | 'domains' | 'costs'>('usage')
  const days = ['10.02', '11.02', '12.02', '13.02', '14.02', '15.02', '16.02']
  const vals = [5, 3, 7, 4, 6, 2, 8]
  const max = Math.max(...vals)
  return (<>
    <div className="flex gap-2 mb-4">
      <TabBtn active={statTab === 'usage'} onClick={() => setStatTab('usage')}>Использование</TabBtn>
      <TabBtn active={statTab === 'models'} onClick={() => setStatTab('models')}>ML-модели</TabBtn>
      <TabBtn active={statTab === 'domains'} onClick={() => setStatTab('domains')}>По доменам</TabBtn>
      <TabBtn active={statTab === 'costs'} onClick={() => setStatTab('costs')}>Стоимость</TabBtn>
    </div>
    {statTab === 'usage' && (<>
      <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-5">
        <StatCard label="Всего обработок" val="347" sub="За всё время" color="#3B82F6" />
        <StatCard label="Успешность" val="96.3%" sub="334 из 347" color="#10B981" />
        <StatCard label="Ср. время" val="3:42" sub="Минут на файл" color="#F59E0B" />
        <StatCard label="Ср. длительность" val="47 мин" sub="Аудио/видео" color="#8B5CF6" />
      </div>
      <div className="bg-white rounded-xl border border-slate-200 p-5">
        <div className="text-[0.82rem] font-semibold text-slate-700 mb-4">Обработок за неделю</div>
        <div className="flex items-end gap-3 h-[100px]">
          {days.map((d, i) => (
            <div key={d} className="flex-1 flex flex-col items-center gap-1">
              <span className="text-[0.65rem] font-semibold text-slate-700">{vals[i]}</span>
              <div className="w-full rounded-t-md bg-[#E52713]" style={{ height: `${(vals[i] / max) * 80}px` }} />
              <span className="text-[0.6rem] text-slate-400">{d}</span>
            </div>
          ))}
        </div>
      </div>
    </>)}
    {statTab === 'models' && (
      <div className="bg-white rounded-xl border border-slate-200 p-5">
        <div className="text-[0.82rem] font-semibold text-slate-700 mb-3">Производительность ML-моделей</div>
        <div className="space-y-3">
          {[
            { name: 'WhisperX large-v3', metric: 'WER', val: '4.2%', avg: '2.8 мин', calls: 347 },
            { name: 'pyannote 3.1', metric: 'DER', val: '8.1%', avg: '1.2 мин', calls: 347 },
            { name: 'wav2vec2-emotion', metric: 'Accuracy', val: '87.3%', avg: '0.8 мин', calls: 334 },
            { name: 'LLM Generation', metric: 'Quality', val: '94.5%', avg: '1.5 мин', calls: 334 },
            { name: 'Silero VAD', metric: 'F1', val: '96.2%', avg: '0.3 мин', calls: 347 },
          ].map(m => (
            <div key={m.name} className="flex items-center gap-4 p-3 bg-slate-50 rounded-lg">
              <div className="flex-1"><div className="text-[0.78rem] font-medium text-slate-700">{m.name}</div><div className="text-[0.65rem] text-slate-400">{m.calls} вызовов · ср. {m.avg}</div></div>
              <div className="text-right"><div className="text-[0.78rem] font-bold text-slate-800">{m.val}</div><div className="text-[0.6rem] text-slate-400">{m.metric}</div></div>
            </div>
          ))}
        </div>
      </div>
    )}
    {statTab === 'domains' && (
      <div className="bg-white rounded-xl border border-slate-200 p-5">
        <div className="text-[0.82rem] font-semibold text-slate-700 mb-3">Использование по доменам</div>
        <div className="space-y-3">
          {[{ d: 'Строительство', v: 234, pct: 67, risk: 45 }, { d: 'ДЦТ', v: 78, pct: 23, risk: 12 }, { d: 'HR', v: 35, pct: 10, risk: 0 }].map(d => (
            <div key={d.d} className="p-3 bg-slate-50 rounded-lg">
              <div className="flex items-center justify-between mb-2">
                <span className="text-[0.78rem] font-medium text-slate-700">{d.d}</span>
                <span className="text-[0.72rem] text-slate-500">{d.v} обработок ({d.pct}%)</span>
              </div>
              <div className="h-2 bg-slate-200 rounded-full overflow-hidden"><div className="h-full bg-[#E52713] rounded-full" style={{ width: `${d.pct}%` }}/></div>
              {d.risk > 0 && <div className="text-[0.65rem] text-slate-400 mt-1">Risk Brief генерировался: {d.risk} раз</div>}
            </div>
          ))}
        </div>
      </div>
    )}
    {statTab === 'costs' && (
      <div className="grid grid-cols-2 gap-4">
        <div className="bg-white rounded-xl border border-slate-200 p-5">
          <div className="text-[0.82rem] font-semibold text-slate-700 mb-3">Стоимость токенов</div>
          <div className="space-y-2">
            {[{ l: 'Сегодня', v: '$2.60', tok: '~45K' }, { l: 'Неделя', v: '$18.40', tok: '~310K' }, { l: 'Месяц', v: '$72.30', tok: '~1.2M' }, { l: 'Всего', v: '$124.80', tok: '~2.1M' }].map(c => (
              <div key={c.l} className="flex items-center justify-between text-[0.75rem]">
                <span className="text-slate-500">{c.l}</span>
                <div><span className="font-bold text-slate-800">{c.v}</span><span className="text-slate-400 ml-2">{c.tok}</span></div>
              </div>
            ))}
          </div>
        </div>
        <div className="bg-white rounded-xl border border-slate-200 p-5">
          <div className="text-[0.82rem] font-semibold text-slate-700 mb-3">GPU utilization</div>
          <div className="space-y-2">
            {[{ l: 'GPU 0 (A100)', v: '67%', temp: '72°C' }, { l: 'VRAM', v: '31.2 / 80 GB', temp: '' }, { l: 'Задачи GPU сегодня', v: '14', temp: '' }].map(g => (
              <div key={g.l} className="flex items-center justify-between text-[0.75rem]">
                <span className="text-slate-500">{g.l}</span>
                <div><span className="font-bold text-slate-800">{g.v}</span>{g.temp && <span className="text-slate-400 ml-2">{g.temp}</span>}</div>
              </div>
            ))}
          </div>
        </div>
      </div>
    )}
  </>)
}

function AdminUsers() {
  const users = [
    { name: 'Хроменок Н.В.', email: 'khromenok@company.ru', role: 'admin', domains: ['Строительство', 'ДЦТ'], active: true },
    { name: 'Иванов А.С.', email: 'ivanov@company.ru', role: 'manager', domains: ['Строительство'], active: true },
    { name: 'Петрова М.В.', email: 'petrova@company.ru', role: 'viewer', domains: ['ДЦТ'], active: true },
    { name: 'Сидоров К.Л.', email: 'sidorov@company.ru', role: 'user', domains: ['Строительство'], active: true },
    { name: 'Козлова Е.А.', email: 'kozlova@company.ru', role: 'user', domains: ['Строительство'], active: true },
    { name: 'Васин В.И.', email: 'vasin@company.ru', role: 'admin', domains: ['Строительство', 'ДЦТ', 'HR'], active: true },
  ]
  const roleBadge: Record<string, string> = { admin: 'bg-red-100 text-red-600', manager: 'bg-purple-100 text-purple-600', viewer: 'bg-blue-100 text-blue-500', user: 'bg-slate-100 text-slate-500' }
  return (
    <div className="bg-white rounded-xl border border-slate-200 overflow-hidden">
      <div className="flex items-center justify-between px-5 py-3 bg-slate-50 border-b border-slate-200">
        <span className="text-[0.82rem] font-semibold text-slate-700">{users.length} пользователей</span>
        <button className="px-3 py-1.5 bg-[#E52713] text-white rounded-lg text-[0.75rem] font-medium border-none cursor-pointer hover:bg-[#E52713]/90 transition-colors">+ Создать</button>
      </div>
      <table className="w-full">
        <thead><tr className="text-[0.65rem] text-slate-400 uppercase tracking-wider"><th className="text-left px-5 py-2 font-semibold">Пользователь</th><th className="text-left px-4 py-2 font-semibold">Email</th><th className="text-center px-4 py-2 font-semibold">Роль</th><th className="text-left px-4 py-2 font-semibold">Домены</th><th className="text-center px-4 py-2 font-semibold">Статус</th></tr></thead>
        <tbody>{users.map(u => (
          <tr key={u.email} className="border-t border-slate-100 hover:bg-slate-50/50 text-[0.78rem]">
            <td className="px-5 py-2.5 font-medium text-slate-700">{u.name}</td>
            <td className="px-4 py-2.5 text-slate-500 text-[0.72rem]">{u.email}</td>
            <td className="px-4 py-2.5 text-center"><span className={`px-2 py-0.5 rounded text-[0.65rem] font-bold ${roleBadge[u.role]}`}>{u.role}</span></td>
            <td className="px-4 py-2.5"><div className="flex gap-1">{u.domains.map(d => <span key={d} className="px-1.5 py-0.5 bg-slate-100 text-slate-500 rounded text-[0.6rem]">{d}</span>)}</div></td>
            <td className="px-4 py-2.5 text-center"><span className="w-2 h-2 rounded-full bg-green-500 inline-block"/></td>
          </tr>
        ))}</tbody>
      </table>
    </div>
  )
}

function AdminProjects() {
  const projs = [
    { code: '1234', name: 'ARGO', domain: 'Строительство', users: 8, reports: 12, status: 'active' },
    { code: '2001', name: 'ВОСТОК', domain: 'Строительство', users: 5, reports: 8, status: 'active' },
    { code: '3045', name: 'САТУРН', domain: 'ДЦТ', users: 4, reports: 15, status: 'active' },
    { code: '4102', name: 'АЛЬФА', domain: 'Строительство', users: 3, reports: 6, status: 'active' },
    { code: '5001', name: 'HR-RECRUIT', domain: 'HR', users: 2, reports: 35, status: 'active' },
  ]
  return (
    <div className="bg-white rounded-xl border border-slate-200 overflow-hidden">
      <div className="flex items-center justify-between px-5 py-3 bg-slate-50 border-b border-slate-200">
        <span className="text-[0.82rem] font-semibold text-slate-700">{projs.length} проектов</span>
        <button className="px-3 py-1.5 bg-[#E52713] text-white rounded-lg text-[0.75rem] font-medium border-none cursor-pointer hover:bg-[#E52713]/90 transition-colors">+ Добавить</button>
      </div>
      <table className="w-full">
        <thead><tr className="text-[0.65rem] text-slate-400 uppercase tracking-wider"><th className="text-left px-5 py-2 font-semibold">Код</th><th className="text-left px-4 py-2 font-semibold">Название</th><th className="text-left px-4 py-2 font-semibold">Домен</th><th className="text-center px-4 py-2 font-semibold">Пользователи</th><th className="text-center px-4 py-2 font-semibold">Отчётов</th><th className="text-center px-4 py-2 font-semibold">Статус</th></tr></thead>
        <tbody>{projs.map(p => (
          <tr key={p.code} className="border-t border-slate-100 hover:bg-slate-50/50 text-[0.78rem]">
            <td className="px-5 py-2.5 font-mono text-slate-500">{p.code}</td>
            <td className="px-4 py-2.5 font-medium text-slate-700">{p.name}</td>
            <td className="px-4 py-2.5"><span className="px-1.5 py-0.5 bg-slate-100 text-slate-500 rounded text-[0.65rem]">{p.domain}</span></td>
            <td className="px-4 py-2.5 text-center text-slate-500">{p.users}</td>
            <td className="px-4 py-2.5 text-center text-slate-500">{p.reports}</td>
            <td className="px-4 py-2.5 text-center"><span className="px-2 py-0.5 bg-green-100 text-green-600 rounded text-[0.65rem] font-bold">Active</span></td>
          </tr>
        ))}</tbody>
      </table>
    </div>
  )
}

function AdminSettings() {
  return (
    <div className="space-y-5">
      <div className="bg-white rounded-xl border border-slate-200 p-5">
        <div className="text-[0.82rem] font-semibold text-slate-700 mb-4">Общие настройки</div>
        <div className="space-y-3">
          {[
            { l: 'Максимальный размер файла', v: '2 GB' },
            { l: 'Максимальная длительность', v: '4 часа' },
            { l: 'Одновременных задач', v: '3' },
            { l: 'Хранение файлов', v: '30 дней' },
            { l: 'Язык интерфейса', v: 'Русский' },
          ].map(s => (
            <div key={s.l} className="flex items-center justify-between py-2 border-b border-slate-100 last:border-0">
              <span className="text-[0.78rem] text-slate-600">{s.l}</span>
              <span className="text-[0.78rem] font-medium text-slate-800 bg-slate-50 px-3 py-1 rounded-lg">{s.v}</span>
            </div>
          ))}
        </div>
      </div>
      <div className="bg-white rounded-xl border border-slate-200 p-5">
        <div className="text-[0.82rem] font-semibold text-slate-700 mb-4">ML-модели</div>
        <div className="space-y-3">
          {[
            { l: 'Транскрипция', v: 'WhisperX large-v3', alt: 'large-v2, medium' },
            { l: 'Диаризация', v: 'pyannote 3.1', alt: '3.0' },
            { l: 'Эмоции', v: 'wav2vec2-emotion', alt: 'отключить' },
            { l: 'Генерация', v: 'LLM Pro', alt: 'LLM Flash' },
          ].map(m => (
            <div key={m.l} className="flex items-center justify-between py-2 border-b border-slate-100 last:border-0">
              <span className="text-[0.78rem] text-slate-600">{m.l}</span>
              <div className="flex items-center gap-2">
                <span className="text-[0.78rem] font-medium text-[#E52713] bg-[#E52713]/5 px-3 py-1 rounded-lg">{m.v}</span>
                <span className="text-[0.6rem] text-slate-400">({m.alt})</span>
              </div>
            </div>
          ))}
        </div>
      </div>
      <div className="bg-white rounded-xl border border-slate-200 p-5">
        <div className="text-[0.82rem] font-semibold text-slate-700 mb-4">Email уведомления</div>
        <div className="space-y-2">
          {[
            { l: 'По завершении обработки', on: true },
            { l: 'При ошибке', on: true },
            { l: 'Еженедельный отчёт', on: false },
          ].map(n => (
            <div key={n.l} className="flex items-center justify-between py-2">
              <span className="text-[0.78rem] text-slate-600">{n.l}</span>
              <div className={`w-8 h-4 rounded-full relative cursor-pointer ${n.on ? 'bg-[#E52713]' : 'bg-slate-300'}`}>
                <div className={`absolute top-0.5 w-3 h-3 rounded-full bg-white shadow transition-all ${n.on ? 'left-4' : 'left-0.5'}`}/>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  )
}

function AdminLogs() {
  const logs = [
    { ts: '17.02 14:23:15', level: 'ERROR', service: 'celery', msg: 'GPU OOM during transcription job j-843 (budget_review.mp4)', job: 'j-843' },
    { ts: '17.02 14:23:15', level: 'ERROR', service: 'whisperx', msg: 'CUDA error: out of memory. Tried to allocate 2.4 GB', job: 'j-843' },
    { ts: '16.02 09:12:44', level: 'WARN', service: 'celery', msg: 'Worker heartbeat timeout (5s), restarting worker-2', job: '' },
    { ts: '15.02 16:45:02', level: 'ERROR', service: 'llm', msg: 'API rate limit exceeded, retrying in 30s (attempt 2/3)', job: 'j-838' },
    { ts: '15.02 16:45:32', level: 'INFO', service: 'llm', msg: 'Retry successful for job j-838', job: 'j-838' },
    { ts: '14.02 11:30:18', level: 'WARN', service: 'disk', msg: 'Storage usage at 78% (39.2/50 GB)', job: '' },
  ]
  const lvlColor: Record<string, string> = { ERROR: 'bg-red-100 text-red-600', WARN: 'bg-amber-100 text-amber-600', INFO: 'bg-blue-100 text-blue-500' }
  return (
    <div className="bg-white rounded-xl border border-slate-200 overflow-hidden">
      <div className="flex items-center justify-between px-5 py-3 bg-slate-50 border-b border-slate-200">
        <span className="text-[0.82rem] font-semibold text-slate-700">Последние записи</span>
        <div className="flex gap-2">
          {['ALL', 'ERROR', 'WARN'].map(f => (
            <button key={f} className="px-2 py-1 bg-white border border-slate-200 rounded text-[0.65rem] text-slate-500 cursor-pointer hover:bg-slate-50 transition-colors">{f}</button>
          ))}
        </div>
      </div>
      <div className="divide-y divide-slate-100">
        {logs.map((l, i) => (
          <div key={i} className="px-5 py-3 flex items-start gap-3 hover:bg-slate-50/50">
            <span className="text-[0.65rem] font-mono text-slate-400 w-28 shrink-0">{l.ts}</span>
            <span className={`px-1.5 py-0.5 rounded text-[0.6rem] font-bold shrink-0 ${lvlColor[l.level]}`}>{l.level}</span>
            <span className="text-[0.65rem] text-slate-400 font-mono w-16 shrink-0">{l.service}</span>
            <span className="text-[0.75rem] text-slate-600 flex-1">{l.msg}</span>
            {l.job && <span className="text-[0.6rem] font-mono text-slate-400 bg-slate-100 px-1.5 py-0.5 rounded shrink-0">{l.job}</span>}
          </div>
        ))}
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\DemoAutoprotocol.tsx
====================================================================================================

====================================================================================================
FILE [19/52]: src\components\DemoCostManager.tsx
Size: 70,559 bytes
====================================================================================================

import React, { useState, useMemo, useCallback, useEffect } from 'react'
import { createPortal } from 'react-dom'

type Screen = 'dashboard' | 'project' | 'analogs' | 'report' | 'ai' | 'deflators'

const BRAND = '#059669'

/* ── Icons ── */
const I = {
  Download: () => <svg className="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>,
  ChevronRight: () => <svg className="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M9 5l7 7-7 7"/></svg>,
  ChevronDown: () => <svg className="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M19 9l-7 7-7-7"/></svg>,
  Upload: () => <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>,
}

const nav: { key: Screen; emoji: string; label: string; section?: string }[] = [
  { key: 'dashboard', emoji: '📊', label: 'Дашборд' },
  { key: 'project', emoji: '🏗', label: 'Проект' },
  { key: 'analogs', emoji: '🔍', label: 'Аналоги', section: 'АНАЛИЗ' },
  { key: 'report', emoji: '📄', label: 'Отчёт' },
  { key: 'ai', emoji: '🤖', label: 'AI-классификация', section: 'ИНСТРУМЕНТЫ' },
  { key: 'deflators', emoji: '📈', label: 'Дефляторы' },
]

const titles: Record<Screen, string> = {
  dashboard: 'Дашборд', project: 'Анализ проекта', analogs: 'Поиск аналогов',
  report: 'Сравнительный отчёт', ai: 'AI-классификация', deflators: 'Дефляторы',
}

/* ── Number formatter ── */
function fmt(n: number): string {
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ')
}

/* ===== EXPORT ===== */
export function DemoCostManager() {
  const [open, setOpen] = useState(false)
  return (
    <>
      <div className="mt-5 flex justify-center">
        <button onClick={(e) => { e.stopPropagation(); setOpen(true) }} className="px-6 py-3 bg-accent hover:bg-accent/90 text-white font-semibold rounded-xl text-sm transition-all cursor-pointer border-none flex items-center gap-2 shadow-lg shadow-accent/25">
          <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path strokeLinecap="round" strokeLinejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
          Открыть демо
        </button>
      </div>
      {open && <Modal onClose={() => setOpen(false)} />}
    </>
  )
}

/* ===== MODAL ===== */
function Modal({ onClose }: { onClose: () => void }) {
  const [screen, setScreen] = useState<Screen>('dashboard')
  const handleKey = useCallback((e: KeyboardEvent) => { if (e.key === 'Escape') onClose() }, [onClose])
  useEffect(() => {
    document.addEventListener('keydown', handleKey)
    document.body.classList.add('demo-modal-open')
    return () => { document.removeEventListener('keydown', handleKey); document.body.classList.remove('demo-modal-open') }
  }, [handleKey])

  return createPortal(
    <div className="fixed inset-0 z-[9999] flex items-center justify-center p-4" onClick={onClose}>
      <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" />
      <div className="demo-modal-enter relative w-full max-w-[1400px] rounded-2xl overflow-hidden shadow-2xl flex flex-col" style={{ height: '90vh', maxHeight: '920px' }} onClick={e => e.stopPropagation()}>
        <button onClick={onClose} className="absolute top-3 right-3 z-50 w-8 h-8 rounded-full bg-black/20 hover:bg-black/40 text-white flex items-center justify-center cursor-pointer border-none transition-colors text-lg" aria-label="Close">&times;</button>
        <div className="flex flex-1 min-h-0">
          {/* Sidebar — WHITE */}
          <div className="w-[240px] bg-white border-r border-slate-200 flex flex-col shrink-0">
            <div className="h-14 flex items-center px-4 border-b border-slate-200">
              <div className="w-8 h-8 rounded-lg flex items-center justify-center text-[0.6rem] text-white font-bold mr-3" style={{ background: BRAND }}>CM</div>
              <div><div className="text-sm font-bold text-slate-800">CostManager</div><div className="text-[0.58rem] text-slate-400">v1.4</div></div>
            </div>
            <div className="flex-1 py-2 px-3 space-y-0.5 overflow-y-auto">
              {nav.map(item => (
                <div key={item.key}>
                  {item.section && <div className="pt-4 pb-2 px-2"><div className="text-[0.6rem] font-bold text-slate-400 uppercase tracking-wider">{item.section}</div></div>}
                  <button onClick={() => setScreen(item.key)} className={`w-full flex items-center gap-2.5 px-3 py-2 rounded-lg text-left cursor-pointer border-none transition-colors text-[0.8rem] ${screen === item.key ? 'bg-[#059669]/10 text-[#059669] font-semibold' : 'bg-transparent text-slate-600 hover:bg-slate-50 hover:text-slate-800'}`}>
                    <span className="text-[0.85rem]">{item.emoji}</span><span>{item.label}</span>
                  </button>
                </div>
              ))}
            </div>
            <div className="p-3 border-t border-slate-200">
              <div className="flex items-center gap-2.5 p-2 rounded-lg bg-slate-50">
                <div className="w-8 h-8 rounded-full flex items-center justify-center text-[0.65rem] font-bold" style={{ background: `${BRAND}15`, color: BRAND }}>НХ</div>
                <div className="flex-1 min-w-0"><div className="text-[0.75rem] font-semibold text-slate-700 truncate">Хроменок Н.В.</div><div className="text-[0.6rem] text-slate-400">Администратор</div></div>
              </div>
              <div className="text-[0.55rem] text-slate-400 text-center mt-2">v1.4 · Design by N. Khromenok & V. Vasin</div>
            </div>
          </div>
          {/* Content */}
          <div className="flex-1 flex flex-col min-w-0 bg-slate-50">
            <div className="h-14 flex items-center justify-between px-6 bg-white border-b border-slate-200 shrink-0">
              <h2 className="text-[0.95rem] font-bold text-slate-800 m-0">{titles[screen]}</h2>
              <div className="flex items-center gap-3">
                <span className="text-[0.72rem] text-slate-400">Портфель: 24 проекта</span>
                <span className="text-[0.72rem] text-slate-400">19 февр. 2026</span>
              </div>
            </div>
            <div className="flex-1 overflow-y-auto">
              {screen === 'dashboard' && <PgDashboard />}
              {screen === 'project' && <PgProject />}
              {screen === 'analogs' && <PgAnalogs />}
              {screen === 'report' && <PgReport />}
              {screen === 'ai' && <PgAI />}
              {screen === 'deflators' && <PgDeflators />}
            </div>
          </div>
        </div>
      </div>
    </div>, document.body)
}

/* ── Helpers ── */
function StatCard({ label, val, sub, color }: { label: string; val: string; sub: string; color: string }) {
  return <div className="bg-white rounded-xl p-4 border border-slate-200" style={{ borderLeftWidth: 3, borderLeftColor: color }}><span className="text-[0.65rem] text-slate-400 uppercase font-bold tracking-wider">{label}</span><div className="text-2xl font-extrabold text-slate-800 mt-1">{val}</div><div className="text-[0.7rem] text-slate-400 mt-0.5">{sub}</div></div>
}

function Badge({ children, color }: { children: React.ReactNode; color: string }) {
  const colors: Record<string, string> = {
    green: 'bg-green-100 text-green-600',
    amber: 'bg-amber-100 text-amber-600',
    blue: 'bg-blue-100 text-blue-600',
    red: 'bg-red-100 text-red-600',
    slate: 'bg-slate-100 text-slate-500',
  }
  return <span className={`px-2 py-0.5 rounded text-[0.65rem] font-bold ${colors[color] || colors.slate}`}>{children}</span>
}

/* ===== DASHBOARD ===== */
function PgDashboard() {
  const barData = [
    { label: 'Жилой комплекс', value: 8.2, color: BRAND },
    { label: 'Бизнес-центр', value: 4.1, color: '#10B981' },
    { label: 'Складской комплекс', value: 3.2, color: '#34D399' },
    { label: 'ЦОД', value: 2.1, color: '#6EE7B7' },
    { label: 'Прочие', value: 1.1, color: '#A7F3D0' },
  ]
  const maxBar = Math.max(...barData.map(b => b.value))

  const projects = [
    { name: 'ЖК «Северный»', code: 'PRJ-2024-015', cost: '6.00 млрд ₽', status: 'Активный', statusColor: 'green' },
    { name: 'БЦ «Горизонт»', code: 'PRJ-2024-022', cost: '2.80 млрд ₽', status: 'Активный', statusColor: 'green' },
    { name: 'Склад «Логопарк»', code: 'PRJ-2023-089', cost: '1.95 млрд ₽', status: 'Завершён', statusColor: 'slate' },
    { name: 'ЦОД «Дата-1»', code: 'PRJ-2024-031', cost: '2.10 млрд ₽', status: 'Оценка', statusColor: 'amber' },
  ]

  return (
    <div className="p-6">
      <div className="grid grid-cols-3 gap-4 mb-6">
        <StatCard label="Проектов" val="24" sub="12 активных" color={BRAND} />
        <StatCard label="Общая стоимость" val="18.7 млрд ₽" sub="портфель" color="#10B981" />
        <StatCard label="Ср. стоимость / м²" val="127 659 ₽/м²" sub="по активным проектам" color="#34D399" />
      </div>

      <div className="grid grid-cols-2 gap-6">
        {/* Bar chart */}
        <div className="bg-white rounded-xl border border-slate-200 p-5">
          <div className="text-[0.82rem] font-bold text-slate-800 mb-4">Стоимость по классам объектов</div>
          <div className="space-y-3">
            {barData.map(bar => (
              <div key={bar.label}>
                <div className="flex items-center justify-between mb-1">
                  <span className="text-[0.72rem] text-slate-600">{bar.label}</span>
                  <span className="text-[0.72rem] font-bold text-slate-700">{bar.value} млрд</span>
                </div>
                <div className="h-5 bg-slate-100 rounded-full overflow-hidden">
                  <div className="h-full rounded-full transition-all duration-500" style={{ width: `${(bar.value / maxBar) * 100}%`, background: bar.color }} />
                </div>
              </div>
            ))}
          </div>
        </div>

        {/* Recent projects */}
        <div className="bg-white rounded-xl border border-slate-200 p-5">
          <div className="text-[0.82rem] font-bold text-slate-800 mb-4">Последние проекты</div>
          <div className="space-y-2.5">
            {projects.map(p => (
              <div key={p.code} className="flex items-center gap-3 p-3 bg-slate-50 rounded-xl border border-slate-100 hover:border-slate-200 transition-colors cursor-pointer">
                <div className="w-9 h-9 rounded-lg flex items-center justify-center text-white text-[0.6rem] font-bold shrink-0" style={{ background: BRAND }}>{p.code.slice(-3)}</div>
                <div className="flex-1 min-w-0">
                  <div className="text-[0.78rem] font-semibold text-slate-800 truncate">{p.name}</div>
                  <div className="text-[0.65rem] text-slate-400">{p.code} · {p.cost}</div>
                </div>
                <Badge color={p.statusColor}>{p.status}</Badge>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  )
}

/* ===== PROJECT ===== */
interface CostNode {
  id: string
  name: string
  cost: number
  materials?: number
  works?: number
  sqm?: number
  children?: CostNode[]
}

const costTree: CostNode[] = [
  { id: '1', name: '1. ПИР и Разрешительная документация', cost: 280000000, materials: 0, works: 280000000, sqm: 5957 },
  { id: '2', name: '2. Подготовительные работы и Временные сооружения', cost: 185000000, materials: 74000000, works: 111000000, sqm: 3936 },
  {
    id: '3', name: '3. Земляные работы и Ограждение котлована', cost: 320000000, materials: 128000000, works: 192000000, sqm: 6809,
    children: [
      { id: '3.1', name: '3.1 Ограждения котлована', cost: 145000000, materials: 58000000, works: 87000000, sqm: 3085 },
      { id: '3.2', name: '3.2 Разработка котлована', cost: 98000000, materials: 39200000, works: 58800000, sqm: 2085 },
      { id: '3.3-5', name: '3.3–3.5 Вывоз, засыпка, водопонижение', cost: 77000000, materials: 30800000, works: 46200000, sqm: 1638 },
    ],
  },
  {
    id: '4', name: '4. Фундаменты и Конструкции подземной части', cost: 980000000, materials: 637000000, works: 343000000, sqm: 20851,
    children: [
      { id: '4.1', name: '4.1 Свайные основания (БНС)', cost: 210000000, materials: 136500000, works: 73500000, sqm: 4468 },
      { id: '4.3', name: '4.3 Монолитные ростверки и фунд. плиты', cost: 320000000, materials: 208000000, works: 112000000, sqm: 6809 },
      { id: '4.4', name: '4.4 Монолитные ЖБК подземной части', cost: 280000000, materials: 182000000, works: 98000000, sqm: 5957 },
      { id: '4.5', name: '4.5 Гидроизоляция подземной части', cost: 95000000, materials: 61750000, works: 33250000, sqm: 2021 },
      { id: '4.6-7', name: '4.6–4.7 Утепление, дренаж', cost: 75000000, materials: 48750000, works: 26250000, sqm: 1596 },
    ],
  },
  {
    id: '5', name: '5. Надземные несущие конструкции (КР)', cost: 1120000000, materials: 728000000, works: 392000000, sqm: 23830,
    children: [
      { id: '5.1', name: '5.1 Монолитные ЖБК', cost: 850000000, materials: 552500000, works: 297500000, sqm: 18085 },
      { id: '5.2', name: '5.2 Металлические несущие конструкции', cost: 180000000, materials: 117000000, works: 63000000, sqm: 3830 },
      { id: '5.3', name: '5.3 Сборные ЖБК', cost: 90000000, materials: 58500000, works: 31500000, sqm: 1915 },
    ],
  },
  {
    id: '6', name: '6. Общестроительные работы (АР)', cost: 720000000, materials: 432000000, works: 288000000, sqm: 15319,
    children: [
      { id: '6.1', name: '6.1 Фасадные работы', cost: 320000000, materials: 192000000, works: 128000000, sqm: 6809 },
      { id: '6.2', name: '6.2 Заполнение оконных проёмов', cost: 145000000, materials: 87000000, works: 58000000, sqm: 3085 },
      { id: '6.3', name: '6.3 Кровельные работы', cost: 95000000, materials: 57000000, works: 38000000, sqm: 2021 },
      { id: '6.4-8', name: '6.4–6.8 Стены, перегородки, двери, лестницы', cost: 160000000, materials: 96000000, works: 64000000, sqm: 3404 },
    ],
  },
  {
    id: '7', name: '7. Отделочные работы (АИ)', cost: 480000000, materials: 288000000, works: 192000000, sqm: 10213,
    children: [
      { id: '7.1', name: '7.1 Отделка Паркинга', cost: 65000000, materials: 39000000, works: 26000000, sqm: 1383 },
      { id: '7.3-4', name: '7.3–7.4 Отделка МОП (подз. + надз.)', cost: 185000000, materials: 111000000, works: 74000000, sqm: 3936 },
      { id: '7.5-6', name: '7.5–7.6 Отделка жилых помещений', cost: 180000000, materials: 108000000, works: 72000000, sqm: 3830 },
      { id: '7.7-9', name: '7.7–7.9 Коммерция, соцобъекты, мокапы', cost: 50000000, materials: 30000000, works: 20000000, sqm: 1064 },
    ],
  },
  {
    id: '8', name: '8. Внутренние инженерные системы (ВИС)', cost: 1050000000, materials: 630000000, works: 420000000, sqm: 22340,
    children: [
      { id: '8.1', name: '8.1 ВК, ВПВ', cost: 220000000, materials: 132000000, works: 88000000, sqm: 4681 },
      { id: '8.2', name: '8.2 ОВиК, ИТП', cost: 310000000, materials: 186000000, works: 124000000, sqm: 6596 },
      { id: '8.3', name: '8.3 Электроснабжение (ЭОМ)', cost: 280000000, materials: 168000000, works: 112000000, sqm: 5957 },
      { id: '8.4', name: '8.4 Слаботочные системы', cost: 95000000, materials: 57000000, works: 38000000, sqm: 2021 },
      { id: '8.5', name: '8.5 Противопожарная защита', cost: 85000000, materials: 51000000, works: 34000000, sqm: 1809 },
      { id: '8.6', name: '8.6 Вертикальный транспорт (лифты)', cost: 60000000, materials: 36000000, works: 24000000, sqm: 1277 },
    ],
  },
  { id: '9', name: '9. Наружные инженерные сети (НС)', cost: 195000000, materials: 117000000, works: 78000000, sqm: 4149 },
  { id: '10', name: '10. Благоустройство', cost: 155000000, materials: 93000000, works: 62000000, sqm: 3298 },
  { id: '11', name: '11. Технологические решения и Спецоборудование', cost: 65000000, materials: 45500000, works: 19500000, sqm: 1383 },
  { id: '12', name: '12. Сопутствующие расходы', cost: 335000000, materials: 67000000, works: 268000000, sqm: 7128 },
  { id: '13', name: '13. Непредвиденные расходы', cost: 115000000, materials: 0, works: 115000000, sqm: 2447 },
]

const DEFLATOR_2024 = 1.085 * 1.047

function PgProject() {
  const [expanded, setExpanded] = useState<Set<string>>(new Set(['4', '5', '8']))
  const [deflated, setDeflated] = useState(false)

  const toggle = useCallback((id: string) => {
    setExpanded(prev => {
      const next = new Set(prev)
      if (next.has(id)) next.delete(id); else next.add(id)
      return next
    })
  }, [])

  const applyDeflator = useCallback((v: number) => deflated ? Math.round(v / DEFLATOR_2024) : v, [deflated])

  const renderRows = useMemo(() => {
    const rows: { node: CostNode; level: number; hasChildren: boolean; isExpanded: boolean }[] = []
    const walk = (nodes: CostNode[], level: number) => {
      for (const n of nodes) {
        const hasChildren = !!n.children && n.children.length > 0
        rows.push({ node: n, level, hasChildren, isExpanded: expanded.has(n.id) })
        if (hasChildren && expanded.has(n.id)) walk(n.children!, level + 1)
      }
    }
    walk(costTree, 0)
    return rows
  }, [expanded])

  const totalCost = costTree.reduce((s, n) => s + n.cost, 0)

  return (
    <div className="p-6">
      {/* Header */}
      <div className="flex items-center justify-between mb-5">
        <div>
          <div className="text-[0.95rem] font-bold text-slate-800">ЖК «Северный»</div>
          <div className="text-[0.72rem] text-slate-400">Код: PRJ-2024-015 · Площадь: 47 000 м² · Москва, СЗАО</div>
        </div>
        <div className="flex items-center gap-3">
          <div className="flex items-center bg-white border border-slate-200 rounded-lg overflow-hidden">
            <button onClick={() => setDeflated(false)} className={`px-3 py-1.5 text-[0.72rem] font-medium border-none cursor-pointer transition-colors ${!deflated ? 'bg-[#059669]/10 text-[#059669]' : 'bg-white text-slate-500 hover:bg-slate-50'}`}>Исходные цены</button>
            <button onClick={() => setDeflated(true)} className={`px-3 py-1.5 text-[0.72rem] font-medium border-none cursor-pointer transition-colors ${deflated ? 'bg-[#059669]/10 text-[#059669]' : 'bg-white text-slate-500 hover:bg-slate-50'}`}>Дефлятированные</button>
          </div>
        </div>
      </div>

      {/* Summary row */}
      <div className="grid grid-cols-4 gap-3 mb-5">
        <div className="bg-white rounded-xl p-3 border border-slate-200 text-center">
          <div className="text-[0.65rem] text-slate-400 uppercase font-bold">Итого</div>
          <div className="text-lg font-extrabold text-slate-800 mt-0.5">{fmt(applyDeflator(totalCost))} ₽</div>
        </div>
        <div className="bg-white rounded-xl p-3 border border-slate-200 text-center">
          <div className="text-[0.65rem] text-slate-400 uppercase font-bold">Материалы</div>
          <div className="text-lg font-extrabold text-slate-800 mt-0.5">{fmt(applyDeflator(3239500000))} ₽</div>
        </div>
        <div className="bg-white rounded-xl p-3 border border-slate-200 text-center">
          <div className="text-[0.65rem] text-slate-400 uppercase font-bold">Работы</div>
          <div className="text-lg font-extrabold text-slate-800 mt-0.5">{fmt(applyDeflator(2760500000))} ₽</div>
        </div>
        <div className="bg-white rounded-xl p-3 border border-slate-200 text-center">
          <div className="text-[0.65rem] text-slate-400 uppercase font-bold">₽ / м²</div>
          <div className="text-lg font-extrabold text-slate-800 mt-0.5">{fmt(applyDeflator(127659))}</div>
        </div>
      </div>

      {/* Cost tree table */}
      <div className="bg-white rounded-xl border border-slate-200 overflow-hidden mb-5">
        <table className="w-full">
          <thead>
            <tr className="text-[0.65rem] text-slate-400 uppercase tracking-wider bg-slate-50">
              <th className="text-left px-4 py-2.5 font-semibold" style={{ width: '40%' }}>Наименование</th>
              <th className="text-right px-4 py-2.5 font-semibold">Стоимость</th>
              <th className="text-right px-4 py-2.5 font-semibold">Материалы</th>
              <th className="text-right px-4 py-2.5 font-semibold">Работы</th>
              <th className="text-right px-4 py-2.5 font-semibold">₽/м²</th>
            </tr>
          </thead>
          <tbody>
            {renderRows.map(({ node, level, hasChildren, isExpanded }) => (
              <tr key={node.id} className="border-t border-slate-100 text-[0.75rem] hover:bg-slate-50/50 transition-colors">
                <td className="px-4 py-2.5">
                  <div className="flex items-center" style={{ paddingLeft: `${level * 20}px` }}>
                    {hasChildren ? (
                      <button onClick={() => toggle(node.id)} className="w-5 h-5 flex items-center justify-center rounded cursor-pointer border-none bg-transparent text-slate-400 hover:text-slate-600 hover:bg-slate-100 transition-colors mr-1.5 shrink-0">
                        {isExpanded ? <I.ChevronDown /> : <I.ChevronRight />}
                      </button>
                    ) : <span className="w-5 mr-1.5 shrink-0" />}
                    <span className={`${level === 0 ? 'font-bold text-slate-800' : level === 1 ? 'font-semibold text-slate-700' : 'text-slate-600'}`}>{node.name}</span>
                  </div>
                </td>
                <td className={`text-right px-4 py-2.5 font-mono ${level === 0 ? 'font-bold text-slate-800' : 'text-slate-600'}`}>{fmt(applyDeflator(node.cost))}</td>
                <td className="text-right px-4 py-2.5 font-mono text-slate-500">{node.materials !== undefined ? fmt(applyDeflator(node.materials)) : '—'}</td>
                <td className="text-right px-4 py-2.5 font-mono text-slate-500">{node.works !== undefined ? fmt(applyDeflator(node.works)) : '—'}</td>
                <td className="text-right px-4 py-2.5 font-mono text-slate-500">{node.sqm !== undefined ? fmt(applyDeflator(node.sqm)) : '—'}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      {/* Local objects */}
      <div className="text-[0.82rem] font-bold text-slate-800 mb-3">Локальные объекты</div>
      <div className="grid grid-cols-2 gap-4">
        {[
          { name: 'Корпус 1', floors: '24 этажа', area: '22 500 м²', cost: '2 980 000 000 ₽', sqm: '132 444 ₽/м²' },
          { name: 'Корпус 2', floors: '28 этажей', area: '24 500 м²', cost: '3 190 000 000 ₽', sqm: '130 204 ₽/м²' },
        ].map(obj => (
          <div key={obj.name} className="bg-white rounded-xl border border-slate-200 p-4 hover:border-[#059669]/30 transition-colors cursor-pointer">
            <div className="flex items-center gap-2 mb-3">
              <div className="w-8 h-8 rounded-lg flex items-center justify-center text-white text-[0.6rem] font-bold" style={{ background: BRAND }}>🏢</div>
              <div>
                <div className="text-[0.82rem] font-bold text-slate-800">{obj.name}</div>
                <div className="text-[0.65rem] text-slate-400">{obj.floors} · {obj.area}</div>
              </div>
            </div>
            <div className="grid grid-cols-2 gap-2">
              <div className="bg-slate-50 rounded-lg p-2"><div className="text-[0.6rem] text-slate-400">Стоимость</div><div className="text-[0.78rem] font-bold text-slate-700">{obj.cost}</div></div>
              <div className="bg-slate-50 rounded-lg p-2"><div className="text-[0.6rem] text-slate-400">₽/м²</div><div className="text-[0.78rem] font-bold text-slate-700">{obj.sqm}</div></div>
            </div>
          </div>
        ))}
      </div>
    </div>
  )
}

/* ── FilterSection (extracted to avoid re-creation during render) ── */
function FilterSection({ id, title, children, openSections, toggleSection }: {
  id: string; title: string; children: React.ReactNode;
  openSections: Set<string>; toggleSection: (s: string) => void
}) {
  return (
    <div className="border border-slate-200 rounded-xl overflow-hidden">
      <button onClick={() => toggleSection(id)} className="w-full flex items-center justify-between px-4 py-3 bg-white text-[0.78rem] font-semibold text-slate-700 cursor-pointer border-none hover:bg-slate-50 transition-colors">
        <span>{title}</span>
        {openSections.has(id) ? <I.ChevronDown /> : <I.ChevronRight />}
      </button>
      {openSections.has(id) && <div className="px-4 pb-4 bg-white border-t border-slate-100">{children}</div>}
    </div>
  )
}

/* ===== ANALOGS ===== */
function PgAnalogs() {
  const [openSections, setOpenSections] = useState<Set<string>>(new Set(['location', 'chars']))

  const toggleSection = useCallback((s: string) => {
    setOpenSections(prev => {
      const next = new Set(prev)
      if (next.has(s)) next.delete(s); else next.add(s)
      return next
    })
  }, [])

  const analogs = [
    { name: 'ЖК «Восточный парк»', sqm: '126 000', city: 'Москва', floors: 22, area: '38 500 м²', year: 2023, match: 87,
      struct: [{ l: 'Конструктив', v: 36, c: '#059669' }, { l: 'Фасад/Отделка', v: 19, c: '#10B981' }, { l: 'Инж. системы', v: 17, c: '#34D399' }, { l: 'Прочие', v: 28, c: '#A7F3D0' }] },
    { name: 'ЖК «Панорама»', sqm: '138 000', city: 'МО', floors: 25, area: '42 000 м²', year: 2023, match: 82,
      struct: [{ l: 'Конструктив', v: 33, c: '#059669' }, { l: 'Фасад/Отделка', v: 23, c: '#10B981' }, { l: 'Инж. системы', v: 18, c: '#34D399' }, { l: 'Прочие', v: 26, c: '#A7F3D0' }] },
    { name: 'ЖК «Сити-Холл»', sqm: '155 000', city: 'Москва', floors: 30, area: '55 000 м²', year: 2024, match: 74,
      struct: [{ l: 'Конструктив', v: 34, c: '#059669' }, { l: 'Фасад/Отделка', v: 20, c: '#10B981' }, { l: 'Инж. системы', v: 21, c: '#34D399' }, { l: 'Прочие', v: 25, c: '#A7F3D0' }] },
  ]

  return (
    <div className="p-6">
      {/* Reference selector */}
      <div className="bg-white rounded-xl border border-slate-200 p-4 mb-5">
        <div className="text-[0.72rem] text-slate-400 uppercase font-bold tracking-wider mb-2">Эталонный объект</div>
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 rounded-lg flex items-center justify-center text-white text-[0.65rem] font-bold" style={{ background: BRAND }}>015</div>
          <div className="flex-1">
            <div className="text-[0.85rem] font-bold text-slate-800">ЖК «Северный»</div>
            <div className="text-[0.7rem] text-slate-400">PRJ-2024-015 · 47 000 м² · 142 500 ₽/м² · Москва, СЗАО</div>
          </div>
          <Badge color="green">Выбран</Badge>
        </div>
      </div>

      <div className="grid grid-cols-3 gap-6">
        {/* Filters */}
        <div className="space-y-3">
          <div className="text-[0.82rem] font-bold text-slate-800 mb-1">Фильтры поиска</div>
          <FilterSection id="location" title="📍 Локация" openSections={openSections} toggleSection={toggleSection}>
            <div className="space-y-2 pt-2">
              <div><div className="text-[0.68rem] text-slate-500 mb-1">Регион</div><div className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 text-[0.75rem] text-slate-700">Москва и МО</div></div>
              <div><div className="text-[0.68rem] text-slate-500 mb-1">Город</div><div className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 text-[0.75rem] text-slate-700">Все</div></div>
              <div><div className="text-[0.68rem] text-slate-500 mb-1">Класс</div><div className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 text-[0.75rem] text-slate-700">Комфорт / Бизнес</div></div>
            </div>
          </FilterSection>
          <FilterSection id="chars" title="📐 Характеристики" openSections={openSections} toggleSection={toggleSection}>
            <div className="space-y-2 pt-2">
              <div><div className="text-[0.68rem] text-slate-500 mb-1">Тип объекта</div><div className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 text-[0.75rem] text-slate-700">Жилой комплекс</div></div>
              <div className="grid grid-cols-2 gap-2">
                <div><div className="text-[0.68rem] text-slate-500 mb-1">Площадь, от</div><div className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 text-[0.75rem] text-slate-700">30 000 м²</div></div>
                <div><div className="text-[0.68rem] text-slate-500 mb-1">Площадь, до</div><div className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 text-[0.75rem] text-slate-700">70 000 м²</div></div>
              </div>
              <div className="grid grid-cols-2 gap-2">
                <div><div className="text-[0.68rem] text-slate-500 mb-1">Этажность, от</div><div className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 text-[0.75rem] text-slate-700">15</div></div>
                <div><div className="text-[0.68rem] text-slate-500 mb-1">Этажность, до</div><div className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 text-[0.75rem] text-slate-700">35</div></div>
              </div>
            </div>
          </FilterSection>
          <FilterSection id="cost" title="💰 Стоимость" openSections={openSections} toggleSection={toggleSection}>
            <div className="space-y-2 pt-2">
              <div className="grid grid-cols-2 gap-2">
                <div><div className="text-[0.68rem] text-slate-500 mb-1">₽/м², от</div><div className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 text-[0.75rem] text-slate-700">100 000</div></div>
                <div><div className="text-[0.68rem] text-slate-500 mb-1">₽/м², до</div><div className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 text-[0.75rem] text-slate-700">200 000</div></div>
              </div>
              <div><div className="text-[0.68rem] text-slate-500 mb-1">Доля категории, %</div><div className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 text-[0.75rem] text-slate-700">СМР: 75-90%</div></div>
            </div>
          </FilterSection>
          <button className="w-full py-2.5 text-white rounded-xl text-[0.8rem] font-semibold border-none cursor-pointer hover:opacity-90 transition-opacity flex items-center justify-center gap-2" style={{ background: BRAND }}>
            🔍 Найти аналоги
          </button>
        </div>

        {/* Results */}
        <div className="col-span-2">
          <div className="flex items-center justify-between mb-3">
            <div className="text-[0.82rem] font-bold text-slate-800">Найденные аналоги</div>
            <span className="text-[0.72rem] text-slate-400">3 проекта</span>
          </div>
          <div className="space-y-3">
            {analogs.map(a => (
              <div key={a.name} className="bg-white rounded-xl border border-slate-200 p-4 hover:border-[#059669]/30 transition-colors cursor-pointer">
                <div className="flex items-center justify-between mb-3">
                  <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-lg flex items-center justify-center text-white text-[0.7rem] font-bold" style={{ background: BRAND }}>{a.floors}э</div>
                    <div>
                      <div className="text-[0.85rem] font-bold text-slate-800">{a.name}</div>
                      <div className="text-[0.7rem] text-slate-400">{a.city} · {a.area} · {a.year} г.</div>
                    </div>
                  </div>
                  <div className="text-right">
                    <div className="text-lg font-extrabold" style={{ color: BRAND }}>{a.sqm} ₽/м²</div>
                    <div className="text-[0.65rem] text-slate-400">совпадение: {a.match}%</div>
                  </div>
                </div>
                <div>
                  <div className="flex h-2.5 rounded-full overflow-hidden mb-1.5">
                    {a.struct.map(s => (
                      <div key={s.l} style={{ width: `${s.v}%`, background: s.c }} />
                    ))}
                  </div>
                  <div className="flex gap-3">
                    {a.struct.map(s => (
                      <span key={s.l} className="flex items-center gap-1 text-[0.6rem] text-slate-500">
                        <span className="w-1.5 h-1.5 rounded-sm shrink-0" style={{ background: s.c }} />{s.l} {s.v}%
                      </span>
                    ))}
                  </div>
                </div>
              </div>
            ))}
          </div>
          <button className="w-full mt-4 py-2.5 bg-white border border-slate-200 rounded-xl text-[0.8rem] font-semibold text-slate-700 cursor-pointer hover:bg-slate-50 transition-colors flex items-center justify-center gap-2">
            📄 Сформировать отчёт
          </button>
        </div>
      </div>
    </div>
  )
}

/* ===== REPORT ===== */
function PgReport() {
  const [tab, setTab] = useState<'table' | 'chart'>('table')

  const sections = [
    { id: '1', name: 'ПИР и РД', ref: 5957, a1: 5100, a2: 6200, a3: 7800, share: 4.7, avg: 6275, median: 5650, p10: 4500, p90: 7900 },
    { id: '2', name: 'Подготовительные работы', ref: 3936, a1: 3400, a2: 4100, a3: 5200, share: 3.1, avg: 4233, median: 4100, p10: 3000, p90: 5400 },
    { id: '3', name: 'Земляные и Котлован', ref: 6809, a1: 5800, a2: 7200, a3: 8500, share: 5.3, avg: 7167, median: 7200, p10: 5200, p90: 9200 },
    { id: '4', name: 'Фундаменты и подз. часть', ref: 20851, a1: 18500, a2: 21200, a3: 24500, share: 16.3, avg: 21400, median: 21200, p10: 16800, p90: 25500 },
    { id: '5', name: 'Надземные несущие КР', ref: 23830, a1: 22000, a2: 24800, a3: 28500, share: 18.7, avg: 25100, median: 24800, p10: 19500, p90: 29500 },
    { id: '6', name: 'Общестроительные (АР)', ref: 15319, a1: 13500, a2: 16000, a3: 18200, share: 12.0, avg: 15900, median: 16000, p10: 12000, p90: 19000 },
    { id: '7', name: 'Отделочные работы (АИ)', ref: 10213, a1: 8900, a2: 10800, a3: 12500, share: 8.0, avg: 10733, median: 10800, p10: 7800, p90: 13500 },
    { id: '8', name: 'ВИС (инж. системы)', ref: 22340, a1: 20100, a2: 23600, a3: 27200, share: 17.5, avg: 23633, median: 23600, p10: 17500, p90: 28000 },
    { id: '9', name: 'Наружные инж. сети', ref: 4149, a1: 3500, a2: 4200, a3: 5100, share: 3.3, avg: 4267, median: 4200, p10: 3000, p90: 5600 },
    { id: '10', name: 'Благоустройство', ref: 3298, a1: 2800, a2: 3400, a3: 4200, share: 2.6, avg: 3467, median: 3400, p10: 2300, p90: 4600 },
    { id: '11', name: 'Технологические решения', ref: 1383, a1: 1000, a2: 1400, a3: 1800, share: 1.1, avg: 1400, median: 1400, p10: 850, p90: 2000 },
    { id: '12', name: 'Сопутствующие расходы', ref: 7128, a1: 6200, a2: 7500, a3: 8800, share: 5.6, avg: 7500, median: 7500, p10: 5300, p90: 9500 },
    { id: '13', name: 'Непредвиденные расходы', ref: 2447, a1: 1800, a2: 2500, a3: 3200, share: 1.9, avg: 2500, median: 2500, p10: 1500, p90: 3400 },
  ]

  const totalRef = sections.reduce((s, c) => s + c.ref, 0)
  const totalA1 = sections.reduce((s, c) => s + c.a1, 0)
  const totalA2 = sections.reduce((s, c) => s + c.a2, 0)
  const totalA3 = sections.reduce((s, c) => s + c.a3, 0)
  const totalAvg = sections.reduce((s, c) => s + c.avg, 0)
  const totalMedian = sections.reduce((s, c) => s + c.median, 0)
  const totalP10 = sections.reduce((s, c) => s + c.p10, 0)
  const totalP90 = sections.reduce((s, c) => s + c.p90, 0)

  const maxChart = Math.max(...sections.map(s => Math.max(s.p90, s.ref))) * 1.12
  const pct = (v: number) => (v / maxChart) * 100

  const devPct = (ref: number, avg: number) => ((ref - avg) / avg * 100).toFixed(1)
  const devCls = (ref: number, avg: number) => {
    const d = Math.abs((ref - avg) / avg * 100)
    return d > 15 ? 'text-red-600 font-bold' : d > 8 ? 'text-amber-600' : 'text-green-600'
  }
  const refCls = (ref: number, p10: number, p90: number) => ref < p10 || ref > p90 ? 'bg-red-50/60' : ''

  return (
    <div className="p-6">
      {/* Report header */}
      <div className="bg-white rounded-xl border border-slate-200 p-4 mb-4">
        <div className="flex items-center justify-between mb-3">
          <div>
            <div className="text-[0.95rem] font-bold text-slate-800">Сравнительный анализ стоимости строительства</div>
            <div className="text-[0.72rem] text-slate-400 mt-0.5">ЖК «Северный» · PRJ-2024-015 · Данные дефлятированы к Q1 2024</div>
          </div>
          <div className="flex items-center gap-2">
            <button className="flex items-center gap-1.5 px-3 py-1.5 text-white rounded-lg text-[0.72rem] font-medium cursor-pointer border-none hover:opacity-90 transition-opacity" style={{ background: BRAND }}><I.Download /> .xlsx</button>
            <button className="flex items-center gap-1.5 px-3 py-1.5 bg-slate-700 text-white rounded-lg text-[0.72rem] font-medium cursor-pointer border-none hover:bg-slate-600 transition-colors"><I.Download /> .pdf</button>
          </div>
        </div>
        <div className="flex gap-3">
          {[
            { l: 'Площадь', v: '47 000 м²' }, { l: 'Этажность', v: '24 + 2 подз.' },
            { l: 'Класс', v: 'Бизнес' }, { l: 'Аналогов', v: '3 проекта' },
            { l: 'Выборка', v: '18 проектов' }, { l: 'Дата отчёта', v: '19.02.2026' },
          ].map(t => (
            <div key={t.l} className="flex-1 bg-slate-50 rounded-lg px-3 py-1.5">
              <div className="text-[0.55rem] text-slate-400 uppercase font-bold">{t.l}</div>
              <div className="text-[0.72rem] font-semibold text-slate-700">{t.v}</div>
            </div>
          ))}
        </div>
      </div>

      {/* Tabs */}
      <div className="flex items-center gap-1 mb-4">
        {([
          { key: 'table' as const, label: '📊 Сравнительный анализ' },
          { key: 'chart' as const, label: '📈 Разброс P10 – Медиана – P90' },
        ]).map(t => (
          <button key={t.key} onClick={() => setTab(t.key)} className={`px-4 py-2 rounded-lg text-[0.75rem] font-medium border cursor-pointer transition-colors ${tab === t.key ? 'bg-[#059669]/10 text-[#059669] font-semibold border-[#059669]/20' : 'bg-white text-slate-500 hover:bg-slate-50 border-slate-200'}`}>{t.label}</button>
        ))}
      </div>

      {tab === 'table' && (
        <>
          {/* Comparison table */}
          <div className="bg-white rounded-xl border border-slate-200 overflow-hidden mb-4">
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead>
                  <tr className="text-[0.58rem] text-slate-400 uppercase tracking-wider bg-slate-50">
                    <th className="text-left px-3 py-2 font-semibold" style={{ minWidth: 155 }}>Раздел</th>
                    <th className="text-right px-2 py-2 font-semibold" style={{ background: '#05966910', minWidth: 68 }}>Проект</th>
                    <th className="text-right px-2 py-2 font-semibold" style={{ minWidth: 62 }}>Аналог 1</th>
                    <th className="text-right px-2 py-2 font-semibold" style={{ minWidth: 62 }}>Аналог 2</th>
                    <th className="text-right px-2 py-2 font-semibold" style={{ minWidth: 62 }}>Аналог 3</th>
                    <th className="text-center px-1 py-2 font-semibold" style={{ minWidth: 36 }}>Доля</th>
                    <th className="text-right px-2 py-2 font-semibold text-blue-400" style={{ minWidth: 52 }}>P10</th>
                    <th className="text-right px-2 py-2 font-semibold" style={{ minWidth: 58 }}>Среднее</th>
                    <th className="text-right px-2 py-2 font-semibold text-emerald-500" style={{ minWidth: 56 }}>Медиана</th>
                    <th className="text-right px-2 py-2 font-semibold text-blue-400" style={{ minWidth: 52 }}>P90</th>
                    <th className="text-right px-2 py-2 font-semibold" style={{ minWidth: 48 }}>Откл.%</th>
                  </tr>
                </thead>
                <tbody>
                  {sections.map(c => (
                    <tr key={c.id} className={`border-t border-slate-100 text-[0.68rem] hover:bg-slate-50/50 ${refCls(c.ref, c.p10, c.p90)}`}>
                      <td className="px-3 py-1.5 font-semibold text-slate-700"><span className="text-slate-400 mr-0.5">{c.id}.</span> {c.name}</td>
                      <td className="text-right px-2 py-1.5 font-mono font-bold text-slate-800" style={{ background: '#05966906' }}>{fmt(c.ref)}</td>
                      <td className="text-right px-2 py-1.5 font-mono text-slate-500">{fmt(c.a1)}</td>
                      <td className="text-right px-2 py-1.5 font-mono text-slate-500">{fmt(c.a2)}</td>
                      <td className="text-right px-2 py-1.5 font-mono text-slate-500">{fmt(c.a3)}</td>
                      <td className="text-center px-1 py-1.5 text-[0.6rem] text-slate-400">{c.share}%</td>
                      <td className="text-right px-2 py-1.5 font-mono text-[0.62rem] text-blue-500">{fmt(c.p10)}</td>
                      <td className="text-right px-2 py-1.5 font-mono text-slate-600 font-semibold">{fmt(c.avg)}</td>
                      <td className="text-right px-2 py-1.5 font-mono text-emerald-600 font-semibold">{fmt(c.median)}</td>
                      <td className="text-right px-2 py-1.5 font-mono text-[0.62rem] text-blue-500">{fmt(c.p90)}</td>
                      <td className={`text-right px-2 py-1.5 font-mono text-[0.62rem] ${devCls(c.ref, c.avg)}`}>{Number(devPct(c.ref, c.avg)) > 0 ? '+' : ''}{devPct(c.ref, c.avg)}%</td>
                    </tr>
                  ))}
                  <tr className="border-t-2 border-slate-300 bg-slate-50 text-[0.7rem] font-bold">
                    <td className="px-3 py-2 text-slate-800">Итого (₽/м²)</td>
                    <td className="text-right px-2 py-2 font-mono text-slate-800" style={{ background: '#05966910' }}>{fmt(totalRef)}</td>
                    <td className="text-right px-2 py-2 font-mono text-slate-600">{fmt(totalA1)}</td>
                    <td className="text-right px-2 py-2 font-mono text-slate-600">{fmt(totalA2)}</td>
                    <td className="text-right px-2 py-2 font-mono text-slate-600">{fmt(totalA3)}</td>
                    <td className="text-center px-1 py-2 text-slate-400">100%</td>
                    <td className="text-right px-2 py-2 font-mono text-blue-500">{fmt(totalP10)}</td>
                    <td className="text-right px-2 py-2 font-mono text-slate-800">{fmt(totalAvg)}</td>
                    <td className="text-right px-2 py-2 font-mono text-emerald-600">{fmt(totalMedian)}</td>
                    <td className="text-right px-2 py-2 font-mono text-blue-500">{fmt(totalP90)}</td>
                    <td className={`text-right px-2 py-2 font-mono text-[0.62rem] ${devCls(totalRef, totalAvg)}`}>{Number(devPct(totalRef, totalAvg)) > 0 ? '+' : ''}{devPct(totalRef, totalAvg)}%</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          {/* Stats strip */}
          <div className="grid grid-cols-4 gap-3">
            <div className="bg-white rounded-xl border border-slate-200 p-3 text-center">
              <div className="text-[0.58rem] text-blue-400 uppercase font-bold">P10</div>
              <div className="text-lg font-extrabold text-blue-600">{fmt(totalP10)}</div>
              <div className="text-[0.58rem] text-slate-400">₽/м²</div>
            </div>
            <div className="bg-white rounded-xl border border-slate-200 p-3 text-center" style={{ borderBottomWidth: 3, borderBottomColor: '#22c55e' }}>
              <div className="text-[0.58rem] text-emerald-500 uppercase font-bold">Медиана</div>
              <div className="text-lg font-extrabold text-slate-800">{fmt(totalMedian)}</div>
              <div className="text-[0.58rem] text-slate-400">₽/м²</div>
            </div>
            <div className="bg-white rounded-xl border border-slate-200 p-3 text-center" style={{ borderBottomWidth: 3, borderBottomColor: '#1e293b' }}>
              <div className="text-[0.58rem] text-slate-500 uppercase font-bold">Среднее</div>
              <div className="text-lg font-extrabold text-slate-800">{fmt(totalAvg)}</div>
              <div className="text-[0.58rem] text-slate-400">₽/м²</div>
            </div>
            <div className="bg-white rounded-xl border border-slate-200 p-3 text-center">
              <div className="text-[0.58rem] text-blue-400 uppercase font-bold">P90</div>
              <div className="text-lg font-extrabold text-blue-600">{fmt(totalP90)}</div>
              <div className="text-[0.58rem] text-slate-400">₽/м²</div>
            </div>
          </div>

          {/* Legend */}
          <div className="flex items-center gap-5 mt-3">
            <div className="flex items-center gap-1.5"><div className="w-3 h-3 rounded bg-red-50 border border-red-200" /><span className="text-[0.65rem] text-slate-500">Проект за пределами P10–P90</span></div>
            <div className="flex items-center gap-1.5"><span className="text-[0.65rem] text-green-600 font-mono font-bold">+2.1%</span><span className="text-[0.65rem] text-slate-500">— отклонение от среднего в норме</span></div>
            <div className="flex items-center gap-1.5"><span className="text-[0.65rem] text-red-600 font-mono font-bold">-18.3%</span><span className="text-[0.65rem] text-slate-500">— значительное отклонение</span></div>
          </div>
        </>
      )}

      {tab === 'chart' && (
        <div className="bg-white rounded-xl border border-slate-200 p-5">
          <div className="text-[0.85rem] font-bold text-slate-800 mb-1">Разброс и статистика (P10 – Медиана – P90)</div>
          <div className="text-[0.68rem] text-slate-400 mb-4">Удельная стоимость по разделам, ₽/м² · ЖК «Северный» vs выборка 18 проектов</div>

          {/* Legend */}
          <div className="flex items-center gap-5 mb-5 pb-3 border-b border-slate-100">
            <span className="flex items-center gap-1.5 text-[0.68rem] text-slate-600">
              <span className="inline-block w-5 h-3 rounded-sm" style={{ background: '#bfdbfe' }} />Разброс P10–P90
            </span>
            <span className="flex items-center gap-1.5 text-[0.68rem] text-slate-600">
              <span className="inline-block w-2.5 h-2.5 rounded-sm" style={{ background: '#22c55e' }} />Медиана
            </span>
            <span className="flex items-center gap-1.5 text-[0.68rem] text-slate-600">
              <span className="inline-block w-1 h-3" style={{ background: '#1e293b', borderRadius: 1 }} />Среднее
            </span>
            <span className="flex items-center gap-1.5 text-[0.68rem] text-slate-600">
              <span className="inline-block" style={{ width: 0, height: 0, borderLeft: '5px solid transparent', borderRight: '5px solid transparent', borderTop: '8px solid #ef4444' }} />Объект проверки
            </span>
          </div>

          {/* Chart rows */}
          <div className="space-y-1.5">
            {sections.map(s => (
              <div key={s.id} className="flex items-center gap-2 group">
                <div className="text-[0.65rem] text-slate-600 text-right shrink-0 truncate" style={{ width: 165 }}>
                  <span className="text-slate-400">{s.id}.</span> {s.name}
                </div>
                <div className="flex-1 relative" style={{ height: 22 }}>
                  {/* P10-P90 range bar */}
                  <div className="absolute rounded" style={{ left: `${pct(s.p10)}%`, width: `${pct(s.p90) - pct(s.p10)}%`, top: 3, height: 16, background: '#bfdbfe' }} />
                  {/* Average bar */}
                  <div className="absolute" style={{ left: `${pct(s.avg)}%`, top: 3, width: 3, height: 16, background: '#1e293b', borderRadius: 1, transform: 'translateX(-50%)' }} />
                  {/* Median square */}
                  <div className="absolute" style={{ left: `${pct(s.median)}%`, top: 5, width: 10, height: 10, background: '#22c55e', borderRadius: 2, transform: 'translateX(-50%)', border: '1.5px solid white', boxShadow: '0 0 0 0.5px #22c55e' }} />
                  {/* Project value triangle */}
                  <div className="absolute" style={{ left: `${pct(s.ref)}%`, top: 0, transform: 'translateX(-50%)', width: 0, height: 0, borderLeft: '5px solid transparent', borderRight: '5px solid transparent', borderTop: '8px solid #ef4444' }} />
                </div>
                <div className="text-[0.58rem] font-mono text-slate-400 shrink-0 text-right" style={{ width: 45 }}>{fmt(s.ref)}</div>
              </div>
            ))}
          </div>

          {/* X-axis */}
          <div className="flex items-center gap-2 mt-2">
            <div style={{ width: 165 }} className="shrink-0" />
            <div className="flex-1 relative h-5 border-t border-slate-200">
              {[0, 5000, 10000, 15000, 20000, 25000, 30000].map(v => (
                <div key={v} className="absolute text-[0.52rem] text-slate-400" style={{ left: `${pct(v)}%`, top: 3, transform: 'translateX(-50%)' }}>{v === 0 ? '0' : `${v / 1000}k`}</div>
              ))}
            </div>
            <div style={{ width: 45 }} className="shrink-0 text-[0.52rem] text-slate-400 text-right">₽/м²</div>
          </div>

          {/* Summary cards */}
          <div className="grid grid-cols-4 gap-3 mt-5 pt-4 border-t border-slate-100">
            <div className="bg-blue-50 rounded-lg p-2.5 text-center">
              <div className="text-[0.55rem] text-blue-500 font-bold uppercase">P10 итого</div>
              <div className="text-[0.85rem] font-extrabold text-blue-700">{fmt(totalP10)} ₽/м²</div>
            </div>
            <div className="bg-emerald-50 rounded-lg p-2.5 text-center">
              <div className="text-[0.55rem] text-emerald-500 font-bold uppercase">Медиана</div>
              <div className="text-[0.85rem] font-extrabold text-emerald-700">{fmt(totalMedian)} ₽/м²</div>
            </div>
            <div className="bg-slate-100 rounded-lg p-2.5 text-center">
              <div className="text-[0.55rem] text-slate-500 font-bold uppercase">Среднее</div>
              <div className="text-[0.85rem] font-extrabold text-slate-700">{fmt(totalAvg)} ₽/м²</div>
            </div>
            <div className="bg-red-50 rounded-lg p-2.5 text-center">
              <div className="text-[0.55rem] text-red-500 font-bold uppercase">Объект проверки</div>
              <div className="text-[0.85rem] font-extrabold text-red-700">{fmt(totalRef)} ₽/м²</div>
            </div>
          </div>
        </div>
      )}
    </div>
  )
}

/* ===== AI CLASSIFICATION ===== */
function PgAI() {
  const [model, setModel] = useState<'gemini' | 'ollama'>('gemini')

  const classifications = [
    { input: 'Бетон В25 монолитных стен подземной части', l1: '4. Фундаменты и Конструкции подземной части', l2: '4.4 Монолитные ЖБК подземной части', l3: '4.4.1 Устр-во монолитных стен', l4: '4.4.1.1 Бетон B25, А500С, 80-110 кг/м³', confidence: 97 },
    { input: 'Кладка стен из газобетонных блоков D500', l1: '6. Общестроительные работы (АР)', l2: '6.5 Внутренние стены и перегородки', l3: '6.5.2 Кладка перегородок из газобетонных блоков', l4: '—', confidence: 95 },
    { input: 'Устройство навесного вент. фасада из керамогранита', l1: '6. Общестроительные работы (АР)', l2: '6.1 Фасадные работы', l3: '6.1.1 Навесные вентилируемые фасадные системы (НВФ)', l4: '—', confidence: 93 },
    { input: 'Прокладка кабеля ВВГнг-LS 3x2.5 в гофре', l1: '8. Внутренние инженерные системы (ВИС)', l2: '8.3 Системы электроснабжения (ЭОМ)', l3: '8.3.1 Силовое электрооборудование (ЭМ)', l4: '—', confidence: 91 },
    { input: 'Монтаж приточно-вытяжной установки', l1: '8. Внутренние инженерные системы (ВИС)', l2: '8.2 Системы ОВиК', l3: '8.2.2 Вентиляция общеобменная (В)', l4: '—', confidence: 78 },
    { input: 'Устройство бетонных полов с упрочнением MasterTop', l1: '7. Отделочные работы (АИ)', l2: '7.1 Отделка Паркинга', l3: '7.1.1 Устройство и отделка полов', l4: '7.1.1.3 Бетонные полы с упрочн. слоем', confidence: 94 },
    { input: 'Разработка грунта экскаватором с погрузкой', l1: '3. Земляные работы и Огражд. котлована', l2: '3.2 Разработка котлована', l3: '—', l4: '—', confidence: 64 },
    { input: 'Монтаж подвесного потолка Армстронг в офисах', l1: '7. Отделочные работы (АИ)', l2: '7.7 Отделка Коммерческих/Офисных помещ.', l3: '7.7.3 Устройство и отделка потолков', l4: '7.7.3.1 Подвесной потолок Армстронг', confidence: 96 },
  ]

  const confColor = (c: number) => {
    if (c >= 90) return 'bg-green-50 text-green-700 border-green-200'
    if (c >= 70) return 'bg-amber-50 text-amber-700 border-amber-200'
    return 'bg-red-50 text-red-700 border-red-200'
  }

  const pipelineSteps = [
    { label: 'Загрузка', emoji: '📥', done: true },
    { label: 'Парсинг', emoji: '📋', done: true },
    { label: 'AI-классификация', emoji: '🤖', done: true },
    { label: 'Валидация', emoji: '✅', done: true },
    { label: 'Экспорт', emoji: '📤', done: false },
  ]

  return (
    <div className="p-6">
      {/* Upload zone */}
      <div className="border-2 border-dashed rounded-xl p-5 text-center mb-5 transition-colors" style={{ borderColor: `${BRAND}40`, background: `${BRAND}05` }}>
        <div className="w-12 h-12 mx-auto mb-3 rounded-xl flex items-center justify-center" style={{ background: `${BRAND}15` }}>
          <div style={{ color: BRAND }}><I.Upload /></div>
        </div>
        <div className="text-[0.82rem] font-medium text-slate-700 mb-1">Загрузите XLSX-файл сметы</div>
        <div className="text-[0.7rem] text-slate-400">Перетащите файл или нажмите для выбора · .xlsx, .xls до 50 MB</div>
      </div>

      {/* Model selector + stats */}
      <div className="flex items-center justify-between mb-5">
        <div className="flex items-center gap-3">
          <div className="text-[0.72rem] text-slate-500 font-medium">Модель:</div>
          <div className="flex items-center bg-white border border-slate-200 rounded-lg overflow-hidden">
            <button onClick={() => setModel('gemini')} className={`px-3 py-1.5 text-[0.72rem] font-medium border-none cursor-pointer transition-colors ${model === 'gemini' ? 'bg-[#059669]/10 text-[#059669]' : 'bg-white text-slate-500 hover:bg-slate-50'}`}>✨ Gemini Pro</button>
            <button onClick={() => setModel('ollama')} className={`px-3 py-1.5 text-[0.72rem] font-medium border-none cursor-pointer transition-colors ${model === 'ollama' ? 'bg-[#059669]/10 text-[#059669]' : 'bg-white text-slate-500 hover:bg-slate-50'}`}>🦙 Ollama (local)</button>
          </div>
        </div>
        <div className="flex items-center gap-4">
          <div className="text-[0.72rem] text-slate-500"><span className="font-bold text-slate-800">847</span> позиций → <span className="font-bold text-green-600">812</span> классифицировано (95.9%)</div>
          <div className="text-[0.72rem] text-amber-500 font-medium">35 требуют проверки</div>
        </div>
      </div>

      {/* Pipeline */}
      <div className="bg-white rounded-xl border border-slate-200 p-4 mb-5">
        <div className="text-[0.72rem] font-semibold text-slate-700 mb-3">Конвейер обработки</div>
        <div className="flex items-center gap-1">
          {pipelineSteps.map((step, i) => (
            <div key={step.label} className="flex items-center gap-1 flex-1">
              <div className={`flex-1 flex items-center gap-2 px-3 py-2 rounded-lg border ${step.done ? 'bg-green-50 border-green-200' : 'bg-slate-50 border-slate-200'}`}>
                <span className="text-[0.8rem]">{step.emoji}</span>
                <span className={`text-[0.7rem] font-medium ${step.done ? 'text-green-700' : 'text-slate-400'}`}>{step.label}</span>
                {step.done && <span className="text-green-500 text-[0.7rem] ml-auto">✓</span>}
              </div>
              {i < pipelineSteps.length - 1 && <span className="text-slate-300 text-[0.8rem] shrink-0">→</span>}
            </div>
          ))}
        </div>
      </div>

      {/* Classification results table */}
      <div className="bg-white rounded-xl border border-slate-200 overflow-hidden">
        <table className="w-full">
          <thead>
            <tr className="text-[0.65rem] text-slate-400 uppercase tracking-wider bg-slate-50">
              <th className="text-left px-4 py-2.5 font-semibold" style={{ width: '22%' }}>Исходная позиция</th>
              <th className="text-left px-3 py-2.5 font-semibold">L1 · Раздел</th>
              <th className="text-left px-3 py-2.5 font-semibold">L2 · Группа</th>
              <th className="text-left px-3 py-2.5 font-semibold">L3 · Подгруппа</th>
              <th className="text-left px-3 py-2.5 font-semibold">L4 · Позиция</th>
              <th className="text-center px-3 py-2.5 font-semibold">Точность</th>
            </tr>
          </thead>
          <tbody>
            {classifications.map((c, i) => (
              <tr key={i} className={`border-t border-slate-100 text-[0.73rem] hover:bg-slate-50/50 ${i % 2 ? 'bg-slate-50/30' : ''}`}>
                <td className="px-4 py-2.5 text-slate-700 font-medium">{c.input}</td>
                <td className="px-3 py-2.5"><span className="px-1.5 py-0.5 rounded bg-emerald-50 text-emerald-700 text-[0.6rem] font-medium">{c.l1}</span></td>
                <td className="px-3 py-2.5"><span className="px-1.5 py-0.5 rounded bg-slate-100 text-slate-600 text-[0.6rem] font-medium">{c.l2}</span></td>
                <td className="px-3 py-2.5"><span className="px-1.5 py-0.5 rounded bg-slate-100 text-slate-600 text-[0.6rem] font-medium">{c.l3}</span></td>
                <td className="px-3 py-2.5">{c.l4 !== '—' ? <span className="px-1.5 py-0.5 rounded bg-blue-50 text-blue-600 text-[0.6rem] font-medium">{c.l4}</span> : <span className="text-[0.6rem] text-slate-300">—</span>}</td>
                <td className="px-3 py-2.5 text-center">
                  <span className={`inline-block px-2 py-0.5 rounded border text-[0.65rem] font-bold ${confColor(c.confidence)}`}>{c.confidence}%</span>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
      <div className="flex items-center justify-between mt-3">
        <span className="text-[0.72rem] text-slate-400">Показано 8 из 847 позиций · Классификатор: 14 разделов, 4 уровня</span>
        <button className="flex items-center gap-1.5 px-4 py-2 text-white rounded-lg text-[0.75rem] font-medium cursor-pointer border-none hover:opacity-90 transition-opacity" style={{ background: BRAND }}>
          <I.Download /> Экспорт результатов
        </button>
      </div>
    </div>
  )
}

/* ===== DEFLATORS ===== */
function PgDeflators() {
  const deflators = [
    { year: 2022, coeff: 1.000, cumulative: 1.000 },
    { year: 2023, coeff: 1.085, cumulative: 1.085 },
    { year: 2024, coeff: 1.047, cumulative: 1.136 },
    { year: 2025, coeff: 1.032, cumulative: 1.172 },
    { year: 2026, coeff: 1.025, cumulative: 1.202 },
  ]

  return (
    <div className="p-6">
      <div className="max-w-[800px]">
        {/* Info card */}
        <div className="bg-white rounded-xl border border-slate-200 p-5 mb-5" style={{ borderLeftWidth: 3, borderLeftColor: BRAND }}>
          <div className="text-[0.82rem] font-bold text-slate-800 mb-2">Что такое дефляторы?</div>
          <div className="text-[0.75rem] text-slate-600 leading-relaxed">
            Дефляторы — это индексы, отражающие изменение уровня цен в строительной отрасли по годам.
            Они применяются для приведения стоимости строительства разных лет к единой ценовой базе,
            что позволяет корректно сравнивать проекты, реализованные в разное время. Базовый год (2022)
            принимается за 1.000. Кумулятивный коэффициент рассчитывается как произведение всех
            годовых коэффициентов от базового года до текущего.
          </div>
        </div>

        {/* Deflator table */}
        <div className="bg-white rounded-xl border border-slate-200 overflow-hidden mb-5">
          <div className="flex items-center justify-between px-5 py-3 border-b border-slate-200 bg-slate-50">
            <div className="text-[0.82rem] font-bold text-slate-700">Таблица дефляторов</div>
            <span className="text-[0.68rem] text-slate-400">Базовый год: 2022</span>
          </div>
          <table className="w-full">
            <thead>
              <tr className="text-[0.65rem] text-slate-400 uppercase tracking-wider bg-slate-50/50">
                <th className="text-left px-5 py-2.5 font-semibold">Год</th>
                <th className="text-right px-5 py-2.5 font-semibold">Годовой коэффициент</th>
                <th className="text-right px-5 py-2.5 font-semibold">Кумулятивный</th>
                <th className="text-right px-5 py-2.5 font-semibold">Рост к базе</th>
              </tr>
            </thead>
            <tbody>
              {deflators.map((d) => (
                <tr key={d.year} className={`border-t border-slate-100 text-[0.78rem] hover:bg-slate-50/50 ${d.year === 2022 ? 'bg-[#059669]/5' : ''}`}>
                  <td className="px-5 py-3">
                    <div className="flex items-center gap-2">
                      <span className="font-bold text-slate-800">{d.year}</span>
                      {d.year === 2022 && <Badge color="green">Базовый</Badge>}
                      {d.year === 2026 && <Badge color="amber">Прогноз</Badge>}
                    </div>
                  </td>
                  <td className="text-right px-5 py-3 font-mono text-slate-700">{d.coeff.toFixed(3)}</td>
                  <td className="text-right px-5 py-3 font-mono font-bold text-slate-800">{d.cumulative.toFixed(3)}</td>
                  <td className="text-right px-5 py-3">
                    <span className={`font-mono text-[0.75rem] ${d.year === 2022 ? 'text-slate-400' : 'text-amber-600'}`}>
                      {d.year === 2022 ? '—' : `+${((d.cumulative - 1) * 100).toFixed(1)}%`}
                    </span>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>

        {/* Visual bar */}
        <div className="bg-white rounded-xl border border-slate-200 p-5 mb-5">
          <div className="text-[0.82rem] font-bold text-slate-800 mb-4">Динамика кумулятивного индекса</div>
          <div className="space-y-2.5">
            {deflators.map(d => (
              <div key={d.year} className="flex items-center gap-3">
                <span className="text-[0.75rem] font-bold text-slate-600 w-10">{d.year}</span>
                <div className="flex-1 h-6 bg-slate-100 rounded-full overflow-hidden">
                  <div className="h-full rounded-full transition-all duration-500 flex items-center justify-end pr-2" style={{ width: `${(d.cumulative / 1.25) * 100}%`, background: `linear-gradient(90deg, ${BRAND}, #34D399)` }}>
                    <span className="text-[0.6rem] font-bold text-white">{d.cumulative.toFixed(3)}</span>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>

        {/* Example */}
        <div className="bg-white rounded-xl border border-slate-200 p-5 mb-5">
          <div className="text-[0.82rem] font-bold text-slate-800 mb-3">Пример расчёта</div>
          <div className="bg-slate-50 rounded-xl p-4 text-[0.75rem] text-slate-600 leading-relaxed">
            <p className="mb-2">Стоимость объекта в ценах 2024 г.: <span className="font-bold text-slate-800">5 650 000 000 ₽</span></p>
            <p className="mb-2">Кумулятивный дефлятор 2024: <span className="font-bold text-slate-800">1.136</span></p>
            <p className="mb-2">Стоимость в базовых ценах 2022 г.: <span className="font-bold text-slate-800">5 650 000 000 / 1.136 = {fmt(Math.round(5650000000 / 1.136))} ₽</span></p>
            <p>Разница: <span className="font-bold text-amber-600">-{fmt(5650000000 - Math.round(5650000000 / 1.136))} ₽</span> (инфляционная составляющая)</p>
          </div>
        </div>

        <button className="px-5 py-2.5 text-white rounded-xl text-[0.8rem] font-semibold border-none cursor-pointer hover:opacity-90 transition-opacity flex items-center justify-center gap-2" style={{ background: BRAND }}>
          + Добавить
        </button>
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\DemoCostManager.tsx
====================================================================================================

====================================================================================================
FILE [20/52]: src\components\ProductCard.tsx
Size: 4,905 bytes
====================================================================================================

import { useState } from 'react'
import type { Product } from '../data/products'

const statusConfig = {
  production: { label: 'PRODUCTION', bg: 'bg-surface-3', text: 'text-muted' },
  pilot: { label: 'ПИЛОТ', bg: 'bg-surface-3', text: 'text-muted' },
  prototype: { label: 'ПРОТОТИП', bg: 'bg-surface-3', text: 'text-muted' },
}

export function ProductCard({ product, demo }: { product: Product; demo?: React.ReactNode }) {
  const [open, setOpen] = useState(false)
  const status = statusConfig[product.status]

  return (
    <div
      className="bg-surface border border-border rounded-2xl mb-3 transition-all hover:border-accent/30 hover:-translate-y-px hover:shadow-[0_2px_12px_rgba(79,124,255,0.06)] relative overflow-hidden"
    >
      {/* Accent stripe */}
      <div className="absolute left-0 top-0 bottom-0 w-[3px] bg-gradient-to-b from-accent/60 to-accent/10" />
      <button
        onClick={() => setOpen(!open)}
        className="w-full px-6 py-5 flex justify-between items-center gap-4 cursor-pointer text-left bg-transparent border-none pl-7"
      >
        <div className="flex-1 min-w-0">
          <div className="text-lg font-bold text-text-primary">{product.name}</div>
          <div className="text-sm text-muted mt-1">{product.oneliner}</div>
        </div>
        <div className="flex items-center gap-3 shrink-0">
          <span className={`px-2.5 py-0.5 rounded text-xs font-bold tracking-wide ${status.bg} ${status.text}`}>
            {status.label}
          </span>
          <span className={`px-3.5 py-1.5 rounded-lg text-sm font-semibold transition-all flex items-center gap-1.5 ${open ? 'bg-accent/15 text-accent' : 'bg-accent text-white shadow-md shadow-accent/25 hover:shadow-lg hover:shadow-accent/30'}`}>
            {open ? 'Свернуть' : 'Подробнее'}
            <span className={`text-xs transition-transform duration-300 ${open ? 'rotate-180' : ''}`}>&#9662;</span>
          </span>
        </div>
      </button>

      <div className={`product-detail ${open ? 'open' : ''}`}>
        <div className="product-detail-inner">
          <div className="px-6 pb-6 border-t border-border pl-7">
            {/* Metrics */}
            <div className="flex divide-x divide-border mt-5">
              {product.metrics.map((m, i) => (
                <div key={i} className="px-5 first:pl-0">
                  <div className="text-xl font-extrabold text-green">{m.value}</div>
                  <div className="text-xs text-muted mt-0.5">{m.label}</div>
                </div>
              ))}
            </div>

            {/* Pain → Solution → Result */}
            <div className="grid grid-cols-1 md:grid-cols-[1fr_auto_1fr_auto_1fr] gap-3 mt-5 items-stretch">
              <FlowBlock label="Задача" color="text-red" text={product.pain} />
              <span className="hidden md:flex items-center text-muted/40 text-lg">&rarr;</span>
              <FlowBlock label="Решение" color="text-accent" text={product.solution} />
              <span className="hidden md:flex items-center text-muted/40 text-lg">&rarr;</span>
              <FlowBlock label="Результат" color="text-green" text={product.result} />
            </div>

            {/* Tech tags */}
            <div className="flex flex-wrap gap-1.5 mt-4">
              {product.tech.map((t) => (
                <span
                  key={t}
                  className="px-2 py-0.5 bg-surface-3 border border-border rounded text-xs text-muted font-medium"
                >
                  {t}
                </span>
              ))}
            </div>

            {/* Inline demo */}
            {demo}

            {/* Demo CTA */}
            {!demo && (
              <div className="mt-4 p-4 bg-surface-2 rounded-lg border border-dashed border-border text-center">
                <p className="text-sm text-muted">{product.demoText}</p>
                <a
                  href={`mailto:KhromenokNV@mail.ru?subject=${encodeURIComponent(product.demoSubject)}`}
                  className="inline-block mt-2 px-5 py-2 bg-accent text-white rounded-md text-sm font-semibold hover:opacity-85 transition-opacity no-underline"
                  onClick={(e) => e.stopPropagation()}
                >
                  Запросить демо
                </a>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  )
}

function FlowBlock({ label, color, text }: { label: string; color: string; text: string }) {
  return (
    <div className="bg-surface-2 rounded-lg p-4">
      <div className={`text-xs font-bold uppercase tracking-wider mb-1.5 ${color}`}>
        {label}
      </div>
      <p className="text-sm text-muted leading-relaxed">{text}</p>
    </div>
  )
}

====================================================================================================
END: src\components\ProductCard.tsx
====================================================================================================

====================================================================================================
FILE [21/52]: src\components\Reveal.tsx
Size: 460 bytes
====================================================================================================

import { useReveal } from '../hooks/useReveal'

interface RevealProps {
  children: React.ReactNode
  stagger?: boolean
  className?: string
}

export function Reveal({ children, stagger, className = '' }: RevealProps) {
  const { ref, visible } = useReveal()

  return (
    <div
      ref={ref}
      className={`${stagger ? 'reveal-stagger' : 'reveal'} ${visible ? 'revealed' : ''} ${className}`}
    >
      {children}
    </div>
  )
}

====================================================================================================
END: src\components\Reveal.tsx
====================================================================================================


####################################################################################################
# DIR: src\components\sminex
####################################################################################################

====================================================================================================
FILE [22/52]: src\components\sminex\AnalyticsScreen.tsx
Size: 7,410 bytes
====================================================================================================

import { useState, useEffect } from 'react'
import { analyticsData } from '../../data/sminex'

const periods = ['Январь 2026', 'Февраль 2026', 'Март 2026']

// Muted accent colors for bars (one per day)
const barColors = ['#1D252D', '#2D3748', '#4A5568', '#1D252D', '#2D3748', '#8B7355', '#A09484']

export default function AnalyticsScreen() {
  const [periodIndex, setPeriodIndex] = useState(1) // February by default
  const maxDayCount = Math.max(...analyticsData.requestsByDay.map(d => d.count))
  const totalByType = analyticsData.requestsByType.reduce((sum, t) => sum + t.count, 0)

  let gradientParts: string[] = []
  let cumulative = 0
  for (const t of analyticsData.requestsByType) {
    const pct = (t.count / totalByType) * 100
    gradientParts.push(`${t.color} ${cumulative}% ${cumulative + pct}%`)
    cumulative += pct
  }
  const conicGradient = `conic-gradient(${gradientParts.join(', ')})`

  const cyclePeriod = () => {
    setPeriodIndex(prev => (prev + 1) % periods.length)
  }

  return (
    <div className="flex-1 overflow-y-auto animate-[fadeIn_0.2s_ease-out]">
      <div className="px-5 pt-4 pb-6 space-y-4">
        <div className="flex items-center justify-between">
          <h1 className="text-xl font-bold text-[#1D252D]">Аналитика</h1>
          <button
            onClick={cyclePeriod}
            className="bg-white rounded-full px-3.5 py-1.5 text-xs font-medium text-[#1D252D] shadow-sm border border-gray-100 transition-all hover:shadow-md active:scale-[0.97]"
          >
            {periods[periodIndex]}
          </button>
        </div>

        <div className="grid grid-cols-2 gap-3">
          <KpiCard label="Всего заявок" value={analyticsData.totalRequests} />
          <KpiCard label="Среднее закрытие" value={analyticsData.avgCloseTime} suffix=" ч" />
          <KpiCard label="Удовлетворённость" value={analyticsData.satisfaction} suffix="/5" accent />
          <KpiCard label="SLA соблюдение" value={analyticsData.slaCompliance} suffix="%" />
        </div>

        {/* Bar chart */}
        <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50">
          <p className="text-xs font-semibold text-[#1D252D]/50 mb-4">Заявки по дням недели</p>
          <div className="flex items-end gap-2 h-28">
            {analyticsData.requestsByDay.map((d, i) => (
              <div key={d.day} className="flex-1 flex flex-col items-center gap-1">
                <span className="text-[10px] font-medium text-[#1D252D]">{d.count}</span>
                <AnimatedBar height={(d.count / maxDayCount) * 100} delay={i * 80} color={barColors[i]} />
                <span className="text-[10px] text-[#1D252D]/40">{d.day}</span>
              </div>
            ))}
          </div>
        </div>

        {/* Donut chart */}
        <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50">
          <p className="text-xs font-semibold text-[#1D252D]/50 mb-4">Типы заявок</p>
          <div className="flex items-center gap-4">
            <div className="relative w-24 h-24 shrink-0">
              <div
                className="w-24 h-24 rounded-full"
                style={{ background: conicGradient }}
              />
              {/* Center hole for donut */}
              <div className="absolute inset-0 flex items-center justify-center">
                <div className="w-14 h-14 rounded-full bg-white flex items-center justify-center">
                  <span className="text-sm font-bold text-[#1D252D]">{totalByType}</span>
                </div>
              </div>
            </div>
            <div className="space-y-1.5 flex-1">
              {analyticsData.requestsByType.map(t => (
                <div key={t.type} className="flex items-center gap-2">
                  <div className="w-2.5 h-2.5 rounded-full shrink-0" style={{ backgroundColor: t.color }} />
                  <span className="text-[10px] text-[#1D252D]/70 flex-1">{t.type}</span>
                  <span className="text-[10px] font-medium text-[#1D252D]">{t.count}</span>
                </div>
              ))}
            </div>
          </div>
        </div>

        {/* Top categories */}
        <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50">
          <p className="text-xs font-semibold text-[#1D252D]/50 mb-3">Топ-3 категории проблем</p>
          <div className="space-y-3">
            {analyticsData.topCategories.map((cat, i) => (
              <div key={cat.category} className="flex items-center gap-3">
                <span className="text-sm font-bold text-[#1D252D]/20 w-5">{i + 1}</span>
                <div className="flex-1">
                  <div className="flex items-center justify-between mb-1">
                    <p className="text-xs font-medium text-[#1D252D]">{cat.category}</p>
                    <span className={`text-[10px] font-medium ${cat.trend > 0 ? 'text-red-500' : cat.trend < 0 ? 'text-green-500' : 'text-gray-400'}`}>
                      {cat.trend > 0 ? '+' : ''}{cat.trend}%
                    </span>
                  </div>
                  {/* Progress bar */}
                  <div className="h-1.5 bg-[#F5F1EC] rounded-full overflow-hidden">
                    <div
                      className="h-full bg-[#1D252D]/20 rounded-full transition-all duration-500"
                      style={{ width: `${(cat.count / analyticsData.topCategories[0].count) * 100}%` }}
                    />
                  </div>
                  <p className="text-[10px] text-[#1D252D]/40 mt-0.5">{cat.count} заявок</p>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  )
}

function AnimatedBar({ height, delay, color }: { height: number; delay: number; color: string }) {
  const [h, setH] = useState(0)
  useEffect(() => {
    const timer = setTimeout(() => setH(height), delay + 100)
    return () => clearTimeout(timer)
  }, [height, delay])
  return (
    <div
      className="w-full rounded-t-lg transition-all duration-500 ease-out"
      style={{ height: `${h}%`, backgroundColor: color }}
    />
  )
}

function KpiCard({ label, value, suffix, accent }: {
  label: string; value: number; suffix?: string; accent?: boolean
}) {
  const [display, setDisplay] = useState(0)
  useEffect(() => {
    if (value === 0) { setDisplay(0); return }
    const duration = 600
    const steps = 20
    const increment = value / steps
    let current = 0
    const timer = setInterval(() => {
      current += increment
      if (current >= value) { setDisplay(value); clearInterval(timer) }
      else setDisplay(Number.isInteger(value) ? Math.round(current) : Number(current.toFixed(1)))
    }, duration / steps)
    return () => clearInterval(timer)
  }, [value])

  return (
    <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50">
      <p className="text-[10px] text-[#1D252D]/50 font-medium mb-1">{label}</p>
      <p className={`text-2xl font-bold ${accent ? 'text-[#8B7355]' : 'text-[#1D252D]'}`}>
        {display}{suffix ?? ''}
      </p>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\AnalyticsScreen.tsx
====================================================================================================

====================================================================================================
FILE [23/52]: src\components\sminex\ArchitectureModal.tsx
Size: 5,357 bytes
====================================================================================================

import { X, Smartphone, Globe, Shield, Layers, Database, Server, GitBranch, Zap } from 'lucide-react'

interface ArchitectureModalProps {
  onClose: () => void
}

export default function ArchitectureModal({ onClose }: ArchitectureModalProps) {
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 animate-[fadeIn_0.3s_ease-out]">
      <div className="absolute inset-0 bg-[#1D252D]/95 backdrop-blur-sm" onClick={onClose} />
      <div className="relative w-full max-w-4xl max-h-[90vh] overflow-y-auto bg-[#F5F1EC] rounded-3xl p-6 md:p-8 animate-[scaleIn_0.3s_ease-out]">
        {/* Close button */}
        <button
          onClick={onClose}
          className="absolute top-4 right-4 text-[#1D252D]/40 hover:text-[#1D252D] transition-colors"
        >
          <X className="w-6 h-6" />
        </button>

        {/* Header */}
        <div className="text-center mb-8">
          <h2 className="text-2xl font-bold text-[#1D252D] mb-2">Архитектура CRM Sminex</h2>
          <p className="text-sm text-[#1D252D]/50">Микросервисная архитектура с event-driven подходом</p>
        </div>

        {/* Diagram */}
        <div className="space-y-2 mb-8">
          {/* Mobile App */}
          <div className="flex justify-center">
            <DiagramBlock icon={Smartphone} label="Mobile App" sub="React Native" color="bg-[#1D252D] text-white" />
          </div>
          <Arrow />

          {/* API Gateway */}
          <div className="flex justify-center">
            <DiagramBlock icon={Globe} label="API Gateway" sub="Kong / Nginx" color="bg-[#8B7355] text-white" />
          </div>
          <Arrow />

          {/* Microservices */}
          <div className="grid grid-cols-2 md:grid-cols-4 gap-2 max-w-2xl mx-auto">
            <DiagramBlock icon={Layers} label="Requests" sub="Service" color="bg-white text-[#1D252D]" small />
            <DiagramBlock icon={Shield} label="Users" sub="Service" color="bg-white text-[#1D252D]" small />
            <DiagramBlock icon={Zap} label="Notif." sub="Service" color="bg-white text-[#1D252D]" small />
            <DiagramBlock icon={Server} label="Analytics" sub="Service" color="bg-white text-[#1D252D]" small />
          </div>
          <Arrow />

          {/* Message Queue */}
          <div className="flex justify-center">
            <DiagramBlock icon={GitBranch} label="Message Queue" sub="Apache Kafka" color="bg-[#A09484] text-white" />
          </div>
          <Arrow />

          {/* Data layer */}
          <div className="grid grid-cols-2 gap-2 max-w-md mx-auto">
            <DiagramBlock icon={Database} label="PostgreSQL" sub="OLTP" color="bg-white text-[#1D252D]" small />
            <DiagramBlock icon={Database} label="Redis" sub="Cache" color="bg-white text-[#1D252D]" small />
          </div>
        </div>

        {/* Key decisions */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
          <DecisionCard
            title="Event Sourcing"
            description="Все изменения заявок сохраняются как цепочка событий — полная аудиторность и возможность восстановления состояния"
          />
          <DecisionCard
            title="CQRS"
            description="Разделение записи и чтения для оптимальной работы аналитики и отчётов без нагрузки на основную БД"
          />
          <DecisionCard
            title="Push-уведомления"
            description="Real-time доставка через WebSocket для активных сессий и FCM/APNs для фоновых уведомлений"
          />
          <DecisionCard
            title="Мультитенантность"
            description="Полная изоляция данных по жилым комплексам с единым API и ролевым разграничением доступа"
          />
        </div>
      </div>
    </div>
  )
}

function DiagramBlock({ icon: Icon, label, sub, color, small }: {
  icon: typeof Smartphone
  label: string
  sub: string
  color: string
  small?: boolean
}) {
  return (
    <div className={`${color} rounded-xl ${small ? 'p-3' : 'px-6 py-3'} flex items-center gap-2.5 shadow-sm border border-gray-100 justify-center`}>
      <Icon className={`${small ? 'w-4 h-4' : 'w-5 h-5'} shrink-0`} />
      <div className="text-center">
        <p className={`${small ? 'text-xs' : 'text-sm'} font-semibold leading-tight`}>{label}</p>
        <p className={`${small ? 'text-[9px]' : 'text-[10px]'} opacity-60`}>{sub}</p>
      </div>
    </div>
  )
}

function Arrow() {
  return <div className="text-center text-[#1D252D]/20 text-lg leading-none py-0.5">↓</div>
}

function DecisionCard({ title, description }: { title: string; description: string }) {
  return (
    <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50">
      <p className="text-sm font-bold text-[#1D252D] mb-1">{title}</p>
      <p className="text-xs text-[#1D252D]/60 leading-relaxed">{description}</p>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\ArchitectureModal.tsx
====================================================================================================

====================================================================================================
FILE [24/52]: src\components\sminex\AssignModal.tsx
Size: 2,577 bytes
====================================================================================================

import { useState } from 'react'
import { X, Wrench } from 'lucide-react'
import { executors } from '../../data/sminex'

interface AssignModalProps {
  onClose: () => void
  onAssign: (executor: string) => void
}

export default function AssignModal({ onClose, onAssign }: AssignModalProps) {
  const [selected, setSelected] = useState<string | null>(null)

  return (
    <div className="absolute inset-0 z-40 flex items-end">
      <div className="absolute inset-0 bg-black/40" onClick={onClose} />
      <div className="relative w-full bg-white rounded-t-3xl p-5 space-y-4 animate-[slideUp_0.3s_ease-out]">
        {/* Header */}
        <div className="flex items-center justify-between">
          <h2 className="text-base font-bold text-[#1D252D]">Назначить исполнителя</h2>
          <button onClick={onClose} className="text-[#1D252D]/40 hover:text-[#1D252D] transition-colors">
            <X className="w-5 h-5" />
          </button>
        </div>

        {/* Executor list */}
        <div className="space-y-2">
          {executors.map(exec => (
            <button
              key={exec.id}
              onClick={() => setSelected(exec.name)}
              className={`w-full flex items-center gap-3 p-3.5 rounded-xl transition-all active:scale-[0.97] ${
                selected === exec.name
                  ? 'bg-[#1D252D] text-white shadow-md'
                  : 'bg-gray-50 text-[#1D252D]'
              }`}
            >
              <div className={`w-8 h-8 rounded-full flex items-center justify-center ${
                selected === exec.name ? 'bg-white/20' : 'bg-[#1D252D]/10'
              }`}>
                <Wrench className="w-4 h-4" />
              </div>
              <span className="text-sm font-medium">{exec.name}</span>
              {selected === exec.name && (
                <div className="ml-auto w-5 h-5 rounded-full bg-white flex items-center justify-center">
                  <div className="w-2.5 h-2.5 rounded-full bg-[#1D252D]" />
                </div>
              )}
            </button>
          ))}
        </div>

        {/* Submit */}
        <button
          onClick={() => selected && onAssign(selected)}
          disabled={!selected}
          className="w-full bg-[#1D252D] text-white rounded-full py-3.5 text-sm font-semibold transition-all hover:opacity-90 active:scale-[0.97] disabled:opacity-40 disabled:active:scale-100"
        >
          Назначить
        </button>
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\AssignModal.tsx
====================================================================================================

====================================================================================================
FILE [25/52]: src\components\sminex\BillsScreen.tsx
Size: 6,934 bytes
====================================================================================================

import { useState } from 'react'
import { CreditCard, CheckCircle2, Receipt } from 'lucide-react'
import SubScreenHeader from './SubScreenHeader'
import { initialBills, paymentHistory, type Bill } from '../../data/sminex'

interface BillsScreenProps {
  onBack: () => void
  onToast: (msg: string) => void
}

export default function BillsScreen({ onBack, onToast }: BillsScreenProps) {
  const [bills, setBills] = useState<Bill[]>(initialBills)
  const [payingId, setPayingId] = useState<string | null>(null)

  const unpaid = bills.filter(b => !b.isPaid)
  const paid = bills.filter(b => b.isPaid)
  const totalUnpaid = unpaid.reduce((sum, b) => sum + b.amount, 0)

  const handlePay = (id: string) => {
    setPayingId(id)
    // Animate for 1.5s then mark as paid
    setTimeout(() => {
      setBills(prev => prev.map(b => b.id === id ? { ...b, isPaid: true } : b))
      setPayingId(null)
      onToast('Оплата прошла успешно')
    }, 1500)
  }

  const handlePayAll = () => {
    const unpaidIds = unpaid.map(b => b.id)
    setPayingId('all')
    setTimeout(() => {
      setBills(prev => prev.map(b => unpaidIds.includes(b.id) ? { ...b, isPaid: true } : b))
      setPayingId(null)
      onToast('Все счета оплачены')
    }, 1500)
  }

  const formatAmount = (amount: number) =>
    amount.toLocaleString('ru-RU') + ' ₽'

  return (
    <div className="flex-1 overflow-y-auto animate-[fadeIn_0.2s_ease-out]">
      <SubScreenHeader title="Счета" onBack={onBack} />

      <div className="px-5 pb-6 space-y-4">
        {/* Total card */}
        <div className="bg-[#1D252D] rounded-2xl p-5 text-white">
          <p className="text-[10px] text-white/50 font-medium mb-1">К оплате за февраль</p>
          <p className="text-3xl font-bold mb-4">{formatAmount(totalUnpaid)}</p>
          {unpaid.length > 0 && (
            <button
              onClick={handlePayAll}
              disabled={payingId !== null}
              className={`w-full py-3 rounded-full text-sm font-semibold transition-all active:scale-[0.97] ${
                payingId === 'all'
                  ? 'bg-green-500 text-white'
                  : 'bg-white text-[#1D252D] hover:bg-white/90'
              }`}
            >
              {payingId === 'all' ? (
                <span className="flex items-center justify-center gap-2">
                  <span className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" />
                  Обработка...
                </span>
              ) : (
                <span className="flex items-center justify-center gap-2">
                  <CreditCard className="w-4 h-4" />
                  Оплатить всё
                </span>
              )}
            </button>
          )}
          {unpaid.length === 0 && (
            <div className="flex items-center justify-center gap-2 text-green-400">
              <CheckCircle2 className="w-5 h-5" />
              <span className="text-sm font-semibold">Все счета оплачены</span>
            </div>
          )}
        </div>

        {/* Unpaid bills */}
        {unpaid.length > 0 && (
          <div>
            <h2 className="text-xs font-bold text-[#1D252D] mb-2">Детализация</h2>
            <div className="space-y-2">
              {unpaid.map(bill => (
                <div key={bill.id} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50 flex items-center gap-3">
                  <div className="w-8 h-8 rounded-full bg-[#F5F1EC] flex items-center justify-center">
                    <Receipt className="w-4 h-4 text-[#8B7355]" />
                  </div>
                  <div className="flex-1 min-w-0">
                    <p className="text-xs font-semibold text-[#1D252D]">{bill.name}</p>
                    <p className="text-xs text-[#1D252D]/50 font-medium">{formatAmount(bill.amount)}</p>
                  </div>
                  <button
                    onClick={() => handlePay(bill.id)}
                    disabled={payingId !== null}
                    className={`text-[10px] font-semibold px-3 py-1.5 rounded-full transition-all active:scale-[0.95] ${
                      payingId === bill.id
                        ? 'bg-green-500 text-white'
                        : 'bg-[#1D252D] text-white hover:opacity-90'
                    }`}
                  >
                    {payingId === bill.id ? (
                      <span className="flex items-center gap-1">
                        <span className="w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin" />
                      </span>
                    ) : 'Оплатить'}
                  </button>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Paid bills */}
        {paid.length > 0 && (
          <div>
            <h2 className="text-xs font-bold text-[#1D252D] mb-2">Оплачено</h2>
            <div className="space-y-2">
              {paid.map(bill => (
                <div key={bill.id} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50 flex items-center gap-3 opacity-60">
                  <div className="w-8 h-8 rounded-full bg-green-50 flex items-center justify-center">
                    <CheckCircle2 className="w-4 h-4 text-green-500" />
                  </div>
                  <div className="flex-1 min-w-0">
                    <p className="text-xs font-semibold text-[#1D252D]">{bill.name}</p>
                    <p className="text-xs text-[#1D252D]/50 font-medium">{formatAmount(bill.amount)}</p>
                  </div>
                  <span className="text-[10px] font-medium px-2 py-0.5 rounded-full bg-green-100 text-green-700">
                    Оплачено
                  </span>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Payment history */}
        <div>
          <h2 className="text-xs font-bold text-[#1D252D] mb-2">История платежей</h2>
          <div className="bg-white rounded-2xl shadow-sm border border-gray-50 divide-y divide-gray-50">
            {paymentHistory.map(payment => (
              <div key={payment.id} className="flex items-center justify-between px-4 py-3">
                <div>
                  <p className="text-xs font-medium text-[#1D252D]">{payment.month}</p>
                  <p className="text-[10px] text-[#1D252D]/40">{payment.date}</p>
                </div>
                <span className="text-xs font-bold text-[#1D252D]">{formatAmount(payment.amount)}</span>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\BillsScreen.tsx
====================================================================================================

====================================================================================================
FILE [26/52]: src\components\sminex\BookingScreen.tsx
Size: 7,362 bytes
====================================================================================================

import { useState, type ReactNode } from 'react'
import { Clock, MapPin, CheckCircle2, Calendar, Waves, Dumbbell, Briefcase, Mountain, Puzzle, Film } from 'lucide-react'
import SubScreenHeader from './SubScreenHeader'
import { amenities, type AmenityBooking } from '../../data/sminex'

const amenityIcons: Record<string, ReactNode> = {
  'waves': <Waves className="w-6 h-6" />,
  'dumbbell': <Dumbbell className="w-6 h-6" />,
  'briefcase': <Briefcase className="w-6 h-6" />,
  'mountain': <Mountain className="w-6 h-6" />,
  'puzzle': <Puzzle className="w-6 h-6" />,
  'film': <Film className="w-6 h-6" />,
}

interface BookingScreenProps {
  onBack: () => void
  onToast: (msg: string) => void
}

export default function BookingScreen({ onBack, onToast }: BookingScreenProps) {
  const [selectedAmenity, setSelectedAmenity] = useState<string | null>(null)
  const [bookings, setBookings] = useState<AmenityBooking[]>([])

  const selected = amenities.find(a => a.id === selectedAmenity)

  const handleBook = (amenityId: string, amenityName: string, slotTime: string) => {
    const newBooking: AmenityBooking = {
      id: `bk-${Date.now()}`,
      amenityId,
      amenityName,
      date: '26.02.2026',
      time: slotTime,
      status: 'upcoming',
    }
    setBookings(prev => [newBooking, ...prev])
    setSelectedAmenity(null)
    onToast(`${amenityName} забронировано на ${slotTime}`)
  }

  const formatPrice = (price: number) =>
    price === 0 ? 'Бесплатно' : `${price.toLocaleString('ru-RU')} ₽/ч`

  // Detail view for a selected amenity
  if (selected) {
    return (
      <div className="flex-1 overflow-y-auto animate-[fadeIn_0.2s_ease-out]">
        <SubScreenHeader title={selected.name} onBack={() => setSelectedAmenity(null)} />

        <div className="px-5 pb-6 space-y-4">
          {/* Amenity hero */}
          <div className="bg-gradient-to-br from-[#1D252D] to-[#2a3a4a] rounded-2xl p-5 text-white">
            <div className="w-14 h-14 rounded-2xl bg-white/10 flex items-center justify-center text-white mb-3">
              {amenityIcons[selected.icon]}
            </div>
            <h2 className="text-lg font-bold mb-1">{selected.name}</h2>
            <p className="text-xs text-white/60 mb-3">{selected.description}</p>
            <div className="flex gap-4">
              <div className="flex items-center gap-1.5">
                <MapPin className="w-3 h-3 text-white/40" />
                <span className="text-[10px] text-white/50">{selected.location}</span>
              </div>
              <div className="flex items-center gap-1.5">
                <Clock className="w-3 h-3 text-white/40" />
                <span className="text-[10px] text-white/50">{formatPrice(selected.pricePerHour)}</span>
              </div>
            </div>
          </div>

          {/* Date selector (static for demo) */}
          <div className="flex items-center gap-2 mb-1">
            <Calendar className="w-4 h-4 text-[#8B7355]" />
            <span className="text-xs font-bold text-[#1D252D]">26 февраля, среда</span>
          </div>

          {/* Time slots */}
          <div>
            <h3 className="text-xs font-bold text-[#1D252D] mb-2">Доступные слоты</h3>
            <div className="grid grid-cols-2 gap-2">
              {selected.slots.map(slot => (
                <button
                  key={slot.id}
                  onClick={() => slot.available && handleBook(selected.id, selected.name, slot.time)}
                  disabled={!slot.available}
                  className={`rounded-2xl p-3.5 text-center transition-all active:scale-[0.97] ${
                    slot.available
                      ? 'bg-white border border-gray-100 hover:border-[#8B7355] hover:shadow-md'
                      : 'bg-gray-50 border border-gray-100 opacity-40'
                  }`}
                >
                  <p className={`text-sm font-bold ${slot.available ? 'text-[#1D252D]' : 'text-gray-400'}`}>
                    {slot.time}
                  </p>
                  <p className={`text-[10px] ${slot.available ? 'text-green-600' : 'text-gray-400'}`}>
                    {slot.available ? 'Свободно' : 'Занято'}
                  </p>
                </button>
              ))}
            </div>
          </div>
        </div>
      </div>
    )
  }

  return (
    <div className="flex-1 overflow-y-auto animate-[fadeIn_0.2s_ease-out]">
      <SubScreenHeader title="Бронирование" onBack={onBack} />

      <div className="px-5 pb-6 space-y-4">
        {/* Active bookings */}
        {bookings.length > 0 && (
          <div>
            <h2 className="text-xs font-bold text-[#1D252D] mb-2">Мои бронирования</h2>
            <div className="space-y-2">
              {bookings.map(booking => (
                <div key={booking.id} className="bg-white rounded-2xl p-3.5 shadow-sm border border-gray-50 flex items-center gap-3">
                  <div className="w-8 h-8 rounded-full bg-green-50 flex items-center justify-center">
                    <CheckCircle2 className="w-4 h-4 text-green-500" />
                  </div>
                  <div className="flex-1 min-w-0">
                    <p className="text-xs font-semibold text-[#1D252D]">{booking.amenityName}</p>
                    <p className="text-[10px] text-[#1D252D]/40">{booking.date} · {booking.time}</p>
                  </div>
                  <span className="text-[10px] font-medium px-2 py-0.5 rounded-full bg-green-100 text-green-700">
                    Активно
                  </span>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Amenity grid */}
        <div>
          <h2 className="text-xs font-bold text-[#1D252D] mb-2">Удобства комплекса</h2>
          <div className="grid grid-cols-2 gap-2.5">
            {amenities.map(amenity => (
              <button
                key={amenity.id}
                onClick={() => setSelectedAmenity(amenity.id)}
                className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50 text-left transition-all hover:shadow-md active:scale-[0.97]"
              >
                <div className="w-10 h-10 rounded-xl bg-[#F5F1EC] flex items-center justify-center text-[#8B7355] mb-2">
                  {amenityIcons[amenity.icon]}
                </div>
                <p className="text-xs font-bold text-[#1D252D] mb-0.5">{amenity.name}</p>
                <p className="text-[10px] text-[#1D252D]/40 mb-2">{amenity.description}</p>
                <div className="flex items-center gap-1">
                  <span className="text-[10px] font-semibold text-[#8B7355]">{formatPrice(amenity.pricePerHour)}</span>
                </div>
                <div className="mt-1.5">
                  <span className="text-[9px] text-green-600 font-medium">
                    {amenity.slots.filter(s => s.available).length} слотов доступно
                  </span>
                </div>
              </button>
            ))}
          </div>
        </div>
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\BookingScreen.tsx
====================================================================================================

====================================================================================================
FILE [27/52]: src\components\sminex\BottomNav.tsx
Size: 3,654 bytes
====================================================================================================

import { useRef, useEffect, useState } from 'react'
import { Home, ListTodo, BarChart3, User, Bell } from 'lucide-react'
import { type UserRole } from '../../data/sminex'

export type Tab = 'dashboard' | 'requests' | 'analytics' | 'notifications' | 'profile'

interface BottomNavProps {
  active: Tab
  onNavigate: (tab: Tab) => void
  requestsBadge?: number
  notifBadge?: number
  userRole: UserRole
}

export default function BottomNav({ active, onNavigate, requestsBadge, notifBadge, userRole }: BottomNavProps) {
  const allTabs: { id: Tab; label: string; icon: typeof Home; roles: UserRole[] }[] = [
    { id: 'dashboard', label: 'Главная', icon: Home, roles: ['resident', 'manager', 'director'] },
    { id: 'requests', label: userRole === 'resident' ? 'Мои заявки' : 'Заявки', icon: ListTodo, roles: ['resident', 'manager', 'director'] },
    { id: 'notifications', label: 'Уведомления', icon: Bell, roles: ['resident'] },
    { id: 'analytics', label: 'Аналитика', icon: BarChart3, roles: ['manager', 'director'] },
    { id: 'profile', label: 'Профиль', icon: User, roles: ['resident', 'manager', 'director'] },
  ]

  const tabs = allTabs.filter(t => t.roles.includes(userRole))
  const activeIndex = tabs.findIndex(t => t.id === active)

  const navRef = useRef<HTMLElement>(null)
  const [indicator, setIndicator] = useState({ left: 0, width: 0 })

  useEffect(() => {
    if (!navRef.current || activeIndex < 0) return
    const buttons = navRef.current.querySelectorAll<HTMLButtonElement>('[data-tab]')
    const btn = buttons[activeIndex]
    if (!btn) return
    const navRect = navRef.current.getBoundingClientRect()
    const btnRect = btn.getBoundingClientRect()
    setIndicator({
      left: btnRect.left - navRect.left,
      width: btnRect.width,
    })
  }, [activeIndex, tabs.length])

  return (
    <nav ref={navRef} className="flex items-center justify-around bg-white/95 backdrop-blur-sm border-t border-gray-100/80 px-2 py-2 shrink-0 relative">
      {/* Sliding indicator */}
      {indicator.width > 0 && (
        <div
          className="absolute top-1.5 h-[calc(100%-12px)] bg-[#F5F1EC] rounded-xl transition-all duration-300 ease-out"
          style={{ left: indicator.left, width: indicator.width }}
        />
      )}

      {tabs.map(tab => {
        const isActive = active === tab.id
        const Icon = tab.icon
        const badge = tab.id === 'requests' ? requestsBadge : tab.id === 'notifications' ? notifBadge : undefined
        return (
          <button
            key={tab.id}
            data-tab={tab.id}
            onClick={() => onNavigate(tab.id)}
            className={`flex flex-col items-center gap-0.5 px-3 py-1 rounded-xl transition-all duration-200 relative z-10 ${
              isActive ? 'text-[#1D252D]' : 'text-gray-400'
            }`}
          >
            <Icon
              className={`w-6 h-6 transition-transform duration-200 ${isActive ? 'scale-105' : 'scale-100'}`}
              fill={isActive ? 'currentColor' : 'none'}
              strokeWidth={1.5}
            />
            {badge !== undefined && badge > 0 && (
              <span className="absolute -top-0.5 right-1 bg-red-500 text-white text-[10px] font-semibold rounded-full w-4 h-4 flex items-center justify-center">
                {badge}
              </span>
            )}
            <span className={`text-[10px] font-medium transition-all duration-200 ${isActive ? 'text-[#1D252D]' : ''}`}>{tab.label}</span>
          </button>
        )
      })}
    </nav>
  )
}

====================================================================================================
END: src\components\sminex\BottomNav.tsx
====================================================================================================

====================================================================================================
FILE [28/52]: src\components\sminex\CamerasScreen.tsx
Size: 4,659 bytes
====================================================================================================

import { useState } from 'react'
import { Video, X, Maximize2 } from 'lucide-react'
import SubScreenHeader from './SubScreenHeader'
import { cameras } from '../../data/sminex'

interface CamerasScreenProps {
  onBack: () => void
}

export default function CamerasScreen({ onBack }: CamerasScreenProps) {
  const [fullscreenCam, setFullscreenCam] = useState<string | null>(null)

  const selectedCamera = cameras.find(c => c.id === fullscreenCam)

  if (fullscreenCam && selectedCamera) {
    return (
      <div className="flex-1 flex flex-col animate-[fadeIn_0.2s_ease-out]">
        {/* Fullscreen camera view */}
        <div
          className="flex-1 bg-gradient-to-br from-[#1D252D] to-[#2a3a4a] relative flex items-center justify-center cursor-pointer"
          onClick={() => setFullscreenCam(null)}
        >
          <Video className="w-16 h-16 text-white/10" />

          {/* Top bar */}
          <div className="absolute top-0 left-0 right-0 p-4 flex items-center justify-between">
            <div className="flex items-center gap-2">
              {selectedCamera.isLive && (
                <div className="flex items-center gap-1.5 bg-black/40 rounded-full px-2.5 py-1">
                  <span className="w-2 h-2 rounded-full bg-red-500 animate-pulse" />
                  <span className="text-[10px] font-bold text-white">LIVE</span>
                </div>
              )}
              {selectedCamera.isRecording && (
                <div className="flex items-center gap-1 bg-black/40 rounded-full px-2.5 py-1">
                  <span className="w-1.5 h-1.5 rounded-full bg-red-500" />
                  <span className="text-[10px] font-bold text-white">REC</span>
                </div>
              )}
            </div>
            <button
              onClick={(e) => { e.stopPropagation(); setFullscreenCam(null) }}
              className="w-8 h-8 rounded-full bg-black/40 flex items-center justify-center text-white"
            >
              <X className="w-4 h-4" />
            </button>
          </div>

          {/* Camera info */}
          <div className="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/60 to-transparent">
            <p className="text-sm font-semibold text-white">{selectedCamera.name}</p>
            <p className="text-xs text-white/50">{selectedCamera.location}</p>
          </div>
        </div>
      </div>
    )
  }

  return (
    <div className="flex-1 overflow-y-auto animate-[fadeIn_0.2s_ease-out]">
      <SubScreenHeader title="Камеры" onBack={onBack} />

      <div className="px-5 pb-6">
        <div className="grid grid-cols-2 gap-3">
          {cameras.map(cam => (
            <button
              key={cam.id}
              onClick={() => setFullscreenCam(cam.id)}
              className="relative rounded-2xl overflow-hidden h-32 bg-gradient-to-br from-[#1D252D] to-[#3a4a5a] flex items-center justify-center group transition-transform active:scale-[0.97]"
            >
              <Video className="w-8 h-8 text-white/15" />

              {/* Badges */}
              <div className="absolute top-2 left-2 flex items-center gap-1">
                {cam.isLive && (
                  <div className="flex items-center gap-1 bg-black/50 rounded-full px-1.5 py-0.5">
                    <span className="w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse" />
                    <span className="text-[8px] font-bold text-white">LIVE</span>
                  </div>
                )}
                {cam.isRecording && (
                  <div className="flex items-center gap-0.5 bg-black/50 rounded-full px-1.5 py-0.5">
                    <span className="w-1 h-1 rounded-full bg-red-500" />
                    <span className="text-[8px] font-bold text-white">REC</span>
                  </div>
                )}
              </div>

              {/* Expand icon */}
              <div className="absolute top-2 right-2 w-6 h-6 rounded-full bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                <Maximize2 className="w-3 h-3 text-white" />
              </div>

              {/* Label */}
              <div className="absolute bottom-0 left-0 right-0 p-2.5 bg-gradient-to-t from-black/60 to-transparent">
                <p className="text-xs font-semibold text-white">{cam.name}</p>
                <p className="text-[9px] text-white/50">{cam.location}</p>
              </div>
            </button>
          ))}
        </div>
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\CamerasScreen.tsx
====================================================================================================

====================================================================================================
FILE [29/52]: src\components\sminex\CreateRequestModal.tsx
Size: 4,705 bytes
====================================================================================================

import { useState } from 'react'
import { X, Camera } from 'lucide-react'
import { requestTypes, requestTypeIcons, type Priority } from '../../data/sminex'

interface CreateRequestModalProps {
  onClose: () => void
  onSubmit: (data: { type: string; description: string; priority: Priority }) => void
}

export default function CreateRequestModal({ onClose, onSubmit }: CreateRequestModalProps) {
  const [type, setType] = useState(requestTypes[0])
  const [description, setDescription] = useState('')
  const [priority, setPriority] = useState<Priority>('medium')

  const handleSubmit = () => {
    if (!description.trim()) return
    onSubmit({ type, description: description.trim(), priority })
  }

  return (
    <div className="absolute inset-0 z-40 flex items-end">
      <div className="absolute inset-0 bg-black/40" onClick={onClose} />
      <div className="relative w-full bg-white rounded-t-3xl p-5 space-y-4 animate-[slideUp_0.3s_ease-out] max-h-[85%] overflow-y-auto">
        {/* Header */}
        <div className="flex items-center justify-between">
          <h2 className="text-base font-bold text-[#1D252D]">Новая заявка</h2>
          <button onClick={onClose} className="text-[#1D252D]/40 hover:text-[#1D252D] transition-colors">
            <X className="w-5 h-5" />
          </button>
        </div>

        {/* Type selector */}
        <div>
          <label className="text-xs font-semibold text-[#1D252D]/50 mb-2 block">Тип проблемы</label>
          <div className="grid grid-cols-4 gap-2">
            {requestTypes.map(t => {
              const Icon = requestTypeIcons[t]
              const isActive = type === t
              return (
                <button
                  key={t}
                  onClick={() => setType(t)}
                  className={`flex flex-col items-center gap-1.5 p-2.5 rounded-xl text-center transition-all active:scale-[0.97] ${
                    isActive ? 'bg-[#1D252D] text-white shadow-md' : 'bg-gray-50 text-[#1D252D]/60'
                  }`}
                >
                  {Icon && <Icon className={`w-4 h-4 ${isActive ? 'text-white' : ''}`} />}
                  <span className="text-[9px] font-medium leading-tight">{t}</span>
                </button>
              )
            })}
          </div>
        </div>

        {/* Description */}
        <div>
          <label className="text-xs font-semibold text-[#1D252D]/50 mb-2 block">Описание</label>
          <textarea
            value={description}
            onChange={e => setDescription(e.target.value.slice(0, 200))}
            placeholder="Опишите проблему подробнее..."
            rows={3}
            className="w-full bg-gray-50 rounded-xl px-4 py-3 text-sm text-[#1D252D] placeholder:text-[#1D252D]/30 border border-gray-100 focus:outline-none focus:ring-2 focus:ring-[#8B7355]/30 resize-none"
          />
          <p className="text-[10px] text-[#1D252D]/30 text-right mt-1">{description.length}/200</p>
        </div>

        {/* Priority */}
        <div>
          <label className="text-xs font-semibold text-[#1D252D]/50 mb-2 block">Приоритет</label>
          <div className="flex gap-2">
            {(['low', 'medium', 'high'] as Priority[]).map(p => (
              <button
                key={p}
                onClick={() => setPriority(p)}
                className={`flex-1 py-2 rounded-full text-xs font-medium transition-all active:scale-[0.97] ${
                  priority === p
                    ? 'bg-[#1D252D] text-white'
                    : 'bg-gray-50 text-[#1D252D]/60 border border-gray-100'
                }`}
              >
                {p === 'low' ? 'Низкий' : p === 'medium' ? 'Средний' : 'Высокий'}
              </button>
            ))}
          </div>
        </div>

        {/* Photo stub */}
        <button className="w-full flex items-center justify-center gap-2 py-3 rounded-xl border border-dashed border-gray-200 text-[#1D252D]/40 text-xs font-medium transition-colors hover:border-gray-300 active:scale-[0.97]">
          <Camera className="w-4 h-4" />
          Добавить фото
        </button>

        {/* Submit */}
        <button
          onClick={handleSubmit}
          disabled={!description.trim()}
          className="w-full bg-[#1D252D] text-white rounded-full py-3.5 text-sm font-semibold transition-all hover:opacity-90 active:scale-[0.97] disabled:opacity-40 disabled:active:scale-100"
        >
          Отправить
        </button>
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\CreateRequestModal.tsx
====================================================================================================

====================================================================================================
FILE [30/52]: src\components\sminex\DashboardScreen.tsx
Size: 17,331 bytes
====================================================================================================

import { useState, useEffect } from 'react'
import { Plus, FileText, TrendingUp, TrendingDown, Video, Camera, Home, Sparkles, Receipt, Car, CloudSun, LayoutGrid, CalendarCheck, Package, Star, ChevronDown } from 'lucide-react'
import { dashboardMetrics, complexes, statusColors, statusLabels, type ServiceRequest, type UserProfile, type SubScreen, type OwnedProperty } from '../../data/sminex'
import ProjectSelector from './ProjectSelector'

interface DashboardScreenProps {
  requests: ServiceRequest[]
  user: UserProfile
  selectedComplex: string | null
  onSelectComplex: (id: string | null) => void
  onOpenRequest: (request: ServiceRequest) => void
  onNavigateRequests: () => void
  onCreateRequest: () => void
  onOpenSubScreen?: (screen: SubScreen) => void
  activePropertyId?: string
  onSelectProperty?: (id: string) => void
}

export default function DashboardScreen({
  requests, user, selectedComplex, onSelectComplex,
  onOpenRequest, onNavigateRequests, onCreateRequest, onOpenSubScreen,
  activePropertyId, onSelectProperty,
}: DashboardScreenProps) {
  const filtered = selectedComplex
    ? requests.filter(r => r.complexId === selectedComplex)
    : requests

  if (user.role === 'resident') {
    return (
      <ResidentDashboard
        requests={filtered}
        user={user}
        onOpenRequest={onOpenRequest}
        onCreateRequest={onCreateRequest}
        onOpenSubScreen={onOpenSubScreen}
        activePropertyId={activePropertyId}
        onSelectProperty={onSelectProperty}
      />
    )
  }

  return (
    <ManagerDashboard
      requests={filtered}
      user={user}
      selectedComplex={selectedComplex}
      onSelectComplex={onSelectComplex}
      onOpenRequest={onOpenRequest}
      onNavigateRequests={onNavigateRequests}
      onCreateRequest={onCreateRequest}
    />
  )
}

function ResidentDashboard({ requests, user, onOpenRequest, onCreateRequest, onOpenSubScreen, activePropertyId, onSelectProperty }: {
  requests: ServiceRequest[]
  user: UserProfile
  onOpenRequest: (r: ServiceRequest) => void
  onCreateRequest: () => void
  onOpenSubScreen?: (screen: SubScreen) => void
  activePropertyId?: string
  onSelectProperty?: (id: string) => void
}) {
  const [showPropertyPicker, setShowPropertyPicker] = useState(false)

  const myRequests = requests.filter(r => r.residentId === user.id || r.resident === user.name)
  const latestTwo = [...myRequests].sort((a, b) => b.number - a.number).slice(0, 2)

  const properties = user.properties ?? []
  const activeProperty: OwnedProperty | undefined = properties.find(p => p.id === activePropertyId) ?? properties[0]

  const mainTiles: { icon: React.ReactNode; label: string; screen: SubScreen; iconBg: string; iconColor: string }[] = [
    { icon: <Video className="w-5 h-5" />, label: 'Домофон', screen: 'intercom', iconBg: 'bg-blue-50', iconColor: 'text-blue-600' },
    { icon: <Camera className="w-5 h-5" />, label: 'Камеры', screen: 'cameras', iconBg: 'bg-slate-100', iconColor: 'text-slate-600' },
    { icon: <Home className="w-5 h-5" />, label: 'Умный дом', screen: 'smart-home', iconBg: 'bg-amber-50', iconColor: 'text-amber-600' },
    { icon: <Sparkles className="w-5 h-5" />, label: 'Услуги', screen: 'services', iconBg: 'bg-violet-50', iconColor: 'text-violet-600' },
    { icon: <Receipt className="w-5 h-5" />, label: 'Счета', screen: 'bills', iconBg: 'bg-emerald-50', iconColor: 'text-emerald-600' },
    { icon: <Car className="w-5 h-5" />, label: 'Парковка', screen: 'parking', iconBg: 'bg-orange-50', iconColor: 'text-orange-600' },
  ]

  const extraTiles: { icon: React.ReactNode; label: string; screen: SubScreen; accent?: boolean }[] = [
    { icon: <Star className="w-4 h-4" />, label: 'Привилегии', screen: 'privileges', accent: true },
    { icon: <LayoutGrid className="w-4 h-4" />, label: 'Схема', screen: 'floor-plan' },
    { icon: <CalendarCheck className="w-4 h-4" />, label: 'Бронь', screen: 'booking' },
    { icon: <Package className="w-4 h-4" />, label: 'Посылки', screen: 'packages' },
  ]

  return (
    <div className="flex-1 overflow-y-auto animate-[fadeIn_0.2s_ease-out]">
      <div className="px-5 pt-4 pb-6 space-y-4">
        {/* Header: greeting + weather + avatar */}
        <div className="flex items-center justify-between">
          <div>
            <div className="flex items-center gap-2 mb-0.5">
              <p className="text-[#1D252D]/50 text-xs font-medium">26 февраля</p>
              <span className="text-[#1D252D]/30 text-xs">·</span>
              <div className="flex items-center gap-1">
                <CloudSun className="w-3.5 h-3.5 text-amber-500" />
                <span className="text-xs font-medium text-[#1D252D]/50">−3°C</span>
              </div>
            </div>
            <h1 className="text-xl font-bold text-[#1D252D]">Здравствуйте, {user.name.split(' ')[0]}</h1>
          </div>
          <div className="w-10 h-10 rounded-full bg-[#1D252D] flex items-center justify-center text-white font-bold text-sm">
            {user.initials}
          </div>
        </div>

        {/* Multi-apartment switcher */}
        {properties.length > 1 && activeProperty && (
          <div className="relative">
            <button
              onClick={() => setShowPropertyPicker(!showPropertyPicker)}
              className="w-full bg-white rounded-2xl p-3 shadow-sm border border-gray-100 flex items-center gap-3 transition-all hover:shadow-md active:scale-[0.99]"
            >
              <div className="w-9 h-9 rounded-xl bg-[#F5F1EC] flex items-center justify-center text-[#8B7355] text-xs font-bold shrink-0">
                {activeProperty.apartment}
              </div>
              <div className="flex-1 text-left min-w-0">
                <p className="text-xs font-bold text-[#1D252D] truncate">{activeProperty.complexName} · кв. {activeProperty.apartment}</p>
                <p className="text-[10px] text-[#1D252D]/40">{activeProperty.typeLabel} · {activeProperty.area} м²</p>
              </div>
              <ChevronDown className={`w-4 h-4 text-[#1D252D]/30 transition-transform ${showPropertyPicker ? 'rotate-180' : ''}`} />
            </button>

            {showPropertyPicker && (
              <div className="absolute top-full left-0 right-0 mt-1 bg-white rounded-2xl shadow-lg border border-gray-100 z-10 overflow-hidden animate-[fadeIn_0.1s_ease-out]">
                {properties.map(prop => (
                  <button
                    key={prop.id}
                    onClick={() => { onSelectProperty?.(prop.id); setShowPropertyPicker(false) }}
                    className={`w-full flex items-center gap-3 px-3 py-2.5 transition-colors ${
                      prop.id === activeProperty.id ? 'bg-[#F5F1EC]' : 'hover:bg-gray-50'
                    }`}
                  >
                    <div className={`w-8 h-8 rounded-lg flex items-center justify-center text-[10px] font-bold shrink-0 ${
                      prop.id === activeProperty.id ? 'bg-[#1D252D] text-white' : 'bg-[#F5F1EC] text-[#8B7355]'
                    }`}>
                      {prop.apartment.slice(0, 3)}
                    </div>
                    <div className="text-left">
                      <p className="text-xs font-semibold text-[#1D252D]">{prop.complexName} · кв. {prop.apartment}</p>
                      <p className="text-[10px] text-[#1D252D]/40">{prop.typeLabel} · {prop.area} м²</p>
                    </div>
                  </button>
                ))}
              </div>
            )}
          </div>
        )}

        {/* Main service grid 2×3 */}
        <div className="grid grid-cols-3 gap-2.5">
          {mainTiles.map((tile, i) => (
            <button
              key={tile.label}
              onClick={() => onOpenSubScreen?.(tile.screen)}
              className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50 flex flex-col items-center gap-2 transition-all hover:shadow-md active:scale-[0.95] animate-[fadeIn_0.3s_ease-out_both]"
              style={{ animationDelay: `${i * 50}ms` }}
            >
              <div className={`w-10 h-10 rounded-xl ${tile.iconBg} flex items-center justify-center ${tile.iconColor} transition-transform duration-200`}>
                {tile.icon}
              </div>
              <span className="text-[11px] font-semibold text-[#1D252D]">{tile.label}</span>
            </button>
          ))}
        </div>

        {/* Extra services — horizontal scroll */}
        <div className="flex gap-2 overflow-x-auto pb-1 -mx-5 px-5 scrollbar-hide">
          {extraTiles.map(tile => (
            <button
              key={tile.label}
              onClick={() => onOpenSubScreen?.(tile.screen)}
              className={`shrink-0 flex items-center gap-2 rounded-full px-4 py-2.5 transition-all active:scale-[0.97] ${
                tile.accent
                  ? 'bg-gradient-to-r from-[#1D252D] to-[#8B7355] text-white'
                  : 'bg-white text-[#1D252D] border border-gray-100 shadow-sm'
              }`}
            >
              <span className={tile.accent ? 'text-amber-300' : 'text-[#8B7355]'}>{tile.icon}</span>
              <span className="text-xs font-semibold">{tile.label}</span>
            </button>
          ))}
        </div>

        {/* New request button */}
        <button
          onClick={onCreateRequest}
          className="w-full bg-[#1D252D] text-white rounded-full py-3 text-sm font-semibold transition-opacity hover:opacity-90 flex items-center justify-center gap-2 active:scale-[0.97]"
        >
          <Plus className="w-4 h-4" />
          Новая заявка
        </button>

        {/* Latest 2 requests */}
        {latestTwo.length > 0 && (
          <div>
            <h2 className="text-sm font-bold text-[#1D252D] mb-2">Последние заявки</h2>
            <div className="space-y-2">
              {latestTwo.map((req, i) => (
                <button
                  key={req.id}
                  onClick={() => onOpenRequest(req)}
                  className="w-full bg-white rounded-2xl p-3.5 text-left shadow-sm border border-gray-50 transition-shadow hover:shadow-md animate-[fadeIn_0.2s_ease-out]"
                  style={{ animationDelay: `${i * 50}ms` }}
                >
                  <div className="flex items-start justify-between mb-1">
                    <div className="flex items-center gap-2">
                      <span className="text-xs font-bold text-[#1D252D]">#{req.number}</span>
                      <span className="text-xs text-[#1D252D]/50">{req.type}</span>
                    </div>
                    <span className={`text-[10px] font-medium px-2 py-0.5 rounded-full ${statusColors[req.status]}`}>
                      {statusLabels[req.status]}
                    </span>
                  </div>
                  <p className="text-xs text-[#1D252D]/70 line-clamp-1">{req.description}</p>
                </button>
              ))}
            </div>
          </div>
        )}
      </div>
    </div>
  )
}

function ManagerDashboard({
  requests, user, selectedComplex, onSelectComplex,
  onOpenRequest, onNavigateRequests, onCreateRequest,
}: {
  requests: ServiceRequest[]
  user: UserProfile
  selectedComplex: string | null
  onSelectComplex: (id: string | null) => void
  onOpenRequest: (r: ServiceRequest) => void
  onNavigateRequests: () => void
  onCreateRequest: () => void
}) {
  const latestRequests = [...requests].sort((a, b) => b.number - a.number).slice(0, 3)
  const getComplexName = (id: string) => complexes.find(c => c.id === id)?.name ?? id
  const firstName = user.name.split(' ')[0]

  return (
    <div className="flex-1 overflow-y-auto animate-[fadeIn_0.2s_ease-out]">
      <div className="px-5 pt-4 pb-6 space-y-5">
        <div className="flex items-center justify-between">
          <div>
            <p className="text-[#1D252D]/50 text-xs font-medium">26 февраля 2026</p>
            <h1 className="text-xl font-bold text-[#1D252D]">Добрый день, {firstName}</h1>
          </div>
          <div className="w-10 h-10 rounded-full bg-[#1D252D] flex items-center justify-center text-white font-bold text-sm">
            {user.initials}
          </div>
        </div>

        {user.role === 'director' && (
          <ProjectSelector selected={selectedComplex} onSelect={onSelectComplex} />
        )}

        <div className="grid grid-cols-2 gap-3">
          <MetricCard label="Новых заявок" value={dashboardMetrics.newRequests} trend={dashboardMetrics.newRequestsTrend} suffix="" />
          <MetricCard label="Среднее время ответа" value={dashboardMetrics.avgResponseTime} trend={dashboardMetrics.avgResponseTrend} suffix=" ч" />
          <MetricCard label="SLA выполнение" value={dashboardMetrics.slaCompliance} trend={dashboardMetrics.slaTrend} suffix="%" />
          <MetricCard label="Просроченных" value={dashboardMetrics.overdue} trend={dashboardMetrics.overdueTrend} suffix="" alert={dashboardMetrics.overdue > 0} />
        </div>

        <div className="flex gap-3">
          <button
            onClick={onCreateRequest}
            className="flex-1 bg-[#1D252D] text-white rounded-full py-3 text-sm font-semibold transition-opacity hover:opacity-90 flex items-center justify-center gap-2 active:scale-[0.97]"
          >
            <Plus className="w-4 h-4" />
            Создать заявку
          </button>
          <button className="flex-1 bg-white text-[#1D252D] rounded-full py-3 text-sm font-semibold border border-gray-200 transition-colors hover:bg-gray-50 flex items-center justify-center gap-2 active:scale-[0.97]">
            <FileText className="w-4 h-4" />
            Отчёт за неделю
          </button>
        </div>

        <div>
          <div className="flex items-center justify-between mb-3">
            <h2 className="text-sm font-bold text-[#1D252D]">Последние заявки</h2>
            <button onClick={onNavigateRequests} className="text-xs text-[#8B7355] font-medium">Все заявки →</button>
          </div>
          <div className="space-y-2.5">
            {latestRequests.map((req, i) => (
              <button
                key={req.id}
                onClick={() => onOpenRequest(req)}
                className="w-full bg-white rounded-2xl p-4 text-left shadow-sm border border-gray-50 transition-shadow hover:shadow-md animate-[fadeIn_0.2s_ease-out]"
                style={{ animationDelay: `${i * 50}ms` }}
              >
                <div className="flex items-start justify-between mb-1.5">
                  <div className="flex items-center gap-2">
                    <span className="text-xs font-bold text-[#1D252D]">#{req.number}</span>
                    <span className="text-xs text-[#1D252D]/50">{req.type}</span>
                  </div>
                  <span className={`text-[10px] font-medium px-2 py-0.5 rounded-full ${statusColors[req.status]}`}>
                    {statusLabels[req.status]}
                  </span>
                </div>
                <p className="text-xs text-[#1D252D]/70 line-clamp-1">{req.description}</p>
                <p className="text-[10px] text-[#1D252D]/40 mt-1.5">{getComplexName(req.complexId)} · кв. {req.apartment}</p>
              </button>
            ))}
          </div>
        </div>
      </div>
    </div>
  )
}

function MetricCard({ label, value, trend, suffix, alert }: {
  label: string; value: number; trend: number; suffix: string; alert?: boolean
}) {
  const [display, setDisplay] = useState(0)
  useEffect(() => {
    if (value === 0) { setDisplay(0); return }
    const duration = 600
    const steps = 20
    const increment = value / steps
    let current = 0
    const timer = setInterval(() => {
      current += increment
      if (current >= value) { setDisplay(value); clearInterval(timer) }
      else setDisplay(Number.isInteger(value) ? Math.round(current) : Number(current.toFixed(1)))
    }, duration / steps)
    return () => clearInterval(timer)
  }, [value])

  return (
    <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50">
      <p className="text-[10px] text-[#1D252D]/50 font-medium mb-1">{label}</p>
      <p className={`text-2xl font-bold ${alert ? 'text-red-600' : 'text-[#1D252D]'}`}>
        {display}{suffix}
      </p>
      <div className="flex items-center gap-1 mt-1">
        {trend > 0 ? (
          <TrendingUp className="w-3 h-3 text-green-500" />
        ) : trend < 0 ? (
          <TrendingDown className="w-3 h-3 text-red-500" />
        ) : null}
        <span className={`text-[10px] font-medium ${trend > 0 ? 'text-green-500' : trend < 0 ? 'text-red-500' : 'text-gray-400'}`}>
          {trend > 0 ? '+' : ''}{trend}%
        </span>
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\DashboardScreen.tsx
====================================================================================================

====================================================================================================
FILE [31/52]: src\components\sminex\DiscoveryModal.tsx
Size: 13,311 bytes
====================================================================================================

import { useState } from 'react'
import { X, TrendingUp, Lightbulb, DollarSign, ExternalLink } from 'lucide-react'

interface DiscoveryModalProps {
  onClose: () => void
}

type Tab = 'market' | 'solutions' | 'monetization'

const tabs: { id: Tab; label: string; icon: typeof TrendingUp }[] = [
  { id: 'market', label: 'Рынок', icon: TrendingUp },
  { id: 'solutions', label: 'Решения', icon: Lightbulb },
  { id: 'monetization', label: 'Монетизация', icon: DollarSign },
]

export default function DiscoveryModal({ onClose }: DiscoveryModalProps) {
  const [activeTab, setActiveTab] = useState<Tab>('market')

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 animate-[fadeIn_0.3s_ease-out]">
      <div className="absolute inset-0 bg-[#1D252D]/95 backdrop-blur-sm" onClick={onClose} />
      <div className="relative w-full max-w-4xl max-h-[90vh] overflow-y-auto bg-[#F5F1EC] rounded-3xl p-6 md:p-8 animate-[scaleIn_0.3s_ease-out]">
        {/* Close */}
        <button
          onClick={onClose}
          className="absolute top-4 right-4 text-[#1D252D]/40 hover:text-[#1D252D] transition-colors"
        >
          <X className="w-6 h-6" />
        </button>

        {/* Header */}
        <div className="text-center mb-6">
          <h2 className="text-2xl font-bold text-[#1D252D] mb-1">Product Discovery</h2>
          <p className="text-sm text-[#1D252D]/50">Обоснование продуктовых решений</p>
        </div>

        {/* Tabs */}
        <div className="flex gap-1 bg-white rounded-2xl p-1 mb-6 shadow-sm">
          {tabs.map(t => (
            <button
              key={t.id}
              onClick={() => setActiveTab(t.id)}
              className={`flex-1 flex items-center justify-center gap-1.5 py-2.5 rounded-xl text-sm font-medium transition-all ${
                activeTab === t.id
                  ? 'bg-[#1D252D] text-white shadow-sm'
                  : 'text-[#1D252D]/50 hover:text-[#1D252D]/80'
              }`}
            >
              <t.icon className="w-4 h-4" />
              {t.label}
            </button>
          ))}
        </div>

        {/* Content */}
        {activeTab === 'market' && <MarketTab />}
        {activeTab === 'solutions' && <SolutionsTab />}
        {activeTab === 'monetization' && <MonetizationTab />}
      </div>
    </div>
  )
}

/* ── Market Tab ── */

const players = [
  { monogram: 'SM', name: 'Sminex', features: 'Премиум CRM, консьерж, умный дом Larnitech', metric: 'NPS 4.8', color: 'bg-[#1D252D]' },
  { monogram: 'CG', name: 'Capital Group', features: 'Приложение Capital Life, сервисы и lifestyle', metric: '15K+ резидентов', color: 'bg-[#8B7355]' },
  { monogram: 'ET', name: 'Etalon + МТС', features: 'Умный дом из коробки, MTS IoT-платформа', metric: '100% smart home', color: 'bg-[#4A5568]' },
  { monogram: 'MR', name: 'MR Group', features: 'Приложение RESIDENTS, бронирование, оплата', metric: '1M+ м² в управлении', color: 'bg-[#A09484]' },
  { monogram: 'SD', name: 'Самолёт + Domiland', features: 'Суперапп для жизни, маркетплейс услуг', metric: '1.4M пользователей', color: 'bg-[#2D3748]' },
]

const marketStats = [
  { value: '100%', label: 'Smart home в новостройках к 2025' },
  { value: '96%', label: 'Заявок через приложение (Сбер данные)' },
  { value: '+100%', label: 'Рост платных заявок за год' },
  { value: '1.4M', label: 'Пользователей суперапп Домиленд' },
]

const sources = [
  { name: 'Habr — Умный дом Etalon + MTS', url: 'https://habr.com/ru/companies/mts/articles/' },
  { name: 'RBC — Цифровизация девелоперов', url: 'https://www.rbc.ru/business/' },
  { name: 'CNews — PropTech в России 2024', url: 'https://www.cnews.ru/reviews/' },
  { name: 'Forbes — Самолёт и Домиленд', url: 'https://www.forbes.ru/tekhnologii/' },
  { name: 'ComNews — Smart home рынок', url: 'https://www.comnews.ru/' },
]

function MarketTab() {
  return (
    <div className="space-y-6">
      {/* Players */}
      <div>
        <h3 className="text-sm font-bold text-[#1D252D] mb-3">Ключевые игроки</h3>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
          {players.map(p => (
            <div key={p.name} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50 flex gap-3">
              <div className={`w-10 h-10 rounded-full ${p.color} flex items-center justify-center shrink-0`}>
                <span className="text-[11px] font-bold text-white tracking-tight">{p.monogram}</span>
              </div>
              <div className="min-w-0">
                <div className="flex items-center gap-2 mb-0.5">
                  <p className="text-sm font-bold text-[#1D252D]">{p.name}</p>
                  <span className="text-[10px] bg-[#8B7355]/10 text-[#8B7355] px-1.5 py-0.5 rounded-full font-medium">{p.metric}</span>
                </div>
                <p className="text-xs text-[#1D252D]/60 leading-relaxed">{p.features}</p>
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Stats */}
      <div>
        <h3 className="text-sm font-bold text-[#1D252D] mb-3">Цифры рынка</h3>
        <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
          {marketStats.map(s => (
            <div key={s.value} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50 text-center">
              <p className="text-xl font-bold text-[#8B7355]">{s.value}</p>
              <p className="text-[10px] text-[#1D252D]/50 mt-1 leading-tight">{s.label}</p>
            </div>
          ))}
        </div>
      </div>

      {/* Sources */}
      <div>
        <h3 className="text-sm font-bold text-[#1D252D] mb-3">Источники</h3>
        <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50 space-y-2">
          {sources.map(s => (
            <a
              key={s.name}
              href={s.url}
              target="_blank"
              rel="noopener noreferrer"
              className="flex items-center gap-2 text-xs text-[#8B7355] hover:text-[#6B5A42] transition-colors"
            >
              <ExternalLink className="w-3 h-3 shrink-0" />
              {s.name}
            </a>
          ))}
        </div>
      </div>
    </div>
  )
}

/* ── Solutions Tab ── */

const solutions = [
  {
    feature: 'Мульти-квартира',
    reason: 'У премиум-резидентов 2-3 объекта. Переключение в одном приложении — must-have',
    benchmark: 'Capital Group, Самолёт',
  },
  {
    feature: 'Умный дом + сценарии',
    reason: '100% новостроек к 2025 — smart home. Сценарии «Ухожу» / «Сон» дают retention',
    benchmark: 'Etalon+МТС (Larnitech)',
  },
  {
    feature: 'Привилегии партнёров',
    reason: 'Премиальная аудитория ожидает lifestyle-бонусы. Растёт LTV через экосистему',
    benchmark: 'Capital Life, Самолёт Клуб',
  },
  {
    feature: 'Бронирование удобств',
    reason: 'Парковка, спортзал, переговорка — высокий спрос, низкая автоматизация. Снижает нагрузку на УК',
    benchmark: 'MR Group RESIDENTS',
  },
  {
    feature: 'Посылки и шкафчики',
    reason: 'Маркетплейсы дали +300% доставок. Шкафчики уменьшают жалобы на 60%',
    benchmark: 'PickPoint интеграции',
  },
  {
    feature: 'Схема квартиры',
    reason: 'Визуализация помогает создавать заявки точнее. Снижает дублирование на 25%',
    benchmark: 'Уникальная фича',
  },
  {
    feature: 'Консьерж-услуги',
    reason: 'Химчистка, вода, уборка — высокая маржинальность для УК. До +25% к ARPU',
    benchmark: 'Sminex, ЖК бизнес-класса',
  },
  {
    feature: 'Домофон и камеры',
    reason: 'Безопасность — топ-1 приоритет резидентов. Видеозвонки на телефон = wow-эффект',
    benchmark: 'Etalon, MR Group',
  },
]

function SolutionsTab() {
  return (
    <div className="space-y-2">
      <p className="text-xs text-[#1D252D]/50 mb-3">Каждое решение основано на анализе конкурентов и потребностях резидентов</p>
      {solutions.map(s => (
        <div key={s.feature} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50">
          <div className="flex items-start justify-between gap-3 mb-1.5">
            <p className="text-sm font-bold text-[#1D252D]">{s.feature}</p>
            <span className="text-[10px] bg-[#8B7355]/10 text-[#8B7355] px-2 py-0.5 rounded-full font-medium whitespace-nowrap shrink-0">
              {s.benchmark}
            </span>
          </div>
          <p className="text-xs text-[#1D252D]/60 leading-relaxed">{s.reason}</p>
        </div>
      ))}
    </div>
  )
}

/* ── Monetization Tab ── */

const revenueChannels = [
  { title: 'Маркетплейс услуг', desc: 'Комиссия с каждой транзакции (клининг, ремонт, доставка)', metric: '5–15%', metricLabel: 'комиссии' },
  { title: 'Подписки Premium', desc: 'Расширенный умный дом, видеонаблюдение, приоритетные заявки', metric: '₽990', metricLabel: '/мес' },
  { title: 'Доп. услуги УК', desc: 'Химчистка, вода, мелкий ремонт — прямая продажа через приложение', metric: '+25%', metricLabel: 'к ARPU' },
  { title: 'Аренда парковки', desc: 'Почасовая и помесячная аренда гостевых мест через приложение', metric: '₽4K', metricLabel: '/мес за место' },
  { title: 'Партнёрские комиссии', desc: 'Рестораны, фитнес, салоны — CPA за привлечённого клиента', metric: '10–20%', metricLabel: 'от чека' },
  { title: 'Реклама 1 этажа', desc: 'Продвижение бизнесов в приложении с геотаргетингом на резидентов', metric: '₽15K', metricLabel: '/мес за слот' },
]

const indirectBenefits = [
  { title: 'Репутация бренда', desc: 'Цифровой сервис → рост NPS → рекомендации → снижение CAC' },
  { title: 'Удержание резидентов', desc: 'Экосистема услуг создаёт switching costs → снижение оттока' },
  { title: 'Рост стоимости м²', desc: 'Цифровой комфорт = аргумент при продаже, +3-5% к стоимости' },
]

function MonetizationTab() {
  return (
    <div className="space-y-6">
      {/* Revenue channels */}
      <div>
        <h3 className="text-sm font-bold text-[#1D252D] mb-3">Каналы дохода</h3>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
          {revenueChannels.map(ch => (
            <div key={ch.title} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50">
              <div className="flex items-start justify-between gap-2 mb-1.5">
                <p className="text-sm font-bold text-[#1D252D]">{ch.title}</p>
                <div className="text-right shrink-0">
                  <span className="text-sm font-bold text-[#8B7355]">{ch.metric}</span>
                  <span className="text-[10px] text-[#1D252D]/40 ml-0.5">{ch.metricLabel}</span>
                </div>
              </div>
              <p className="text-xs text-[#1D252D]/60 leading-relaxed">{ch.desc}</p>
            </div>
          ))}
        </div>
      </div>

      {/* Indirect */}
      <div>
        <h3 className="text-sm font-bold text-[#1D252D] mb-3">Косвенный доход</h3>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-2">
          {indirectBenefits.map(b => (
            <div key={b.title} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50">
              <p className="text-sm font-bold text-[#1D252D] mb-1">{b.title}</p>
              <p className="text-xs text-[#1D252D]/60 leading-relaxed">{b.desc}</p>
            </div>
          ))}
        </div>
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\DiscoveryModal.tsx
====================================================================================================

====================================================================================================
FILE [32/52]: src\components\sminex\FloorPlanScreen.tsx
Size: 6,752 bytes
====================================================================================================

import { useState } from 'react'
import { Thermometer, Droplets, Lightbulb, X } from 'lucide-react'
import SubScreenHeader from './SubScreenHeader'
import type { OwnedProperty, FloorPlanRoom } from '../../data/sminex'

interface FloorPlanScreenProps {
  onBack: () => void
  property: OwnedProperty
}

export default function FloorPlanScreen({ onBack, property }: FloorPlanScreenProps) {
  const [selectedRoom, setSelectedRoom] = useState<FloorPlanRoom | null>(null)

  const roomColor = (room: FloorPlanRoom) => {
    if (selectedRoom?.id === room.id) return 'bg-[#8B7355]/30 border-[#8B7355]'
    if (room.devicesOn > 0) return 'bg-amber-50 border-amber-200'
    return 'bg-[#F5F1EC]/60 border-[#1D252D]/10'
  }

  return (
    <div className="flex-1 overflow-y-auto animate-[fadeIn_0.2s_ease-out]">
      <SubScreenHeader title="Схема квартиры" onBack={onBack} />

      <div className="px-5 pb-6 space-y-4">
        {/* Property info */}
        <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-xs font-bold text-[#1D252D]">{property.complexName} · кв. {property.apartment}</p>
              <p className="text-[10px] text-[#1D252D]/40">{property.typeLabel} · {property.area} м² · {property.floor} этаж</p>
            </div>
            <div className="text-right">
              <p className="text-[10px] text-[#1D252D]/40">{property.rooms.length} комнат</p>
            </div>
          </div>
        </div>

        {/* Interactive floor plan */}
        <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50">
          <p className="text-xs font-semibold text-[#1D252D]/50 mb-3">План квартиры</p>
          <div className="relative w-full" style={{ paddingBottom: '100%' }}>
            <div className="absolute inset-0">
              {property.rooms.map(room => (
                <button
                  key={room.id}
                  onClick={() => setSelectedRoom(selectedRoom?.id === room.id ? null : room)}
                  className={`absolute border-2 rounded-xl transition-all duration-200 flex flex-col items-center justify-center gap-0.5 hover:shadow-md active:scale-[0.98] ${roomColor(room)}`}
                  style={{
                    left: `${room.x}%`,
                    top: `${room.y}%`,
                    width: `${room.w}%`,
                    height: `${room.h}%`,
                  }}
                >
                  <span className="text-[9px] font-bold text-[#1D252D] leading-tight text-center px-1">
                    {room.name}
                  </span>
                  {room.temperature !== undefined && (
                    <span className="text-[8px] text-[#8B7355] font-medium">{room.temperature}°C</span>
                  )}
                  {room.devicesOn > 0 && (
                    <div className="flex items-center gap-0.5">
                      <Lightbulb className="w-2.5 h-2.5 text-amber-500" />
                      <span className="text-[8px] text-amber-600 font-medium">{room.devicesOn}</span>
                    </div>
                  )}
                </button>
              ))}
            </div>
          </div>
        </div>

        {/* Selected room detail */}
        {selectedRoom && (
          <div className="bg-white rounded-2xl p-4 shadow-sm border border-[#8B7355]/20 animate-[fadeIn_0.15s_ease-out]">
            <div className="flex items-center justify-between mb-3">
              <h3 className="text-sm font-bold text-[#1D252D]">{selectedRoom.name}</h3>
              <button onClick={() => setSelectedRoom(null)} className="text-[#1D252D]/30 hover:text-[#1D252D]">
                <X className="w-4 h-4" />
              </button>
            </div>
            <div className="grid grid-cols-3 gap-2">
              {selectedRoom.temperature !== undefined && (
                <div className="bg-[#F5F1EC] rounded-xl p-3 text-center">
                  <Thermometer className="w-4 h-4 text-[#8B7355] mx-auto mb-1" />
                  <p className="text-sm font-bold text-[#1D252D]">{selectedRoom.temperature}°C</p>
                  <p className="text-[8px] text-[#1D252D]/40">Температура</p>
                </div>
              )}
              {selectedRoom.humidity !== undefined && (
                <div className="bg-[#F5F1EC] rounded-xl p-3 text-center">
                  <Droplets className="w-4 h-4 text-blue-500 mx-auto mb-1" />
                  <p className="text-sm font-bold text-[#1D252D]">{selectedRoom.humidity}%</p>
                  <p className="text-[8px] text-[#1D252D]/40">Влажность</p>
                </div>
              )}
              <div className="bg-[#F5F1EC] rounded-xl p-3 text-center">
                <Lightbulb className="w-4 h-4 text-amber-500 mx-auto mb-1" />
                <p className="text-sm font-bold text-[#1D252D]">{selectedRoom.devicesOn}/{selectedRoom.devicesTotal}</p>
                <p className="text-[8px] text-[#1D252D]/40">Устройства</p>
              </div>
            </div>
          </div>
        )}

        {/* Room list summary */}
        <div>
          <h3 className="text-xs font-bold text-[#1D252D] mb-2">Комнаты</h3>
          <div className="bg-white rounded-2xl shadow-sm border border-gray-50 divide-y divide-gray-50">
            {property.rooms.map(room => (
              <button
                key={room.id}
                onClick={() => setSelectedRoom(room)}
                className={`w-full flex items-center justify-between px-4 py-3 transition-colors ${
                  selectedRoom?.id === room.id ? 'bg-[#F5F1EC]' : ''
                }`}
              >
                <div className="flex items-center gap-3">
                  <div className={`w-2 h-2 rounded-full ${room.devicesOn > 0 ? 'bg-amber-400' : 'bg-gray-200'}`} />
                  <span className="text-xs font-medium text-[#1D252D]">{room.name}</span>
                </div>
                <div className="flex items-center gap-3">
                  {room.temperature !== undefined && (
                    <span className="text-[10px] text-[#1D252D]/40">{room.temperature}°C</span>
                  )}
                  {room.devicesOn > 0 && (
                    <span className="text-[10px] text-amber-600 font-medium">{room.devicesOn} вкл</span>
                  )}
                </div>
              </button>
            ))}
          </div>
        </div>
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\FloorPlanScreen.tsx
====================================================================================================

====================================================================================================
FILE [33/52]: src\components\sminex\IntercomScreen.tsx
Size: 7,303 bytes
====================================================================================================

import { useState } from 'react'
import { Video, Plus, UserCheck, LogIn, Package, Users } from 'lucide-react'
import SubScreenHeader from './SubScreenHeader'
import { guestPasses, entryEvents, type GuestPass } from '../../data/sminex'

interface IntercomScreenProps {
  onBack: () => void
  onToast: (msg: string) => void
}

export default function IntercomScreen({ onBack, onToast }: IntercomScreenProps) {
  const [doorOpen, setDoorOpen] = useState(false)
  const [doorTimer, setDoorTimer] = useState(0)
  const [passes, setPasses] = useState<GuestPass[]>(guestPasses)
  const [showNewPass, setShowNewPass] = useState(false)
  const [newGuestName, setNewGuestName] = useState('')

  const handleOpenDoor = () => {
    if (doorOpen) return
    setDoorOpen(true)
    setDoorTimer(5)
    const interval = setInterval(() => {
      setDoorTimer(prev => {
        if (prev <= 1) {
          clearInterval(interval)
          setDoorOpen(false)
          return 0
        }
        return prev - 1
      })
    }, 1000)
  }

  const handleCreatePass = () => {
    if (!newGuestName.trim()) return
    const newPass: GuestPass = {
      id: `gp-${Date.now()}`,
      guestName: newGuestName.trim(),
      date: '26.02.2026',
      timeRange: '12:00–23:00',
      status: 'active',
    }
    setPasses(prev => [newPass, ...prev])
    setNewGuestName('')
    setShowNewPass(false)
    onToast(`Пропуск для ${newPass.guestName} создан`)
  }

  const entryIcon = (type: string) => {
    switch (type) {
      case 'entry': return <LogIn className="w-3.5 h-3.5 text-green-600" />
      case 'exit': return <LogIn className="w-3.5 h-3.5 text-[#1D252D]/40 rotate-180" />
      case 'delivery': return <Package className="w-3.5 h-3.5 text-blue-600" />
      case 'guest': return <Users className="w-3.5 h-3.5 text-amber-600" />
      default: return null
    }
  }

  const passStatusLabel: Record<string, string> = { active: 'Активен', used: 'Использован', expired: 'Истёк' }
  const passStatusColor: Record<string, string> = {
    active: 'bg-green-100 text-green-700',
    used: 'bg-gray-100 text-gray-500',
    expired: 'bg-red-100 text-red-500',
  }

  return (
    <div className="flex-1 overflow-y-auto animate-[fadeIn_0.2s_ease-out]">
      <SubScreenHeader title="Домофон" onBack={onBack} />

      <div className="px-5 pb-6 space-y-4">
        {/* Video feed mock */}
        <div className="relative rounded-2xl overflow-hidden h-44 bg-gradient-to-br from-[#1D252D] to-[#3a4a5a] flex items-center justify-center">
          <Video className="w-12 h-12 text-white/20" />
          <div className="absolute top-3 left-3 flex items-center gap-1.5">
            <span className="w-2 h-2 rounded-full bg-red-500 animate-pulse" />
            <span className="text-[10px] font-bold text-white/80">LIVE</span>
          </div>
          <p className="absolute bottom-3 left-3 text-[10px] text-white/50">Подъезд 2 · Камера входа</p>
        </div>

        {/* Open door button */}
        <button
          onClick={handleOpenDoor}
          disabled={doorOpen}
          className={`w-full py-3.5 rounded-full text-sm font-semibold transition-all active:scale-[0.97] ${
            doorOpen
              ? 'bg-green-500 text-white'
              : 'bg-[#1D252D] text-white hover:opacity-90'
          }`}
        >
          {doorOpen ? (
            <span className="flex items-center justify-center gap-2">
              <span className="w-2 h-2 rounded-full bg-white animate-pulse" />
              Дверь открыта · {doorTimer}с
            </span>
          ) : (
            'Открыть дверь'
          )}
        </button>

        {/* Guest passes */}
        <div>
          <div className="flex items-center justify-between mb-3">
            <h2 className="text-sm font-bold text-[#1D252D]">Гостевые пропуска</h2>
            <button
              onClick={() => setShowNewPass(!showNewPass)}
              className="w-7 h-7 rounded-full bg-[#1D252D] flex items-center justify-center text-white"
            >
              <Plus className="w-4 h-4" />
            </button>
          </div>

          {showNewPass && (
            <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50 mb-3 animate-[fadeIn_0.15s_ease-out]">
              <p className="text-xs font-semibold text-[#1D252D]/50 mb-2">Новый пропуск</p>
              <input
                type="text"
                placeholder="Имя гостя"
                value={newGuestName}
                onChange={e => setNewGuestName(e.target.value)}
                onKeyDown={e => e.key === 'Enter' && handleCreatePass()}
                className="w-full bg-[#F5F1EC] rounded-xl px-3 py-2.5 text-sm text-[#1D252D] placeholder:text-[#1D252D]/30 mb-2 focus:outline-none focus:ring-2 focus:ring-[#8B7355]/30"
              />
              <button
                onClick={handleCreatePass}
                disabled={!newGuestName.trim()}
                className="w-full bg-[#1D252D] text-white rounded-full py-2.5 text-xs font-semibold disabled:opacity-30 hover:opacity-90 transition-opacity"
              >
                Создать пропуск
              </button>
            </div>
          )}

          <div className="space-y-2">
            {passes.map(pass => (
              <div key={pass.id} className="bg-white rounded-2xl p-3.5 shadow-sm border border-gray-50 flex items-center gap-3">
                <div className="w-8 h-8 rounded-full bg-[#F5F1EC] flex items-center justify-center">
                  <UserCheck className="w-4 h-4 text-[#8B7355]" />
                </div>
                <div className="flex-1 min-w-0">
                  <p className="text-xs font-semibold text-[#1D252D] truncate">{pass.guestName}</p>
                  <p className="text-[10px] text-[#1D252D]/40">{pass.date} · {pass.timeRange}</p>
                </div>
                <span className={`text-[10px] font-medium px-2 py-0.5 rounded-full ${passStatusColor[pass.status]}`}>
                  {passStatusLabel[pass.status]}
                </span>
              </div>
            ))}
          </div>
        </div>

        {/* Entry history */}
        <div>
          <h2 className="text-sm font-bold text-[#1D252D] mb-3">История входов</h2>
          <div className="bg-white rounded-2xl shadow-sm border border-gray-50 divide-y divide-gray-50">
            {entryEvents.map(event => (
              <div key={event.id} className="flex items-center gap-3 px-4 py-3">
                <div className="w-7 h-7 rounded-full bg-[#F5F1EC] flex items-center justify-center">
                  {entryIcon(event.type)}
                </div>
                <div className="flex-1 min-w-0">
                  <p className="text-xs text-[#1D252D] truncate">{event.description}</p>
                </div>
                <span className="text-[10px] text-[#1D252D]/40 shrink-0">{event.time}</span>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\IntercomScreen.tsx
====================================================================================================

====================================================================================================
FILE [34/52]: src\components\sminex\NotificationsScreen.tsx
Size: 2,407 bytes
====================================================================================================

import { Bell, CheckCircle, AlertTriangle, Star, Info } from 'lucide-react'
import { type Notification, type UserRole } from '../../data/sminex'

interface NotificationsScreenProps {
  notifications: Notification[]
  userRole: UserRole
}

const typeIcons = {
  status_change: AlertTriangle,
  assigned: Info,
  completed: CheckCircle,
  rate: Star,
  info: Bell,
}

const typeColors = {
  status_change: 'bg-amber-100 text-amber-600',
  assigned: 'bg-blue-100 text-blue-600',
  completed: 'bg-green-100 text-green-600',
  rate: 'bg-purple-100 text-purple-600',
  info: 'bg-gray-100 text-gray-600',
}

export default function NotificationsScreen({ notifications, userRole }: NotificationsScreenProps) {
  const filtered = notifications.filter(n => n.forRole.includes(userRole))

  return (
    <div className="flex-1 overflow-y-auto animate-[fadeIn_0.2s_ease-out]">
      <div className="px-5 pt-4 pb-6 space-y-4">
        <h1 className="text-xl font-bold text-[#1D252D]">Уведомления</h1>

        {filtered.length === 0 ? (
          <div className="text-center py-12 text-[#1D252D]/40 text-sm">Нет уведомлений</div>
        ) : (
          <div className="space-y-2">
            {filtered.map((notif, i) => {
              const Icon = typeIcons[notif.type]
              const colorClass = typeColors[notif.type]
              return (
                <div
                  key={notif.id}
                  className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50 flex items-start gap-3 transition-shadow hover:shadow-md"
                  style={{ animationDelay: `${i * 50}ms` }}
                >
                  <div className={`w-9 h-9 rounded-full flex items-center justify-center shrink-0 ${colorClass}`}>
                    <Icon className="w-4 h-4" />
                  </div>
                  <div className="flex-1 min-w-0">
                    <p className="text-xs text-[#1D252D] leading-relaxed">{notif.text}</p>
                    <p className="text-[10px] text-[#1D252D]/40 mt-1">{notif.time}</p>
                  </div>
                  {!notif.read && (
                    <div className="w-2 h-2 rounded-full bg-[#8B7355] shrink-0 mt-1.5" />
                  )}
                </div>
              )
            })}
          </div>
        )}
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\NotificationsScreen.tsx
====================================================================================================

====================================================================================================
FILE [35/52]: src\components\sminex\PackagesScreen.tsx
Size: 6,849 bytes
====================================================================================================

import { useState } from 'react'
import { Package, Truck, MailOpen, CheckCircle2, Copy, Box } from 'lucide-react'
import SubScreenHeader from './SubScreenHeader'
import { initialPackages, type Package as PackageType } from '../../data/sminex'

interface PackagesScreenProps {
  onBack: () => void
  onToast: (msg: string) => void
}

export default function PackagesScreen({ onBack, onToast }: PackagesScreenProps) {
  const [packages, setPackages] = useState<PackageType[]>(initialPackages)

  const handlePickup = (id: string) => {
    setPackages(prev => prev.map(p =>
      p.id === id ? { ...p, status: 'picked_up' as const, statusLabel: 'Забрано' } : p
    ))
    onToast('Посылка отмечена как полученная')
  }

  const handleCopyCode = (code: string) => {
    navigator.clipboard?.writeText(code)
    onToast(`Код ${code} скопирован`)
  }

  const statusIcon = (status: string) => {
    switch (status) {
      case 'in_transit': return <Truck className="w-4 h-4 text-blue-500" />
      case 'delivered': return <MailOpen className="w-4 h-4 text-green-500" />
      case 'in_locker': return <Box className="w-4 h-4 text-amber-500" />
      case 'picked_up': return <CheckCircle2 className="w-4 h-4 text-gray-400" />
      default: return <Package className="w-4 h-4 text-gray-400" />
    }
  }

  const statusBgColor: Record<string, string> = {
    in_transit: 'bg-blue-50',
    delivered: 'bg-green-50',
    in_locker: 'bg-amber-50',
    picked_up: 'bg-gray-50',
  }

  const statusBadgeColor: Record<string, string> = {
    in_transit: 'bg-blue-100 text-blue-700',
    delivered: 'bg-green-100 text-green-700',
    in_locker: 'bg-amber-100 text-amber-700',
    picked_up: 'bg-gray-100 text-gray-500',
  }

  const active = packages.filter(p => p.status !== 'picked_up')
  const history = packages.filter(p => p.status === 'picked_up')

  return (
    <div className="flex-1 overflow-y-auto animate-[fadeIn_0.2s_ease-out]">
      <SubScreenHeader title="Посылки" onBack={onBack} />

      <div className="px-5 pb-6 space-y-4">
        {/* Active packages */}
        {active.length > 0 && (
          <div>
            <h2 className="text-xs font-bold text-[#1D252D] mb-2">Активные</h2>
            <div className="space-y-2.5">
              {active.map(pkg => (
                <div key={pkg.id} className="bg-white rounded-2xl shadow-sm border border-gray-50 overflow-hidden">
                  <div className="p-4 flex items-start gap-3">
                    <div className={`w-10 h-10 rounded-xl flex items-center justify-center shrink-0 ${statusBgColor[pkg.status]}`}>
                      {statusIcon(pkg.status)}
                    </div>
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center justify-between mb-1">
                        <p className="text-xs font-bold text-[#1D252D]">{pkg.carrier}</p>
                        <span className={`text-[9px] font-medium px-2 py-0.5 rounded-full ${statusBadgeColor[pkg.status]}`}>
                          {pkg.statusLabel}
                        </span>
                      </div>
                      <p className="text-[10px] text-[#1D252D]/60 mb-0.5">{pkg.description}</p>
                      <p className="text-[10px] text-[#1D252D]/30">{pkg.trackingNumber}</p>
                      {pkg.deliveryDate && (
                        <p className="text-[10px] text-blue-600 mt-1">Ожидается: {pkg.deliveryDate}</p>
                      )}
                      {pkg.arrivedAt && (
                        <p className="text-[10px] text-[#1D252D]/40 mt-0.5">Доставлено: {pkg.arrivedAt}</p>
                      )}
                    </div>
                  </div>

                  {/* Locker info + actions */}
                  {pkg.status === 'in_locker' && pkg.lockerCode && (
                    <div className="border-t border-gray-50 bg-amber-50/50 px-4 py-3">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="text-[10px] text-[#1D252D]/40">Ячейка №{pkg.lockerNumber}</p>
                          <div className="flex items-center gap-2 mt-0.5">
                            <span className="text-lg font-mono font-bold text-[#1D252D] tracking-widest">{pkg.lockerCode}</span>
                            <button
                              onClick={() => handleCopyCode(pkg.lockerCode!)}
                              className="text-[#8B7355] hover:text-[#1D252D] transition-colors"
                            >
                              <Copy className="w-3.5 h-3.5" />
                            </button>
                          </div>
                        </div>
                        <button
                          onClick={() => handlePickup(pkg.id)}
                          className="text-[10px] font-semibold text-white bg-[#1D252D] px-3.5 py-2 rounded-full hover:opacity-90 transition-opacity active:scale-[0.95]"
                        >
                          Забрал
                        </button>
                      </div>
                    </div>
                  )}
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Empty state */}
        {active.length === 0 && (
          <div className="bg-white rounded-2xl p-8 shadow-sm border border-gray-50 text-center">
            <Package className="w-10 h-10 text-[#1D252D]/15 mx-auto mb-2" />
            <p className="text-sm font-semibold text-[#1D252D]/30">Нет активных посылок</p>
          </div>
        )}

        {/* History */}
        {history.length > 0 && (
          <div>
            <h2 className="text-xs font-bold text-[#1D252D] mb-2">Полученные</h2>
            <div className="bg-white rounded-2xl shadow-sm border border-gray-50 divide-y divide-gray-50">
              {history.map(pkg => (
                <div key={pkg.id} className="flex items-center gap-3 px-4 py-3 opacity-50">
                  <div className="w-7 h-7 rounded-full bg-gray-50 flex items-center justify-center">
                    <CheckCircle2 className="w-3.5 h-3.5 text-gray-400" />
                  </div>
                  <div className="flex-1 min-w-0">
                    <p className="text-xs text-[#1D252D]">{pkg.carrier} · {pkg.description}</p>
                  </div>
                  <span className="text-[10px] text-[#1D252D]/30 shrink-0">{pkg.arrivedAt}</span>
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\PackagesScreen.tsx
====================================================================================================

====================================================================================================
FILE [36/52]: src\components\sminex\ParkingScreen.tsx
Size: 5,874 bytes
====================================================================================================

import { useState } from 'react'
import { Car, MapPin, Clock, Plus } from 'lucide-react'
import SubScreenHeader from './SubScreenHeader'
import { parkingSpot, parkingEvents } from '../../data/sminex'

interface ParkingScreenProps {
  onBack: () => void
  onToast: (msg: string) => void
}

export default function ParkingScreen({ onBack, onToast }: ParkingScreenProps) {
  const [guestRequested, setGuestRequested] = useState(false)
  const [guestPlate, setGuestPlate] = useState('')
  const [showGuestForm, setShowGuestForm] = useState(false)

  const handleRequestGuest = () => {
    if (!guestPlate.trim()) return
    setGuestRequested(true)
    setShowGuestForm(false)
    onToast(`Гостевое место для ${guestPlate.trim()} запрошено`)
  }

  return (
    <div className="flex-1 overflow-y-auto animate-[fadeIn_0.2s_ease-out]">
      <SubScreenHeader title="Парковка" onBack={onBack} />

      <div className="px-5 pb-6 space-y-4">
        {/* Your spot */}
        <div className="bg-[#1D252D] rounded-2xl p-5 text-white">
          <div className="flex items-center gap-3 mb-4">
            <div className="w-12 h-12 rounded-2xl bg-white/10 flex items-center justify-center">
              <Car className="w-6 h-6 text-white" />
            </div>
            <div>
              <p className="text-[10px] text-white/50 font-medium">Ваше место</p>
              <p className="text-2xl font-bold">№{parkingSpot.number}</p>
            </div>
          </div>
          <div className="flex gap-3">
            <div className="flex-1 bg-white/10 rounded-xl p-3">
              <div className="flex items-center gap-1.5 mb-1">
                <MapPin className="w-3 h-3 text-white/50" />
                <span className="text-[10px] text-white/50">Уровень</span>
              </div>
              <p className="text-sm font-bold">{parkingSpot.level}</p>
            </div>
            <div className="flex-1 bg-white/10 rounded-xl p-3">
              <div className="flex items-center gap-1.5 mb-1">
                <Car className="w-3 h-3 text-white/50" />
                <span className="text-[10px] text-white/50">Статус</span>
              </div>
              <p className="text-sm font-bold">
                {parkingSpot.status === 'free' ? 'Свободно' : 'Занято'}
              </p>
            </div>
          </div>
        </div>

        {/* Guest parking */}
        <div>
          <div className="flex items-center justify-between mb-2">
            <h2 className="text-xs font-bold text-[#1D252D]">Гостевая парковка</h2>
            {!guestRequested && (
              <button
                onClick={() => setShowGuestForm(!showGuestForm)}
                className="w-7 h-7 rounded-full bg-[#1D252D] flex items-center justify-center text-white"
              >
                <Plus className="w-4 h-4" />
              </button>
            )}
          </div>

          {showGuestForm && (
            <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50 mb-3 animate-[fadeIn_0.15s_ease-out]">
              <p className="text-xs font-semibold text-[#1D252D]/50 mb-2">Запрос гостевого места</p>
              <input
                type="text"
                placeholder="Госномер (напр. А777АА)"
                value={guestPlate}
                onChange={e => setGuestPlate(e.target.value)}
                onKeyDown={e => e.key === 'Enter' && handleRequestGuest()}
                className="w-full bg-[#F5F1EC] rounded-xl px-3 py-2.5 text-sm text-[#1D252D] placeholder:text-[#1D252D]/30 mb-2 focus:outline-none focus:ring-2 focus:ring-[#8B7355]/30"
              />
              <button
                onClick={handleRequestGuest}
                disabled={!guestPlate.trim()}
                className="w-full bg-[#1D252D] text-white rounded-full py-2.5 text-xs font-semibold disabled:opacity-30 hover:opacity-90 transition-opacity"
              >
                Запросить место
              </button>
            </div>
          )}

          {guestRequested && (
            <div className="bg-green-50 rounded-2xl p-4 border border-green-100 mb-3 animate-[fadeIn_0.15s_ease-out]">
              <div className="flex items-center gap-2">
                <div className="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center">
                  <Car className="w-4 h-4 text-green-600" />
                </div>
                <div>
                  <p className="text-xs font-semibold text-green-800">Гостевое место запрошено</p>
                  <p className="text-[10px] text-green-600">{guestPlate} · Уровень B1</p>
                </div>
              </div>
            </div>
          )}
        </div>

        {/* Events */}
        <div>
          <h2 className="text-xs font-bold text-[#1D252D] mb-2">События</h2>
          <div className="bg-white rounded-2xl shadow-sm border border-gray-50 divide-y divide-gray-50">
            {parkingEvents.map(event => (
              <div key={event.id} className="flex items-center gap-3 px-4 py-3">
                <div className="w-7 h-7 rounded-full bg-[#F5F1EC] flex items-center justify-center">
                  <Clock className="w-3.5 h-3.5 text-[#8B7355]" />
                </div>
                <div className="flex-1 min-w-0">
                  <p className="text-xs text-[#1D252D] truncate">{event.description}</p>
                </div>
                <span className="text-[10px] text-[#1D252D]/40 shrink-0">{event.time}</span>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\ParkingScreen.tsx
====================================================================================================

====================================================================================================
FILE [37/52]: src\components\sminex\PhoneFrame.tsx
Size: 3,181 bytes
====================================================================================================

import { type ReactNode } from 'react'
import { ArrowLeft, Layers, Search } from 'lucide-react'

interface PhoneFrameProps {
  children: ReactNode
  onBack: () => void
  onOpenArchitecture: () => void
  onOpenDiscovery: () => void
}

export default function PhoneFrame({ children, onBack, onOpenArchitecture, onOpenDiscovery }: PhoneFrameProps) {
  return (
    <div className="min-h-screen bg-[#F5F1EC] flex flex-col items-center justify-center font-[Montserrat] p-4">
      {/* Top controls */}
      <div className="hidden md:flex items-center gap-4 mb-4">
        <button
          onClick={onBack}
          className="flex items-center gap-2 text-[#1D252D]/60 hover:text-[#1D252D] transition-colors text-sm font-medium"
        >
          <ArrowLeft className="w-4 h-4" />
          Назад к портфолио
        </button>
        <button
          onClick={onOpenArchitecture}
          className="flex items-center gap-2 bg-white text-[#1D252D] rounded-full px-4 py-2 text-sm font-medium shadow-sm border border-gray-200 hover:shadow-md transition-shadow"
        >
          <Layers className="w-4 h-4 text-[#8B7355]" />
          Архитектура системы
        </button>
        <button
          onClick={onOpenDiscovery}
          className="flex items-center gap-2 bg-white text-[#1D252D] rounded-full px-4 py-2 text-sm font-medium shadow-sm border border-gray-200 hover:shadow-md transition-shadow"
        >
          <Search className="w-4 h-4 text-[#8B7355]" />
          Продуктовый анализ
        </button>
      </div>

      {/* Phone frame — visible on md+ */}
      <div className="hidden md:flex flex-col w-[390px] h-[844px] bg-[#1D252D] rounded-[3rem] p-3 shadow-2xl">
        {/* Notch */}
        <div className="flex justify-center pt-2 pb-1">
          <div className="w-28 h-6 bg-black rounded-full" />
        </div>
        {/* Screen */}
        <div className="flex-1 bg-[#F5F1EC] rounded-[2.2rem] overflow-hidden flex flex-col relative">
          {/* Status bar */}
          <div className="flex items-center justify-between px-8 py-2 text-[#1D252D] text-xs font-semibold">
            <span>9:41</span>
            <div className="flex items-center gap-1">
              <svg className="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24"><path d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3a4.237 4.237 0 00-6 0zm-4-4l2 2a7.074 7.074 0 0110 0l2-2C15.14 9.14 8.87 9.14 5 13z"/></svg>
              <svg className="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24"><path d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v15.33C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V5.33C17 4.6 16.4 4 15.67 4z"/></svg>
            </div>
          </div>
          {/* Content */}
          <div className="flex-1 overflow-hidden flex flex-col">
            {children}
          </div>
        </div>
      </div>

      {/* Mobile — full screen */}
      <div className="md:hidden fixed inset-0 bg-[#F5F1EC] flex flex-col overflow-hidden relative">
        {children}
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\PhoneFrame.tsx
====================================================================================================

====================================================================================================
FILE [38/52]: src\components\sminex\PrivilegesScreen.tsx
Size: 5,161 bytes
====================================================================================================

import { useState, type ReactNode } from 'react'
import { Copy, Star, Utensils, Sofa, Dumbbell, Car, Sparkles, Heart, Leaf, Bed, Wrench, Stethoscope } from 'lucide-react'
import SubScreenHeader from './SubScreenHeader'
import { partnerCategories, partners } from '../../data/sminex'

const partnerIcons: Record<string, ReactNode> = {
  'utensils': <Utensils className="w-5 h-5" />,
  'sofa': <Sofa className="w-5 h-5" />,
  'dumbbell': <Dumbbell className="w-5 h-5" />,
  'car': <Car className="w-5 h-5" />,
  'sparkles': <Sparkles className="w-5 h-5" />,
  'heart': <Heart className="w-5 h-5" />,
  'leaf': <Leaf className="w-5 h-5" />,
  'bed': <Bed className="w-5 h-5" />,
  'wrench': <Wrench className="w-5 h-5" />,
  'stethoscope': <Stethoscope className="w-5 h-5" />,
}

interface PrivilegesScreenProps {
  onBack: () => void
  onToast: (msg: string) => void
}

export default function PrivilegesScreen({ onBack, onToast }: PrivilegesScreenProps) {
  const [selectedCategory, setSelectedCategory] = useState('pc-all')

  const filtered = selectedCategory === 'pc-all'
    ? partners
    : partners.filter(p => p.categoryId === selectedCategory)

  const handleCopyPromo = (code: string, partnerName: string) => {
    navigator.clipboard?.writeText(code)
    onToast(`Промокод ${code} скопирован — ${partnerName}`)
  }

  return (
    <div className="flex-1 overflow-y-auto animate-[fadeIn_0.2s_ease-out]">
      <SubScreenHeader title="Привилегии" onBack={onBack} />

      <div className="px-5 pb-6 space-y-4">
        {/* Hero banner */}
        <div className="bg-gradient-to-r from-[#1D252D] to-[#8B7355] rounded-2xl p-5 text-white">
          <div className="flex items-center gap-2 mb-2">
            <Star className="w-5 h-5 text-amber-300 fill-amber-300" />
            <p className="text-xs font-bold text-white/80">Клуб Ривер Парк</p>
          </div>
          <p className="text-lg font-bold mb-1">Привилегии резидента</p>
          <p className="text-[10px] text-white/60">Эксклюзивные скидки и предложения от {partners.length} партнёров</p>
        </div>

        {/* Category pills */}
        <div className="flex gap-2 overflow-x-auto pb-1 -mx-5 px-5 scrollbar-hide">
          {partnerCategories.map(cat => (
            <button
              key={cat.id}
              onClick={() => setSelectedCategory(cat.id)}
              className={`px-3.5 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-colors ${
                selectedCategory === cat.id
                  ? 'bg-[#1D252D] text-white'
                  : 'bg-white text-[#1D252D]/60 border border-gray-100'
              }`}
            >
              {cat.name}
            </button>
          ))}
        </div>

        {/* Partner cards */}
        <div className="space-y-2.5">
          {filtered.map(partner => (
            <div key={partner.id} className="bg-white rounded-2xl shadow-sm border border-gray-50 overflow-hidden">
              <div className="p-4 flex items-start gap-3">
                <div className="w-12 h-12 rounded-xl bg-[#F5F1EC] flex items-center justify-center text-[#8B7355] shrink-0">
                  {partnerIcons[partner.logo]}
                </div>
                <div className="flex-1 min-w-0">
                  <div className="flex items-center gap-2 mb-0.5">
                    <p className="text-xs font-bold text-[#1D252D]">{partner.name}</p>
                    {partner.isExclusive && (
                      <span className="text-[8px] font-bold text-amber-700 bg-amber-100 px-1.5 py-0.5 rounded-full">
                        EXCLUSIVE
                      </span>
                    )}
                  </div>
                  <p className="text-[10px] text-[#1D252D]/50 mb-1.5">{partner.description}</p>
                  <div className="flex items-center gap-2">
                    <span className="text-sm font-bold text-[#8B7355]">{partner.discount}</span>
                  </div>
                </div>
              </div>

              {/* Promo code */}
              {partner.promoCode && (
                <div className="border-t border-gray-50 px-4 py-2.5 bg-[#F5F1EC]/50 flex items-center justify-between">
                  <div>
                    <p className="text-[9px] text-[#1D252D]/40">Промокод</p>
                    <p className="text-xs font-mono font-bold text-[#1D252D] tracking-wider">{partner.promoCode}</p>
                  </div>
                  <button
                    onClick={() => handleCopyPromo(partner.promoCode!, partner.name)}
                    className="flex items-center gap-1 text-[10px] font-semibold text-[#8B7355] hover:text-[#1D252D] transition-colors"
                  >
                    <Copy className="w-3 h-3" />
                    Копировать
                  </button>
                </div>
              )}
            </div>
          ))}
        </div>
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\PrivilegesScreen.tsx
====================================================================================================

====================================================================================================
FILE [39/52]: src\components\sminex\ProfileScreen.tsx
Size: 4,362 bytes
====================================================================================================

import { useState } from 'react'
import { Bell, Moon, Info, LogOut, ArrowLeftRight } from 'lucide-react'
import { type UserProfile, complexes } from '../../data/sminex'

interface ProfileScreenProps {
  user: UserProfile
  onSwitchRole: () => void
}

export default function ProfileScreen({ user, onSwitchRole }: ProfileScreenProps) {
  const complexName = user.complexId
    ? complexes.find(c => c.id === user.complexId)?.name
    : undefined

  const [notifOn, setNotifOn] = useState(true)
  const [darkOn, setDarkOn] = useState(false)

  return (
    <div className="flex-1 overflow-y-auto animate-[fadeIn_0.2s_ease-out]">
      <div className="px-5 pt-6 pb-6 space-y-5">
        {/* Avatar + info */}
        <div className="flex flex-col items-center text-center">
          <div className="w-20 h-20 rounded-full bg-[#1D252D] flex items-center justify-center text-white text-2xl font-bold mb-3">
            {user.initials}
          </div>
          <p className="text-lg font-bold text-[#1D252D]">{user.name}</p>
          <p className="text-xs text-[#8B7355] font-medium">{user.roleLabel}</p>
        </div>

        {/* Info card */}
        <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50 space-y-3">
          {complexName && (
            <InfoRow label="Жилой комплекс" value={complexName} />
          )}
          {user.apartment && (
            <InfoRow label="Квартира" value={user.apartment} />
          )}
          {user.position && (
            <InfoRow label="Должность" value={user.position} />
          )}
          {user.phone && (
            <InfoRow label="Телефон" value={user.phone} />
          )}
        </div>

        {/* Settings */}
        <div className="bg-white rounded-2xl shadow-sm border border-gray-50 overflow-hidden">
          <SettingRow icon={Bell} label="Уведомления" isOn={notifOn} onToggle={() => setNotifOn(!notifOn)} />
          <SettingRow icon={Moon} label="Тёмная тема" isOn={darkOn} onToggle={() => setDarkOn(!darkOn)} />
          <SettingRow icon={Info} label="О приложении" value="v2.0 demo" />
        </div>

        {/* Actions */}
        <div className="space-y-2">
          <button
            onClick={onSwitchRole}
            className="w-full bg-white text-[#1D252D] rounded-full py-3 text-sm font-semibold border border-gray-200 transition-colors hover:bg-gray-50 flex items-center justify-center gap-2 active:scale-[0.97]"
          >
            <ArrowLeftRight className="w-4 h-4" />
            Сменить роль
          </button>
          <button
            onClick={onSwitchRole}
            className="w-full text-red-500 rounded-full py-3 text-sm font-semibold transition-colors hover:bg-red-50 flex items-center justify-center gap-2 active:scale-[0.97]"
          >
            <LogOut className="w-4 h-4" />
            Выйти
          </button>
        </div>
      </div>
    </div>
  )
}

function InfoRow({ label, value }: { label: string; value: string }) {
  return (
    <div className="flex items-center justify-between">
      <span className="text-xs text-[#1D252D]/40">{label}</span>
      <span className="text-xs font-medium text-[#1D252D]">{value}</span>
    </div>
  )
}

function SettingRow({ icon: Icon, label, isOn, onToggle, value }: {
  icon: typeof Bell
  label: string
  isOn?: boolean
  onToggle?: () => void
  value?: string
}) {
  return (
    <div className="flex items-center justify-between px-4 py-3.5 border-b border-gray-50 last:border-0">
      <div className="flex items-center gap-3">
        <Icon className="w-4 h-4 text-[#1D252D]/40" />
        <span className="text-sm text-[#1D252D]">{label}</span>
      </div>
      {onToggle !== undefined ? (
        <button
          onClick={onToggle}
          className={`w-11 h-[26px] rounded-full relative transition-colors duration-300 ${isOn ? 'bg-[#1D252D]' : 'bg-gray-200'}`}
        >
          <div className={`absolute top-[3px] w-5 h-5 rounded-full bg-white shadow-sm transition-all duration-300 ${isOn ? 'left-[22px]' : 'left-[3px]'}`} />
        </button>
      ) : (
        <span className="text-xs text-[#1D252D]/40">{value}</span>
      )}
    </div>
  )
}

====================================================================================================
END: src\components\sminex\ProfileScreen.tsx
====================================================================================================

====================================================================================================
FILE [40/52]: src\components\sminex\ProjectSelector.tsx
Size: 2,160 bytes
====================================================================================================

import { useState, useRef, useEffect } from 'react'
import { Building2, ChevronDown } from 'lucide-react'
import { complexes, type ResidentialComplex } from '../../data/sminex'

interface ProjectSelectorProps {
  selected: string | null
  onSelect: (complexId: string | null) => void
}

export default function ProjectSelector({ selected, onSelect }: ProjectSelectorProps) {
  const [open, setOpen] = useState(false)
  const ref = useRef<HTMLDivElement>(null)

  useEffect(() => {
    function handleClick(e: MouseEvent) {
      if (ref.current && !ref.current.contains(e.target as Node)) setOpen(false)
    }
    document.addEventListener('mousedown', handleClick)
    return () => document.removeEventListener('mousedown', handleClick)
  }, [])

  const options: { id: string | null; name: string }[] = [
    { id: null, name: 'Все объекты' },
    ...complexes.map((c: ResidentialComplex) => ({ id: c.id, name: c.name })),
  ]

  const current = options.find(o => o.id === selected) ?? options[0]

  return (
    <div ref={ref} className="relative">
      <button
        onClick={() => setOpen(!open)}
        className="flex items-center gap-2 bg-white rounded-full px-4 py-2 text-sm font-medium text-[#1D252D] shadow-sm border border-gray-100"
      >
        <Building2 className="w-4 h-4 text-[#8B7355]" />
        {current.name}
        <ChevronDown className={`w-3.5 h-3.5 transition-transform ${open ? 'rotate-180' : ''}`} />
      </button>
      {open && (
        <div className="absolute top-full left-0 mt-1 bg-white rounded-2xl shadow-lg border border-gray-100 py-1 z-50 min-w-[180px]">
          {options.map(o => (
            <button
              key={o.id ?? 'all'}
              onClick={() => { onSelect(o.id); setOpen(false) }}
              className={`w-full text-left px-4 py-2.5 text-sm transition-colors ${
                current.id === o.id ? 'bg-[#F5F1EC] font-semibold text-[#1D252D]' : 'text-[#1D252D]/70 hover:bg-[#F5F1EC]/50'
              }`}
            >
              {o.name}
            </button>
          ))}
        </div>
      )}
    </div>
  )
}

====================================================================================================
END: src\components\sminex\ProjectSelector.tsx
====================================================================================================

====================================================================================================
FILE [41/52]: src\components\sminex\RequestDetailScreen.tsx
Size: 10,499 bytes
====================================================================================================

import { useState } from 'react'
import { ChevronLeft, Send, Star } from 'lucide-react'
import {
  complexes, statusColors, statusLabels, priorityLabels, priorityColors,
  requestTypeIcons, requestTypeColors,
  type ServiceRequest, type UserProfile,
} from '../../data/sminex'

interface RequestDetailScreenProps {
  request: ServiceRequest
  user: UserProfile
  onBack: () => void
  onTakeInWork: (requestId: string) => void
  onCloseRequest: (requestId: string) => void
  onAssign: (requestId: string) => void
  onRate: (requestId: string, rating: number) => void
  onSendMessage: (requestId: string, text: string) => void
}

export default function RequestDetailScreen({
  request, user, onBack,
  onTakeInWork, onCloseRequest, onAssign, onRate, onSendMessage,
}: RequestDetailScreenProps) {
  const [message, setMessage] = useState('')
  const [hoverRating, setHoverRating] = useState(0)
  const complexName = complexes.find(c => c.id === request.complexId)?.name ?? request.complexId
  const TypeIcon = requestTypeIcons[request.type]
  const typeColor = requestTypeColors[request.type] || 'bg-gray-100 text-gray-600'

  const handleSend = () => {
    if (!message.trim()) return
    onSendMessage(request.id, message.trim())
    setMessage('')
  }

  const isManager = user.role === 'manager' || user.role === 'director'
  const isResident = user.role === 'resident'
  const canRate = isResident && request.status === 'completed' && !request.rating

  return (
    <div className="flex-1 overflow-y-auto animate-[fadeIn_0.2s_ease-out]">
      <div className="px-5 pt-3 pb-6 space-y-4">
        {/* Header */}
        <div className="flex items-center gap-3">
          <button onClick={onBack} className="text-[#1D252D]/50 hover:text-[#1D252D] transition-colors">
            <ChevronLeft className="w-5 h-5" />
          </button>
          <div className="flex-1">
            <div className="flex items-center gap-2">
              <h1 className="text-lg font-bold text-[#1D252D]">#{request.number}</h1>
              <span className={`text-[10px] font-medium px-2 py-0.5 rounded-full ${statusColors[request.status]}`}>
                {statusLabels[request.status]}
              </span>
            </div>
            <div className="flex items-center gap-2 mt-0.5">
              {TypeIcon && (
                <div className={`w-5 h-5 rounded-full flex items-center justify-center ${typeColor}`}>
                  <TypeIcon className="w-3 h-3" />
                </div>
              )}
              <p className="text-xs text-[#1D252D]/50">{request.type}</p>
            </div>
          </div>
        </div>

        {/* Info block */}
        <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50 space-y-3">
          <InfoRow label="Тип" value={request.type} />
          <InfoRow label="Категория" value={request.category} />
          <InfoRow label="ЖК" value={complexName} />
          <InfoRow label="Квартира" value={request.apartment} />
          <InfoRow label="Заявитель" value={request.resident} />
          <InfoRow label="Телефон" value={request.phone} />
          <InfoRow label="Создана" value={request.createdAt} />
          <InfoRow label="Приоритет">
            <span className={`font-medium ${priorityColors[request.priority]}`}>
              {priorityLabels[request.priority]}
            </span>
          </InfoRow>
          {request.assignee && <InfoRow label="Исполнитель" value={request.assignee} />}
        </div>

        {/* Description */}
        <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50">
          <p className="text-xs font-semibold text-[#1D252D]/50 mb-1.5">Описание</p>
          <p className="text-sm text-[#1D252D]">{request.description}</p>
        </div>

        {/* Rating for completed + resident */}
        {canRate && (
          <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50 text-center">
            <p className="text-xs font-semibold text-[#1D252D]/50 mb-2">Оцените работу</p>
            <div className="flex justify-center gap-1">
              {[1, 2, 3, 4, 5].map(star => (
                <button
                  key={star}
                  onClick={() => onRate(request.id, star)}
                  onMouseEnter={() => setHoverRating(star)}
                  onMouseLeave={() => setHoverRating(0)}
                  className="transition-transform active:scale-90"
                >
                  <Star
                    className={`w-7 h-7 ${
                      star <= (hoverRating || (request.rating ?? 0))
                        ? 'text-amber-400 fill-amber-400'
                        : 'text-gray-200'
                    }`}
                  />
                </button>
              ))}
            </div>
          </div>
        )}

        {request.rating && (
          <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50 text-center">
            <p className="text-xs font-semibold text-[#1D252D]/50 mb-2">Оценка</p>
            <div className="flex justify-center gap-0.5">
              {[1, 2, 3, 4, 5].map(star => (
                <Star
                  key={star}
                  className={`w-5 h-5 ${star <= request.rating! ? 'text-amber-400 fill-amber-400' : 'text-gray-200'}`}
                />
              ))}
            </div>
          </div>
        )}

        {/* Timeline */}
        <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50">
          <p className="text-xs font-semibold text-[#1D252D]/50 mb-3">История</p>
          <div className="space-y-0">
            {request.timeline.map((event, i) => (
              <div key={i} className="flex gap-3">
                <div className="flex flex-col items-center">
                  <div className={`w-2.5 h-2.5 rounded-full mt-1 ${i === 0 ? 'bg-[#1D252D]' : 'bg-[#1D252D]/20'}`} />
                  {i < request.timeline.length - 1 && <div className="w-px flex-1 bg-[#1D252D]/10 my-1" />}
                </div>
                <div className="pb-4">
                  <p className="text-xs font-medium text-[#1D252D]">{event.status}</p>
                  <p className="text-[10px] text-[#1D252D]/40">{event.author} · {event.date}</p>
                </div>
              </div>
            ))}
          </div>
        </div>

        {/* Chat */}
        {request.chat.length > 0 && (
          <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50">
            <p className="text-xs font-semibold text-[#1D252D]/50 mb-3">Комментарии</p>
            <div className="space-y-3">
              {request.chat.map(msg => (
                <div key={msg.id} className={`flex flex-col ${msg.role === 'resident' ? 'items-start' : 'items-end'}`}>
                  <div className={`max-w-[85%] rounded-2xl px-3.5 py-2.5 ${
                    msg.role === 'resident'
                      ? 'bg-[#F5F1EC] rounded-tl-sm'
                      : 'bg-[#1D252D] text-white rounded-tr-sm'
                  }`}>
                    <p className={`text-[10px] font-semibold mb-0.5 ${
                      msg.role === 'resident' ? 'text-[#8B7355]' : 'text-white/60'
                    }`}>{msg.author}</p>
                    <p className="text-xs">{msg.text}</p>
                  </div>
                  <p className="text-[9px] text-[#1D252D]/30 mt-0.5 px-1">{msg.date.split(' ')[1]}</p>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Chat input */}
        {request.status !== 'completed' && (
          <div className="flex gap-2">
            <input
              type="text"
              placeholder="Написать сообщение..."
              value={message}
              onChange={e => setMessage(e.target.value)}
              onKeyDown={e => e.key === 'Enter' && handleSend()}
              className="flex-1 bg-white rounded-full px-4 py-2.5 text-sm text-[#1D252D] placeholder:text-[#1D252D]/30 border border-gray-100 shadow-sm focus:outline-none focus:ring-2 focus:ring-[#8B7355]/30"
            />
            <button
              onClick={handleSend}
              disabled={!message.trim()}
              className="w-10 h-10 rounded-full bg-[#1D252D] flex items-center justify-center text-white transition-opacity hover:opacity-90 disabled:opacity-30 active:scale-[0.97] shrink-0"
            >
              <Send className="w-4 h-4" />
            </button>
          </div>
        )}

        {/* Action buttons */}
        <div className="space-y-2">
          {isManager && request.status === 'new' && (
            <button
              onClick={() => onTakeInWork(request.id)}
              className="w-full bg-[#1D252D] text-white rounded-full py-3 text-sm font-semibold transition-opacity hover:opacity-90 active:scale-[0.97]"
            >
              Взять в работу
            </button>
          )}
          {isManager && (request.status === 'new' || request.status === 'in_progress') && (
            <button
              onClick={() => onAssign(request.id)}
              className="w-full bg-white text-[#1D252D] rounded-full py-3 text-sm font-semibold border border-gray-200 transition-colors hover:bg-gray-50 active:scale-[0.97]"
            >
              Назначить исполнителя
            </button>
          )}
          {isManager && request.status === 'in_progress' && (
            <button
              onClick={() => onCloseRequest(request.id)}
              className="w-full bg-green-600 text-white rounded-full py-3 text-sm font-semibold transition-opacity hover:opacity-90 active:scale-[0.97]"
            >
              Закрыть заявку
            </button>
          )}
        </div>
      </div>
    </div>
  )
}

function InfoRow({ label, value, children }: { label: string; value?: string; children?: React.ReactNode }) {
  return (
    <div className="flex items-center justify-between">
      <span className="text-xs text-[#1D252D]/40">{label}</span>
      {children ?? <span className="text-xs font-medium text-[#1D252D]">{value}</span>}
    </div>
  )
}

====================================================================================================
END: src\components\sminex\RequestDetailScreen.tsx
====================================================================================================

====================================================================================================
FILE [42/52]: src\components\sminex\RequestsScreen.tsx
Size: 6,594 bytes
====================================================================================================

import { useState } from 'react'
import { Search } from 'lucide-react'
import {
  complexes, statusColors, statusLabels, priorityLabels, priorityColors,
  requestTypeIcons, requestTypeColors,
  type ServiceRequest, type RequestStatus, type UserProfile,
} from '../../data/sminex'

interface RequestsScreenProps {
  requests: ServiceRequest[]
  user: UserProfile
  selectedComplex: string | null
  onOpenRequest: (request: ServiceRequest) => void
}

type FilterStatus = 'all' | RequestStatus

export default function RequestsScreen({ requests, user, selectedComplex, onOpenRequest }: RequestsScreenProps) {
  const [search, setSearch] = useState('')
  const [filter, setFilter] = useState<FilterStatus>('all')

  // Filter by role
  let roleFiltered = requests
  if (user.role === 'resident') {
    roleFiltered = requests.filter(r => r.residentId === user.id || r.resident === user.name)
  } else if (user.role === 'manager' && user.complexId) {
    roleFiltered = requests.filter(r => r.complexId === user.complexId)
  }

  // Filter by complex selector (director)
  if (selectedComplex) {
    roleFiltered = roleFiltered.filter(r => r.complexId === selectedComplex)
  }

  const filtered = roleFiltered
    .filter(r => filter === 'all' || r.status === filter)
    .filter(r => {
      if (!search) return true
      const q = search.toLowerCase()
      return (
        r.description.toLowerCase().includes(q) ||
        r.type.toLowerCase().includes(q) ||
        r.resident.toLowerCase().includes(q) ||
        String(r.number).includes(q)
      )
    })
    .sort((a, b) => b.number - a.number)

  const getComplexName = (id: string) => complexes.find(c => c.id === id)?.name ?? id

  const filters: { id: FilterStatus; label: string; count: number }[] = [
    { id: 'all', label: 'Все', count: roleFiltered.length },
    { id: 'new', label: 'Новые', count: roleFiltered.filter(r => r.status === 'new').length },
    { id: 'in_progress', label: 'В работе', count: roleFiltered.filter(r => r.status === 'in_progress').length },
    { id: 'completed', label: 'Выполнены', count: roleFiltered.filter(r => r.status === 'completed').length },
    { id: 'overdue', label: 'Просрочены', count: roleFiltered.filter(r => r.status === 'overdue').length },
  ]

  return (
    <div className="flex-1 overflow-y-auto animate-[fadeIn_0.2s_ease-out]">
      <div className="px-5 pt-4 pb-6 space-y-4">
        <h1 className="text-xl font-bold text-[#1D252D]">
          {user.role === 'resident' ? 'Мои заявки' : 'Заявки'}
        </h1>

        <div className="relative">
          <Search className="absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-[#1D252D]/30" />
          <input
            type="text"
            placeholder="Поиск по номеру, типу, описанию..."
            value={search}
            onChange={e => setSearch(e.target.value)}
            className="w-full bg-white rounded-full pl-10 pr-4 py-2.5 text-sm text-[#1D252D] placeholder:text-[#1D252D]/30 border border-gray-100 shadow-sm focus:outline-none focus:ring-2 focus:ring-[#8B7355]/30"
          />
        </div>

        <div className="flex gap-2 overflow-x-auto pb-1 -mx-5 px-5 scrollbar-hide">
          {filters.map(f => (
            <button
              key={f.id}
              onClick={() => setFilter(f.id)}
              className={`shrink-0 px-3.5 py-1.5 rounded-full text-xs font-medium transition-colors ${
                filter === f.id
                  ? 'bg-[#1D252D] text-white'
                  : 'bg-white text-[#1D252D]/60 border border-gray-100'
              }`}
            >
              {f.label}
              <span className={`ml-1.5 ${filter === f.id ? 'text-white/60' : 'text-[#1D252D]/30'}`}>{f.count}</span>
            </button>
          ))}
        </div>

        <div className="space-y-2.5">
          {filtered.length === 0 && (
            <div className="text-center py-8 text-[#1D252D]/40 text-sm">Заявки не найдены</div>
          )}
          {filtered.map((req, i) => {
            const TypeIcon = requestTypeIcons[req.type]
            const typeColor = requestTypeColors[req.type] || 'bg-gray-100 text-gray-600'
            return (
              <button
                key={req.id}
                onClick={() => onOpenRequest(req)}
                className="w-full bg-white rounded-2xl p-4 text-left shadow-sm border border-gray-50 transition-shadow hover:shadow-md animate-[slideUp_0.3s_ease-out_both]"
                style={{ animationDelay: `${i * 50}ms` }}
              >
                <div className="flex items-start gap-3">
                  {TypeIcon && (
                    <div className={`w-9 h-9 rounded-full flex items-center justify-center shrink-0 ${typeColor}`}>
                      <TypeIcon className="w-4 h-4" />
                    </div>
                  )}
                  <div className="flex-1 min-w-0">
                    <div className="flex items-start justify-between mb-1">
                      <div className="flex items-center gap-2">
                        <span className="text-xs font-bold text-[#1D252D]">#{req.number}</span>
                        <span className="text-xs text-[#1D252D]/50">{req.type}</span>
                      </div>
                      <span className={`text-[10px] font-medium px-2 py-0.5 rounded-full ${statusColors[req.status]}`}>
                        {statusLabels[req.status]}
                      </span>
                    </div>
                    <p className="text-xs text-[#1D252D]/70 line-clamp-1 mb-1.5">{req.description}</p>
                    <div className="flex items-center justify-between">
                      <span className="text-[10px] text-[#1D252D]/40">
                        {user.role !== 'resident' && `${getComplexName(req.complexId)} · `}кв. {req.apartment}
                      </span>
                      <div className="flex items-center gap-2">
                        <span className={`text-[10px] font-medium ${priorityColors[req.priority]}`}>{priorityLabels[req.priority]}</span>
                        <span className="text-[10px] text-[#1D252D]/30">{req.createdAt.split(' ')[0].slice(5)}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </button>
            )
          })}
        </div>
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\RequestsScreen.tsx
====================================================================================================

====================================================================================================
FILE [43/52]: src\components\sminex\RoleSelectScreen.tsx
Size: 2,514 bytes
====================================================================================================

import { Home, ClipboardList, Building2 } from 'lucide-react'
import { users, type UserRole } from '../../data/sminex'

interface RoleSelectScreenProps {
  onSelectRole: (role: UserRole) => void
}

const roleConfig: Record<UserRole, { icon: typeof Home; accent: string; iconBg: string }> = {
  resident: { icon: Home, accent: 'border-l-blue-400', iconBg: 'bg-[#1D252D]' },
  manager: { icon: ClipboardList, accent: 'border-l-amber-400', iconBg: 'bg-[#8B7355]' },
  director: { icon: Building2, accent: 'border-l-emerald-400', iconBg: 'bg-[#1D252D]' },
}

export default function RoleSelectScreen({ onSelectRole }: RoleSelectScreenProps) {
  return (
    <div className="flex-1 flex flex-col items-center justify-center px-6">
      {/* Logo */}
      <div className="mb-2 animate-[fadeIn_0.4s_ease-out_both]">
        <h1 className="text-2xl font-bold tracking-[0.25em] text-[#1D252D]">SMINEX</h1>
      </div>
      <p className="text-xs text-[#1D252D]/50 font-medium mb-10 animate-[fadeIn_0.4s_ease-out_0.1s_both]">CRM жилых комплексов</p>

      {/* Role cards */}
      <div className="w-full space-y-3">
        {users.map((user, i) => {
          const config = roleConfig[user.role]
          const Icon = config.icon
          return (
            <button
              key={user.id}
              onClick={() => onSelectRole(user.role)}
              className={`w-full bg-white rounded-2xl p-4 text-left shadow-sm border border-gray-100 border-l-4 ${config.accent} transition-all hover:shadow-md active:scale-[0.97] flex items-center gap-4 animate-[fadeIn_0.4s_ease-out_both]`}
              style={{ animationDelay: `${200 + i * 80}ms` }}
            >
              <div className={`w-12 h-12 rounded-full ${config.iconBg} flex items-center justify-center shrink-0`}>
                <Icon className="w-5 h-5 text-white" />
              </div>
              <div className="flex-1 min-w-0">
                <p className="text-sm font-bold text-[#1D252D]">{user.roleLabel}</p>
                <p className="text-xs text-[#1D252D]/70 font-medium">{user.name}</p>
                <p className="text-[10px] text-[#1D252D]/40 mt-0.5">{user.description}</p>
              </div>
            </button>
          )
        })}
      </div>

      {/* Footer */}
      <p className="text-[10px] text-[#1D252D]/30 mt-10 animate-[fadeIn_0.4s_ease-out_0.6s_both]">Демо-прототип · данные вымышлены</p>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\RoleSelectScreen.tsx
====================================================================================================

====================================================================================================
FILE [44/52]: src\components\sminex\ServicesScreen.tsx
Size: 4,663 bytes
====================================================================================================

import { useState, type ReactNode } from 'react'
import { Clock, CheckCircle2, Shirt, Sparkles, Car, Droplets, Baby, Wrench } from 'lucide-react'
import SubScreenHeader from './SubScreenHeader'
import { conciergeServices, type ActiveOrder } from '../../data/sminex'

const serviceIcons: Record<string, ReactNode> = {
  'shirt': <Shirt className="w-5 h-5" />,
  'sparkles': <Sparkles className="w-5 h-5" />,
  'car': <Car className="w-5 h-5" />,
  'droplets': <Droplets className="w-5 h-5" />,
  'baby': <Baby className="w-5 h-5" />,
  'wrench': <Wrench className="w-5 h-5" />,
}

interface ServicesScreenProps {
  onBack: () => void
  onToast: (msg: string) => void
}

export default function ServicesScreen({ onBack, onToast }: ServicesScreenProps) {
  const [activeOrders, setActiveOrders] = useState<ActiveOrder[]>([])

  const handleOrder = (_serviceId: string, serviceName: string) => {
    const newOrder: ActiveOrder = {
      id: `ao-${Date.now()}`,
      service: serviceName,
      status: 'pending',
      date: '26.02.2026',
    }
    setActiveOrders(prev => [newOrder, ...prev])
    onToast(`${serviceName} — заказ оформлен`)

    // Simulate status change after 3 seconds
    setTimeout(() => {
      setActiveOrders(prev =>
        prev.map(o => o.id === newOrder.id ? { ...o, status: 'in_progress' } : o)
      )
    }, 3000)
  }

  const orderStatusLabel: Record<string, string> = {
    pending: 'Ожидает', in_progress: 'В процессе', done: 'Выполнен',
  }
  const orderStatusColor: Record<string, string> = {
    pending: 'bg-amber-100 text-amber-700',
    in_progress: 'bg-blue-100 text-blue-700',
    done: 'bg-green-100 text-green-700',
  }

  return (
    <div className="flex-1 overflow-y-auto animate-[fadeIn_0.2s_ease-out]">
      <SubScreenHeader title="Услуги" onBack={onBack} />

      <div className="px-5 pb-6 space-y-4">
        {/* Active orders */}
        {activeOrders.length > 0 && (
          <div>
            <h2 className="text-xs font-bold text-[#1D252D] mb-2">Активные заказы</h2>
            <div className="space-y-2">
              {activeOrders.map(order => (
                <div key={order.id} className="bg-white rounded-2xl p-3.5 shadow-sm border border-gray-50 flex items-center gap-3">
                  <div className="w-8 h-8 rounded-full bg-[#F5F1EC] flex items-center justify-center">
                    {order.status === 'done'
                      ? <CheckCircle2 className="w-4 h-4 text-green-600" />
                      : <Clock className="w-4 h-4 text-[#8B7355]" />
                    }
                  </div>
                  <div className="flex-1 min-w-0">
                    <p className="text-xs font-semibold text-[#1D252D]">{order.service}</p>
                    <p className="text-[10px] text-[#1D252D]/40">{order.date}</p>
                  </div>
                  <span className={`text-[10px] font-medium px-2 py-0.5 rounded-full ${orderStatusColor[order.status]}`}>
                    {orderStatusLabel[order.status]}
                  </span>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Service grid */}
        <div>
          <h2 className="text-xs font-bold text-[#1D252D] mb-2">Консьерж-сервис</h2>
          <div className="grid grid-cols-2 gap-2.5">
            {conciergeServices.map(service => (
              <div key={service.id} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50 flex flex-col">
                <div className="w-10 h-10 rounded-xl bg-[#F5F1EC] flex items-center justify-center text-[#8B7355] mb-2">
                  {serviceIcons[service.icon]}
                </div>
                <p className="text-xs font-bold text-[#1D252D] mb-0.5">{service.name}</p>
                <p className="text-[10px] text-[#1D252D]/40 mb-2 flex-1">{service.description}</p>
                <div className="flex items-center justify-between">
                  <span className="text-[10px] font-semibold text-[#8B7355]">{service.price}</span>
                  <button
                    onClick={() => handleOrder(service.id, service.name)}
                    className="text-[10px] font-semibold text-white bg-[#1D252D] px-3 py-1 rounded-full hover:opacity-90 transition-opacity active:scale-[0.95]"
                  >
                    Заказать
                  </button>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\ServicesScreen.tsx
====================================================================================================

====================================================================================================
FILE [45/52]: src\components\sminex\SmartHomeScreen.tsx
Size: 10,451 bytes
====================================================================================================

import { useState, type ReactNode } from 'react'
import { Thermometer, Lightbulb, Power, Lock, Blinds, Zap, Home, DoorOpen, Sunrise, MoonStar, Sun, Sunset, Film, Moon } from 'lucide-react'
import SubScreenHeader from './SubScreenHeader'
import {
  smartRooms, smartDevices as initialDevices, lightScenes as initialScenes,
  sensors, smartScenarios as initialScenarios,
  type SmartDevice, type LightScene, type SmartScenario,
} from '../../data/sminex'

const scenarioIcons: Record<string, ReactNode> = {
  'home': <Home className="w-5 h-5" />,
  'door-open': <DoorOpen className="w-5 h-5" />,
  'sunrise': <Sunrise className="w-5 h-5" />,
  'moon-star': <MoonStar className="w-5 h-5" />,
}

const sceneIcons: Record<string, ReactNode> = {
  'sun': <Sun className="w-5 h-5" />,
  'sunset': <Sunset className="w-5 h-5" />,
  'film': <Film className="w-5 h-5" />,
  'moon': <Moon className="w-5 h-5" />,
}

interface SmartHomeScreenProps {
  onBack: () => void
}

export default function SmartHomeScreen({ onBack }: SmartHomeScreenProps) {
  const [selectedRoom, setSelectedRoom] = useState('Все')
  const [temperature, setTemperature] = useState(22)
  const [scenarios, setScenarios] = useState<SmartScenario[]>(initialScenarios)
  const [activatingScenario, setActivatingScenario] = useState<string | null>(null)
  const [devices, setDevices] = useState<SmartDevice[]>(initialDevices)
  const [scenes, setScenes] = useState<LightScene[]>(initialScenes)

  const filteredDevices = selectedRoom === 'Все'
    ? devices
    : devices.filter(d => d.room === selectedRoom)

  const filteredSensors = selectedRoom === 'Все'
    ? sensors
    : sensors.filter(s => s.room === selectedRoom)

  const toggleDevice = (id: string) => {
    setDevices(prev => prev.map(d => d.id === id ? { ...d, isOn: !d.isOn } : d))
  }

  const activateScene = (id: string) => {
    setScenes(prev => prev.map(s => ({ ...s, isActive: s.id === id })))
  }

  const deviceIcon = (type: string) => {
    switch (type) {
      case 'light': return <Lightbulb className="w-4 h-4" />
      case 'outlet': return <Power className="w-4 h-4" />
      case 'lock': return <Lock className="w-4 h-4" />
      case 'curtains': return <Blinds className="w-4 h-4" />
      default: return <Power className="w-4 h-4" />
    }
  }

  const activateScenario = (id: string) => {
    setActivatingScenario(id)
    setScenarios(prev => prev.map(s => ({ ...s, isActive: s.id === id })))
    setTimeout(() => setActivatingScenario(null), 1500)
  }

  return (
    <div className="flex-1 overflow-y-auto animate-[fadeIn_0.2s_ease-out]">
      <SubScreenHeader title="Умный дом" onBack={onBack} />

      <div className="px-5 pb-6 space-y-4">
        {/* Scenarios */}
        <div>
          <div className="flex items-center gap-2 mb-2">
            <Zap className="w-3.5 h-3.5 text-[#8B7355]" />
            <h3 className="text-xs font-bold text-[#1D252D]">Сценарии</h3>
          </div>
          <div className="grid grid-cols-2 gap-2">
            {scenarios.map(scenario => (
              <button
                key={scenario.id}
                onClick={() => activateScenario(scenario.id)}
                className={`rounded-2xl p-3 text-left transition-all active:scale-[0.97] ${
                  scenario.isActive
                    ? 'bg-[#1D252D] text-white shadow-lg'
                    : 'bg-white text-[#1D252D] border border-gray-100'
                }`}
              >
                <div className="flex items-center gap-2 mb-1">
                  <span className={scenario.isActive ? 'text-white' : 'text-[#8B7355]'}>{scenarioIcons[scenario.icon]}</span>
                  <span className="text-xs font-bold">{scenario.name}</span>
                </div>
                <p className={`text-[9px] leading-tight ${scenario.isActive ? 'text-white/50' : 'text-[#1D252D]/40'}`}>
                  {scenario.description}
                </p>
                {activatingScenario === scenario.id && (
                  <div className="mt-1.5 flex items-center gap-1">
                    <span className="w-3 h-3 border-2 border-white/50 border-t-white rounded-full animate-spin" />
                    <span className="text-[9px] text-white/60">Применяю...</span>
                  </div>
                )}
                {scenario.isActive && activatingScenario !== scenario.id && (
                  <p className="text-[9px] text-green-400 mt-1">Активен</p>
                )}
              </button>
            ))}
          </div>
        </div>

        {/* Room pills */}
        <div className="flex gap-2 overflow-x-auto pb-1 -mx-5 px-5 scrollbar-hide">
          {smartRooms.map(room => (
            <button
              key={room}
              onClick={() => setSelectedRoom(room)}
              className={`px-3.5 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-colors ${
                selectedRoom === room
                  ? 'bg-[#1D252D] text-white'
                  : 'bg-white text-[#1D252D]/60 border border-gray-100'
              }`}
            >
              {room}
            </button>
          ))}
        </div>

        {/* Climate */}
        <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-50">
          <div className="flex items-center gap-2 mb-3">
            <Thermometer className="w-4 h-4 text-[#8B7355]" />
            <h3 className="text-xs font-bold text-[#1D252D]">Климат</h3>
          </div>
          <div className="flex items-center justify-between mb-2">
            <span className="text-2xl font-bold text-[#1D252D]">{temperature}°C</span>
            <span className="text-[10px] text-[#1D252D]/40">Целевая температура</span>
          </div>
          <input
            type="range"
            min={16}
            max={30}
            value={temperature}
            onChange={e => setTemperature(Number(e.target.value))}
            className="w-full h-1.5 bg-[#F5F1EC] rounded-full appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-[#1D252D] [&::-webkit-slider-thumb]:shadow-md"
          />
          <div className="flex justify-between mt-1">
            <span className="text-[10px] text-[#1D252D]/30">16°C</span>
            <span className="text-[10px] text-[#1D252D]/30">30°C</span>
          </div>
        </div>

        {/* Light scenes */}
        <div>
          <h3 className="text-xs font-bold text-[#1D252D] mb-2">Сцены освещения</h3>
          <div className="grid grid-cols-4 gap-2">
            {scenes.map(scene => (
              <button
                key={scene.id}
                onClick={() => activateScene(scene.id)}
                className={`rounded-2xl p-3 text-center transition-all active:scale-[0.95] ${
                  scene.isActive
                    ? 'bg-[#1D252D] text-white shadow-lg'
                    : 'bg-white text-[#1D252D] border border-gray-100'
                }`}
              >
                <span className={`block mb-1 ${scene.isActive ? 'text-white' : 'text-[#8B7355]'}`}>{sceneIcons[scene.icon]}</span>
                <p className="text-[9px] font-medium leading-tight">{scene.name}</p>
              </button>
            ))}
          </div>
        </div>

        {/* Devices */}
        <div>
          <h3 className="text-xs font-bold text-[#1D252D] mb-2">Устройства</h3>
          <div className="grid grid-cols-2 gap-2">
            {filteredDevices.map(device => (
              <button
                key={device.id}
                onClick={() => toggleDevice(device.id)}
                className={`rounded-2xl p-3.5 text-left transition-all duration-300 active:scale-[0.97] ${
                  device.isOn
                    ? 'bg-[#1D252D] text-white shadow-lg'
                    : 'bg-white text-[#1D252D] border border-gray-100'
                }`}
              >
                <div className="flex items-center justify-between mb-2">
                  <div className={`w-8 h-8 rounded-full flex items-center justify-center transition-colors duration-300 ${
                    device.isOn ? 'bg-white/20' : 'bg-[#F5F1EC]'
                  }`}>
                    <span className={`transition-colors duration-300 ${device.isOn ? 'text-white' : 'text-[#8B7355]'}`}>
                      {deviceIcon(device.type)}
                    </span>
                  </div>
                  {/* Mini toggle */}
                  <div className={`w-9 h-[22px] rounded-full relative transition-colors duration-300 ${device.isOn ? 'bg-white/25' : 'bg-gray-200'}`}>
                    <div className={`absolute top-[3px] w-4 h-4 rounded-full shadow-sm transition-all duration-300 ${
                      device.isOn ? 'left-[18px] bg-white' : 'left-[3px] bg-white'
                    }`} />
                  </div>
                </div>
                <p className="text-xs font-semibold">{device.name}</p>
                <p className={`text-[10px] transition-colors duration-300 ${device.isOn ? 'text-white/50' : 'text-[#1D252D]/40'}`}>
                  {device.room}
                </p>
              </button>
            ))}
          </div>
        </div>

        {/* Sensors */}
        {filteredSensors.length > 0 && (
          <div>
            <h3 className="text-xs font-bold text-[#1D252D] mb-2">Датчики</h3>
            <div className="bg-white rounded-2xl shadow-sm border border-gray-50 divide-y divide-gray-50">
              {filteredSensors.map(sensor => (
                <div key={sensor.id} className="flex items-center justify-between px-4 py-3">
                  <div>
                    <p className="text-xs text-[#1D252D]">{sensor.name}</p>
                    <p className="text-[10px] text-[#1D252D]/40">{sensor.room}</p>
                  </div>
                  <span className="text-sm font-bold text-[#1D252D]">{sensor.value}{sensor.unit}</span>
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\SmartHomeScreen.tsx
====================================================================================================

====================================================================================================
FILE [46/52]: src\components\sminex\SubScreenHeader.tsx
Size: 729 bytes
====================================================================================================

import { ChevronLeft } from 'lucide-react'

interface SubScreenHeaderProps {
  title: string
  onBack: () => void
  rightElement?: React.ReactNode
}

export default function SubScreenHeader({ title, onBack, rightElement }: SubScreenHeaderProps) {
  return (
    <div className="flex items-center gap-3 px-5 pt-3 pb-2">
      <button
        onClick={onBack}
        className="w-8 h-8 rounded-full bg-white/80 flex items-center justify-center text-[#1D252D]/60 hover:text-[#1D252D] hover:bg-white transition-colors shadow-sm"
      >
        <ChevronLeft className="w-5 h-5" />
      </button>
      <h1 className="flex-1 text-lg font-bold text-[#1D252D]">{title}</h1>
      {rightElement}
    </div>
  )
}

====================================================================================================
END: src\components\sminex\SubScreenHeader.tsx
====================================================================================================

====================================================================================================
FILE [47/52]: src\components\sminex\Toast.tsx
Size: 1,635 bytes
====================================================================================================

import { useEffect, useState } from 'react'
import { CheckCircle, AlertTriangle } from 'lucide-react'

export interface ToastMessage {
  id: string
  text: string
  type: 'success' | 'error'
}

interface ToastProps {
  toast: ToastMessage
  onDismiss: (id: string) => void
}

const DURATION = 3000

export default function Toast({ toast, onDismiss }: ToastProps) {
  const [exiting, setExiting] = useState(false)

  useEffect(() => {
    const exitTimer = setTimeout(() => setExiting(true), DURATION - 300)
    const removeTimer = setTimeout(() => onDismiss(toast.id), DURATION)
    return () => { clearTimeout(exitTimer); clearTimeout(removeTimer) }
  }, [toast.id, onDismiss])

  return (
    <div className={`absolute top-3 left-3 right-3 z-50 ${exiting ? 'animate-[toastOut_0.3s_ease-in_forwards]' : 'animate-[toastIn_0.3s_ease-out]'}`}>
      <div className="bg-[#1D252D] text-white rounded-2xl shadow-lg px-4 py-3 flex items-center gap-3 overflow-hidden relative">
        {toast.type === 'success' ? (
          <CheckCircle className="w-5 h-5 text-green-400 shrink-0" />
        ) : (
          <AlertTriangle className="w-5 h-5 text-amber-400 shrink-0" />
        )}
        <p className="text-sm font-medium flex-1">{toast.text}</p>
        {/* Progress bar */}
        <div className="absolute bottom-0 left-0 right-0 h-[2px] bg-white/10">
          <div
            className="h-full bg-white/30 rounded-full"
            style={{
              animation: `toastProgress ${DURATION}ms linear forwards`,
            }}
          />
        </div>
      </div>
    </div>
  )
}

====================================================================================================
END: src\components\sminex\Toast.tsx
====================================================================================================


####################################################################################################
# DIR: src\data
####################################################################################################

====================================================================================================
FILE [48/52]: src\data\prescriptions.ts
Size: 7,612 bytes
====================================================================================================

/** Sample prescriptions for the DataBook mini-demo */
export interface Prescription {
  id: number
  category: string
  text: string
  object: string
  date: string
}

export const samplePrescriptions: Prescription[] = [
  { id: 1, category: 'Бетонные работы', text: 'Обнаружены раковины и каверны на поверхности монолитной плиты перекрытия. Глубина дефектов до 15мм. Требуется ремонт поверхности согласно ППР.', object: 'Корпус 3', date: '2024-01-15' },
  { id: 2, category: 'Кирпичная кладка', text: 'Отклонение кирпичной кладки наружных стен от вертикали превышает допустимые значения по СП 70.13330. Отклонение 18мм при допуске 10мм.', object: 'Корпус 7', date: '2024-02-03' },
  { id: 3, category: 'Гидроизоляция', text: 'Нарушена целостность гидроизоляционного ковра в зоне примыкания к парапету кровли. Обнаружены вздутия и отслоения мембраны.', object: 'Корпус 1', date: '2024-01-22' },
  { id: 4, category: 'Фасадные работы', text: 'Отсутствуют температурные швы в облицовке фасада из керамогранита. Шаг установки не соответствует проектной документации.', object: 'Корпус 5', date: '2024-03-10' },
  { id: 5, category: 'Армирование', text: 'Защитный слой бетона арматуры фундаментной плиты менее проектного значения. Фактический — 25мм, проектный — 50мм. Фиксаторы арматуры установлены с нарушением шага.', object: 'Корпус 2', date: '2024-01-08' },
  { id: 6, category: 'Вентиляция', text: 'Воздуховоды приточной вентиляции не закреплены к перекрытию. Отсутствуют хомуты и подвесы на участке от секции 3 до секции 5. Вибрация при работе системы.', object: 'Корпус 9', date: '2024-02-18' },
  { id: 7, category: 'Электромонтаж', text: 'Кабельные линии проложены без соблюдения требуемых расстояний от трубопроводов отопления. Минимальное расстояние 50мм вместо требуемых 200мм.', object: 'Корпус 4', date: '2024-03-05' },
  { id: 8, category: 'Отделочные работы', text: 'Штукатурка стен выполнена без грунтования основания. Обнаружены участки с отслоением штукатурного слоя. Площадь дефектов — до 2м² на этаж.', object: 'Корпус 6', date: '2024-02-25' },
  { id: 9, category: 'Бетонные работы', text: 'Не выдержан режим ухода за бетоном в зимних условиях. Температура прогрева ниже нормативной. Требуется проверка прочности неразрушающим методом.', object: 'Корпус 11', date: '2024-01-30' },
  { id: 10, category: 'Кровельные работы', text: 'Уклон кровли не обеспечивает водоотведение к воронкам. Застой воды на площади более 5м². Требуется устройство разуклонки из керамзитобетона.', object: 'Корпус 8', date: '2024-03-15' },
  { id: 11, category: 'Сварочные работы', text: 'Сварные соединения арматурных каркасов выполнены без контроля УЗД. Обнаружены непровары и подрезы. Отсутствуют акты освидетельствования сварных соединений.', object: 'Корпус 3', date: '2024-02-12' },
  { id: 12, category: 'Благоустройство', text: 'Бордюрный камень установлен с отклонением от проектной линии. Перепад высот между смежными элементами — 12мм при допуске 3мм.', object: 'Территория', date: '2024-04-01' },
  { id: 13, category: 'Водоснабжение', text: 'Трубопроводы ГВС смонтированы без теплоизоляции на участке от ИТП до стояков. Теплопотери и конденсат на трубах.', object: 'Корпус 10', date: '2024-03-20' },
  { id: 14, category: 'Лифтовое оборудование', text: 'Зазор между створками дверей лифта и порталом превышает допустимые значения. Фактический зазор 8мм при нормативе не более 6мм по ГОСТ 33984.1.', object: 'Корпус 5', date: '2024-04-10' },
  { id: 15, category: 'Противопожарная защита', text: 'Отсутствует заделка кабельных проходок через противопожарные преграды. Нарушена огнестойкость перекрытия в местах прохода инженерных коммуникаций.', object: 'Корпус 7', date: '2024-03-28' },
  { id: 16, category: 'Монтажные работы', text: 'Оконные блоки установлены без пароизоляционной ленты с внутренней стороны. Монтажный шов не соответствует требованиям ГОСТ 30971.', object: 'Корпус 2', date: '2024-02-08' },
  { id: 17, category: 'Бетонные работы', text: 'Трещины в монолитных стенах подвала. Ширина раскрытия до 0.3мм. Требуется обследование и инъектирование полиуретановыми составами.', object: 'Корпус 1', date: '2024-01-18' },
  { id: 18, category: 'Отделочные работы', text: 'Напольная плитка в местах общего пользования уложена с пустотами под плиткой более 10% площади. Простукивание выявило пустоты на лестничных площадках.', object: 'Корпус 4', date: '2024-04-05' },
  { id: 19, category: 'Канализация', text: 'Уклон канализационных трубопроводов D110 менее нормативного. Фактический уклон 0.01 при требуемом 0.02 по СП 30.13330. Риск засоров.', object: 'Корпус 6', date: '2024-03-12' },
  { id: 20, category: 'Фасадные работы', text: 'Навесная фасадная система: кронштейны установлены без паронитовых прокладок. Мостики холода в зоне крепления. Нарушение теплотехнического расчёта.', object: 'Корпус 9', date: '2024-02-22' },
]

====================================================================================================
END: src\data\prescriptions.ts
====================================================================================================

====================================================================================================
FILE [49/52]: src\data\products.ts
Size: 6,533 bytes
====================================================================================================

export interface Product {
  id: string
  name: string
  oneliner: string
  status: 'production' | 'pilot' | 'prototype'
  metrics: { value: string; label: string }[]
  pain: string
  solution: string
  result: string
  tech: string[]
  demoText: string
  demoSubject: string
}

export const products: Product[] = [
  {
    id: 'aihub',
    name: 'AI-Hub',
    oneliner: 'Корпоративный SSO-портал и инфраструктурное ядро экосистемы',
    status: 'production',
    metrics: [
      { value: 'OAuth2', label: '+ PKCE + OIDC' },
      { value: 'ADFS', label: 'корпоративная интеграция' },
      { value: 'CI/CD', label: 'GitHub Actions' },
    ],
    pain: 'Разрозненные инструменты без единой авторизации. Каждый сервис — отдельный вход. Отсутствие контроля доступов и аудита использования.',
    solution: 'OAuth2 Authorization Server с PKCE. Интеграция с Active Directory (ADFS/OIDC). AI-чат (Gemini streaming), каталог приложений, система промптов, admin-панель с RBAC.',
    result: 'Единая точка входа для всей экосистемы. Полный аудит действий. Управление пользователями, группами, доступами. Автоматический деплой через GitHub Actions.',
    tech: ['FastAPI async', 'React 19', 'TypeScript', 'PostgreSQL', 'OAuth2/PKCE', 'ADFS/OIDC', 'JWT', 'Docker', 'Nginx', 'GitHub Actions'],
    demoText: 'Документация и демонстрация admin-панели — по запросу',
    demoSubject: 'AI-Hub Demo',
  },
  {
    id: 'autoprotocol',
    name: 'Автопротокол v2',
    oneliner: 'ML-система автоматического протоколирования совещаний',
    status: 'production',
    metrics: [
      { value: '7', label: 'этапов ML-пайплайна' },
      { value: '90+', label: 'языков транскрипции' },
      { value: '3', label: 'бизнес-домена' },
    ],
    pain: 'Ручное протоколирование совещаний. Администратор проекта тратит значительное время на расшифровку, структурирование и распределение поручений.',
    solution: 'Многоэтапный ML-пайплайн: транскрипция (WhisperX) → диаризация спикеров (pyannote) → анализ эмоций (wav2vec2) → структурирование и генерация артефактов (Gemini).',
    result: 'Кратное сокращение времени подготовки протоколов. Автоматическая генерация риск-брифов. Пилотируется на проектах. Три конфигурации: строительство, HR, IT.',
    tech: ['FastAPI', 'Celery', 'Redis', 'WhisperX', 'pyannote', 'wav2vec2', 'Gemini', 'CUDA/GPU', 'React', 'Docker'],
    demoText: 'Демонстрация обработки аудиозаписи — по запросу',
    demoSubject: 'Autoprotocol Demo',
  },
  {
    id: 'costmanager',
    name: 'CostManager',
    oneliner: 'AI-аналитика себестоимости строительства и бенчмаркинг объектов-аналогов',
    status: 'production',
    metrics: [
      { value: '~8', label: 'пользователей (отдел)' },
      { value: 'P10/P90', label: 'статистический анализ' },
      { value: 'Decimal', label: 'финансовая точность' },
    ],
    pain: 'Ручной анализ строительных смет. Классификация позиций вручную. Сравнение объектов-аналогов в разрозненных таблицах Excel.',
    solution: 'AI-автоклассификация сметных позиций (Gemini + Ollama). Иерархическая разбивка затрат с дефлятированием. Генерация аналитических Excel-отчётов с P10/P90.',
    result: 'Департамент экономики строительства полностью перешёл на инструмент. Профессиональные отчёты: титульный лист, сравнительный анализ, попарное сравнение, рыночная валидация.',
    tech: ['Python', 'Flask', 'PostgreSQL', 'Gemini API', 'Ollama', 'xlsxwriter', 'NumPy', 'Chart.js'],
    demoText: 'Примеры отчётов и демонстрация интерфейса — по запросу',
    demoSubject: 'CostManager Demo',
  },
  {
    id: 'databook',
    name: 'DataBook',
    oneliner: 'Интеллектуальный поиск по базе предписаний строительного контроля',
    status: 'production',
    metrics: [
      { value: '8 500+', label: 'уникальных предписаний' },
      { value: '~25 000', label: 'исходных записей' },
      { value: 'ежедневно', label: 'используется инженерами' },
    ],
    pain: 'Инженеры СК тратят значительное время на поиск прецедентов предписаний в разрозненных источниках. Нет единой структурированной базы.',
    solution: 'NLP-система с лемматизацией русского языка. Дедупликация через векторную близость (25 000 → 8 500). Полнотекстовый поиск PostgreSQL с fuzzy matching.',
    result: 'Ежедневно используется инженерами на объектах. Organic adoption: внедрение без административного давления. Поиск прецедента — секунды вместо часов.',
    tech: ['Python', 'FastAPI', 'PostgreSQL FTS', 'NLP', 'Vector Similarity', 'React', 'Docker'],
    demoText: 'Демонстрация доступна по запросу',
    demoSubject: 'DataBook Demo',
  },
]

====================================================================================================
END: src\data\products.ts
====================================================================================================

====================================================================================================
FILE [50/52]: src\data\sminex.ts
Size: 41,869 bytes
====================================================================================================

import type { ComponentType } from 'react'
import { Droplets, Volume2, Car, DoorOpen, ArrowUpDown, Trash2, Trees, Zap } from 'lucide-react'

export type SubScreen = 'intercom' | 'cameras' | 'smart-home' | 'services' | 'bills' | 'parking' | 'floor-plan' | 'booking' | 'packages' | 'privileges' | null

export type RequestStatus = 'new' | 'in_progress' | 'completed' | 'overdue'
export type Priority = 'low' | 'medium' | 'high' | 'critical'
export type UserRole = 'resident' | 'manager' | 'director'

export interface OwnedProperty {
  id: string
  complexId: string
  complexName: string
  apartment: string
  type: 'apartment' | 'studio' | 'penthouse' | 'storage' | 'commercial'
  typeLabel: string
  area: number
  floor: number
  rooms: FloorPlanRoom[]
}

export interface FloorPlanRoom {
  id: string
  name: string
  x: number
  y: number
  w: number
  h: number
  temperature?: number
  humidity?: number
  devicesOn: number
  devicesTotal: number
}

export interface UserProfile {
  id: string
  name: string
  initials: string
  role: UserRole
  roleLabel: string
  complexId?: string
  apartment?: string
  phone?: string
  position?: string
  description: string
  properties?: OwnedProperty[]
}

export interface ResidentialComplex {
  id: string
  name: string
  address: string
}

export interface TimelineEvent {
  date: string
  status: string
  author: string
}

export interface ChatMessage {
  id: string
  author: string
  role: 'resident' | 'manager' | 'executor'
  text: string
  date: string
}

export interface ServiceRequest {
  id: string
  number: number
  type: string
  category: string
  complexId: string
  apartment: string
  resident: string
  residentId?: string
  phone: string
  description: string
  status: RequestStatus
  priority: Priority
  createdAt: string
  updatedAt: string
  assignee?: string
  timeline: TimelineEvent[]
  chat: ChatMessage[]
  rating?: number
}

export interface Notification {
  id: string
  text: string
  time: string
  type: 'status_change' | 'assigned' | 'completed' | 'rate' | 'info'
  read: boolean
  requestNumber?: number
  forRole: UserRole[]
}

export interface DashboardMetrics {
  newRequests: number
  newRequestsTrend: number
  avgResponseTime: number
  avgResponseTrend: number
  slaCompliance: number
  slaTrend: number
  overdue: number
  overdueTrend: number
}

export interface AnalyticsData {
  period: string
  totalRequests: number
  avgCloseTime: number
  satisfaction: number
  slaCompliance: number
  requestsByDay: { day: string; count: number }[]
  requestsByType: { type: string; count: number; color: string }[]
  topCategories: { category: string; count: number; trend: number }[]
}

export const users: UserProfile[] = [
  {
    id: 'resident-1',
    name: 'Иванов А.С.',
    initials: 'ИА',
    role: 'resident',
    roleLabel: 'Собственник',
    complexId: 'river-park',
    apartment: '142',
    phone: '+7 (999) 123-45-67',
    description: 'кв. 142, Ривер Парк',
    properties: [
      {
        id: 'prop-1',
        complexId: 'river-park',
        complexName: 'Ривер Парк',
        apartment: '142',
        type: 'apartment',
        typeLabel: 'Квартира',
        area: 98.5,
        floor: 12,
        rooms: [
          { id: 'rm-hall', name: 'Прихожая', x: 0, y: 0, w: 30, h: 25, temperature: 22, humidity: 40, devicesOn: 1, devicesTotal: 2 },
          { id: 'rm-living', name: 'Гостиная', x: 30, y: 0, w: 45, h: 55, temperature: 22.5, humidity: 45, devicesOn: 3, devicesTotal: 4 },
          { id: 'rm-kitchen', name: 'Кухня', x: 75, y: 0, w: 25, h: 40, temperature: 23, humidity: 50, devicesOn: 1, devicesTotal: 2 },
          { id: 'rm-bedroom', name: 'Спальня', x: 0, y: 25, w: 30, h: 40, temperature: 21, humidity: 48, devicesOn: 1, devicesTotal: 3 },
          { id: 'rm-child', name: 'Детская', x: 0, y: 65, w: 30, h: 35, temperature: 22, humidity: 45, devicesOn: 0, devicesTotal: 2 },
          { id: 'rm-bath', name: 'Ванная', x: 75, y: 40, w: 25, h: 30, temperature: 24, humidity: 65, devicesOn: 1, devicesTotal: 1 },
          { id: 'rm-wc', name: 'С/У', x: 75, y: 70, w: 25, h: 30, devicesOn: 0, devicesTotal: 0 },
          { id: 'rm-balcony', name: 'Балкон', x: 30, y: 55, w: 45, h: 15, devicesOn: 0, devicesTotal: 1 },
        ],
      },
      {
        id: 'prop-2',
        complexId: 'west-garden',
        complexName: 'Вест Гарден',
        apartment: '301',
        type: 'studio',
        typeLabel: 'Студия',
        area: 42.0,
        floor: 3,
        rooms: [
          { id: 'rm2-main', name: 'Студия', x: 0, y: 0, w: 70, h: 70, temperature: 21, humidity: 42, devicesOn: 1, devicesTotal: 3 },
          { id: 'rm2-bath', name: 'Ванная', x: 70, y: 0, w: 30, h: 40, temperature: 23, humidity: 60, devicesOn: 0, devicesTotal: 1 },
          { id: 'rm2-balcony', name: 'Балкон', x: 0, y: 70, w: 70, h: 30, devicesOn: 0, devicesTotal: 0 },
        ],
      },
      {
        id: 'prop-3',
        complexId: 'river-park',
        complexName: 'Ривер Парк',
        apartment: 'К-12',
        type: 'storage',
        typeLabel: 'Кладовая',
        area: 8.0,
        floor: -1,
        rooms: [
          { id: 'rm3-main', name: 'Кладовая', x: 0, y: 0, w: 100, h: 100, temperature: 18, humidity: 35, devicesOn: 0, devicesTotal: 0 },
        ],
      },
    ],
  },
  {
    id: 'manager-1',
    name: 'Смирнов К.А.',
    initials: 'СК',
    role: 'manager',
    roleLabel: 'Управляющий',
    complexId: 'river-park',
    position: 'Управляющий ЖК',
    description: 'Ривер Парк',
  },
  {
    id: 'director-1',
    name: 'Хроменок Н.В.',
    initials: 'ХН',
    role: 'director',
    roleLabel: 'Директор УК',
    position: 'Директор управляющей компании',
    description: 'Все жилые комплексы',
  },
]

export const complexes: ResidentialComplex[] = [
  { id: 'river-park', name: 'Ривер Парк', address: 'Москва, наб. Шелепихинская, 34' },
  { id: 'west-garden', name: 'Вест Гарден', address: 'Москва, ул. Минская, 2' },
]

export const initialRequests: ServiceRequest[] = [
  {
    id: 'r1', number: 2847, type: 'Протечка', category: 'Сантехника',
    complexId: 'river-park', apartment: '142', resident: 'Иванов А.С.', residentId: 'resident-1', phone: '+7 (999) 123-45-67',
    description: 'Протечка трубы в ванной комнате, вода капает с потолка',
    status: 'new', priority: 'critical', createdAt: '2026-02-26 09:15', updatedAt: '2026-02-26 09:15',
    timeline: [
      { date: '2026-02-26 09:15', status: 'Заявка создана', author: 'Система' },
    ],
    chat: [
      { id: 'c1', author: 'Иванов А.С.', role: 'resident', text: 'Вода капает с потолка в ванной, срочно нужен сантехник!', date: '2026-02-26 09:15' },
      { id: 'c2', author: 'Управляющий', role: 'manager', text: 'Принято, направляем специалиста. Ориентировочное время — 1 час.', date: '2026-02-26 09:22' },
    ],
  },
  {
    id: 'r2', number: 2846, type: 'Шум', category: 'Нарушения',
    complexId: 'river-park', apartment: '87', resident: 'Петрова М.В.', phone: '+7 (999) 234-56-78',
    description: 'Шум от ремонтных работ в соседней квартире после 21:00',
    status: 'in_progress', priority: 'medium', createdAt: '2026-02-25 22:30', updatedAt: '2026-02-26 08:00',
    assignee: 'Смирнов К.А.',
    timeline: [
      { date: '2026-02-25 22:30', status: 'Заявка создана', author: 'Система' },
      { date: '2026-02-26 08:00', status: 'Взята в работу', author: 'Смирнов К.А.' },
    ],
    chat: [
      { id: 'c3', author: 'Петрова М.В.', role: 'resident', text: 'В квартире 88 опять ремонт после 21. Невозможно уснуть.', date: '2026-02-25 22:30' },
      { id: 'c4', author: 'Смирнов К.А.', role: 'manager', text: 'Зафиксировали. Направим предупреждение собственнику кв. 88.', date: '2026-02-26 08:00' },
    ],
  },
  {
    id: 'r3', number: 2845, type: 'Парковка', category: 'Территория',
    complexId: 'west-garden', apartment: '201', resident: 'Козлов Д.И.', phone: '+7 (999) 345-67-89',
    description: 'На моём парковочном месте №47 стоит чужой автомобиль',
    status: 'in_progress', priority: 'high', createdAt: '2026-02-25 18:45', updatedAt: '2026-02-25 19:10',
    assignee: 'Васильев П.Р.',
    timeline: [
      { date: '2026-02-25 18:45', status: 'Заявка создана', author: 'Система' },
      { date: '2026-02-25 19:10', status: 'Взята в работу', author: 'Васильев П.Р.' },
    ],
    chat: [
      { id: 'c5', author: 'Козлов Д.И.', role: 'resident', text: 'На моём месте №47 стоит серый BMW X5, гос.номер А777АА. Прошу убрать.', date: '2026-02-25 18:45' },
      { id: 'c6', author: 'Васильев П.Р.', role: 'manager', text: 'Устанавливаем владельца ТС. Если не удастся связаться — вызовем эвакуатор.', date: '2026-02-25 19:10' },
    ],
  },
  {
    id: 'r4', number: 2844, type: 'Домофон', category: 'Оборудование',
    complexId: 'river-park', apartment: '56', resident: 'Сидорова Е.Н.', phone: '+7 (999) 456-78-90',
    description: 'Не работает домофон в подъезде 3, невозможно открыть дверь',
    status: 'completed', priority: 'high', createdAt: '2026-02-24 14:20', updatedAt: '2026-02-25 11:00',
    assignee: 'Техслужба',
    timeline: [
      { date: '2026-02-24 14:20', status: 'Заявка создана', author: 'Система' },
      { date: '2026-02-24 15:00', status: 'Взята в работу', author: 'Техслужба' },
      { date: '2026-02-25 11:00', status: 'Выполнена', author: 'Техслужба' },
    ],
    chat: [
      { id: 'c7', author: 'Сидорова Е.Н.', role: 'resident', text: 'Домофон в 3-м подъезде не работает с утра.', date: '2026-02-24 14:20' },
      { id: 'c8', author: 'Техслужба', role: 'executor', text: 'Вышел из строя контроллер. Заменили, домофон работает.', date: '2026-02-25 11:00' },
    ],
    rating: 5,
  },
  {
    id: 'r5', number: 2843, type: 'Лифт', category: 'Оборудование',
    complexId: 'west-garden', apartment: '310', resident: 'Николаев В.П.', phone: '+7 (999) 567-89-01',
    description: 'Лифт в корпусе 2 застревает между этажами 5 и 6',
    status: 'overdue', priority: 'critical', createdAt: '2026-02-22 10:00', updatedAt: '2026-02-24 10:00',
    assignee: 'Лифтовая служба',
    timeline: [
      { date: '2026-02-22 10:00', status: 'Заявка создана', author: 'Система' },
      { date: '2026-02-22 11:30', status: 'Взята в работу', author: 'Лифтовая служба' },
      { date: '2026-02-24 10:00', status: 'Просрочена', author: 'Система' },
    ],
    chat: [
      { id: 'c9', author: 'Николаев В.П.', role: 'resident', text: 'Лифт в корпусе 2 опять застрял! Третий раз за неделю.', date: '2026-02-22 10:00' },
      { id: 'c10', author: 'Лифтовая служба', role: 'executor', text: 'Ожидаем запчасть от производителя. Срок поставки — 2 дня.', date: '2026-02-22 14:00' },
      { id: 'c11', author: 'Николаев В.П.', role: 'resident', text: 'Прошло уже 2 дня, лифт всё ещё не работает!', date: '2026-02-24 10:00' },
    ],
  },
  {
    id: 'r6', number: 2842, type: 'Уборка', category: 'Клининг',
    complexId: 'river-park', apartment: '—', resident: 'Совет дома', phone: '+7 (999) 678-90-12',
    description: 'Грязный холл первого этажа в корпусе 1, не убирали 3 дня',
    status: 'completed', priority: 'medium', createdAt: '2026-02-23 08:00', updatedAt: '2026-02-23 16:00',
    assignee: 'Клининг',
    timeline: [
      { date: '2026-02-23 08:00', status: 'Заявка создана', author: 'Система' },
      { date: '2026-02-23 09:00', status: 'Взята в работу', author: 'Клининг' },
      { date: '2026-02-23 16:00', status: 'Выполнена', author: 'Клининг' },
    ],
    chat: [
      { id: 'c12', author: 'Совет дома', role: 'resident', text: 'Холл 1 этажа в корпусе 1 — очень грязно. Просим убрать.', date: '2026-02-23 08:00' },
    ],
    rating: 4,
  },
  {
    id: 'r7', number: 2841, type: 'Благоустройство', category: 'Территория',
    complexId: 'west-garden', apartment: '—', resident: 'Морозова А.Л.', phone: '+7 (999) 789-01-23',
    description: 'Сломана скамейка на детской площадке во дворе',
    status: 'in_progress', priority: 'medium', createdAt: '2026-02-24 12:00', updatedAt: '2026-02-25 09:00',
    assignee: 'Хоз. служба',
    timeline: [
      { date: '2026-02-24 12:00', status: 'Заявка создана', author: 'Система' },
      { date: '2026-02-25 09:00', status: 'Взята в работу', author: 'Хоз. служба' },
    ],
    chat: [
      { id: 'c13', author: 'Морозова А.Л.', role: 'resident', text: 'На детской площадке сломана скамейка, торчат гвозди. Опасно для детей!', date: '2026-02-24 12:00' },
    ],
  },
  {
    id: 'r8', number: 2840, type: 'Протечка', category: 'Сантехника',
    complexId: 'west-garden', apartment: '115', resident: 'Андреев С.М.', phone: '+7 (999) 890-12-34',
    description: 'Течёт кран на кухне, невозможно полностью закрыть',
    status: 'new', priority: 'low', createdAt: '2026-02-26 07:00', updatedAt: '2026-02-26 07:00',
    timeline: [
      { date: '2026-02-26 07:00', status: 'Заявка создана', author: 'Система' },
    ],
    chat: [
      { id: 'c14', author: 'Андреев С.М.', role: 'resident', text: 'Кран на кухне подтекает, вода капает постоянно.', date: '2026-02-26 07:00' },
    ],
  },
  {
    id: 'r9', number: 2839, type: 'Электрика', category: 'Оборудование',
    complexId: 'river-park', apartment: '204', resident: 'Белова О.К.', phone: '+7 (999) 901-23-45',
    description: 'Не горит освещение на лестничной клетке 7 этажа',
    status: 'completed', priority: 'medium', createdAt: '2026-02-22 19:00', updatedAt: '2026-02-23 10:00',
    assignee: 'Электрик',
    timeline: [
      { date: '2026-02-22 19:00', status: 'Заявка создана', author: 'Система' },
      { date: '2026-02-22 20:00', status: 'Взята в работу', author: 'Электрик' },
      { date: '2026-02-23 10:00', status: 'Выполнена', author: 'Электрик' },
    ],
    chat: [],
    rating: 5,
  },
  {
    id: 'r10', number: 2838, type: 'Шум', category: 'Нарушения',
    complexId: 'west-garden', apartment: '78', resident: 'Громов И.Д.', phone: '+7 (999) 012-34-56',
    description: 'Громкая музыка из квартиры 79 каждые выходные',
    status: 'overdue', priority: 'low', createdAt: '2026-02-20 23:00', updatedAt: '2026-02-23 12:00',
    assignee: 'Смирнов К.А.',
    timeline: [
      { date: '2026-02-20 23:00', status: 'Заявка создана', author: 'Система' },
      { date: '2026-02-21 09:00', status: 'Взята в работу', author: 'Смирнов К.А.' },
      { date: '2026-02-23 12:00', status: 'Просрочена', author: 'Система' },
    ],
    chat: [],
  },
  {
    id: 'r11', number: 2837, type: 'Домофон', category: 'Оборудование',
    complexId: 'river-park', apartment: '33', resident: 'Кузнецов П.В.', phone: '+7 (999) 111-22-33',
    description: 'Домофонная трубка в квартире не работает, нет связи',
    status: 'new', priority: 'medium', createdAt: '2026-02-26 08:30', updatedAt: '2026-02-26 08:30',
    timeline: [
      { date: '2026-02-26 08:30', status: 'Заявка создана', author: 'Система' },
    ],
    chat: [
      { id: 'c15', author: 'Кузнецов П.В.', role: 'resident', text: 'Трубка домофона перестала работать, не слышу вызовы.', date: '2026-02-26 08:30' },
    ],
  },
  {
    id: 'r12', number: 2836, type: 'Уборка', category: 'Клининг',
    complexId: 'west-garden', apartment: '—', resident: 'Жильцы подъезда 2', phone: '+7 (999) 222-33-44',
    description: 'Мусор у контейнерной площадки не вывозился 2 дня',
    status: 'completed', priority: 'high', createdAt: '2026-02-24 07:00', updatedAt: '2026-02-24 14:00',
    assignee: 'Клининг',
    timeline: [
      { date: '2026-02-24 07:00', status: 'Заявка создана', author: 'Система' },
      { date: '2026-02-24 08:00', status: 'Взята в работу', author: 'Клининг' },
      { date: '2026-02-24 14:00', status: 'Выполнена', author: 'Клининг' },
    ],
    chat: [],
    rating: 3,
  },
  {
    id: 'r13', number: 2835, type: 'Лифт', category: 'Оборудование',
    complexId: 'river-park', apartment: '178', resident: 'Фёдорова Н.С.', phone: '+7 (999) 333-44-55',
    description: 'Лифт издаёт скрежет при движении, страшно пользоваться',
    status: 'in_progress', priority: 'high', createdAt: '2026-02-25 11:00', updatedAt: '2026-02-25 14:00',
    assignee: 'Лифтовая служба',
    timeline: [
      { date: '2026-02-25 11:00', status: 'Заявка создана', author: 'Система' },
      { date: '2026-02-25 14:00', status: 'Взята в работу', author: 'Лифтовая служба' },
    ],
    chat: [
      { id: 'c16', author: 'Фёдорова Н.С.', role: 'resident', text: 'Лифт скрежещет при движении, вибрация. Боюсь ездить.', date: '2026-02-25 11:00' },
    ],
  },
  {
    id: 'r14', number: 2834, type: 'Благоустройство', category: 'Территория',
    complexId: 'river-park', apartment: '—', resident: 'Волков А.А.', phone: '+7 (999) 444-55-66',
    description: 'Яма на дороге при въезде во двор, можно повредить машину',
    status: 'new', priority: 'medium', createdAt: '2026-02-25 16:00', updatedAt: '2026-02-25 16:00',
    timeline: [
      { date: '2026-02-25 16:00', status: 'Заявка создана', author: 'Система' },
    ],
    chat: [],
  },
  {
    id: 'r15', number: 2833, type: 'Электрика', category: 'Оборудование',
    complexId: 'west-garden', apartment: '95', resident: 'Соколова Т.М.', phone: '+7 (999) 555-66-77',
    description: 'Мигает свет в коридоре, возможно проблема с проводкой',
    status: 'completed', priority: 'medium', createdAt: '2026-02-21 13:00', updatedAt: '2026-02-22 09:00',
    assignee: 'Электрик',
    timeline: [
      { date: '2026-02-21 13:00', status: 'Заявка создана', author: 'Система' },
      { date: '2026-02-21 15:00', status: 'Взята в работу', author: 'Электрик' },
      { date: '2026-02-22 09:00', status: 'Выполнена', author: 'Электрик' },
    ],
    chat: [],
    rating: 4,
  },
]

export const initialNotifications: Notification[] = [
  { id: 'n1', text: 'Ваша заявка #2847 зарегистрирована', time: '09:15', type: 'info', read: true, requestNumber: 2847, forRole: ['resident'] },
  { id: 'n2', text: 'Управляющий ответил по заявке #2847', time: '09:22', type: 'status_change', read: true, requestNumber: 2847, forRole: ['resident'] },
  { id: 'n3', text: 'Заявка #2844 выполнена — оцените работу', time: 'Вчера', type: 'rate', read: false, requestNumber: 2844, forRole: ['resident'] },
  { id: 'n4', text: 'Новая заявка #2847 — Протечка, кв. 142', time: '09:15', type: 'info', read: false, requestNumber: 2847, forRole: ['manager', 'director'] },
  { id: 'n5', text: 'Заявка #2843 просрочена — Лифт, Вест Гарден', time: 'Вчера', type: 'status_change', read: false, requestNumber: 2843, forRole: ['manager', 'director'] },
  { id: 'n6', text: 'Техслужба закрыла заявку #2844', time: 'Вчера', type: 'completed', read: true, requestNumber: 2844, forRole: ['manager', 'director'] },
  { id: 'n7', text: 'SLA нарушен по 2 заявкам', time: '2 дня назад', type: 'status_change', read: true, forRole: ['director'] },
]

export const requestTypeIcons: Record<string, ComponentType<{ className?: string }>> = {
  'Протечка': Droplets,
  'Шум': Volume2,
  'Парковка': Car,
  'Домофон': DoorOpen,
  'Лифт': ArrowUpDown,
  'Уборка': Trash2,
  'Благоустройство': Trees,
  'Электрика': Zap,
}

export const requestTypeColors: Record<string, string> = {
  'Протечка': 'bg-blue-100 text-blue-600',
  'Шум': 'bg-purple-100 text-purple-600',
  'Парковка': 'bg-amber-100 text-amber-600',
  'Домофон': 'bg-emerald-100 text-emerald-600',
  'Лифт': 'bg-orange-100 text-orange-600',
  'Уборка': 'bg-teal-100 text-teal-600',
  'Благоустройство': 'bg-green-100 text-green-600',
  'Электрика': 'bg-yellow-100 text-yellow-600',
}

export const executors = [
  { id: 'tech', name: 'Техслужба' },
  { id: 'cleaning', name: 'Клининг' },
  { id: 'electric', name: 'Электрик' },
  { id: 'elevator', name: 'Лифтовая служба' },
  { id: 'maintenance', name: 'Хоз. служба' },
]

export const requestTypes = [
  'Протечка', 'Шум', 'Парковка', 'Домофон', 'Лифт', 'Уборка', 'Благоустройство', 'Электрика',
]

export const dashboardMetrics: DashboardMetrics = {
  newRequests: 5,
  newRequestsTrend: 12,
  avgResponseTime: 2.4,
  avgResponseTrend: -8,
  slaCompliance: 94,
  slaTrend: 3,
  overdue: 2,
  overdueTrend: -1,
}

export const analyticsData: AnalyticsData = {
  period: 'Февраль 2026',
  totalRequests: 47,
  avgCloseTime: 18.5,
  satisfaction: 4.7,
  slaCompliance: 94,
  requestsByDay: [
    { day: 'Пн', count: 8 },
    { day: 'Вт', count: 6 },
    { day: 'Ср', count: 9 },
    { day: 'Чт', count: 7 },
    { day: 'Пт', count: 10 },
    { day: 'Сб', count: 4 },
    { day: 'Вс', count: 3 },
  ],
  requestsByType: [
    { type: 'Сантехника', count: 12, color: '#1D252D' },
    { type: 'Оборудование', count: 10, color: '#8B7355' },
    { type: 'Клининг', count: 8, color: '#A09484' },
    { type: 'Нарушения', count: 7, color: '#C4B8A8' },
    { type: 'Территория', count: 6, color: '#D8CFC4' },
    { type: 'Прочее', count: 4, color: '#E8E0D8' },
  ],
  topCategories: [
    { category: 'Сантехника', count: 12, trend: 15 },
    { category: 'Лифты и домофоны', count: 10, trend: -5 },
    { category: 'Уборка территории', count: 8, trend: 0 },
  ],
}

export const statusLabels: Record<RequestStatus, string> = {
  new: 'Новая',
  in_progress: 'В работе',
  completed: 'Выполнена',
  overdue: 'Просрочена',
}

export const statusColors: Record<RequestStatus, string> = {
  new: 'bg-blue-100 text-blue-800',
  in_progress: 'bg-amber-100 text-amber-800',
  completed: 'bg-green-100 text-green-800',
  overdue: 'bg-red-100 text-red-800',
}

export const priorityLabels: Record<Priority, string> = {
  low: 'Низкий',
  medium: 'Средний',
  high: 'Высокий',
  critical: 'Критический',
}

export const priorityColors: Record<Priority, string> = {
  low: 'text-gray-500',
  medium: 'text-amber-600',
  high: 'text-orange-600',
  critical: 'text-red-600',
}

// ─── Premium Features: Types ───

export interface GuestPass {
  id: string
  guestName: string
  date: string
  timeRange: string
  status: 'active' | 'used' | 'expired'
}

export interface EntryEvent {
  id: string
  type: 'entry' | 'exit' | 'delivery' | 'guest'
  description: string
  time: string
}

export interface Camera {
  id: string
  name: string
  location: string
  isLive: boolean
  isRecording: boolean
}

export interface SmartDevice {
  id: string
  name: string
  type: 'light' | 'outlet' | 'lock' | 'curtains'
  isOn: boolean
  room: string
}

export interface LightScene {
  id: string
  name: string
  icon: string
  isActive: boolean
}

export interface Sensor {
  id: string
  name: string
  value: string
  unit: string
  room: string
}

export interface ConciergeService {
  id: string
  name: string
  icon: string
  price: string
  description: string
}

export interface ActiveOrder {
  id: string
  service: string
  status: 'pending' | 'in_progress' | 'done'
  date: string
}

export interface Bill {
  id: string
  name: string
  amount: number
  isPaid: boolean
}

export interface PaymentHistory {
  id: string
  month: string
  amount: number
  date: string
}

export interface ParkingSpot {
  id: string
  number: string
  level: string
  type: 'owned' | 'guest'
  status: 'free' | 'occupied'
}

export interface ParkingEvent {
  id: string
  description: string
  time: string
}

// ─── Premium Features: Mock Data ───

export const guestPasses: GuestPass[] = [
  { id: 'gp1', guestName: 'Петров Д.М.', date: '26.02.2026', timeRange: '14:00–18:00', status: 'active' },
  { id: 'gp2', guestName: 'Курьер Яндекс', date: '25.02.2026', timeRange: '12:00–12:30', status: 'used' },
  { id: 'gp3', guestName: 'Сидорова А.К.', date: '24.02.2026', timeRange: '10:00–22:00', status: 'expired' },
]

export const entryEvents: EntryEvent[] = [
  { id: 'ee1', type: 'entry', description: 'Ваш вход через подъезд 2', time: '09:12' },
  { id: 'ee2', type: 'delivery', description: 'Курьер Ozon — посылка', time: '08:45' },
  { id: 'ee3', type: 'guest', description: 'Гость: Петров Д.М.', time: 'Вчера 17:30' },
  { id: 'ee4', type: 'exit', description: 'Ваш выход через паркинг', time: 'Вчера 08:50' },
]

export const cameras: Camera[] = [
  { id: 'cam1', name: 'Подъезд', location: 'Вход, подъезд 2', isLive: true, isRecording: true },
  { id: 'cam2', name: 'Парковка', location: 'Уровень B1', isLive: true, isRecording: true },
  { id: 'cam3', name: 'Двор', location: 'Детская площадка', isLive: true, isRecording: false },
  { id: 'cam4', name: 'Детская', location: 'Игровая комната', isLive: true, isRecording: true },
]

export const smartRooms = ['Все', 'Гостиная', 'Спальня', 'Кухня', 'Ванная']

export const smartDevices: SmartDevice[] = [
  { id: 'sd1', name: 'Люстра', type: 'light', isOn: true, room: 'Гостиная' },
  { id: 'sd2', name: 'Торшер', type: 'light', isOn: false, room: 'Гостиная' },
  { id: 'sd3', name: 'Розетка TV', type: 'outlet', isOn: true, room: 'Гостиная' },
  { id: 'sd4', name: 'Потолочный свет', type: 'light', isOn: true, room: 'Спальня' },
  { id: 'sd5', name: 'Ночник', type: 'light', isOn: false, room: 'Спальня' },
  { id: 'sd6', name: 'Шторы', type: 'curtains', isOn: false, room: 'Спальня' },
  { id: 'sd7', name: 'Подсветка', type: 'light', isOn: true, room: 'Кухня' },
  { id: 'sd8', name: 'Замок', type: 'lock', isOn: true, room: 'Гостиная' },
]

export const lightScenes: LightScene[] = [
  { id: 'ls1', name: 'Яркий день', icon: 'sun', isActive: false },
  { id: 'ls2', name: 'Вечерний', icon: 'sunset', isActive: true },
  { id: 'ls3', name: 'Кинотеатр', icon: 'film', isActive: false },
  { id: 'ls4', name: 'Ночной', icon: 'moon', isActive: false },
]

export const sensors: Sensor[] = [
  { id: 'sn1', name: 'Температура', value: '22.5', unit: '°C', room: 'Гостиная' },
  { id: 'sn2', name: 'Влажность', value: '45', unit: '%', room: 'Гостиная' },
  { id: 'sn3', name: 'CO₂', value: '420', unit: 'ppm', room: 'Гостиная' },
  { id: 'sn4', name: 'Температура', value: '21.0', unit: '°C', room: 'Спальня' },
  { id: 'sn5', name: 'Влажность', value: '50', unit: '%', room: 'Спальня' },
]

export const conciergeServices: ConciergeService[] = [
  { id: 'cs1', name: 'Химчистка', icon: 'shirt', price: 'от 1 500 ₽', description: 'Забор и доставка одежды' },
  { id: 'cs2', name: 'Клининг', icon: 'sparkles', price: 'от 3 000 ₽', description: 'Уборка квартиры' },
  { id: 'cs3', name: 'Автомойка', icon: 'car', price: 'от 1 200 ₽', description: 'Мойка в паркинге' },
  { id: 'cs4', name: 'Вода', icon: 'droplets', price: '350 ₽', description: 'Доставка воды 19л' },
  { id: 'cs5', name: 'Няня', icon: 'baby', price: 'от 800 ₽/ч', description: 'Присмотр за детьми' },
  { id: 'cs6', name: 'Мастер', icon: 'wrench', price: 'от 2 000 ₽', description: 'Мелкий ремонт' },
]

export const initialBills: Bill[] = [
  { id: 'b1', name: 'ЖКХ', amount: 8450, isPaid: false },
  { id: 'b2', name: 'Электричество', amount: 2180, isPaid: false },
  { id: 'b3', name: 'Водоснабжение', amount: 1340, isPaid: false },
  { id: 'b4', name: 'Интернет', amount: 990, isPaid: true },
  { id: 'b5', name: 'Парковка', amount: 5000, isPaid: true },
]

export const paymentHistory: PaymentHistory[] = [
  { id: 'ph1', month: 'Январь 2026', amount: 17960, date: '28.01.2026' },
  { id: 'ph2', month: 'Декабрь 2025', amount: 18200, date: '27.12.2025' },
  { id: 'ph3', month: 'Ноябрь 2025', amount: 16800, date: '25.11.2025' },
]

export const parkingSpot: ParkingSpot = {
  id: 'ps1', number: '47', level: 'B1', type: 'owned', status: 'free',
}

export const parkingEvents: ParkingEvent[] = [
  { id: 'pe1', description: 'Въезд вашего автомобиля', time: '09:05' },
  { id: 'pe2', description: 'Выезд вашего автомобиля', time: 'Вчера 08:50' },
  { id: 'pe3', description: 'Гостевой пропуск: А777АА', time: 'Вчера 17:20' },
]

// ─── Amenity Booking ───

export interface Amenity {
  id: string
  name: string
  icon: string
  description: string
  pricePerHour: number
  location: string
  slots: AmenitySlot[]
}

export interface AmenitySlot {
  id: string
  time: string
  available: boolean
}

export interface AmenityBooking {
  id: string
  amenityId: string
  amenityName: string
  date: string
  time: string
  status: 'upcoming' | 'active' | 'past'
}

export const amenities: Amenity[] = [
  {
    id: 'am1', name: 'SPA-зона', icon: 'waves', description: 'Сауна, хаммам, бассейн',
    pricePerHour: 3000, location: 'Корпус 1, -1 этаж',
    slots: [
      { id: 's1', time: '10:00–12:00', available: true },
      { id: 's2', time: '12:00–14:00', available: false },
      { id: 's3', time: '14:00–16:00', available: true },
      { id: 's4', time: '16:00–18:00', available: true },
      { id: 's5', time: '18:00–20:00', available: false },
      { id: 's6', time: '20:00–22:00', available: true },
    ],
  },
  {
    id: 'am2', name: 'Спортзал', icon: 'dumbbell', description: 'Тренажёры, свободные веса',
    pricePerHour: 0, location: 'Корпус 1, -1 этаж',
    slots: [
      { id: 's7', time: '07:00–09:00', available: true },
      { id: 's8', time: '09:00–11:00', available: true },
      { id: 's9', time: '11:00–13:00', available: false },
      { id: 's10', time: '17:00–19:00', available: true },
      { id: 's11', time: '19:00–21:00', available: false },
    ],
  },
  {
    id: 'am3', name: 'Переговорная', icon: 'briefcase', description: 'Коворкинг, 8 мест, проектор',
    pricePerHour: 1500, location: 'Корпус 2, 1 этаж',
    slots: [
      { id: 's12', time: '09:00–11:00', available: true },
      { id: 's13', time: '11:00–13:00', available: true },
      { id: 's14', time: '13:00–15:00', available: false },
      { id: 's15', time: '15:00–17:00', available: true },
    ],
  },
  {
    id: 'am4', name: 'Лаунж на крыше', icon: 'mountain', description: 'Терраса, барбекю, бар',
    pricePerHour: 5000, location: 'Крыша, 25 этаж',
    slots: [
      { id: 's16', time: '12:00–15:00', available: true },
      { id: 's17', time: '15:00–18:00', available: false },
      { id: 's18', time: '18:00–21:00', available: true },
      { id: 's19', time: '21:00–00:00', available: true },
    ],
  },
  {
    id: 'am5', name: 'Детская комната', icon: 'puzzle', description: 'Игровая, аниматор',
    pricePerHour: 800, location: 'Корпус 1, 1 этаж',
    slots: [
      { id: 's20', time: '10:00–12:00', available: true },
      { id: 's21', time: '12:00–14:00', available: true },
      { id: 's22', time: '14:00–16:00', available: false },
      { id: 's23', time: '16:00–18:00', available: true },
    ],
  },
  {
    id: 'am6', name: 'Кинозал', icon: 'film', description: '12 мест, Dolby Atmos',
    pricePerHour: 4000, location: 'Корпус 2, -1 этаж',
    slots: [
      { id: 's24', time: '14:00–16:00', available: true },
      { id: 's25', time: '16:00–18:00', available: true },
      { id: 's26', time: '18:00–20:00', available: false },
      { id: 's27', time: '20:00–22:00', available: true },
    ],
  },
]

// ─── Packages & Lockers ───

export interface Package {
  id: string
  carrier: string
  trackingNumber: string
  description: string
  status: 'in_transit' | 'delivered' | 'in_locker' | 'picked_up'
  statusLabel: string
  lockerCode?: string
  lockerNumber?: string
  deliveryDate?: string
  arrivedAt?: string
}

export const initialPackages: Package[] = [
  {
    id: 'pkg1', carrier: 'Ozon', trackingNumber: 'OZ-8847291',
    description: 'Книги и канцелярия', status: 'in_locker',
    statusLabel: 'В ячейке', lockerCode: '4829', lockerNumber: '12',
    arrivedAt: '26.02 · 08:45',
  },
  {
    id: 'pkg2', carrier: 'Wildberries', trackingNumber: 'WB-3319204',
    description: 'Одежда', status: 'in_transit',
    statusLabel: 'В пути', deliveryDate: '27.02.2026',
  },
  {
    id: 'pkg3', carrier: 'Яндекс Маркет', trackingNumber: 'YM-5567102',
    description: 'Электроника', status: 'delivered',
    statusLabel: 'Доставлено курьером', arrivedAt: '25.02 · 14:20',
  },
  {
    id: 'pkg4', carrier: 'CDEK', trackingNumber: 'CD-1104887',
    description: 'Подарок', status: 'picked_up',
    statusLabel: 'Забрано', arrivedAt: '23.02 · 10:00',
  },
]

// ─── Partner Privileges ───

export interface PartnerCategory {
  id: string
  name: string
}

export interface Partner {
  id: string
  name: string
  categoryId: string
  logo: string
  discount: string
  description: string
  promoCode?: string
  isExclusive: boolean
}

export const partnerCategories: PartnerCategory[] = [
  { id: 'pc-all', name: 'Все' },
  { id: 'pc-food', name: 'Рестораны' },
  { id: 'pc-beauty', name: 'Красота' },
  { id: 'pc-fitness', name: 'Спорт' },
  { id: 'pc-auto', name: 'Авто' },
  { id: 'pc-home', name: 'Интерьер' },
  { id: 'pc-kids', name: 'Дети' },
]

export const partners: Partner[] = [
  { id: 'p1', name: 'Maison Dellos', categoryId: 'pc-food', logo: 'utensils', discount: '−15%', description: 'Рестораны Café Пушкинъ, Турандот, Бочка', isExclusive: true },
  { id: 'p2', name: 'BoConcept', categoryId: 'pc-home', logo: 'sofa', discount: '−20%', description: 'Мебель и аксессуары, дизайн-консультация', promoCode: 'SMINEX20', isExclusive: true },
  { id: 'p3', name: 'World Class', categoryId: 'pc-fitness', logo: 'dumbbell', discount: '−30%', description: 'Годовой абонемент в премиум-клуб', isExclusive: false },
  { id: 'p4', name: 'Mercedes-Benz', categoryId: 'pc-auto', logo: 'car', discount: 'Тест-драйв', description: 'Персональный менеджер, приоритет на новинки', isExclusive: true },
  { id: 'p5', name: 'Babor SPA', categoryId: 'pc-beauty', logo: 'sparkles', discount: '−25%', description: 'Премиум-уход, комплексные программы', promoCode: 'RIVER25', isExclusive: false },
  { id: 'p6', name: 'Little Angels', categoryId: 'pc-kids', logo: 'heart', discount: '−15%', description: 'Билингвальный детский сад, подготовка к школе', isExclusive: false },
  { id: 'p7', name: 'LavkaLavka', categoryId: 'pc-food', logo: 'leaf', discount: '−10%', description: 'Фермерские продукты с доставкой', promoCode: 'FRESH10', isExclusive: false },
  { id: 'p8', name: 'Togas', categoryId: 'pc-home', logo: 'bed', discount: '−20%', description: 'Постельное бельё и текстиль премиум-класса', promoCode: 'HOME20', isExclusive: true },
  { id: 'p9', name: 'Performance', categoryId: 'pc-auto', logo: 'wrench', discount: '−15%', description: 'Детейлинг, керамика, тонировка в паркинге', isExclusive: false },
  { id: 'p10', name: 'Dr.Loder', categoryId: 'pc-fitness', logo: 'stethoscope', discount: 'Чекап', description: 'Медицинский чекап, персональная программа', isExclusive: true },
]

// ─── Smart Home Scenarios ───

export interface SmartScenario {
  id: string
  name: string
  icon: string
  description: string
  isActive: boolean
  actions: string[]
}

export const smartScenarios: SmartScenario[] = [
  {
    id: 'sc1', name: 'Я дома', icon: 'home',
    description: 'Включить свет, поднять температуру, разблокировать',
    isActive: false,
    actions: ['Свет → Вечерний', 'Климат → 22°C', 'Замок → Закрыт', 'Шторы → Открыты'],
  },
  {
    id: 'sc2', name: 'Я ушёл', icon: 'door-open',
    description: 'Выключить всё, снизить температуру, заблокировать',
    isActive: false,
    actions: ['Свет → Выкл', 'Климат → 18°C', 'Замок → Закрыт', 'Шторы → Закрыты', 'Розетки → Выкл'],
  },
  {
    id: 'sc3', name: 'Доброе утро', icon: 'sunrise',
    description: 'Плавный свет, открыть шторы, включить кофемашину',
    isActive: false,
    actions: ['Свет → 30%', 'Шторы → Открыты', 'Розетка кофе → Вкл', 'Климат → 22°C'],
  },
  {
    id: 'sc4', name: 'Спокойной ночи', icon: 'moon-star',
    description: 'Ночник в спальне, закрыть шторы, снизить температуру',
    isActive: false,
    actions: ['Свет → Ночник', 'Шторы → Закрыты', 'Климат → 20°C', 'Замок → Закрыт'],
  },
]

====================================================================================================
END: src\data\sminex.ts
====================================================================================================


####################################################################################################
# DIR: src\hooks
####################################################################################################

====================================================================================================
FILE [51/52]: src\hooks\useReveal.ts
Size: 632 bytes
====================================================================================================

import { useEffect, useRef, useState } from 'react'

export function useReveal(threshold = 0.15) {
  const ref = useRef<HTMLDivElement>(null)
  const [visible, setVisible] = useState(false)

  useEffect(() => {
    const el = ref.current
    if (!el) return

    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setVisible(true)
          observer.unobserve(el)
        }
      },
      { threshold, rootMargin: '-60px 0px' },
    )

    observer.observe(el)
    return () => observer.disconnect()
  }, [threshold])

  return { ref, visible }
}

====================================================================================================
END: src\hooks\useReveal.ts
====================================================================================================


####################################################################################################
# DIR: src\pages
####################################################################################################

====================================================================================================
FILE [52/52]: src\pages\SminexDemo.tsx
Size: 13,242 bytes
====================================================================================================

import { useState, useCallback } from 'react'
import { useNavigate } from 'react-router-dom'
import PhoneFrame from '../components/sminex/PhoneFrame'
import BottomNav, { type Tab } from '../components/sminex/BottomNav'
import RoleSelectScreen from '../components/sminex/RoleSelectScreen'
import DashboardScreen from '../components/sminex/DashboardScreen'
import RequestsScreen from '../components/sminex/RequestsScreen'
import RequestDetailScreen from '../components/sminex/RequestDetailScreen'
import AnalyticsScreen from '../components/sminex/AnalyticsScreen'
import NotificationsScreen from '../components/sminex/NotificationsScreen'
import ProfileScreen from '../components/sminex/ProfileScreen'
import CreateRequestModal from '../components/sminex/CreateRequestModal'
import AssignModal from '../components/sminex/AssignModal'
import ArchitectureModal from '../components/sminex/ArchitectureModal'
import DiscoveryModal from '../components/sminex/DiscoveryModal'
import IntercomScreen from '../components/sminex/IntercomScreen'
import CamerasScreen from '../components/sminex/CamerasScreen'
import SmartHomeScreen from '../components/sminex/SmartHomeScreen'
import ServicesScreen from '../components/sminex/ServicesScreen'
import BillsScreen from '../components/sminex/BillsScreen'
import ParkingScreen from '../components/sminex/ParkingScreen'
import FloorPlanScreen from '../components/sminex/FloorPlanScreen'
import BookingScreen from '../components/sminex/BookingScreen'
import PackagesScreen from '../components/sminex/PackagesScreen'
import PrivilegesScreen from '../components/sminex/PrivilegesScreen'
import Toast, { type ToastMessage } from '../components/sminex/Toast'
import {
  initialRequests, initialNotifications, users,
  type ServiceRequest, type UserRole, type UserProfile, type Priority, type SubScreen, type OwnedProperty,
} from '../data/sminex'

export default function SminexDemo() {
  const navigate = useNavigate()

  // Core state
  const [currentRole, setCurrentRole] = useState<UserRole | null>(null)
  const [requests, setRequests] = useState<ServiceRequest[]>(initialRequests)
  const [notifications] = useState(initialNotifications)
  const [activeTab, setActiveTab] = useState<Tab>('dashboard')
  const [selectedComplex, setSelectedComplex] = useState<string | null>(null)
  const [selectedRequest, setSelectedRequest] = useState<ServiceRequest | null>(null)
  const [subScreen, setSubScreen] = useState<SubScreen>(null)
  const [activePropertyId, setActivePropertyId] = useState<string>('prop-1')

  // Modals
  const [showCreateRequest, setShowCreateRequest] = useState(false)
  const [assignRequestId, setAssignRequestId] = useState<string | null>(null)
  const [showArchitecture, setShowArchitecture] = useState(false)
  const [showDiscovery, setShowDiscovery] = useState(false)

  // Toasts
  const [toasts, setToasts] = useState<ToastMessage[]>([])

  const addToast = useCallback((text: string, type: 'success' | 'error' = 'success') => {
    const id = `t-${Date.now()}`
    setToasts(prev => [...prev, { id, text, type }])
  }, [])

  const dismissToast = useCallback((id: string) => {
    setToasts(prev => prev.filter(t => t.id !== id))
  }, [])

  const user: UserProfile | null = currentRole ? users.find(u => u.role === currentRole) ?? null : null

  // Helper to get fresh request from state
  const getFreshRequest = (id: string) => requests.find(r => r.id === id) ?? null

  const now = () => {
    const d = new Date()
    return `2026-02-26 ${String(d.getHours()).padStart(2, '0')}:${String(d.getMinutes()).padStart(2, '0')}`
  }

  // Role selection
  const handleSelectRole = (role: UserRole) => {
    setCurrentRole(role)
    setActiveTab('dashboard')
    setSelectedRequest(null)
    // Auto-set complex filter for manager
    const u = users.find(uu => uu.role === role)
    if (role === 'manager' && u?.complexId) {
      setSelectedComplex(null) // manager sees their own complex, no need for selector
    } else {
      setSelectedComplex(null)
    }
  }

  const handleSwitchRole = () => {
    setCurrentRole(null)
    setSelectedRequest(null)
    setSubScreen(null)
    setActiveTab('dashboard')
  }

  // Navigation
  const handleNavigate = (tab: Tab) => {
    setSelectedRequest(null)
    setSubScreen(null)
    setActiveTab(tab)
  }

  const handleOpenRequest = (request: ServiceRequest) => {
    // Always use fresh version from state
    const fresh = getFreshRequest(request.id)
    if (fresh) setSelectedRequest(fresh)
  }

  const handleBackFromDetail = () => {
    setSelectedRequest(null)
  }

  // Actions
  const handleTakeInWork = (requestId: string) => {
    if (!user) return
    setRequests(prev => prev.map(r => {
      if (r.id !== requestId) return r
      return {
        ...r,
        status: 'in_progress' as const,
        assignee: user.name,
        updatedAt: now(),
        timeline: [...r.timeline, { date: now(), status: 'Взята в работу', author: user.name }],
      }
    }))
    // Update selected request view
    setTimeout(() => {
      const fresh = requests.find(r => r.id === requestId)
      if (fresh) setSelectedRequest({ ...fresh, status: 'in_progress', assignee: user.name })
    }, 0)
    addToast('Заявка взята в работу')
  }

  const handleCloseRequest = (requestId: string) => {
    if (!user) return
    setRequests(prev => prev.map(r => {
      if (r.id !== requestId) return r
      return {
        ...r,
        status: 'completed' as const,
        updatedAt: now(),
        timeline: [...r.timeline, { date: now(), status: 'Выполнена', author: user.name }],
      }
    }))
    setSelectedRequest(null)
    addToast('Заявка закрыта')
  }

  const handleAssign = (executor: string) => {
    if (!assignRequestId) return
    setRequests(prev => prev.map(r => {
      if (r.id !== assignRequestId) return r
      return {
        ...r,
        assignee: executor,
        updatedAt: now(),
        timeline: [...r.timeline, { date: now(), status: `Назначен: ${executor}`, author: user?.name ?? 'Система' }],
      }
    }))
    // Refresh selected if viewing
    if (selectedRequest?.id === assignRequestId) {
      const fresh = requests.find(r => r.id === assignRequestId)
      if (fresh) setSelectedRequest({ ...fresh, assignee: executor })
    }
    setAssignRequestId(null)
    addToast(`Исполнитель назначен: ${executor}`)
  }

  const handleCreateRequest = (data: { type: string; description: string; priority: Priority }) => {
    const maxNum = Math.max(...requests.map(r => r.number))
    const newReq: ServiceRequest = {
      id: `r-${Date.now()}`,
      number: maxNum + 1,
      type: data.type,
      category: data.type,
      complexId: user?.complexId ?? 'river-park',
      apartment: user?.apartment ?? '—',
      resident: user?.name ?? 'Аноним',
      residentId: user?.id,
      phone: user?.phone ?? '',
      description: data.description,
      status: 'new',
      priority: data.priority,
      createdAt: now(),
      updatedAt: now(),
      timeline: [{ date: now(), status: 'Заявка создана', author: 'Система' }],
      chat: [],
    }
    setRequests(prev => [newReq, ...prev])
    setShowCreateRequest(false)
    addToast(`Заявка #${newReq.number} создана`)
  }

  const handleRate = (requestId: string, rating: number) => {
    setRequests(prev => prev.map(r => r.id === requestId ? { ...r, rating } : r))
    if (selectedRequest?.id === requestId) {
      setSelectedRequest(prev => prev ? { ...prev, rating } : null)
    }
    addToast('Спасибо за оценку!')
  }

  const handleSendMessage = (requestId: string, text: string) => {
    if (!user) return
    const msgId = `msg-${Date.now()}`
    const chatMsg = {
      id: msgId,
      author: user.name,
      role: user.role === 'resident' ? 'resident' as const : 'manager' as const,
      text,
      date: now(),
    }
    setRequests(prev => prev.map(r => r.id === requestId ? { ...r, chat: [...r.chat, chatMsg] } : r))
    if (selectedRequest?.id === requestId) {
      setSelectedRequest(prev => prev ? { ...prev, chat: [...prev.chat, chatMsg] } : null)
    }
  }

  // Compute badges
  const newRequestsCount = requests.filter(r => r.status === 'new').length
  const unreadNotifs = notifications.filter(n => !n.read && n.forRole.includes(currentRole ?? 'resident')).length

  // Render
  const handleCloseSubScreen = () => setSubScreen(null)

  const activeProperty: OwnedProperty | undefined = user?.properties?.find(p => p.id === activePropertyId)

  const renderScreen = () => {
    if (!user) return <RoleSelectScreen onSelectRole={handleSelectRole} />

    // Sub-screens (resident only, premium features)
    if (subScreen) {
      switch (subScreen) {
        case 'intercom': return <IntercomScreen onBack={handleCloseSubScreen} onToast={addToast} />
        case 'cameras': return <CamerasScreen onBack={handleCloseSubScreen} />
        case 'smart-home': return <SmartHomeScreen onBack={handleCloseSubScreen} />
        case 'services': return <ServicesScreen onBack={handleCloseSubScreen} onToast={addToast} />
        case 'bills': return <BillsScreen onBack={handleCloseSubScreen} onToast={addToast} />
        case 'parking': return <ParkingScreen onBack={handleCloseSubScreen} onToast={addToast} />
        case 'floor-plan': return activeProperty
          ? <FloorPlanScreen onBack={handleCloseSubScreen} property={activeProperty} />
          : null
        case 'booking': return <BookingScreen onBack={handleCloseSubScreen} onToast={addToast} />
        case 'packages': return <PackagesScreen onBack={handleCloseSubScreen} onToast={addToast} />
        case 'privileges': return <PrivilegesScreen onBack={handleCloseSubScreen} onToast={addToast} />
      }
    }

    if (selectedRequest) {
      // Refresh from state
      const fresh = getFreshRequest(selectedRequest.id) ?? selectedRequest
      return (
        <RequestDetailScreen
          request={fresh}
          user={user}
          onBack={handleBackFromDetail}
          onTakeInWork={handleTakeInWork}
          onCloseRequest={handleCloseRequest}
          onAssign={(id) => setAssignRequestId(id)}
          onRate={handleRate}
          onSendMessage={handleSendMessage}
        />
      )
    }

    switch (activeTab) {
      case 'dashboard':
        return (
          <DashboardScreen
            requests={requests}
            user={user}
            selectedComplex={selectedComplex}
            onSelectComplex={setSelectedComplex}
            onOpenRequest={handleOpenRequest}
            onNavigateRequests={() => handleNavigate('requests')}
            onCreateRequest={() => setShowCreateRequest(true)}
            onOpenSubScreen={setSubScreen}
            activePropertyId={activePropertyId}
            onSelectProperty={setActivePropertyId}
          />
        )
      case 'requests':
        return (
          <RequestsScreen
            requests={requests}
            user={user}
            selectedComplex={selectedComplex}
            onOpenRequest={handleOpenRequest}
          />
        )
      case 'analytics':
        return <AnalyticsScreen />
      case 'notifications':
        return <NotificationsScreen notifications={notifications} userRole={user.role} />
      case 'profile':
        return <ProfileScreen user={user} onSwitchRole={handleSwitchRole} />
    }
  }

  return (
    <>
      <PhoneFrame onBack={() => navigate('/')} onOpenArchitecture={() => setShowArchitecture(true)} onOpenDiscovery={() => setShowDiscovery(true)}>
        {/* Toast layer */}
        {toasts.length > 0 && <Toast toast={toasts[0]} onDismiss={dismissToast} />}

        {renderScreen()}

        {/* Bottom nav — only when role is selected and not on role screen */}
        {user && !selectedRequest && !subScreen && (
          <BottomNav
            active={activeTab}
            onNavigate={handleNavigate}
            requestsBadge={newRequestsCount}
            notifBadge={unreadNotifs}
            userRole={user.role}
          />
        )}

        {/* Create request modal */}
        {showCreateRequest && (
          <CreateRequestModal
            onClose={() => setShowCreateRequest(false)}
            onSubmit={handleCreateRequest}
          />
        )}

        {/* Assign modal */}
        {assignRequestId && (
          <AssignModal
            onClose={() => setAssignRequestId(null)}
            onAssign={handleAssign}
          />
        )}
      </PhoneFrame>

      {/* Architecture modal — outside phone frame */}
      {showArchitecture && (
        <ArchitectureModal onClose={() => setShowArchitecture(false)} />
      )}

      {/* Discovery modal — outside phone frame */}
      {showDiscovery && (
        <DiscoveryModal onClose={() => setShowDiscovery(false)} />
      )}
    </>
  )
}

====================================================================================================
END: src\pages\SminexDemo.tsx
====================================================================================================

====================================================================================================
END OF BUNDLE
Files: 52
Generated: 2026-02-27 16:42:01
====================================================================================================
